{"id":"scribe-0fq","title":"Refactor ScribeError into specialized error subclasses","description":"**Problem**: `ScribeError` (errors.ts) is the only error class, with all types distinguished by enum. This limits:\n- Pattern matching with `instanceof`\n- Type-safe error handling\n- Extension with domain-specific data\n\n**Missing system error codes in `fromSystemError()`**:\n- EEXIST (file exists)\n- EISDIR (is a directory)\n- ENOTDIR (not a directory)\n- EMFILE/ENFILE (too many open files)\n- ENOTEMPTY (directory not empty)\n\n**Solution**: Introduce subclasses:\n```typescript\nclass FileSystemError extends ScribeError { path: string; }\nclass NoteError extends ScribeError { noteId: NoteId; }\nclass VaultError extends ScribeError { vaultPath: VaultPath; }\nclass EngineError extends ScribeError { engine: string; }\n```\n\n**Files**: packages/shared/src/errors.ts\n**Impact**: Enables `catch (e) { if (e instanceof FileSystemError) ... }` pattern","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:33.416373-06:00","updated_at":"2025-12-12T22:40:04.208069-06:00","closed_at":"2025-12-12T22:40:04.208069-06:00","dependencies":[{"issue_id":"scribe-0fq","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:36.802445-06:00","created_by":"daemon"}]}
{"id":"scribe-0o7","title":"Remove or integrate unused design system primitives","description":"Several design system primitives are exported but never used in the application:\n\n**Unused Primitives:**\n- Input (packages/design-system/src/primitives/Input/)\n- Overlay (packages/design-system/src/primitives/Overlay/)\n- Portal (packages/design-system/src/primitives/Portal/)\n- List (packages/design-system/src/primitives/List/)\n- ListItem (packages/design-system/src/primitives/List/)\n- HistoryIcon (packages/design-system/src/icons/icons.tsx)\n\n**Options:**\n1. Remove unused primitives to reduce bundle size\n2. Document these as 'available for future use'\n3. Integrate them into the application where appropriate\n\n**Files:**\n- packages/design-system/src/primitives/\n- packages/design-system/src/icons/icons.tsx","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:19:40.402099-06:00","updated_at":"2025-12-12T21:19:40.402099-06:00","dependencies":[{"issue_id":"scribe-0o7","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.622773-06:00","created_by":"daemon"}]}
{"id":"scribe-0w9","title":"Code Cleanup \u0026 Technical Debt Reduction","description":"Epic tracking 88 code cleanup issues organized into parallel work tracks.\n\n## Work Tracks\n\n**Track A - Critical Bugs (P1):** scribe-f47, scribe-k5r (race conditions), scribe-ys3 (determinism), scribe-3r5 (memory leak)\n\n**Track B - Main Process:** scribe-930 (IPC refactor) → scribe-5na, scribe-8fq, scribe-0w9.4\n\n**Track C - TaskIndex:** scribe-l59 → scribe-ct6 → scribe-3px → scribe-9jq\n\n**Track D - FileSystemVault:** scribe-8xm, scribe-xub, scribe-1rf, scribe-bk5 (parallel)\n\n**Track E - Plugins:** scribe-9cl → scribe-6my, scribe-bq3, scribe-a0k\n\n**Track F - UI Refactoring:** scribe-1sh → scribe-5lp, scribe-arr; scribe-5es\n\n**Track G - Type System:** scribe-9st, scribe-ncq, scribe-0fq, scribe-zz5 (parallel)\n\n**Track H - Tests:** 20+ test tasks (highly parallel)\n\n**Track I - Design System:** scribe-99n, scribe-3ix, scribe-69x, scribe-rwj\n\n## Execution Order\n1. Track A first (critical bugs)\n2. All other tracks can run in parallel\n3. Within tracks, follow → arrows (blocks dependencies)","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-12T20:59:09.984968-06:00","updated_at":"2025-12-12T21:42:59.236736-06:00"}
{"id":"scribe-0w9.1","title":"Add tests for SlashMenuPlugin interactions","description":"apps/desktop/renderer/src/components/Editor/SlashMenu/SlashMenuPlugin.tsx is 341 lines of trigger detection, query filtering, keyboard handling, and portal rendering logic, but there are zero tests referencing it. Regressions in slash command insertion or menu dismissal will only show up in manual QA. Add unit/integration tests that cover: detecting the '/' trigger at valid positions, updating the query as text changes, handling escape/down/up/enter shortcuts, executing the selected SlashCommand, and preventing retrigger loops via the insertion counter. Mock Lexical editor state so the tests can assert that command actions remove the trigger text and that the menu closes when focus or selection moves away. Also cover the fast-dismiss path when the user types a space after the trigger.","acceptance_criteria":"- Tests fail if trigger detection breaks (e.g., slash typed mid-word)\n- Tests cover keyboard navigation and command execution states\n- Menu dismissal on space/escape and on selection change is verified","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:04.245708-06:00","updated_at":"2025-12-12T21:43:17.282164-06:00","closed_at":"2025-12-12T21:43:17.282164-06:00","dependencies":[{"issue_id":"scribe-0w9.1","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:04.246064-06:00","created_by":"daemon"},{"issue_id":"scribe-0w9.1","depends_on_id":"scribe-yhw","type":"related","created_at":"2025-12-12T21:42:23.234136-06:00","created_by":"daemon"}]}
{"id":"scribe-0w9.2","title":"Add tests for SelectionToolbarPlugin formatting","description":"apps/desktop/renderer/src/components/Editor/SelectionToolbar/SelectionToolbarPlugin.tsx is a 333-line Lexical plugin that positions the floating format toolbar, tracks active marks, and toggles heading transformations, but there is no automated coverage. Bugs in selection detection, toolbar positioning logic, or heading toggling would only surface manually. Add tests that simulate Lexical selections and native selection events to verify: toolbar only appears for non-empty selections, positioning clamps within the viewport, active format state reflects bold/italic/underline/highlight/heading combos, and clicking toolbar buttons dispatches the expected Lexical commands (FORMAT_TEXT_COMMAND, heading conversion back to paragraph, etc.). Also cover the \"Ask AI\" placeholder to ensure it stays a no-op until implemented.","acceptance_criteria":"- Tests fail when toolbar incorrectly appears/disappears for selections\n- Formatting button interactions are asserted via Lexical dispatch mocks\n- Positioning/viewport clamping logic is covered","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:14.533127-06:00","updated_at":"2025-12-12T21:43:17.330099-06:00","closed_at":"2025-12-12T21:43:17.330099-06:00","dependencies":[{"issue_id":"scribe-0w9.2","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:14.533484-06:00","created_by":"daemon"},{"issue_id":"scribe-0w9.2","depends_on_id":"scribe-mii","type":"related","created_at":"2025-12-12T21:42:23.279845-06:00","created_by":"daemon"}]}
{"id":"scribe-0w9.3","title":"Add tests for TableUIPlugin hover controls","description":"apps/desktop/renderer/src/components/Editor/plugins/TableUIPlugin.tsx (417 lines) renders the floating add/delete row \u0026 column controls, but no automated tests assert its hover detection or Lexical mutations. The plugin debounces mousemove events, tracks DOMRects, and issues Lexical table mutations ($insertTableRowAtSelection, $deleteTableColumnAtSelection, etc.). Bugs here would break table editing without failing CI. Add tests that simulate mouse movement near tables to verify the hover zone behavior, ensure we only show add/delete buttons at the edges, and assert that clicking those buttons dispatches the correct Lexical helpers. Include coverage for hiding controls when the cursor leaves the hover zone and for the delete button positioning logic.","acceptance_criteria":"- Table hover simulation tests fail if add/delete buttons render at the wrong times\n- Lexical mutations invoked by insert/delete handlers are asserted\n- Hover-zone timeouts and hide timers are covered","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:19.434307-06:00","updated_at":"2025-12-12T21:43:17.379511-06:00","closed_at":"2025-12-12T21:43:17.379511-06:00","dependencies":[{"issue_id":"scribe-0w9.3","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:19.434648-06:00","created_by":"daemon"},{"issue_id":"scribe-0w9.3","depends_on_id":"scribe-rmk","type":"related","created_at":"2025-12-12T21:42:23.324185-06:00","created_by":"daemon"}]}
{"id":"scribe-0w9.4","title":"Deduplicate preload API surface and renderer type definitions","description":"The preload bridge in apps/desktop/electron/preload/src/preload.ts (378 lines) hand-wires every IPC channel with inline docs, and apps/desktop/renderer/src/types/scribe.d.ts (213 lines) re-declares the same shape so the renderer gets TypeScript support. This duplication is already drifting (e.g., preload exports update.onAvailable/onDownloaded docs that do not exist in the d.ts), and every new IPC endpoint has to be added in two places manually. Extract a shared contract (e.g., a typed interface or literal object in packages/shared) and generate both the preload bridge implementation and the renderer ambient type declarations from it. This ensures the renderer cannot call APIs that the preload layer forgot to expose and eliminates ~200 lines of redundant documentation.","acceptance_criteria":"- Single source of truth defines the Scribe IPC surface\n- Preload bridge imports that contract instead of duplicating docs\n- Renderer ambient types come from the same source (codegen or shared interface)\n- Existing API consumers keep type safety","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:24.267426-06:00","updated_at":"2025-12-12T23:59:41.603286-06:00","closed_at":"2025-12-12T23:59:41.603286-06:00","dependencies":[{"issue_id":"scribe-0w9.4","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:24.267799-06:00","created_by":"daemon"},{"issue_id":"scribe-0w9.4","depends_on_id":"scribe-930","type":"related","created_at":"2025-12-12T21:42:18.072834-06:00","created_by":"daemon"}]}
{"id":"scribe-0zb","title":"Add tests for ErrorBoundary component","description":"ErrorBoundary.tsx has NO tests despite being a critical error handling component.\n\n**Test scenarios:**\n- Error catching and display\n- Error message formatting\n- Recovery/retry functionality\n- Child component rendering when no error\n- Error logging behavior\n\n**Files:**\n- apps/desktop/renderer/src/components/ErrorBoundary/ErrorBoundary.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:27:35.940983-06:00","updated_at":"2025-12-12T23:52:21.543269-06:00","closed_at":"2025-12-12T23:52:21.543269-06:00","dependencies":[{"issue_id":"scribe-0zb","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:41.840474-06:00","created_by":"daemon"}]}
{"id":"scribe-15q","title":"Add concurrent modification tests for TaskIndex","description":"Add tests for concurrent/race condition scenarios in task-index.test.ts:\n- Multiple rapid indexNote() calls on same note\n- Concurrent toggle() calls on same task\n- indexNote() during scheduled persist (debounce timer running)\n- Multiple notes being indexed simultaneously\n- reorder() during indexNote() on overlapping tasks\n\nCurrent tests cover basic CRUD but don't test timing/concurrency edge cases.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:49.468977-06:00","updated_at":"2025-12-12T21:00:49.468977-06:00","dependencies":[{"issue_id":"scribe-15q","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:52.899864-06:00","created_by":"daemon"}]}
{"id":"scribe-1rf","title":"Refactor FileSystemVault: Extract NoteValidator for structure checks","description":"FileSystemVault.isValidNote() (lines 322-385) is a 63-line validation method with complex nested field checks.\n\n**Extract: NoteValidator**\n- Move isValidNote() method entirely\n- Encapsulate all field validation rules\n- Add specific error messages for each validation failure\n\n**Interface:**\n```typescript\ninterface NoteValidator {\n  validate(note: unknown): note is Note\n  validateWithErrors(note: unknown): { valid: boolean; errors: string[] }\n}\n```\n\n**Current validations embedded:**\n- Core fields: id, createdAt, updatedAt, content, metadata\n- Optional title (string if present)\n- Optional tags (array of strings)\n- Optional daily { date: string }\n- Optional meeting { date, dailyNoteId, attendees[] }\n\n**Benefits:**\n- Validation rules documented in one place\n- Easier to add new note types with custom validation\n- Better error reporting for debugging corrupt notes\n- Validation testable without full vault setup","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:49.981406-06:00","updated_at":"2025-12-12T22:45:46.56177-06:00","closed_at":"2025-12-12T22:45:46.56177-06:00","dependencies":[{"issue_id":"scribe-1rf","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:53.428347-06:00","created_by":"daemon"}]}
{"id":"scribe-1sh","title":"Extract App.tsx state and effects into custom hooks","description":"The App.tsx component in apps/desktop/renderer/src/App.tsx is ~635 lines with 20+ useState calls and complex state interdependencies. This makes the component hard to reason about and test.\n\n## Analysis\n\n### State Variables (20+ useState calls, lines 33-52)\n**UI State:**\n- isPaletteOpen, paletteMode (command palette)\n- backlinkResults, showBacklinks (backlinks panel)\n- sidebarOpen, contextPanelOpen (panel visibility)\n- sidebarWidth, contextPanelWidth (panel dimensions)\n- globalError (error display)\n\n**Data State:**\n- historyEntries (navigation history with titles)\n- promptPlaceholder + promptResolverRef (prompt input modal)\n\n**Already Extracted:**\n- noteState (useNoteState hook)\n- navigation (useNavigationHistory hook)\n- theme (useTheme hook)\n- toasts (useToast hook)\n- scroll (useScrollHeader hook)\n\n### Effects and Callbacks\n- Command registration effect (~140 lines, lines 138-279)\n- Keyboard shortcut handler (~60 lines, lines 281-342)\n- handleCommandSelect (~30 lines, lines 345-375)\n- History entries fetching (~25 lines, lines 396-424)\n- Various click/navigation handlers\n\n## Proposed Solution\n\n### 1. useCommandPalette.ts\nExtract command palette state and logic:\n```typescript\nconst {\n  isOpen,\n  mode,\n  promptPlaceholder,\n  open,\n  close,\n  setMode,\n  promptInput,\n  resolvePrompt,\n} = useCommandPalette();\n```\nState: isPaletteOpen, paletteMode, promptPlaceholder, promptResolverRef\n\n### 2. useBacklinks.ts\nExtract backlinks panel state:\n```typescript\nconst {\n  results,\n  isVisible,\n  show,\n  hide,\n  fetchForNote,\n} = useBacklinks();\n```\nState: backlinkResults, showBacklinks\n\n### 3. usePanelState.ts\nExtract side panel state (generic for sidebar and context panel):\n```typescript\nconst sidebar = usePanelState(SIDEBAR_DEFAULT_WIDTH);\nconst contextPanel = usePanelState(CONTEXT_PANEL_DEFAULT_WIDTH);\n// Returns: { isOpen, width, toggle, setWidth }\n```\n\n### 4. useHistoryEntries.ts (or merge into useNavigationHistory)\nExtract history entries with titles fetching:\n```typescript\nconst historyEntries = useHistoryEntries(historyStack, sidebarOpen);\n```\n\n### 5. useAppCommands.ts\nExtract command registration into a hook that returns void but registers commands on mount:\n```typescript\nuseAppCommands({\n  createNote: noteState.createNote,\n  setPaletteMode,\n  resolvedTheme,\n  setTheme,\n  // ... other dependencies\n});\n```\n\n### 6. useAppKeyboardShortcuts.ts\nExtract keyboard shortcut handling:\n```typescript\nuseAppKeyboardShortcuts({\n  isPaletteOpen,\n  setPaletteMode,\n  openPalette,\n  createNote,\n  canGoBack,\n  canGoForward,\n  navigateBack,\n  navigateForward,\n  toggleSidebar,\n  toggleContextPanel,\n});\n```\n\n### Result\nApp.tsx becomes primarily:\n- Hook composition (~50 lines)\n- JSX layout (~150 lines)\n- Total: ~200-250 lines\n\nEach hook is independently testable and has clear responsibility boundaries.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:29.554154-06:00","updated_at":"2025-12-12T21:59:14.754693-06:00","closed_at":"2025-12-12T21:59:14.754693-06:00","dependencies":[{"issue_id":"scribe-1sh","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:32.804009-06:00","created_by":"daemon"}]}
{"id":"scribe-22l","title":"Extract shared traverseNodes() utility from engine packages","description":"The traverseNodes() function for walking Lexical AST trees is duplicated in 3 files:\n- packages/engine-core/src/metadata.ts (lines 170-178)\n- packages/engine-core/src/task-extraction.ts (lines 134-142 as traverseForText, 95-107 as traverseForTasks)  \n- packages/engine-search/src/text-extraction.ts (lines 83-91)\n- apps/desktop/electron/main/src/main.ts (lines 1047-1054)\n\nAll implementations are nearly identical: iterate nodes, call callback, recurse on children.\n\n**Suggested fix**: Create a shared @scribe/shared or @scribe/engine-core/ast-utils module exporting:\n- traverseNodes(nodes, callback) - basic traversal\n- traverseNodesWithAncestors(nodes, callback) - traversal with parent context (for task-extraction)\n- findNodeByKey(nodes, key) - key-based lookup\n- extractTextFromNode(node) - text extraction helper\n\nEstimate: ~1 hour","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:11.92009-06:00","updated_at":"2025-12-13T00:23:01.777216-06:00","closed_at":"2025-12-13T00:23:01.777216-06:00","dependencies":[{"issue_id":"scribe-22l","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:15.843528-06:00","created_by":"daemon"}]}
{"id":"scribe-2wh","title":"Create window.scribe type declaration for tests","description":"Test files extensively mock `window.scribe` API but use 'any' types throughout:\n\n**Pattern in 80+ test locations:**\n```typescript\n(window as any).scribe = {\n  notes: { list: vi.fn(), ... },\n  search: { query: vi.fn(), ... },\n  // etc\n}\n```\n\n**Solution:**\nCreate a proper type declaration:\n\n1. Create `apps/desktop/renderer/src/types/scribe.d.ts`:\n```typescript\ninterface ScribeAPI {\n  notes: {\n    list(): Promise\u003cNote[]\u003e;\n    read(id: NoteId): Promise\u003cNote\u003e;\n    create(note: Partial\u003cNote\u003e): Promise\u003cNote\u003e;\n    save(note: Note): Promise\u003cvoid\u003e;\n    delete(id: NoteId): Promise\u003cvoid\u003e;\n    // ... other methods\n  };\n  search: {\n    query(text: string): Promise\u003cSearchResult[]\u003e;\n  };\n  // ... other namespaces\n}\n\ndeclare global {\n  interface Window {\n    scribe: ScribeAPI;\n  }\n}\n```\n\n2. Update tests to use typed mocks:\n```typescript\nwindow.scribe = {\n  notes: { list: vi.fn\u003c[], Promise\u003cNote[]\u003e\u003e(), ... },\n};\n```\n\n**Impact:** Eliminates ~80 'any' usages in tests, improves test type safety","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:26:38.510129-06:00","updated_at":"2025-12-12T21:26:38.510129-06:00","dependencies":[{"issue_id":"scribe-2wh","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.414327-06:00","created_by":"daemon"}]}
{"id":"scribe-2xy","title":"Deduplicate fadeIn keyframe in design-system","description":"The fadeIn keyframe animation is defined twice in the design system:\n\n1. packages/design-system/src/tokens/animations.css.ts (lines 12-15):\n```typescript\nexport const fadeIn = keyframes({\n  '0%': { opacity: 0 },\n  '100%': { opacity: 1 },\n});\n```\n\n2. packages/design-system/src/primitives/Overlay/Overlay.css.ts (lines 4-7):\n```typescript\nconst fadeIn = keyframes({\n  from: { opacity: 0 },\n  to: { opacity: 1 },\n});\n```\n\nBoth are semantically identical (0%/100% vs from/to).\n\n**Suggested fix**: \n1. Remove the local fadeIn definition in Overlay.css.ts\n2. Import from the shared animations tokens:\n   `import { fadeIn } from '../../tokens/animations.css';`\n\nThis is a small change but establishes the pattern that animation keyframes should come from the token layer.\n\nEstimate: ~15 minutes","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-12T21:01:05.045138-06:00","updated_at":"2025-12-12T21:01:05.045138-06:00","dependencies":[{"issue_id":"scribe-2xy","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:08.117838-06:00","created_by":"daemon"}]}
{"id":"scribe-397","title":"Document hash algorithm in task-extraction.ts","description":"The hash algorithm in task-extraction.ts has minimal documentation.\n\n**computeTextHash (lines 148-158):**\n```typescript\nexport function computeTextHash(text: string): string {\n  // Simple hash implementation based on DJB2 algorithm\n  let hash = 5381;\n  for (let i = 0; i \u003c text.length; i++) {\n    hash = (hash * 33) ^ text.charCodeAt(i);\n  }\n  // Convert to hex and pad/truncate to 16 chars\n  const hexHash = Math.abs(hash).toString(16).padStart(16, '0');\n  return hexHash.slice(0, 16);\n}\n```\n\n**Missing documentation:**\n- Why DJB2 was chosen over other algorithms\n- Collision probability analysis\n- Why 16 characters was chosen\n- Warning about non-cryptographic nature\n- Performance characteristics\n\n**getNodeKey (lines 164-172):**\n- Fallback key generation uses Math.random()\n- When fallback is triggered\n- Consequences of random key generation\n\n**Files:**\n- packages/engine-core/src/task-extraction.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:20:19.15432-06:00","updated_at":"2025-12-12T21:20:19.15432-06:00","dependencies":[{"issue_id":"scribe-397","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.460289-06:00","created_by":"daemon"}]}
{"id":"scribe-3hh","title":"Add circular reference tests for GraphEngine","description":"Add tests for circular link handling in graph-engine.test.ts:\n- A links to B, B links to A (simple bidirectional)\n- A -\u003e B -\u003e C -\u003e A (cycle of 3)\n- Longer cycles (A -\u003e B -\u003e C -\u003e D -\u003e A)\n- neighbors() with circular refs (no infinite loop, no duplicates)\n- backlinks() with circular refs\n- Verify edge counts are correct with cycles\n- removeNote() properly cleans up circular references\n\nCurrent tests have one bidirectional test but don't cover true cycles.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:01:08.059983-06:00","updated_at":"2025-12-12T21:01:08.059983-06:00","dependencies":[{"issue_id":"scribe-3hh","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:11.010536-06:00","created_by":"daemon"}]}
{"id":"scribe-3iq","title":"Add tests for FocusNodePlugin","description":"FocusNodePlugin.tsx (218 lines) has NO tests.\n\n**Functions needing tests:**\n- Node focus/scroll behavior\n- Task focus handling\n- Section focus handling\n- Integration with Lexical editor\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/plugins/FocusNodePlugin.tsx","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:27:13.524717-06:00","updated_at":"2025-12-12T21:27:13.524717-06:00","dependencies":[{"issue_id":"scribe-3iq","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:20.878639-06:00","created_by":"daemon"}]}
{"id":"scribe-3ix","title":"Extract inline style objects to CSS/design tokens in widget components","description":"TasksWidget.tsx:42, AttendeesWidget.tsx:44, and ReferencesWidget.tsx:124 create new style objects on every render (e.g., style={{ color: '#22c55e' }}). This causes unnecessary object allocations and re-renders. Additionally, these use hardcoded hex colors (#22c55e, #10b981, #8b5cf6) instead of design tokens. Fix: Move styles to CSS classes using design system color tokens.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:50.032793-06:00","updated_at":"2025-12-12T22:45:47.314936-06:00","closed_at":"2025-12-12T22:45:47.314936-06:00","dependencies":[{"issue_id":"scribe-3ix","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:53.361114-06:00","created_by":"daemon"},{"issue_id":"scribe-3ix","depends_on_id":"scribe-99n","type":"related","created_at":"2025-12-12T21:42:11.451441-06:00","created_by":"daemon"}]}
{"id":"scribe-3px","title":"Extract TaskIndex.indexNote() reconciliation logic into helper functions","description":"The indexNote() method in packages/engine-core/src/task-index.ts (lines 162-258) is ~97 lines of dense reconciliation logic that handles multiple responsibilities.\n\n## Analysis\n\nThe method performs these distinct operations:\n1. **Task extraction** (line 167-171): Calls extractTasksFromNote()\n2. **Index snapshot** (lines 173-188): Creates lookup maps for existing tasks by nodeKey and textHash\n3. **Matching tracking** (lines 190-197): Setup for tracking matched/new tasks\n4. **Reconciliation loop** (lines 199-235): Main loop that:\n   - Finds existing tasks by nodeKey or textHash fallback\n   - Either updates existing or creates new tasks\n   - Manages byNote index updates\n5. **Orphan removal** (lines 237-249): Removes tasks no longer in note\n6. **Persistence trigger** (lines 251-257): Marks dirty and schedules persist\n\n### Complexity Issues\n- The method is doing 6 distinct things in sequence\n- The reconciliation loop has nested conditionals for match finding\n- Index management (byNote) is interleaved with business logic\n- Hard to unit test individual reconciliation rules\n\n## Proposed Solution\n\nExtract into focused helper functions:\n\n### 1. buildExistingTaskMaps()\n```typescript\nfunction buildExistingTaskMaps(tasks: Map\u003cstring, Task\u003e, taskIds: Set\u003cstring\u003e): {\n  byNodeKey: Map\u003cstring, Task\u003e;\n  byTextHash: Map\u003cstring, Task\u003e;\n}\n```\nExtracts lines 177-188.\n\n### 2. findMatchingTask()\n```typescript\nfunction findMatchingTask(\n  ext: ExtractedTask,\n  byNodeKey: Map\u003cstring, Task\u003e,\n  byTextHash: Map\u003cstring, Task\u003e\n): Task | undefined\n```\nExtracts the matching logic from lines 201-207.\n\n### 3. processExtractedTasks()\n```typescript\nfunction processExtractedTasks(\n  extracted: ExtractedTask[],\n  existingMaps: { byNodeKey; byTextHash },\n  maxPriority: number,\n  now: number\n): {\n  toUpdate: Task[];\n  toAdd: Task[];\n  matchedIds: Set\u003cstring\u003e;\n}\n```\nExtracts lines 199-235 into a pure function that returns what to do.\n\n### 4. findOrphanedTaskIds()\n```typescript\nfunction findOrphanedTaskIds(\n  existingIds: Set\u003cstring\u003e,\n  matchedIds: Set\u003cstring\u003e\n): string[]\n```\nSimple set difference, extracts the logic from lines 239-249.\n\n### Refactored indexNote()\n```typescript\nindexNote(note: Note): TaskChangeEvent[] {\n  const changes: TaskChangeEvent[] = [];\n  const now = Date.now();\n  \n  const extracted = extractTasksFromNote(note);\n  const existingIds = new Set(this.byNote.get(note.id) ?? []);\n  const existingMaps = buildExistingTaskMaps(this.tasks, existingIds);\n  \n  const { toUpdate, toAdd, matchedIds } = processExtractedTasks(\n    extracted,\n    existingMaps,\n    this.getMaxPriority(),\n    now\n  );\n  \n  // Apply updates\n  for (const task of toUpdate) {\n    this.tasks.set(task.id, task);\n    changes.push({ type: 'updated', task });\n  }\n  \n  // Apply additions\n  for (const task of toAdd) {\n    this.addTaskToIndex(task);\n    changes.push({ type: 'added', task });\n  }\n  \n  // Remove orphans\n  for (const taskId of findOrphanedTaskIds(existingIds, matchedIds)) {\n    this.removeTaskFromIndex(taskId, note.id);\n    changes.push({ type: 'removed', taskId });\n  }\n  \n  if (changes.length \u003e 0) {\n    this.dirty = true;\n    this.schedulePersist();\n  }\n  \n  return changes;\n}\n```\n\nBenefits:\n- Each helper is pure and easily unit testable\n- Reconciliation rules are explicit and documented\n- Main method is readable at a high level (~30 lines)\n- Index management is isolated in addTaskToIndex/removeTaskFromIndex","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:53.323898-06:00","updated_at":"2025-12-12T23:14:11.04001-06:00","closed_at":"2025-12-12T23:14:11.04001-06:00","dependencies":[{"issue_id":"scribe-3px","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:56.517999-06:00","created_by":"daemon"}]}
{"id":"scribe-3r5","title":"Fix memory leak: setInterval not cleared in auto-updater.ts","description":"In auto-updater.ts lines 70-74, setInterval() creates a periodic update check but the interval ID is never stored or cleared. If setupAutoUpdater() is called multiple times (e.g., window recreation, hot reload), intervals accumulate causing: 1) Multiple concurrent update checks, 2) Memory leak from retained closures, 3) Potential race conditions. Fix: Store interval ID at module level, clear existing interval before creating new one, and/or add cleanup function.","acceptance_criteria":"- Interval ID stored at module level\n- clearInterval() called before creating new interval\n- Add cleanup function exported for testing\n- Unit test verifies only one interval active after multiple setupAutoUpdater() calls","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T21:01:05.066027-06:00","updated_at":"2025-12-12T21:52:35.492997-06:00","closed_at":"2025-12-12T21:52:35.492997-06:00","dependencies":[{"issue_id":"scribe-3r5","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:07.905344-06:00","created_by":"daemon"}]}
{"id":"scribe-4pv","title":"Fix any type usage in TaskItem drag-and-drop","description":"TaskItem.tsx uses 'any' type for drag-and-drop attributes:\n\n**Location:** apps/desktop/renderer/src/components/Tasks/TaskItem.tsx\n\n**Code (lines 54-57):**\n```typescript\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nattributes: any;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nlisteners: any;\n```\n\n**Root Cause:**\nThe @dnd-kit library types are not being used properly.\n\n**Solution:**\nImport proper types from @dnd-kit/core:\n```typescript\nimport { DraggableAttributes } from '@dnd-kit/core';\nimport { SyntheticListenerMap } from '@dnd-kit/core/dist/hooks/utilities';\n\ninterface TaskItemProps {\n  attributes: DraggableAttributes;\n  listeners: SyntheticListenerMap | undefined;\n  // ...\n}\n```\n\n**Impact:** Removes eslint-disable comments, improves type safety","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:22.466077-06:00","updated_at":"2025-12-12T23:46:29.221218-06:00","closed_at":"2025-12-12T23:46:29.221218-06:00","dependencies":[{"issue_id":"scribe-4pv","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.312276-06:00","created_by":"daemon"}]}
{"id":"scribe-52x","title":"Add tests for Sidebar component","description":"Sidebar.tsx (161 lines) and related components have NO tests.\n\n**Files needing tests:**\n- apps/desktop/renderer/src/components/Sidebar/Sidebar.tsx (161 lines)\n- apps/desktop/renderer/src/components/Sidebar/HistoryListItem.tsx\n\n**Test scenarios:**\n- Sidebar open/close toggle\n- History list rendering\n- Note selection from history\n- Resize handle behavior\n- Empty state rendering\n\n**Files:**\n- apps/desktop/renderer/src/components/Sidebar/*","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:27:24.299984-06:00","updated_at":"2025-12-12T21:27:24.299984-06:00","dependencies":[{"issue_id":"scribe-52x","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:33.272302-06:00","created_by":"daemon"}]}
{"id":"scribe-5es","title":"Create useErrorHandler hook for consistent error handling","description":"Error handling is inconsistent across 24+ locations with repeated pattern:\n```typescript\nconsole.error('Failed to \u003caction\u003e:', error);\n```\n\n**Files with repeated pattern:**\n- TasksWidget.tsx (4 occurrences)\n- TasksScreen.tsx (4 occurrences)\n- CommandPalette.tsx (3 occurrences)\n- ContextPanel.tsx (2 occurrences)\n- PersonMentionAutocomplete.tsx, PersonMentionPlugin.tsx, AttendeesWidget.tsx, etc.\n\n**Issues:**\n1. No centralized error handling\n2. Inconsistent error message formatting\n3. ScribeError.getUserMessage() exists but isn't used in UI\n4. Errors only logged to console - no user feedback\n\n**Solution:**\nCreate `useErrorHandler` hook:\n```typescript\nfunction useErrorHandler() {\n  const { showToast } = useToast();\n  \n  return useCallback((error: unknown, context?: string) =\u003e {\n    const message = error instanceof ScribeError \n      ? error.getUserMessage()\n      : 'An unexpected error occurred';\n    \n    console.error(context ? `${context}:` : 'Error:', error);\n    showToast({ message, type: 'error' });\n  }, [showToast]);\n}\n```\n\n**Files:**\n- New: apps/desktop/renderer/src/hooks/useErrorHandler.ts\n- Update: All files with console.error patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:25:45.260291-06:00","updated_at":"2025-12-12T21:59:15.149346-06:00","closed_at":"2025-12-12T21:59:15.149346-06:00","dependencies":[{"issue_id":"scribe-5es","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.013691-06:00","created_by":"daemon"}]}
{"id":"scribe-5lp","title":"Refactor CommandPalette props drilling with React context or composition","description":"App.tsx passes 15+ props to CommandPalette (lines 518-564) including method callbacks like onCommandSelect, onSearchResultSelect, onNoteSelect, onModeChange, showToast, noteState object with 5 methods, onPromptSubmit, onPromptCancel. This creates tight coupling and makes the component harder to maintain. Consider: 1) CommandPaletteContext for shared state/callbacks, 2) Composition pattern with specialized sub-components, 3) Custom hooks for related functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:57.257181-06:00","updated_at":"2025-12-12T23:14:12.670145-06:00","closed_at":"2025-12-12T23:14:12.670145-06:00","dependencies":[{"issue_id":"scribe-5lp","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:00.673922-06:00","created_by":"daemon"},{"issue_id":"scribe-5lp","depends_on_id":"scribe-1sh","type":"blocks","created_at":"2025-12-12T21:42:09.614506-06:00","created_by":"daemon"}]}
{"id":"scribe-5na","title":"Add tests for main.ts IPC handlers","description":"CRITICAL: apps/desktop/electron/main/src/main.ts (1216 lines) has NO tests. This file contains ALL IPC handlers for the application.\n\n**Missing Test Coverage:**\n- notes:* handlers (CRUD, findByDate, findByTitle)\n- search:* handlers\n- graph:* handlers  \n- tasks:* handlers (toggle, list, update)\n- people:* handlers\n- daily/meeting note creation handlers\n- Helper functions: toggleChecklistNode, createPersonContent, etc.\n\n**Priority:** This is the most critical test coverage gap - all data operations flow through these handlers.\n\n**Recommendation:** \n1. Extract IPC handlers into separate testable modules (see scribe-930)\n2. Add integration tests for each handler category\n3. Add unit tests for helper functions\n\n**Files:**\n- apps/desktop/electron/main/src/main.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T21:19:02.613563-06:00","updated_at":"2025-12-12T22:11:59.247223-06:00","closed_at":"2025-12-12T22:11:59.247223-06:00","dependencies":[{"issue_id":"scribe-5na","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:24.60974-06:00","created_by":"daemon"},{"issue_id":"scribe-5na","depends_on_id":"scribe-930","type":"blocks","created_at":"2025-12-12T21:41:45.555226-06:00","created_by":"daemon"}]}
{"id":"scribe-5v4","title":"Replace console.log with proper logging in main.ts","description":"main.ts (1215 lines) has 12 console.log statements that should be replaced with a proper logging system:\n\n**Startup diagnostics (lines 66-103):**\n- 'Vault initialized at:', vaultPath\n- 'Loaded ${noteCount} notes from vault'\n- 'Graph initialized with ${notes.length} notes'\n- 'Search index initialized with ${searchEngine.size()} notes'\n- 'Task index initialized with ${taskIndex.size} tasks'\n- 'Graph stats: ${stats.nodes} nodes, ${stats.edges} edges, ${stats.tags} tags'\n- 'Task index flushed successfully' (line 1210)\n\n**Debug logging (line 217 in App.tsx):**\n- 'Backlinks for current note:', backlinks\n\n**Solution:**\n1. Create a Logger class with log levels (debug, info, warn, error)\n2. Use DEBUG/INFO for startup diagnostics\n3. Disable debug logs in production builds\n4. Consider writing logs to file for debugging production issues\n\n**Files:**\n- apps/desktop/electron/main/src/main.ts\n- apps/desktop/renderer/src/App.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:25:29.826795-06:00","updated_at":"2025-12-12T23:36:33.822569-06:00","closed_at":"2025-12-12T23:36:33.822569-06:00","dependencies":[{"issue_id":"scribe-5v4","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:44.912439-06:00","created_by":"daemon"},{"issue_id":"scribe-5v4","depends_on_id":"scribe-5es","type":"related","created_at":"2025-12-12T21:42:05.318567-06:00","created_by":"daemon"}]}
{"id":"scribe-69x","title":"Add emptyState primitive to design system","description":"The `emptyState` style is duplicated 9 times across the codebase:\n\n**Files with duplicate emptyState:**\n1. ContextPanel.css.ts (line 292)\n2. ReferencesWidget.css.ts (line 100)\n3. AttendeesWidget.css.ts (line 257)\n4. Sidebar.css.ts (line 146)\n5. DraggableTaskList.css.ts (line 22)\n6. WikiLinkAutocomplete.css.ts (line 94)\n7. PersonMentionAutocomplete.css.ts (line 98)\n8. SlashMenu.css.ts (line 82)\n9. TasksScreen.css.ts (line 73)\n\n**Common Pattern:**\n```typescript\nexport const emptyState = style({\n  fontSize: vars.typography.size.sm,\n  color: vars.color.foregroundMuted,\n  padding: vars.spacing['2'] || vars.spacing['4'],\n  textAlign: 'center',\n  fontStyle: 'italic', // in some cases\n});\n```\n\n**Solution:**\nAdd to design system primitives:\n```typescript\n// packages/design-system/src/primitives/States/\nexport const emptyState = style({ ... });\nexport const loadingState = style({ ... });\n```\n\n**Estimated savings:** ~45 lines","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:18:53.296415-06:00","updated_at":"2025-12-12T21:18:53.296415-06:00","dependencies":[{"issue_id":"scribe-69x","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.945071-06:00","created_by":"daemon"}]}
{"id":"scribe-6my","title":"Extract useAutocompletePlugin hook from WikiLinkPlugin and PersonMentionPlugin","description":"~300 lines of autocomplete plugin logic are duplicated between:\n- apps/desktop/renderer/src/components/Editor/plugins/WikiLinkPlugin.tsx (424 lines)\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx (427 lines)\n\nBoth plugins share identical patterns for:\n1. Trigger state management (isActive, startOffset, anchorKey, query) \n2. Autocomplete state (isOpen, query, results, selectedIndex, position, isLoading)\n3. Debounced search with timeout refs\n4. Cursor position calculation from DOM selection\n5. Keyboard navigation (ArrowUp/Down, Enter/Tab, Escape)\n6. Lexical update listener for trigger detection\n7. Command registration for insertion\n8. Portal rendering of autocomplete dropdown\n\n**Suggested fix**: Create a useAutocompletePlugin hook that abstracts:\n- Trigger character detection (configurable: '[[' vs '@')\n- State management for trigger and autocomplete\n- Keyboard navigation handlers\n- Position calculation\n- Debounced search integration\n\nEach plugin would then only define:\n- Trigger pattern\n- Search function\n- Node creation logic\n- Custom autocomplete UI component\n\nEstimate: ~3 hours","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:26.020958-06:00","updated_at":"2025-12-13T00:20:55.788351-06:00","closed_at":"2025-12-13T00:20:55.788351-06:00","dependencies":[{"issue_id":"scribe-6my","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:29.038723-06:00","created_by":"daemon"},{"issue_id":"scribe-6my","depends_on_id":"scribe-9cl","type":"blocks","created_at":"2025-12-12T21:42:03.534113-06:00","created_by":"daemon"}]}
{"id":"scribe-6tq","title":"Extract magic numbers to constants in engine-core and engine-search packages","description":"Extract hardcoded magic numbers to named constants for better maintainability:\n\n**engine-core/src/metadata.ts:49**\n- `slice(0, 200)` - MAX_TITLE_LENGTH for title truncation\n\n**engine-core/src/task-extraction.ts:151-157**\n- `5381` - DJB2_HASH_INITIAL (DJB2 hash algorithm initial value)\n- `33` - DJB2_HASH_MULTIPLIER\n- `16` - TEXT_HASH_LENGTH (hex characters for hash)\n\n**engine-search/src/search-engine.ts**\n- Line 96: `1000` - MAX_INDEXED_CONTENT_LENGTH\n- Line 239, 252: `160` - SNIPPET_MAX_LENGTH\n- Line 248: `80` - SNIPPET_CONTEXT_RADIUS\n- Lines 221-225: Field weights (10, 5, 1) - SEARCH_WEIGHT_TITLE, SEARCH_WEIGHT_TAGS, SEARCH_WEIGHT_CONTENT\n\nConsider creating a constants.ts file in each package or a shared config.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:16.874344-06:00","updated_at":"2025-12-13T00:22:21.919178-06:00","closed_at":"2025-12-13T00:22:21.919178-06:00","dependencies":[{"issue_id":"scribe-6tq","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:20.838992-06:00","created_by":"daemon"}]}
{"id":"scribe-6vz","title":"Add tests for packages/shared utility functions","description":"packages/shared/src/ has NO tests despite containing utility functions used throughout the codebase.\n\n**Files needing tests:**\n\n**types.ts (functions):**\n- serializeTaskId(noteId, nodeKey) - serializes task identifiers\n- parseTaskId(taskId) - parses task ID back to components\n- isSystemNoteId(id) - checks for system note IDs\n\n**errors.ts (104 lines):**\n- ScribeError class methods\n- getUserMessage() - user-friendly error messages\n- fromSystemError() - converts system errors to ScribeError\n- Error code mapping for ENOENT, EACCES, ENOSPC, etc.\n\n**Impact:** These utilities are used across all packages and the desktop app.\n\n**Files:**\n- packages/shared/src/types.ts\n- packages/shared/src/errors.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:19:12.446752-06:00","updated_at":"2025-12-12T23:25:37.363021-06:00","closed_at":"2025-12-12T23:25:37.363021-06:00","dependencies":[{"issue_id":"scribe-6vz","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:25.021332-06:00","created_by":"daemon"}]}
{"id":"scribe-782","title":"Add tests for useTaskSubscription hook","description":"apps/desktop/renderer/src/hooks/useTaskSubscription.ts (120 lines) has NO tests.\n\n**What needs testing:**\n- Task change event subscription\n- Event batching behavior\n- Cleanup on unmount\n- Filtering by note ID\n- Debouncing behavior\n\n**Files:**\n- apps/desktop/renderer/src/hooks/useTaskSubscription.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:19:18.214183-06:00","updated_at":"2025-12-12T21:19:18.214183-06:00","dependencies":[{"issue_id":"scribe-782","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.892663-06:00","created_by":"daemon"}]}
{"id":"scribe-7id","title":"Extract shared widget card styles in ContextPanel components","description":"Context panel widget components have duplicated card styles (~60 lines duplicated):\n\n**Duplicated Files:**\n- ContextPanel.css.ts (lines 82-134)\n- ReferencesWidget.css.ts (lines 14-45)\n- AttendeesWidget.css.ts (lines 14-46)\n\n**Duplicated Patterns:**\n- `card` style (backgroundColor, borderRadius, padding, marginBottom, boxShadow, border, transition)\n- `cardHeader` style (display: flex, alignItems, gap, marginBottom, color, fontWeight)\n- `cardIcon` style (width, height, flexShrink)\n- `cardTitle` style (fontSize)\n\n**Solution:**\nExtract to shared styles:\n```typescript\n// ContextPanel/shared.css.ts\nexport const widgetCard = style({ ... });\nexport const widgetCardHeader = style({ ... });\n```\n\n**Estimated savings:** ~60 lines","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:18:32.700848-06:00","updated_at":"2025-12-12T21:18:32.700848-06:00","dependencies":[{"issue_id":"scribe-7id","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:27.101058-06:00","created_by":"daemon"}]}
{"id":"scribe-8c8","title":"quarantineFile() silently fails, leaving corrupt files in place","description":"In packages/storage-fs/src/storage.ts lines 77-79, quarantineFile() logs an error but continues silently if file move fails. Corrupt files remain in notes directory and will cause repeated parse failures on each startup. Should propagate error or retry with alternative strategy.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T20:59:57.995945-06:00","updated_at":"2025-12-12T22:12:02.080995-06:00","closed_at":"2025-12-12T22:12:02.080995-06:00","dependencies":[{"issue_id":"scribe-8c8","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:10.823603-06:00","created_by":"daemon"}]}
{"id":"scribe-8f8","title":"Fix any type usage in SearchEngine","description":"SearchEngine uses 'any' type assertions when working with MiniSearch results:\n\n**Location:** packages/engine-search/src/search-engine.ts\n\n**Code (lines 141, 149):**\n```typescript\n// Line 141\nresults as any[]\n\n// Line 149\n(item as any).doc as SearchDocument\n```\n\n**Root Cause:**\nMiniSearch's TypeScript types may not be properly parameterized.\n\n**Solution:**\n1. Configure MiniSearch with proper generic types:\n```typescript\nconst miniSearch = new MiniSearch\u003cSearchDocument\u003e({\n  // options\n});\n```\n\n2. Create proper type for search results:\n```typescript\ninterface MiniSearchResult {\n  id: string;\n  score: number;\n  match: Record\u003cstring, string[]\u003e;\n  doc?: SearchDocument;\n}\n```\n\n**Impact:** Removes type unsafety in search results handling","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:31.032684-06:00","updated_at":"2025-12-12T23:52:18.526432-06:00","closed_at":"2025-12-12T23:52:18.526432-06:00","dependencies":[{"issue_id":"scribe-8f8","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.363967-06:00","created_by":"daemon"}]}
{"id":"scribe-8fq","title":"Document IPC handler contracts in main.ts","description":"apps/desktop/electron/main/src/main.ts (1216 lines) contains all IPC handlers but they lack documentation.\n\n**Needs documentation:**\n\n**Handler Categories:**\n- notes:* (CRUD, findByDate, findByTitle) - parameter validation, return types, error codes\n- search:* - query syntax, result format\n- graph:* - node/edge semantics\n- tasks:* - toggle behavior, state transitions\n- people:* - auto-creation behavior\n- daily/meeting notes - creation rules, date handling\n\n**Helper Functions:**\n- toggleChecklistNode (lines 977-1026) - fallback chain algorithm, mutation semantics\n- createPersonContent - content structure\n- Date handling logic (lines 381-427) - format expectations, filtering rules\n\n**Business Logic:**\n- Title matching precedence (lines 359-378)\n- Daily note creation timing (noon timezone fix, lines 686-704)\n- Meeting note auto-creation (lines 740-771)\n\n**Files:**\n- apps/desktop/electron/main/src/main.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:20:02.513951-06:00","updated_at":"2025-12-12T23:36:32.713206-06:00","closed_at":"2025-12-12T23:36:32.713206-06:00","dependencies":[{"issue_id":"scribe-8fq","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:24.858138-06:00","created_by":"daemon"},{"issue_id":"scribe-8fq","depends_on_id":"scribe-930","type":"blocks","created_at":"2025-12-12T21:42:18.118171-06:00","created_by":"daemon"}]}
{"id":"scribe-8xm","title":"Refactor FileSystemVault: Extract AtomicFileWriter for safe I/O","description":"FileSystemVault.atomicWrite() (lines 285-314) implements crash-safe file writing that could be reused across the codebase.\n\n**Extract: AtomicFileWriter**\n- Move atomicWrite() method (temp file → fsync → rename pattern)\n- Make reusable for any file type (not just notes)\n- Handle temp file cleanup on errors\n\n**Interface:**\n```typescript\ninterface AtomicFileWriter {\n  write(filePath: string, content: string): Promise\u003cvoid\u003e\n  writeJSON\u003cT\u003e(filePath: string, data: T): Promise\u003cvoid\u003e\n}\n```\n\n**Current implementation details:**\n- Creates .filename.tmp in same directory\n- Writes content to temp file\n- Opens file handle, calls sync()\n- Atomic rename to final path\n- Cleanup temp on error\n\n**Benefits:**\n- Reusable by TaskPersistence (also uses temp+rename)\n- Consistent crash-safety across all file writes\n- Single place to tune fsync behavior\n- Could add options for sync frequency","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:59.588403-06:00","updated_at":"2025-12-12T23:14:13.539718-06:00","closed_at":"2025-12-12T23:14:13.539718-06:00","dependencies":[{"issue_id":"scribe-8xm","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:02.816232-06:00","created_by":"daemon"},{"issue_id":"scribe-8xm","depends_on_id":"scribe-xub","type":"related","created_at":"2025-12-12T21:41:57.738506-06:00","created_by":"daemon"}]}
{"id":"scribe-930","title":"Refactor setupIPCHandlers() into domain-specific handler modules","description":"The setupIPCHandlers() function in apps/desktop/electron/main/src/main.ts is ~710 lines and handles 8+ distinct domains in a single monolithic function. This violates single responsibility and makes the main process hard to navigate.\n\n## Analysis\n\nThe function contains IPC handlers for these distinct domains:\n1. **Notes CRUD** (lines 246-458): list, read, create, save, delete, findByTitle, findByDate, searchTitles\n2. **Search** (lines 460-466): query handler\n3. **Graph** (lines 468-490): forNote, backlinks, notesWithTag handlers\n4. **People** (lines 492-558): list, create, search handlers\n5. **App/Config** (lines 560-603): openDevTools, getLastOpenedNote, setLastOpenedNote, getConfig, setConfig, shell:openExternal\n6. **Dictionary/Spellcheck** (lines 607-659): addWord, removeWord, getLanguages, setLanguages, getAvailableLanguages\n7. **Daily Notes** (lines 661-718): getOrCreate, find handlers\n8. **Meeting Notes** (lines 720-835): create, addAttendee, removeAttendee handlers\n9. **Tasks** (lines 837-949): toggle, list, get, reorder handlers\n\n## Proposed Solution\n\nExtract each domain into its own handler module under electron/main/src/handlers/:\n\n- notesHandlers.ts - Notes CRUD operations\n- searchHandlers.ts - Search operations\n- graphHandlers.ts - Graph traversal operations\n- peopleHandlers.ts - People management\n- appHandlers.ts - App config and shell operations\n- dictionaryHandlers.ts - Spellcheck dictionary management\n- dailyHandlers.ts - Daily note operations\n- meetingHandlers.ts - Meeting note operations\n- tasksHandlers.ts - Task operations\n\nEach handler module should:\n1. Export a setup function that receives dependencies (vault, graphEngine, searchEngine, taskIndex, mainWindow)\n2. Register its own IPC handlers\n3. Handle its own error wrapping\n\nThis reduces main.ts to ~100-150 lines of initialization and handler registration.","acceptance_criteria":"- Create handlers/ directory under electron/main/src/\n- Each domain module exports setup function taking (vault, graphEngine, searchEngine, taskIndex, mainWindow)\n- main.ts reduced to \u003c200 lines of initialization\n- All existing IPC channels still work (no breaking changes)\n- Each handler module has own error wrapping","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T20:59:44.950606-06:00","updated_at":"2025-12-12T21:59:13.438445-06:00","closed_at":"2025-12-12T21:59:13.438445-06:00","dependencies":[{"issue_id":"scribe-930","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T20:59:48.996334-06:00","created_by":"daemon"}]}
{"id":"scribe-95c","title":"Adopt useErrorHandler hook in existing components","description":"Follow-up to scribe-5es. Update components to use the new useErrorHandler hook instead of raw console.error calls.\n\n**Prerequisites:**\n- Toast context or showToast prop must be available in components\n- May depend on App.tsx refactoring (scribe-1sh) to establish patterns\n\n**Components to update (when showToast is available):**\n- TasksWidget.tsx (4 occurrences)\n- TasksScreen.tsx (4 occurrences)  \n- CommandPalette.tsx (3 occurrences)\n- ContextPanel.tsx (2 occurrences)\n- useNoteState.ts (6 occurrences)\n- PersonMentionAutocomplete.tsx, PersonMentionPlugin.tsx\n- WikiLinkNode.ts, PersonMentionNode.ts\n- LinkClickPlugin.tsx, InitialStatePlugin.tsx\n- AttendeesWidget.tsx\n- App.tsx (2 occurrences)\n- index.tsx (2 occurrences)\n- commands/people.ts\n\n**Pattern:**\n```typescript\n// Before\nconsole.error('Failed to load tasks:', error);\n\n// After\nhandleError(error, 'Failed to load tasks');\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:57:08.593365-06:00","updated_at":"2025-12-12T21:57:08.593365-06:00","dependencies":[{"issue_id":"scribe-95c","depends_on_id":"scribe-5es","type":"discovered-from","created_at":"2025-12-12T21:57:08.593841-06:00","created_by":"daemon"}]}
{"id":"scribe-99n","title":"Migrate inline SVG icons to design system","description":"Multiple components define inline SVG icons instead of using the design system's Lucide icons:\n\n**Files with inline SVGs:**\n- TasksWidget.tsx: CheckCircleIcon\n- ReferencesWidget.tsx: ExternalLinkIcon, ReferenceIcon\n- AttendeesWidget.tsx: AttendeesIcon (Users icon)\n- LinkedMentions.tsx: FileTextIcon, LinkIcon, ChevronIcon\n- CalendarWidget.tsx: CalendarIcon, ClockIcon\n- TaskItem.tsx: CheckmarkIcon, GripIcon\n\n**Issues:**\n1. Duplicate icon definitions across files\n2. Inconsistent sizing/styling\n3. Design system already exports Lucide icons from @scribe/design-system\n\n**Solution:**\n1. Add missing icons to packages/design-system/src/icons/icons.tsx:\n   - ExternalLink, CheckCircle, Users, Clock, ChevronDown, ChevronUp, GripVertical\n2. Replace all inline SVG components with design system imports\n3. Create colored icon wrapper if needed for widget headers\n\n**Estimated savings:** ~100 lines of duplicate SVG code","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:25:37.247008-06:00","updated_at":"2025-12-12T23:46:26.295506-06:00","closed_at":"2025-12-12T23:46:26.295506-06:00","dependencies":[{"issue_id":"scribe-99n","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:44.963748-06:00","created_by":"daemon"}]}
{"id":"scribe-9cl","title":"Extract shared TriggerableAutocompletePlugin base from WikiLinkPlugin and PersonMentionPlugin","description":"WikiLinkPlugin.tsx (424 lines) and PersonMentionPlugin.tsx (427 lines) share nearly identical patterns:\n\n**Duplicated Code (~300 lines):**\n- TriggerState interface (identical in both)\n- Autocomplete state management (isOpen, query, position, selectedIndex, results, isLoading)\n- Insert command pattern (INSERT_WIKILINK_COMMAND vs INSERT_PERSON_MENTION_COMMAND)\n- Keyboard navigation logic (ArrowUp/ArrowDown/Enter/Tab handling)\n- Update listener registration with text detection\n- Escape key handling\n\n**Solution:**\nCreate an abstract `TriggerableAutocompletePlugin` base that handles:\n- Trigger detection pattern (customizable trigger char: `[[` vs `@`)\n- Autocomplete state management\n- Keyboard navigation\n- Escape handling\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/plugins/WikiLinkPlugin.tsx\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx\n\n**Estimated savings:** ~300 lines of duplicated code","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:18:07.237611-06:00","updated_at":"2025-12-12T23:19:22.243229-06:00","closed_at":"2025-12-12T23:19:22.243229-06:00","dependencies":[{"issue_id":"scribe-9cl","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:25.247247-06:00","created_by":"daemon"}]}
{"id":"scribe-9jq","title":"Refactor TaskIndex: Extract TaskQuery for filtering/pagination","description":"TaskIndex.list() (lines 294-368) bundles filtering, sorting, and cursor pagination into one 74-line method.\n\n**Extract: TaskQuery**\n- Move list() filtering logic (lines 298-325)\n- Move sorting logic (lines 328-347)\n- Move cursor encode/decode (lines 571-586)\n- Move pagination slicing (lines 350-367)\n\n**Interface:**\n```typescript\ninterface TaskQuery {\n  execute(\n    tasks: Iterable\u003cTask\u003e,\n    filter?: TaskFilter\n  ): { tasks: Task[]; nextCursor?: string }\n}\n```\n\n**Current filters embedded in method:**\n- completed (boolean)\n- noteId (string)\n- createdAfter/createdBefore (number)\n- completedAfter/completedBefore (number)\n- sortBy: 'priority' | 'createdAt'\n- sortOrder: 'asc' | 'desc'\n- cursor-based pagination\n\n**Benefits:**\n- Query logic reusable across different indexes\n- Cursor encoding strategy swappable\n- Filter composition becomes easier to extend","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:41.702488-06:00","updated_at":"2025-12-12T23:25:35.213319-06:00","closed_at":"2025-12-12T23:25:35.213319-06:00","dependencies":[{"issue_id":"scribe-9jq","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:45.074193-06:00","created_by":"daemon"},{"issue_id":"scribe-9jq","depends_on_id":"scribe-3px","type":"blocks","created_at":"2025-12-12T21:41:54.795116-06:00","created_by":"daemon"}]}
{"id":"scribe-9nb","title":"Extract magic strings and values in storage-fs and desktop app","description":"Extract hardcoded magic strings and values to named constants:\n\n**storage-fs/src/storage.ts**\n- Lines 183, 229, 426: `'Untitled'` repeated 3 times - DEFAULT_NOTE_TITLE\n- Consider exporting from @scribe/shared for consistency across packages\n\n**desktop/electron/main/src/main.ts:1086-1087**\n- `1200` - DEFAULT_WINDOW_WIDTH\n- `800` - DEFAULT_WINDOW_HEIGHT\n- Line 1089: `{ x: 16, y: 16 }` - TRAFFIC_LIGHT_POSITION\n\nThese should be moved to a config/constants file for easy adjustment and documentation.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:27.613762-06:00","updated_at":"2025-12-13T00:22:39.010307-06:00","closed_at":"2025-12-13T00:22:39.010307-06:00","dependencies":[{"issue_id":"scribe-9nb","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:30.651525-06:00","created_by":"daemon"}]}
{"id":"scribe-9st","title":"Introduce branded types for NoteId and VaultPath","description":"**Problem**: `NoteId = string` and `VaultPath = string` (types.ts:11,16) provide no compile-time safety. A NoteId can be accidentally passed where a VaultPath is expected and vice versa.\n\n**Solution**: Use branded/opaque types:\n```typescript\ntype NoteId = string \u0026 { __brand: 'NoteId' };\ntype VaultPath = string \u0026 { __brand: 'VaultPath' };\n\n// Factory functions\nfunction noteId(id: string): NoteId { return id as NoteId; }\nfunction vaultPath(path: string): VaultPath { return path as VaultPath; }\n```\n\n**Files**: packages/shared/src/types.ts\n**Impact**: Prevents bugs from type confusion at compile time","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:24.456954-06:00","updated_at":"2025-12-12T22:40:03.421626-06:00","closed_at":"2025-12-12T22:40:03.421626-06:00","dependencies":[{"issue_id":"scribe-9st","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:27.602594-06:00","created_by":"daemon"}]}
{"id":"scribe-a0k","title":"Extract shared InlineLinkNode base class from WikiLinkNode and PersonMentionNode","description":"WikiLinkNode.ts (173 lines) and PersonMentionNode.ts (180 lines) have nearly identical DecoratorNode implementations.\n\n**Duplicated Patterns (~100 lines):**\n- Class structure extending `DecoratorNode\u003cJSX.Element\u003e`\n- Identical methods: getType(), clone(), createDOM(), updateDOM(), exportDOM(), decorate(), exportJSON(), importJSON(), isInline(), getTextContent()\n- Component click handler pattern with error handling\n\n**Solution:**\nCreate a base `InlineLinkNode` class that handles:\n- Common DOM creation\n- Serialization/deserialization\n- Click handling with navigation\n- Subclasses provide type-specific display and CSS class names\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/plugins/WikiLinkNode.ts\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionNode.ts\n\n**Estimated savings:** ~100 lines","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-12T21:18:13.464049-06:00","updated_at":"2025-12-12T23:21:24.671899-06:00","dependencies":[{"issue_id":"scribe-a0k","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:25.190852-06:00","created_by":"daemon"},{"issue_id":"scribe-a0k","depends_on_id":"scribe-9cl","type":"related","created_at":"2025-12-12T21:42:03.6224-06:00","created_by":"daemon"}]}
{"id":"scribe-arr","title":"Decompose CommandPalette.tsx into mode-specific panel components","description":"The CommandPalette component in apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx is ~1339 lines with 6 distinct modes mixed into one monolithic component. This makes it difficult to understand, test, and extend.\n\n## Analysis\n\nThe component manages these distinct modes with significant state and rendering logic for each:\n\n1. **Command Mode** (default): Command list with fuzzy search, keyboard navigation, 'create daily note' option\n2. **File-Browse Mode**: Note listing with recent notes, fuzzy search via Fuse.js, delete button per item\n3. **Delete-Browse Mode**: Note selection for deletion (similar to file-browse but different click behavior)\n4. **Delete-Confirm Mode**: Confirmation dialog for note deletion\n5. **Person-Browse Mode**: People listing with fuzzy search\n6. **Prompt-Input Mode**: Text input modal for creating entities\n\n### State Complexity (~25 useState calls)\n- query, selectedIndex, searchResults (command mode)\n- allNotes, isLoadingNotes, selectedNoteIndex, displayedNotes (file-browse)\n- allPeople, isLoadingPeople, selectedPersonIndex, fuzzyPeopleResults (person-browse)\n- pendingDeleteNote, returnMode, isDeleting (delete modes)\n- promptInputValue (prompt mode)\n- showCreateDailyOption, createDailyIsoDate (date search feature)\n\n### Duplicated Patterns\n- renderFileBrowseResults() and renderDeleteBrowseResults() are 90% identical\n- Keyboard handlers for file-browse and delete-browse are nearly identical\n- Fuse.js index setup is duplicated for notes and people\n\n## Proposed Solution\n\nExtract mode-specific logic into dedicated components:\n\n### 1. CommandModePanel.tsx\n- Command rendering and selection\n- Search results rendering\n- 'Create daily note' option\n- State: query, selectedIndex, searchResults, showCreateDailyOption\n\n### 2. FileBrowsePanel.tsx\n- Recent notes display\n- Fuzzy search with Fuse.js\n- Note item rendering with delete button\n- State: allNotes, selectedNoteIndex, fuzzySearchResults\n\n### 3. DeleteBrowsePanel.tsx (or reuse FileBrowsePanel with mode prop)\n- Can share FileBrowsePanel with an onSelect callback difference\n\n### 4. DeleteConfirmDialog.tsx\n- Confirmation UI\n- State: pendingDeleteNote, isDeleting\n\n### 5. PersonBrowsePanel.tsx\n- People listing and fuzzy search\n- State: allPeople, selectedPersonIndex, fuzzyPeopleResults\n\n### 6. PromptInputPanel.tsx\n- Text input modal\n- State: promptInputValue\n\n### 7. Shared hook: useFuzzySearch.ts\n- Extract Fuse.js index creation and search logic\n- Reusable for notes, people, and future searchable lists\n\n### CommandPalette.tsx (refactored)\n- Mode router that renders the appropriate panel\n- Manages only: isOpen, mode, onClose\n- Passes callbacks to child panels\n\nExpected result: CommandPalette.tsx reduced to ~150-200 lines, with each panel being ~100-200 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:08.135479-06:00","updated_at":"2025-12-12T22:12:03.310454-06:00","closed_at":"2025-12-12T22:12:03.310454-06:00","dependencies":[{"issue_id":"scribe-arr","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:11.564444-06:00","created_by":"daemon"},{"issue_id":"scribe-arr","depends_on_id":"scribe-1sh","type":"related","created_at":"2025-12-12T21:42:09.6592-06:00","created_by":"daemon"}]}
{"id":"scribe-arx","title":"Remove unused taskNavigation utility","description":"The taskNavigation utility (156 lines + tests) is never imported. Investigation needed before removal.\n\n**Action Required:**\n1. Check git history for why this was created\n2. Search for related features or tickets\n3. If orphaned: delete. If intended: integrate or document.\n\n**Files:**\n- apps/desktop/renderer/src/utils/taskNavigation.ts\n- apps/desktop/renderer/src/utils/taskNavigation.test.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:19:31.497154-06:00","updated_at":"2025-12-12T21:43:51.076327-06:00","dependencies":[{"issue_id":"scribe-arx","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.730305-06:00","created_by":"daemon"},{"issue_id":"scribe-arx","depends_on_id":"scribe-oua","type":"related","created_at":"2025-12-12T21:43:51.027975-06:00","created_by":"daemon"}]}
{"id":"scribe-b7l","title":"Add special character handling tests for SearchEngine","description":"Add tests for special character handling in search-engine.test.ts:\n- Search queries with special chars: @, #, *, ?, [, ], (, ), etc.\n- Note content with special chars (emojis, unicode, code blocks)\n- Tags with special chars (#c++, #c#, #node.js)\n- Title with special chars (e.g., 'Q\u0026A', 'TODO: Fix bug')\n- FlexSearch tokenization edge cases\n- SQL-like injection strings (shouldn't break search)\n- Regex metacharacters in search query\n\nCurrent tests use only alphanumeric content.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:01:25.516765-06:00","updated_at":"2025-12-12T21:01:25.516765-06:00","dependencies":[{"issue_id":"scribe-b7l","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:28.73017-06:00","created_by":"daemon"}]}
{"id":"scribe-baj","title":"Add tests for node.ts utility module","description":"packages/engine-core/src/node.ts has NO tests.\n\n**Functions needing tests:**\n- Node traversal utilities\n- Node type checking functions\n- Helper functions for working with Lexical nodes\n\n**Files:**\n- packages/engine-core/src/node.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:26:09.730906-06:00","updated_at":"2025-12-12T21:26:09.730906-06:00","dependencies":[{"issue_id":"scribe-baj","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.212157-06:00","created_by":"daemon"}]}
{"id":"scribe-bi0","title":"Make text-extraction helpers internal (not exported)","description":"The functions `extractTextWithContext` and `generateSnippet` are exported from engine-search but only used internally.\n\n**Evidence:**\n- Exported from packages/engine-search/src/index.ts\n- Only used within search-engine.ts\n- No external imports found\n\n**Action:**\nRemove from public exports and keep as internal implementation details.\n\n**Files:**\n- packages/engine-search/src/index.ts\n- packages/engine-search/src/text-extraction.ts","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-12T21:19:43.986997-06:00","updated_at":"2025-12-12T21:19:43.986997-06:00","dependencies":[{"issue_id":"scribe-bi0","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:28.038905-06:00","created_by":"daemon"}]}
{"id":"scribe-bk5","title":"Refactor FileSystemVault: Extract NoteMigrator for legacy upgrades","description":"FileSystemVault.migrateNote() (lines 413-439) handles legacy note format upgrades mixed with storage logic.\n\n**Extract: NoteMigrator**\n- Move migrateNote() method\n- Define migration versioning scheme\n- Support chained migrations (v1→v2→v3)\n- Track which notes have been migrated\n\n**Interface:**\n```typescript\ninterface NoteMigrator {\n  needsMigration(note: unknown): boolean\n  migrate(note: unknown): Note\n  getVersion(note: Note): number\n}\n```\n\n**Current migrations embedded:**\n- Add explicit title (from metadata.title or 'Untitled')\n- Add explicit type (from metadata.type or content.type)\n- Initialize tags as empty array\n- Preserve daily/meeting fields\n\n**Benefits:**\n- New migrations don't require touching FileSystemVault\n- Migration logic testable with sample legacy data\n- Could add dry-run mode to preview migrations\n- Version tracking enables incremental upgrades","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:01:16.325127-06:00","updated_at":"2025-12-12T23:18:49.884965-06:00","closed_at":"2025-12-12T23:18:49.884965-06:00","dependencies":[{"issue_id":"scribe-bk5","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:19.352888-06:00","created_by":"daemon"},{"issue_id":"scribe-bk5","depends_on_id":"scribe-1rf","type":"related","created_at":"2025-12-12T21:41:57.783221-06:00","created_by":"daemon"}]}
{"id":"scribe-bq3","title":"Extract shared AutocompleteList component from WikiLinkAutocomplete and PersonMentionAutocomplete","description":"WikiLinkAutocomplete.tsx and PersonMentionAutocomplete.tsx share common patterns:\n\n**Duplicated Patterns (~50 lines):**\n1. Scroll into view logic:\n```typescript\nuseEffect(() =\u003e {\n  if (selectedRef.current) {\n    selectedRef.current.scrollIntoView({ block: 'nearest' });\n  }\n}, [selectedIndex]);\n```\n2. Result list rendering with selectedRef assignment\n3. Loading/empty state rendering\n\n**Solution:**\nCreate a shared `AutocompleteList` component:\n```typescript\ninterface AutocompleteListProps\u003cT\u003e {\n  items: T[];\n  selectedIndex: number;\n  onSelect: (item: T) =\u003e void;\n  renderItem: (item: T, isSelected: boolean) =\u003e ReactNode;\n  emptyMessage: string;\n  loadingMessage?: string;\n  isLoading?: boolean;\n}\n```\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/plugins/WikiLinkAutocomplete.tsx\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionAutocomplete.tsx\n\n**Estimated savings:** ~50 lines","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:18:38.548033-06:00","updated_at":"2025-12-12T21:18:38.548033-06:00","dependencies":[{"issue_id":"scribe-bq3","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:27.048914-06:00","created_by":"daemon"},{"issue_id":"scribe-bq3","depends_on_id":"scribe-9cl","type":"blocks","created_at":"2025-12-12T21:42:03.579038-06:00","created_by":"daemon"}]}
{"id":"scribe-bxq","title":"Remove 'not yet implemented' console.log placeholders","description":"Several features have placeholder console.log statements indicating incomplete functionality:\n\n**SlashMenu commands.ts:**\n- Line 148: 'AI Continue: Not yet implemented'\n- Line 159: 'AI Summarize: Not yet implemented'\n\n**SelectionToolbarPlugin.tsx:**\n- Line 276: 'Link formatting not yet implemented'\n- Line 320: 'Ask AI clicked - not yet implemented'\n\n**Options:**\n1. **Implement the features** - if they're planned soon\n2. **Remove the menu items** - if features are not planned\n3. **Disable with visual indicator** - show as grayed out with 'Coming Soon' tooltip\n\n**Recommendation:** Remove the menu items until features are implemented to avoid confusing users.\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/SlashMenu/commands.ts\n- apps/desktop/renderer/src/components/Editor/SelectionToolbar/SelectionToolbarPlugin.tsx","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:25:54.42246-06:00","updated_at":"2025-12-12T21:25:54.42246-06:00","dependencies":[{"issue_id":"scribe-bxq","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.062745-06:00","created_by":"daemon"}]}
{"id":"scribe-csc","title":"Create generic createLinkContext factory for WikiLinkContext and PersonMentionContext","description":"WikiLinkContext.tsx and PersonMentionContext.tsx are nearly identical (39 lines each).\n\n**Duplicated Pattern:**\n```typescript\ninterface ContextValue {\n  currentNoteId: NoteId | null;\n  onClick: (...) =\u003e Promise\u003cvoid\u003e;\n  onError: (message: string) =\u003e void;\n}\nconst Context = createContext\u003cContextValue | null\u003e(null);\nexport function Provider({ children, ...props }) { ... }\nexport function useContext() { ... }\n```\n\n**Solution:**\nCreate a generic `createLinkContext\u003cT\u003e()` factory function that generates context/provider/hook for any link-type node.\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/plugins/WikiLinkContext.tsx\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionContext.tsx\n\n**Estimated savings:** ~40 lines","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:18:18.411037-06:00","updated_at":"2025-12-12T21:18:18.411037-06:00","dependencies":[{"issue_id":"scribe-csc","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:27.155602-06:00","created_by":"daemon"}]}
{"id":"scribe-ct6","title":"Refactor TaskIndex: Extract TaskReconciler for note sync logic","description":"TaskIndex mixes reconciliation with storage. The indexNote() method (lines 162-258) is 96 lines of complex matching logic.\n\n**Extract: TaskReconciler**\n- Move indexNote() core logic\n- Move reconcileTask() private method (lines 496-551)\n- Move createTask() private method (lines 468-489)\n- Move getMaxPriority() helper\n\n**Interface:**\n```typescript\ninterface TaskReconciler {\n  reconcile(\n    note: Note,\n    existingTasks: Map\u003cstring, Task\u003e,\n    now: number\n  ): {\n    toAdd: Task[]\n    toUpdate: Task[]\n    toRemove: string[]\n  }\n}\n```\n\n**Reconciliation rules (currently embedded):**\n1. Match by nodeKey first\n2. Fallback to textHash\n3. Preserve priority/createdAt on match\n4. Set completedAt on state transitions\n5. Generate stable task IDs\n\n**Benefits:**\n- Reconciliation logic testable in isolation\n- Clear separation of 'what changed' from 'apply changes'\n- Easier to reason about matching rules","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:33.559119-06:00","updated_at":"2025-12-12T22:45:44.872789-06:00","closed_at":"2025-12-12T22:45:44.872789-06:00","dependencies":[{"issue_id":"scribe-ct6","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:36.813071-06:00","created_by":"daemon"},{"issue_id":"scribe-ct6","depends_on_id":"scribe-l59","type":"blocks","created_at":"2025-12-12T21:41:54.748217-06:00","created_by":"daemon"}]}
{"id":"scribe-dvf","title":"Add tests for ContextPanel and widget components","description":"ContextPanel (216 lines) and several widget components have NO or minimal tests.\n\n**Files needing tests:**\n- apps/desktop/renderer/src/components/ContextPanel/ContextPanel.tsx (216 lines)\n- apps/desktop/renderer/src/components/ContextPanel/CalendarWidget.tsx\n- apps/desktop/renderer/src/components/ContextPanel/LinkedMentions.tsx (202 lines)\n- apps/desktop/renderer/src/components/ContextPanel/AttendeesWidget.tsx (237 lines)\n\n**Test scenarios:**\n- Panel open/close toggle\n- Widget visibility based on note type\n- Calendar widget date display\n- Backlinks/references fetching and display\n- Attendees CRUD operations\n- Empty states for each widget\n\n**Note:** TasksWidget.test.tsx and ReferencesWidget.test.tsx already exist.\n\n**Files:**\n- apps/desktop/renderer/src/components/ContextPanel/*","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:27:29.395019-06:00","updated_at":"2025-12-12T23:52:20.940177-06:00","closed_at":"2025-12-12T23:52:20.940177-06:00","dependencies":[{"issue_id":"scribe-dvf","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:33.32444-06:00","created_by":"daemon"}]}
{"id":"scribe-e6b","title":"Reduce IPC handler boilerplate in main.ts with withEngines() wrapper","description":"main.ts has ~15 IPC handlers that repeat the same initialization check pattern:\n\n```typescript\nipcMain.handle('notes:save', async (_event, note: Note) =\u003e {\n  if (!vault) {\n    throw new Error('Vault not initialized');\n  }\n  if (!graphEngine) {\n    throw new Error('Graph engine not initialized');\n  }\n  if (!searchEngine) {\n    throw new Error('Search engine not initialized');\n  }\n  if (!taskIndex) {\n    throw new Error('Task index not initialized');\n  }\n  // ... actual logic\n});\n```\n\nThis boilerplate appears in handlers for:\n- notes:save, notes:delete, notes:read\n- graph:forNote, graph:backlinks, graph:notesWithTag\n- people:list, people:create, people:search  \n- tasks:toggle, tasks:list, tasks:get, tasks:reorder\n- daily:getOrCreate, daily:find\n- meeting:create, meeting:addAttendee, meeting:removeAttendee\n\n**Suggested fix**: Create a withEngines() higher-order function:\n\n```typescript\ntype Engines = {\n  vault: FileSystemVault;\n  graphEngine: GraphEngine;\n  searchEngine: SearchEngine;\n  taskIndex: TaskIndex;\n};\n\nfunction withEngines\u003cT extends unknown[], R\u003e(\n  handler: (engines: Engines, ...args: T) =\u003e Promise\u003cR\u003e\n): (...args: T) =\u003e Promise\u003cR\u003e {\n  return async (...args: T) =\u003e {\n    if (!vault || !graphEngine || !searchEngine || !taskIndex) {\n      throw new Error('Engines not initialized');\n    }\n    return handler({ vault, graphEngine, searchEngine, taskIndex }, ...args);\n  };\n}\n\n// Usage:\nipcMain.handle('notes:save', withEngines(async ({ vault, graphEngine, searchEngine, taskIndex }, _event, note) =\u003e {\n  await vault.save(note);\n  graphEngine.addNote(note);\n  // ...\n}));\n```\n\nAlternative: Use decorator pattern with metadata if TypeScript decorators are enabled.\n\nEstimate: ~1.5 hours","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:53.718032-06:00","updated_at":"2025-12-12T21:00:53.718032-06:00","dependencies":[{"issue_id":"scribe-e6b","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:56.918282-06:00","created_by":"daemon"}]}
{"id":"scribe-e8a","title":"loadConfig() swallows all errors including JSON parse failures","description":"In apps/desktop/electron/main/src/main.ts lines 41-44, loadConfig() catches all errors and returns empty config. This hides JSON parsing errors (corrupt config) and permission errors. Should distinguish between ENOENT (acceptable) and other errors (should log/alert).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-12T20:59:55.124091-06:00","updated_at":"2025-12-12T22:12:00.872349-06:00","closed_at":"2025-12-12T22:12:00.872349-06:00","dependencies":[{"issue_id":"scribe-e8a","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:09.982165-06:00","created_by":"daemon"}]}
{"id":"scribe-etk","title":"Add tests for auto-updater.ts","description":"apps/desktop/electron/main/src/auto-updater.ts has NO tests despite containing critical auto-update functionality.\n\n**Functions needing tests:**\n- setupAutoUpdater() - initializes auto-updater and periodic checks\n- checkForUpdate() - manual update check\n- downloadUpdate() - download handler\n- installUpdate() - quit and install\n- Event handlers for update-available, update-downloaded, error\n\n**Test scenarios:**\n- Successful update check flow\n- Update available → download → install\n- Network errors during check\n- Download failures\n- User cancellation\n- Multiple setupAutoUpdater() calls (related to scribe-3r5 memory leak)\n\n**Note:** This is related to scribe-3r5 (memory leak in setInterval) - tests should verify cleanup.\n\n**Files:**\n- apps/desktop/electron/main/src/auto-updater.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:00.207189-06:00","updated_at":"2025-12-12T23:46:27.183853-06:00","closed_at":"2025-12-12T23:46:27.183853-06:00","dependencies":[{"issue_id":"scribe-etk","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.112925-06:00","created_by":"daemon"},{"issue_id":"scribe-etk","depends_on_id":"scribe-3r5","type":"blocks","created_at":"2025-12-12T21:41:49.543142-06:00","created_by":"daemon"}]}
{"id":"scribe-eyg","title":"Add tests for vault.ts initialization utilities","description":"packages/storage-fs/src/vault.ts (105 lines) has NO tests.\n\n**Functions needing tests:**\n- initializeVault(vaultPath) - creates vault directory structure\n- isValidVault(vaultPath) - validates vault structure\n- Path utilities for vault subdirectories\n\n**Test scenarios:**\n- Creating new vault in empty directory\n- Validating existing vault structure\n- Handling missing subdirectories\n- Permission errors\n- Cross-platform path handling\n\n**Files:**\n- packages/storage-fs/src/vault.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:19:15.827269-06:00","updated_at":"2025-12-12T23:36:30.63515-06:00","closed_at":"2025-12-12T23:36:30.63515-06:00","dependencies":[{"issue_id":"scribe-eyg","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:24.965877-06:00","created_by":"daemon"}]}
{"id":"scribe-f47","title":"Race condition in FileSystemStorage.save() allows concurrent overwrites","description":"## Location\n`packages/storage-fs/src/storage.ts` lines 210-254\n\n## Problem\nThe `save()` method has a race condition between reading existing note state and writing the updated note. The sequence is:\n\n1. Read existing note from in-memory map (line 213)\n2. Merge fields and prepare updated note (lines 215-238)\n3. Atomic write to disk (line 242)\n4. Update in-memory map (line 245)\n\nIf two concurrent saves occur for the same note:\n- Save A reads state at T1\n- Save B reads state at T1 (same state)\n- Save A writes at T2\n- Save B writes at T3, overwriting Save A's changes\n\nThe `atomicWrite()` only prevents partial writes (crash safety), NOT concurrent access.\n\n## Impact\n- **Data loss**: User edits can be silently overwritten\n- **State inconsistency**: In-memory map can diverge from disk if operations interleave\n\n## Suggested Solutions\n\n### Option 1: Per-note mutex (Recommended)\n```typescript\nprivate saveLocks = new Map\u003cNoteId, Promise\u003cvoid\u003e\u003e();\n\nasync save(note: Note): Promise\u003cvoid\u003e {\n  const lock = this.saveLocks.get(note.id) ?? Promise.resolve();\n  const newLock = lock.then(() =\u003e this.doSave(note));\n  this.saveLocks.set(note.id, newLock);\n  return newLock;\n}\n```\n\n### Option 2: Write queue with debouncing\nUseful if saves are frequent (e.g., autosave on keystroke).\n\n### Option 3: Optimistic locking with version field\nAdd `version: number` to Note, reject saves where version doesn't match.\n\n## Acceptance Criteria\n- [ ] Concurrent saves to the same note are serialized\n- [ ] No data loss under concurrent operations\n- [ ] Add unit tests for concurrent save scenarios","acceptance_criteria":"- Concurrent saves to the same note are serialized via per-note mutex\n- No data loss under concurrent operations (verified by test)\n- Unit tests cover: concurrent saves, save during save, state consistency\n- Implementation uses promise-chaining pattern from suggested solution","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T20:59:45.395722-06:00","updated_at":"2025-12-12T21:52:31.541446-06:00","closed_at":"2025-12-12T21:52:31.541446-06:00","dependencies":[{"issue_id":"scribe-f47","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:06.093729-06:00","created_by":"daemon"}]}
{"id":"scribe-gyb","title":"Remove deprecated extractTitle function from engine-core","description":"The `extractTitle` function is marked as deprecated but still exported.\n\n**Evidence:**\n- packages/engine-core/src/metadata.ts (lines 30-35)\n- Marked with `@deprecated` - 'Title is now stored explicitly on Note.title'\n- Exported from packages/engine-core/src/index.ts\n- Only used in its own test file (metadata.test.ts)\n\n**Actions:**\n1. Remove `extractTitle` from exports in index.ts\n2. Delete the function from metadata.ts\n3. Update/remove related tests\n\n**Files:**\n- packages/engine-core/src/metadata.ts\n- packages/engine-core/src/index.ts\n- packages/engine-core/src/metadata.test.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:19:35.892137-06:00","updated_at":"2025-12-12T21:19:35.892137-06:00","dependencies":[{"issue_id":"scribe-gyb","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.674977-06:00","created_by":"daemon"}]}
{"id":"scribe-js3","title":"Add persistence failure recovery tests for TaskIndex","description":"Add tests for persistence error handling in task-index.test.ts:\n- persist() when fs.writeFile fails (disk full, permission denied)\n- persist() when fs.rename fails (atomic write failure)\n- persist() when fs.mkdir fails\n- load() with corrupted JSONL file (partial lines, invalid JSON)\n- Recovery behavior after persist failure (dirty flag state, retry)\n- schedulePersist() error callback handling\n\nCurrent tests mock fs to always succeed. Need failure path coverage.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:58.673043-06:00","updated_at":"2025-12-12T21:00:58.673043-06:00","dependencies":[{"issue_id":"scribe-js3","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:01.742492-06:00","created_by":"daemon"}]}
{"id":"scribe-k5r","title":"Race condition in FileSystemStorage.delete() causes state inconsistency","description":"## Location\n`packages/storage-fs/src/storage.ts` lines 262-273\n\n## Problem\nThe `delete()` method has a race condition between disk deletion and in-memory map update:\n\n```typescript\nasync delete(id: NoteId): Promise\u003cvoid\u003e {\n  const notePath = getNoteFilePath(this.vaultPath, id);\n  try {\n    await fs.unlink(notePath);  // Step 1: Delete from disk\n    this.notes.delete(id);       // Step 2: Delete from memory\n  } catch (error) { ... }\n}\n```\n\n### Race Scenarios\n\n**Scenario 1: Delete + Save race**\n- Delete starts, removes file from disk\n- Save starts for same note, reads from in-memory map (still exists!)\n- Save writes new file to disk\n- Delete removes from in-memory map\n- Result: File exists on disk, not in memory\n\n**Scenario 2: Delete + Delete race**\n- Delete A removes file, about to update map\n- Delete B tries to unlink, gets ENOENT\n- Inconsistent error handling\n\n**Scenario 3: Delete + Read race**\n- Delete removes file from disk\n- Read checks in-memory map, finds note\n- Returns stale data that no longer exists on disk\n\n## Impact\n- **Ghost files**: Files on disk not tracked in memory\n- **Phantom notes**: In-memory notes with no backing file\n- **Stale reads**: Returning deleted note data\n\n## Suggested Solutions\n\n### Option 1: Per-note mutex (Recommended)\nShare the same lock mechanism with `save()`:\n```typescript\nasync delete(id: NoteId): Promise\u003cvoid\u003e {\n  return this.withNoteLock(id, async () =\u003e {\n    const notePath = getNoteFilePath(this.vaultPath, id);\n    this.notes.delete(id);      // Remove from memory first\n    await fs.unlink(notePath);  // Then remove from disk\n  });\n}\n```\n\n### Option 2: Memory-first deletion\nDelete from memory before disk to prevent stale reads:\n```typescript\nasync delete(id: NoteId): Promise\u003cvoid\u003e {\n  const note = this.notes.get(id);\n  this.notes.delete(id);  // Immediate memory removal\n  try {\n    await fs.unlink(notePath);\n  } catch (error) {\n    if (note) this.notes.set(id, note);  // Rollback on failure\n    throw error;\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] Delete and save operations on same note are serialized\n- [ ] No ghost files or phantom notes after concurrent operations\n- [ ] Add unit tests for delete + save race scenarios","acceptance_criteria":"- Delete and save operations on same note are serialized (reuse mutex from scribe-f47)\n- No ghost files or phantom notes after concurrent operations\n- Memory-first deletion order (remove from map before disk)\n- Unit tests cover: delete+save race, delete+delete race, delete+read race","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T21:00:01.817352-06:00","updated_at":"2025-12-12T21:52:33.121387-06:00","closed_at":"2025-12-12T21:52:33.121387-06:00","dependencies":[{"issue_id":"scribe-k5r","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:06.694348-06:00","created_by":"daemon"},{"issue_id":"scribe-k5r","depends_on_id":"scribe-f47","type":"related","created_at":"2025-12-12T21:41:47.696064-06:00","created_by":"daemon"}]}
{"id":"scribe-l59","title":"Refactor TaskIndex: Extract TaskPersistence for JSONL I/O","description":"TaskIndex (588 lines) violates SRP by mixing storage, persistence, reconciliation, and query logic.\n\n**Extract: TaskPersistence**\n- Move load() and persist() methods\n- Move schedulePersist(), flush() debounce logic\n- Move persistPath, dirty flag, persistTimeout, debounceMs state\n- Owns atomic temp+rename write pattern (lines 96-115)\n- Owns JSONL parse/serialize (lines 62-89, 101-104)\n\n**Interface:**\n```typescript\ninterface TaskPersistence {\n  load(): Promise\u003cMap\u003cstring, Task\u003e\u003e\n  persist(tasks: Map\u003cstring, Task\u003e): Promise\u003cvoid\u003e\n  schedulePersist(tasks: Map\u003cstring, Task\u003e): void\n  flush(tasks: Map\u003cstring, Task\u003e): Promise\u003cvoid\u003e\n}\n```\n\n**Benefits:**\n- TaskIndex focuses on indexing logic\n- Persistence strategy becomes swappable (JSONL, SQLite, etc.)\n- Easier to test persistence in isolation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:23.962989-06:00","updated_at":"2025-12-12T22:40:05.10641-06:00","closed_at":"2025-12-12T22:40:05.10641-06:00","dependencies":[{"issue_id":"scribe-l59","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:27.558572-06:00","created_by":"daemon"}]}
{"id":"scribe-lgy","title":"Add tests for text-extraction.ts","description":"packages/engine-search/src/text-extraction.ts has NO unit tests despite being used by SearchEngine.\n\n**Functions needing tests:**\n- extractText(lexicalState) - main text extraction from Lexical state\n- Helper functions for node traversal\n- Whitespace normalization\n- Special node handling (links, mentions, etc.)\n\n**Test scenarios:**\n- Plain text extraction\n- Nested node structures\n- WikiLink text extraction\n- Person mention text extraction  \n- Table text extraction\n- Empty/null content handling\n- Malformed Lexical state\n- Very large documents\n\n**Files:**\n- packages/engine-search/src/text-extraction.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:04.348742-06:00","updated_at":"2025-12-12T21:26:53.921809-06:00","closed_at":"2025-12-12T21:26:53.921809-06:00","dependencies":[{"issue_id":"scribe-lgy","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.162906-06:00","created_by":"daemon"}]}
{"id":"scribe-mii","title":"Add tests for SelectionToolbar components","description":"SelectionToolbar has NO tests despite being 332+ lines of complex formatting logic:\n\n**Files needing tests:**\n- apps/desktop/renderer/src/components/Editor/SelectionToolbar/SelectionToolbarPlugin.tsx (332 lines)\n- apps/desktop/renderer/src/components/Editor/SelectionToolbar/SelectionToolbar.tsx (175 lines)\n\n**Test scenarios:**\n- Toolbar visibility on text selection\n- Toolbar positioning (above/below selection)\n- Format toggling (bold, italic, underline, strikethrough, code)\n- Active state detection for each format\n- Toolbar hiding on selection clear\n- Keyboard shortcuts for formatting\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/SelectionToolbar/*","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:27:05.642211-06:00","updated_at":"2025-12-12T23:59:43.378638-06:00","closed_at":"2025-12-12T23:59:43.378638-06:00","dependencies":[{"issue_id":"scribe-mii","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:10.335696-06:00","created_by":"daemon"}]}
{"id":"scribe-ms1","title":"Add very long content tests for SearchEngine","description":"Add tests for large content handling in search-engine.test.ts:\n- Note with content \u003e 1000 chars (current indexing limit)\n- Note with content \u003e 5000 chars (context extraction limit)\n- Snippet generation for match beyond indexed content\n- Search performance with many large notes\n- Memory behavior (ensure large notes don't bloat index)\n- fullText storage vs indexed content truncation\n- Match found in truncated portion (should still return note?)\n\nCurrent tests use short content strings only.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:01:34.727792-06:00","updated_at":"2025-12-12T21:01:34.727792-06:00","dependencies":[{"issue_id":"scribe-ms1","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:37.574198-06:00","created_by":"daemon"}]}
{"id":"scribe-ncq","title":"Use discriminated unions for Note type-specific data","description":"**Problem**: The `Note` interface (types.ts:186-202) uses optional fields that allow invalid state:\n```typescript\ndaily?: { date: string };\nmeeting?: { date: string; dailyNoteId: NoteId; attendees: NoteId[] };\n```\n\nThis allows:\n- `type: 'daily'` with `meeting` data present (invalid)\n- `type: 'meeting'` with `daily` data present (invalid)\n- `type: undefined` with `daily` or `meeting` data (invalid)\n- `type: 'daily'` with no `daily` data (invalid)\n\n**Solution**: Use discriminated unions to make invalid states unrepresentable:\n```typescript\ntype Note = BaseNote \u0026 (\n  | { type?: undefined }\n  | { type: 'person' }\n  | { type: 'project' }\n  | { type: 'template' }\n  | { type: 'daily'; daily: { date: string } }\n  | { type: 'meeting'; meeting: { date: string; dailyNoteId: NoteId; attendees: NoteId[] } }\n);\n```\n\n**Files**: packages/shared/src/types.ts\n**Impact**: Compiler prevents impossible states, simplifies validation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:54.961156-06:00","updated_at":"2025-12-12T23:14:11.77357-06:00","closed_at":"2025-12-12T23:14:11.77357-06:00","dependencies":[{"issue_id":"scribe-ncq","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:58.145392-06:00","created_by":"daemon"},{"issue_id":"scribe-ncq","depends_on_id":"scribe-9st","type":"related","created_at":"2025-12-12T21:42:15.653838-06:00","created_by":"daemon"}]}
{"id":"scribe-njf","title":"Create useErrorHandler.ts hook file","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:54:34.83668-06:00","updated_at":"2025-12-12T21:55:58.815284-06:00","closed_at":"2025-12-12T21:55:58.815284-06:00","dependencies":[{"issue_id":"scribe-njf","depends_on_id":"scribe-5es","type":"discovered-from","created_at":"2025-12-12T21:54:34.837184-06:00","created_by":"daemon"}]}
{"id":"scribe-nwu","title":"Add unit tests for text-extraction.ts","description":"Create text-extraction.test.ts with tests for:\n- extractTextForSearch(): empty content, nested nodes, various node types\n- extractTextWithContext(): maxLength parameter, truncation behavior\n- generateSnippet(): edge cases (match at start/end, ellipsis handling)\n- traverseNodes(): deep nesting, empty children arrays\n\nCurrent state: No dedicated test file exists. Functions are only indirectly tested via search-engine.test.ts.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:39.960087-06:00","updated_at":"2025-12-12T21:43:17.427752-06:00","closed_at":"2025-12-12T21:43:17.427752-06:00","dependencies":[{"issue_id":"scribe-nwu","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:43.641246-06:00","created_by":"daemon"},{"issue_id":"scribe-nwu","depends_on_id":"scribe-lgy","type":"related","created_at":"2025-12-12T21:42:24.564078-06:00","created_by":"daemon"}]}
{"id":"scribe-o3s","title":"Add accessibility attributes to Input, ListItem, and Button primitives","description":"Several design system primitives are missing accessibility attributes:\n\n## Input (packages/design-system/src/primitives/Input/Input.tsx)\n- Missing `aria-invalid={error}` binding to the error prop\n- No built-in label association (consider `aria-label` or `id` prop pattern)\n- Should pass `aria-describedby` for error message association\n\n## ListItem (packages/design-system/src/primitives/List/ListItem.tsx)\n- Missing `tabIndex={disabled ? -1 : 0}` for keyboard focus\n- No keyboard navigation handlers (Enter/Space to select)\n- Note: Already has `role=\"option\"`, `aria-selected`, `aria-disabled` - good!\n\n## Button (packages/design-system/src/primitives/Button/Button.tsx)\n- Missing `aria-disabled` when disabled (native disabled works but aria helps AT)\n- No loading state support (`aria-busy`, spinner, disabled interaction)\n- Consider `aria-pressed` for toggle buttons\n\n**Implementation notes:**\n- Input: Add `aria-invalid={error}` to the input element (line 28-32)\n- ListItem: Add `tabIndex` and `onKeyDown` handler for Enter/Space\n- Button: Add optional `loading` prop with `aria-busy` and visual indicator\n\n**Files:**\n- packages/design-system/src/primitives/Input/Input.tsx\n- packages/design-system/src/primitives/List/ListItem.tsx\n- packages/design-system/src/primitives/Button/Button.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:22.7241-06:00","updated_at":"2025-12-12T22:40:06.301667-06:00","closed_at":"2025-12-12T22:40:06.301667-06:00","dependencies":[{"issue_id":"scribe-o3s","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:27.614497-06:00","created_by":"daemon"}]}
{"id":"scribe-oua","title":"Remove unused useTaskSubscription hook","description":"The useTaskSubscription hook is exported but never imported or used anywhere in the codebase.\n\n**Evidence:**\n- Defined in apps/desktop/renderer/src/hooks/useTaskSubscription.ts (120 lines)\n- Exported from the hooks directory\n- Zero imports found in any other file\n\n**Options:**\n1. Delete the hook if no longer needed\n2. Integrate it where it was intended to be used\n3. Document why it exists for future use\n\n**Files:**\n- apps/desktop/renderer/src/hooks/useTaskSubscription.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:19:27.905213-06:00","updated_at":"2025-12-12T21:19:27.905213-06:00","dependencies":[{"issue_id":"scribe-oua","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.782396-06:00","created_by":"daemon"}]}
{"id":"scribe-rmk","title":"Add tests for TableUIPlugin","description":"TableUIPlugin.tsx (416 lines) has NO dedicated tests despite complex table UI logic.\n\n**Functions needing tests:**\n- Table hover detection\n- Row/column controls rendering\n- Row/column add/delete operations\n- Context menu handling\n- Drag-to-resize functionality (if present)\n\n**Note:** Some table tests exist in TablePlugin.test.tsx and TableKeyboardPlugin.test.tsx, but TableUIPlugin-specific functionality is not tested.\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/plugins/TableUIPlugin.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:27:17.191509-06:00","updated_at":"2025-12-12T23:59:44.708453-06:00","closed_at":"2025-12-12T23:59:44.708453-06:00","dependencies":[{"issue_id":"scribe-rmk","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:20.931744-06:00","created_by":"daemon"}]}
{"id":"scribe-rwj","title":"Extract FloatingMenu primitive to design system from autocomplete CSS","description":"Three autocomplete-style components have nearly identical CSS (~150 lines duplicated):\n\n**Duplicated Files:**\n- WikiLinkAutocomplete.css.ts\n- PersonMentionAutocomplete.css.ts\n- SlashMenu.css.ts\n\n**Duplicated Styles:**\n1. Container/dropdown: position, zIndex, minWidth, maxWidth, maxHeight, overflow, backgroundColor, borderRadius, boxShadow, border, animation\n2. Item styles: display: flex, alignItems, gap, padding, cursor, transition, hover state\n3. itemSelected/itemIcon/itemText patterns\n\n**Solution:**\nExtract to design system:\n```typescript\n// packages/design-system/src/primitives/FloatingMenu/\nexport const floatingMenuContainer = style({ ... });\nexport const floatingMenuItem = style({ ... });\nexport const floatingMenuItemSelected = style({ ... });\n```\n\n**Estimated savings:** ~150 lines","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:18:27.199004-06:00","updated_at":"2025-12-12T23:25:36.22515-06:00","closed_at":"2025-12-12T23:25:36.22515-06:00","dependencies":[{"issue_id":"scribe-rwj","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:25.135171-06:00","created_by":"daemon"},{"issue_id":"scribe-rwj","depends_on_id":"scribe-69x","type":"related","created_at":"2025-12-12T21:42:11.499173-06:00","created_by":"daemon"}]}
{"id":"scribe-rzh","title":"Add JSDoc documentation to packages/shared/src/types.ts","description":"types.ts (442 lines) is the foundational types file but lacks comprehensive documentation.\n\n**Needs documentation:**\n\n**Core Types:**\n- NoteId, VaultPath - branded type aliases with no explanation\n- LexicalState (lines 44-58) - inner `root` object properties minimally documented\n- LexicalNode (lines 63-67) - generic catch-all with `[key: string]: unknown`\n\n**Data Types:**\n- GraphNode (lines 207-218) - when `title` can be null, what `tags` contains\n- GraphEdge (lines 223-227) - edge semantics, what 'tag' edge means\n- SearchResult (lines 232-241) - snippet length, score range, positions meaning\n\n**Utility Functions:**\n- serializeTaskId, parseTaskId, isSystemNoteId - no JSDoc\n\n**Impact:** This is the foundation for all other packages. Well-documented types prevent bugs.\n\n**Files:**\n- packages/shared/src/types.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:19:55.168311-06:00","updated_at":"2025-12-12T23:36:31.425405-06:00","closed_at":"2025-12-12T23:36:31.425405-06:00","dependencies":[{"issue_id":"scribe-rzh","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:24.913483-06:00","created_by":"daemon"}]}
{"id":"scribe-s0u","title":"Add ARIA dialog attributes to Overlay component","description":"The Overlay component (packages/design-system/src/primitives/Overlay/Overlay.tsx) is missing critical accessibility attributes for modal dialogs:\n\n**Missing attributes:**\n- `role=\"dialog\"` on the content container\n- `aria-modal=\"true\"` to indicate modal behavior\n- `aria-labelledby` prop to reference dialog title\n- `aria-describedby` prop to reference dialog description\n\n**Implementation notes:**\n- Add optional `ariaLabelledby` and `ariaDescribedby` props to OverlayProps\n- Apply `role=\"dialog\"` and `aria-modal=\"true\"` to the content div (line 83)\n- Consider adding focus trap functionality as a follow-up\n- The component already handles Escape key and scroll lock correctly\n\n**Files:** packages/design-system/src/primitives/Overlay/Overlay.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:13.7379-06:00","updated_at":"2025-12-12T21:59:16.181013-06:00","closed_at":"2025-12-12T21:59:16.181013-06:00","dependencies":[{"issue_id":"scribe-s0u","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:27.018143-06:00","created_by":"daemon"}]}
{"id":"scribe-u9y","title":"Add tests for useNoteState hook","description":"apps/desktop/renderer/src/hooks/useNoteState.ts (337 lines) has NO tests despite being a critical hook.\n\n**What needs testing:**\n- Note CRUD operations (create, read, update, delete)\n- Optimistic updates and rollback on error\n- State transitions (loading, error states)\n- Concurrent operation handling\n- Edge cases (deleting current note, creating duplicate titles)\n\n**Complexity Factors:**\n- Manages IPC communication with main process\n- Has optimistic update patterns\n- Handles error recovery\n- Coordinates with navigation history\n\n**Files:**\n- apps/desktop/renderer/src/hooks/useNoteState.ts","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-12T21:19:06.849933-06:00","updated_at":"2025-12-12T23:15:50.099574-06:00","dependencies":[{"issue_id":"scribe-u9y","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:25.079742-06:00","created_by":"daemon"}]}
{"id":"scribe-ugi","title":"Fix any type usage in design system primitives","description":"The design system primitives use 'any' type assertions for ref forwarding:\n\n**Files:**\n- packages/design-system/src/primitives/Text/Text.tsx:51 - `ref={ref as any}`\n- packages/design-system/src/primitives/Surface/Surface.tsx:52 - `ref={ref as any}`\n\n**Both have eslint-disable comments:**\n```typescript\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nref={ref as any}\n```\n\n**Root Cause:**\nThe polymorphic component pattern (using `as` prop) makes TypeScript's ref typing complex.\n\n**Solution:**\n1. Use proper generic typing for polymorphic refs\n2. Or use a type-safe ref forwarding pattern like:\n```typescript\ntype PolymorphicRef\u003cC extends ElementType\u003e = \n  ComponentPropsWithRef\u003cC\u003e['ref'];\n```\n\n**Impact:** Improves type safety in design system, removes eslint-disable comments","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:26:16.593092-06:00","updated_at":"2025-12-12T23:46:28.179566-06:00","closed_at":"2025-12-12T23:46:28.179566-06:00","dependencies":[{"issue_id":"scribe-ugi","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:26:45.262895-06:00","created_by":"daemon"}]}
{"id":"scribe-uqw","title":"Document SearchEngine configuration and query syntax","description":"SearchEngine lacks documentation for its configuration and query capabilities.\n\n**Needs documentation:**\n\n**Constructor (lines 31-54):**\n- FlexSearch configuration options are unexplained:\n  - Why `tokenize: 'forward'`?\n  - What do `resolution: 9` and `depth: 2` mean?\n  - Why is `bidirectional: true`?\n\n**search method (lines 126-182):**\n- Query syntax (what operators are supported?)\n- Empty result behavior\n- Performance characteristics\n\n**getFieldWeight (lines 220-227):**\n- Magic numbers (10, 5, 1) are undocumented\n- Scoring algorithm explanation\n\n**Result merging (lines 140-175):**\n- How FlexSearch returns grouped results\n- Why merging is necessary\n- Score calculation algorithm\n\n**Files:**\n- packages/engine-search/src/search-engine.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:20:12.998052-06:00","updated_at":"2025-12-12T21:20:12.998052-06:00","dependencies":[{"issue_id":"scribe-uqw","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.514857-06:00","created_by":"daemon"}]}
{"id":"scribe-v3c","title":"search-engine silently swallows date parsing errors","description":"In packages/engine-search/src/search-engine.ts lines 86-88, date parsing errors are caught with empty handler. While intentional (invalid dates should use original title), the pattern is fragile. Consider using try-with-fallback pattern more explicitly or logging at debug level for troubleshooting.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-12T21:00:05.881824-06:00","updated_at":"2025-12-12T23:59:46.14263-06:00","closed_at":"2025-12-12T23:59:46.14263-06:00","dependencies":[{"issue_id":"scribe-v3c","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:12.394846-06:00","created_by":"daemon"}]}
{"id":"scribe-vum","title":"Add JSDoc to FileSystemVault class and methods","description":"FileSystemVault in storage.ts lacks comprehensive documentation despite being a critical class.\n\n**Needs documentation:**\n\n**Class level:**\n- Overall purpose and responsibility\n- Thread-safety / concurrent access behavior\n- Constructor `vaultPath` parameter expectations\n\n**Methods:**\n- quarantineFile (lines 64-80) - naming convention, error handling\n- atomicWrite (lines 285-314) - performance, disk space, network filesystem behavior\n- isValidNote (lines 322-385) - validation rules, why fields are optional\n- migrateNote (lines 413-439) - migration scenarios, field precedence\n\n**Files:**\n- packages/storage-fs/src/storage.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:20:07.221387-06:00","updated_at":"2025-12-12T21:20:07.221387-06:00","dependencies":[{"issue_id":"scribe-vum","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.568445-06:00","created_by":"daemon"}]}
{"id":"scribe-w3n","title":"Extract hardcoded CSS values to design tokens in design-system package","description":"Extract hardcoded CSS values to design tokens for consistency:\n\n**primitives/Overlay/Overlay.css.ts**\n- Line 16: `'150ms'` - should use vars.animation.duration.fast or similar\n- Line 22: `'rgba(0, 0, 0, 0.4)'` - BACKDROP_COLOR_TRANSPARENT\n- Line 25: `'rgba(0, 0, 0, 0.3)'` - BACKDROP_COLOR_BLUR\n- Line 26-27: `'blur(4px)'` - BACKDROP_BLUR_AMOUNT\n\n**tokens/animations.css.ts**\n- Line 78: `'1s'` in spin animation - should use vars.animation.duration token\n- Lines 22, 31: `'10px'` translateY offset - SLIDE_OFFSET token\n\nThe design system already has a token system (vars.animation.duration, etc.) - these values should be migrated to use existing tokens or new tokens should be added to contract.css.ts.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:38.334086-06:00","updated_at":"2025-12-12T21:00:38.334086-06:00","dependencies":[{"issue_id":"scribe-w3n","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:41.664077-06:00","created_by":"daemon"}]}
{"id":"scribe-wzv","title":"Extract shared PaletteItem component from CommandPalette browse modes","description":"CommandPalette.tsx (1339 lines) has 3 nearly identical render functions:\n- renderFileBrowseResults() (lines 804-889) \n- renderDeleteBrowseResults() (lines 892-963)\n- renderPersonBrowseResults() (lines 966-1035)\n\n~90% of the code is identical:\n1. Loading state rendering\n2. Empty state rendering  \n3. No results rendering\n4. Item rendering with icon, title, description, enter hint\n5. Mouse hover/click handlers\n6. Selected state styling\n\nDifferences are minimal:\n- Icon type (FileTextIcon vs UserIcon)\n- Empty state message text\n- Click handler action (navigate vs delete-confirm vs navigate)\n- Optional delete button on file-browse items\n\n**Suggested fix**: Extract a PaletteItem component and a PaletteItemList wrapper:\n\n```tsx\ninterface PaletteItemProps {\n  icon: ReactNode;\n  title: string;\n  description: string;\n  isSelected: boolean;\n  onClick: () =\u003e void;\n  onMouseEnter: () =\u003e void;\n  actions?: ReactNode; // For delete button\n}\n\ninterface PaletteItemListProps\u003cT\u003e {\n  items: T[];\n  isLoading: boolean;\n  emptyMessage: string;\n  noResultsMessage: string;\n  selectedIndex: number;\n  renderItem: (item: T, index: number) =\u003e PaletteItemProps;\n}\n```\n\nThis would reduce ~270 lines to ~50 lines.\n\nEstimate: ~2 hours","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:00:39.510106-06:00","updated_at":"2025-12-12T21:00:39.510106-06:00","dependencies":[{"issue_id":"scribe-wzv","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:42.664365-06:00","created_by":"daemon"}]}
{"id":"scribe-x6z","title":"Add tests for FloatingDock component","description":"FloatingDock.tsx has NO tests.\n\n**Files needing tests:**\n- apps/desktop/renderer/src/components/FloatingDock/FloatingDock.tsx\n\n**Test scenarios:**\n- Dock visibility\n- Action button clicks\n- Keyboard navigation\n- Position/styling\n\n**Files:**\n- apps/desktop/renderer/src/components/FloatingDock/*","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:27:38.507301-06:00","updated_at":"2025-12-12T21:27:38.507301-06:00","dependencies":[{"issue_id":"scribe-x6z","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:41.89076-06:00","created_by":"daemon"}]}
{"id":"scribe-xub","title":"Refactor FileSystemVault: Extract QuarantineManager for corrupt files","description":"FileSystemVault handles corrupt file quarantine inline (lines 64-80, 117-124). This is a cross-cutting concern that clutters the main load flow.\n\n**Extract: QuarantineManager**\n- Move quarantineFile() method\n- Move quarantinedFiles list tracking\n- Move getQuarantinedFiles() accessor\n- Add recovery/restore capabilities\n\n**Interface:**\n```typescript\ninterface QuarantineManager {\n  quarantine(sourcePath: string, reason: string): Promise\u003cvoid\u003e\n  listQuarantined(): string[]\n  restore(fileName: string): Promise\u003cvoid\u003e\n  deleteQuarantined(fileName: string): Promise\u003cvoid\u003e\n}\n```\n\n**Current behavior:**\n- Creates .scribe/quarantine/ directory\n- Renames file with ISO timestamp prefix\n- Tracks quarantined files in memory\n- Logs warning to console\n\n**Benefits:**\n- load() becomes cleaner (just call quarantine on parse failure)\n- Quarantine policy (what to quarantine, retention) centralized\n- Could add notifications for quarantined files\n- Recovery tooling lives in one place","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-12T21:01:08.373608-06:00","updated_at":"2025-12-13T00:19:58.743154-06:00","dependencies":[{"issue_id":"scribe-xub","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:11.49167-06:00","created_by":"daemon"}]}
{"id":"scribe-y7a","title":"Add tests for useScrollHeader hook","description":"apps/desktop/renderer/src/hooks/useScrollHeader.ts (99 lines) has NO tests.\n\n**What needs testing:**\n- Scroll position tracking\n- Parallax calculation\n- Header visibility state\n- Scroll direction detection\n- Performance (no excessive re-renders)\n\n**Files:**\n- apps/desktop/renderer/src/hooks/useScrollHeader.ts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:19:20.424471-06:00","updated_at":"2025-12-12T21:19:20.424471-06:00","dependencies":[{"issue_id":"scribe-y7a","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.838601-06:00","created_by":"daemon"}]}
{"id":"scribe-ybm","title":"Add self-referencing note tests for GraphEngine","description":"Add tests for self-referencing notes in graph-engine.test.ts:\n- Note links to itself (metadata.links includes own ID)\n- backlinks() for self-referencing note\n- neighbors() for self-referencing note (should include self?)\n- Edge count when note links to itself\n- Updating self-referencing note (edge cleanup)\n- Removing self-referencing note\n\nThis is a valid edge case (e.g., recursive topic notes) that needs defined behavior.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:01:16.69194-06:00","updated_at":"2025-12-12T21:01:16.69194-06:00","dependencies":[{"issue_id":"scribe-ybm","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:01:19.782765-06:00","created_by":"daemon"}]}
{"id":"scribe-yhw","title":"Add tests for SlashMenuPlugin and SlashMenu components","description":"SlashMenu components have NO tests despite being 341+ lines of complex menu logic:\n\n**Files needing tests:**\n- apps/desktop/renderer/src/components/Editor/SlashMenu/SlashMenuPlugin.tsx (341 lines)\n- apps/desktop/renderer/src/components/Editor/SlashMenu/SlashMenu.tsx\n- apps/desktop/renderer/src/components/Editor/SlashMenu/SlashMenuItem.tsx\n- apps/desktop/renderer/src/components/Editor/SlashMenu/commands.ts (197 lines)\n\n**Test scenarios:**\n- Trigger detection (typing '/')\n- Menu positioning\n- Keyboard navigation (up/down/enter/escape)\n- Command filtering based on query\n- Command execution for each command type\n- Menu closing on blur/click outside\n- Nested menu state (if applicable)\n\n**Complexity:** These components handle:\n- Lexical editor integration\n- Keyboard event handling\n- Dynamic positioning\n- Command registry\n\n**Files:**\n- apps/desktop/renderer/src/components/Editor/SlashMenu/*","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:27:01.391259-06:00","updated_at":"2025-12-12T23:52:20.633714-06:00","closed_at":"2025-12-12T23:52:20.633714-06:00","dependencies":[{"issue_id":"scribe-yhw","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:27:10.284341-06:00","created_by":"daemon"}]}
{"id":"scribe-ys3","title":"Task key generation uses Math.random() despite 'deterministic' comment","description":"CRITICAL: In packages/engine-core/src/task-extraction.ts lines 169-171, getNodeKey() claims to generate a 'deterministic key from position' but uses Math.random(). This causes:\n1. Task IDs to change on every re-extraction\n2. Task reconciliation to fail (tasks appear as new/removed)\n3. Priority and completedAt metadata loss\n4. Potential duplicate tasks\n\nThe fallback should use actual deterministic data (parent key + index, or text hash). While the code says 'this shouldn't happen in practice', defensive code should still be correct.","acceptance_criteria":"- getNodeKey() uses deterministic data only (parent key + index, or text hash)\n- No Math.random() in any code path\n- Add unit test that extracts tasks twice and verifies stable IDs\n- Add test for task reconciliation preserving metadata","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T21:00:03.240413-06:00","updated_at":"2025-12-12T21:52:34.370494-06:00","closed_at":"2025-12-12T21:52:34.370494-06:00","dependencies":[{"issue_id":"scribe-ys3","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:11.604112-06:00","created_by":"daemon"}]}
{"id":"scribe-yzl","title":"Extract CollapsiblePanel primitive from Sidebar and ContextPanel","description":"Sidebar.css.ts and ContextPanel.css.ts have identical panel container patterns (~60 lines duplicated):\n\n**Duplicated Patterns:**\n1. CSS custom property for width (`sidebarWidth`/`panelWidth`)\n2. Main container style with identical transition, overflow, position, zIndex\n3. Open/closed variant styles with identical transform/opacity patterns\n4. Inner container with width variable binding\n\n**Solution:**\nExtract to a shared `CollapsiblePanel` primitive in the design system.\n\n**Files:**\n- apps/desktop/renderer/src/components/Sidebar/Sidebar.css.ts (lines 17-54)\n- apps/desktop/renderer/src/components/ContextPanel/ContextPanel.css.ts (lines 17-57)\n\n**Estimated savings:** ~60 lines","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T21:18:46.360252-06:00","updated_at":"2025-12-12T21:18:46.360252-06:00","dependencies":[{"issue_id":"scribe-yzl","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:20:26.996846-06:00","created_by":"daemon"}]}
{"id":"scribe-zz5","title":"Decouple shared types from Lexical editor internals","description":"**Problem**: The shared package (types.ts:44-58, 172) is tightly coupled to Lexical editor internals:\n- `LexicalState` and `LexicalNode` leak editor implementation details\n- `Note.content: LexicalState` forces all consumers to understand Lexical\n- `LexicalNode` uses `[key: string]: unknown` which is too permissive\n\n**Solution**:\n1. Define an abstract `NoteContent` type in shared\n2. Move Lexical-specific types to renderer or a dedicated `lexical-types` package\n3. Use a branded opaque type: `type NoteContent = { __contentFormat: 'lexical-v1' }`\n4. Add a `contentVersion` field for future format migrations\n\n**Alternative**: If Lexical types must stay, at least constrain `LexicalNode`:\n```typescript\ninterface LexicalNode {\n  type: LexicalNodeType; // union of known node types\n  version: number;\n  children?: LexicalNode[];\n  // other known fields...\n}\n```\n\n**Files**: packages/shared/src/types.ts\n**Impact**: Reduces coupling, enables future editor migrations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T21:00:45.098387-06:00","updated_at":"2025-12-12T22:45:45.839615-06:00","closed_at":"2025-12-12T22:45:45.839615-06:00","dependencies":[{"issue_id":"scribe-zz5","depends_on_id":"scribe-0w9","type":"parent-child","created_at":"2025-12-12T21:00:47.75257-06:00","created_by":"daemon"},{"issue_id":"scribe-zz5","depends_on_id":"scribe-0fq","type":"related","created_at":"2025-12-12T21:42:15.698155-06:00","created_by":"daemon"}]}
