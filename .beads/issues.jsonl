{"id":"scribe-60c","title":"Review and polish markdown-export spec","description":"Epic to track all findings from thorough review of features/markdown-export/spec.md. Covers gaps, inconsistencies, technical inaccuracies, and areas needing more context or polish.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-16T22:22:26.542958-06:00","updated_at":"2025-12-16T22:22:26.542958-06:00"}
{"id":"scribe-60c.1","title":"Fix cross-platform path handling in ShareMenu filename extraction","description":"In ShareMenu.tsx line 460, the code uses `result.filePath.split('/').pop()` to extract the filename. This will fail on Windows where the path separator is `\\`. \n\nThe renderer process doesn't have access to Node's `path.basename()`, so need an alternative solution:\n- Use a regex that handles both separators: `filePath.split(/[/\\\\]/).pop()`\n- Or pass the filename separately from the main process\n\nLocation: features/markdown-export/spec.md line 460 (ShareMenu component code)","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-16T22:22:34.162512-06:00","updated_at":"2025-12-16T22:22:34.162512-06:00","dependencies":[{"issue_id":"scribe-60c.1","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:34.162874-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.10","title":"Add error handling for file permission errors","description":"The export handler (lines 329-335) has generic error handling but doesn't specifically handle permission errors. Users may select directories they don't have write access to.\n\nCurrent code:\n```typescript\n} catch (error) {\n  const message = error instanceof Error ? error.message : 'Unknown error';\n  return { success: false, error: `Failed to write file: ${message}` };\n}\n```\n\nShould add specific handling for:\n1. EACCES - Permission denied\n2. EROFS - Read-only file system\n3. ENOSPC - No space left on device\n\nUser-friendly error messages would be better than raw system errors:\n- \"Permission denied. Try saving to a different location.\"\n- \"The disk is full. Free up space and try again.\"\n\nLocation: features/markdown-export/spec.md lines 329-335","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:23:27.244426-06:00","updated_at":"2025-12-16T22:23:27.244426-06:00","dependencies":[{"issue_id":"scribe-60c.10","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:27.244813-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.11","title":"Specify line ending format for exported Markdown","description":"The spec doesn't specify whether exported Markdown files should use:\n- LF (Unix-style: `\\n`)\n- CRLF (Windows-style: `\\r\\n`)\n- Platform-native line endings\n\nThis affects cross-platform compatibility. A Markdown file exported on Windows with CRLF may display differently in some tools on macOS/Linux.\n\nRecommendation: Use LF (`\\n`) consistently for all platforms because:\n1. Markdown parsers universally support LF\n2. Most modern editors handle LF fine on Windows\n3. Git's autocrlf setting can convert if needed\n4. It's the CommonMark spec's line ending\n\nShould add this to the Implementation Notes section.\n\nLocation: features/markdown-export/spec.md - Implementation Notes section (around line 198)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:31.770165-06:00","updated_at":"2025-12-16T22:23:31.770165-06:00","dependencies":[{"issue_id":"scribe-60c.11","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:31.770526-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.12","title":"Document handling of special Markdown characters in plain text","description":"The spec doesn't address how special Markdown characters in regular text content should be handled. For example:\n\nIf a note contains literal text like:\n- \"The price is $100 * 2 = $200\"\n- \"Use # to start a comment\"\n- \"The [brackets] are important\"\n\nThese could be misinterpreted as Markdown syntax:\n- `*` could start emphasis\n- `#` at line start could become a heading\n- `[brackets]` could become a broken link\n\nOptions to consider:\n1. Escape special characters: `\\*`, `\\#`, `\\[`\n2. Only escape when ambiguous (context-aware)\n3. Don't escape (preserve raw text, accept rendering differences)\n\nThe CommonMark spec defines which characters need escaping. This should be explicitly documented in the Content Conversion section.\n\nLocation: features/markdown-export/spec.md - Content Conversion section (around line 174)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:23:36.925181-06:00","updated_at":"2025-12-16T22:23:36.925181-06:00","dependencies":[{"issue_id":"scribe-60c.12","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:36.925552-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.13","title":"Add File Changes entry for test files","description":"The File Changes table (lines 99-114) lists all production code files but omits test files. The Testing Plan section references specific test file paths that should be included in the File Changes table for completeness:\n\nMissing test file entries:\n1. `packages/shared/src/content-extractor.test.ts` - **New** - Unit tests for content extractor\n2. `apps/desktop/renderer/src/components/ShareMenu/ShareMenu.test.tsx` - **New** - Component tests for ShareMenu\n3. `apps/desktop/electron/main/src/handlers/exportHandlers.test.ts` - **New** - Integration tests for export handler\n4. `apps/cli/tests/unit/notes-export.test.ts` or similar - **New** - CLI export tests\n\nAdding these ensures implementers know the full scope of files to create.\n\nLocation: features/markdown-export/spec.md lines 99-114","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:45.149142-06:00","updated_at":"2025-12-16T22:23:45.149142-06:00","dependencies":[{"issue_id":"scribe-60c.13","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:45.149538-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.14","title":"Verify file paths match actual project structure","description":"The spec references several file paths that need verification against the actual project structure. Some paths may not exist or may have different structures:\n\nPaths to verify:\n1. `apps/desktop/electron/main/src/handlers/` - Does this handlers directory exist? The spec assumes a handlers pattern that may not be established.\n\n2. `apps/desktop/electron/main/src/handlers/index.ts` - Assumes a barrel export file exists for handlers.\n\n3. `apps/desktop/renderer/src/components/NoteHeader/` - Does NoteHeader component exist? The spec modifies it but the component may have a different name or location.\n\n4. `apps/cli/src/content-extractor.ts` - Is there an existing content extractor in CLI to modify?\n\n5. `packages/shared/src/ipc-contract.ts` - Verify this file exists and contains the IPC_CHANNELS constant.\n\nShould examine actual project structure and update paths in spec accordingly.\n\nLocation: features/markdown-export/spec.md lines 99-114 (File Changes table)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-16T22:23:50.803022-06:00","updated_at":"2025-12-16T22:23:50.803022-06:00","dependencies":[{"issue_id":"scribe-60c.14","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:50.803393-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.15","title":"Clarify table formatting approach in Open Questions","description":"Open Question #1 (line 912) asks about table formatting and recommends \"Simple pipe syntax for MVP\" but doesn't define what \"simple pipe syntax\" means vs GitHub-flavored Markdown tables.\n\nThe Content Conversion table (line 190) just says \"Markdown table with pipes\" without specifying:\n\n1. Whether to include header separator row (`|---|---|`)\n2. Whether to support column alignment (`:---`, `:---:`, `---:`)\n3. How to handle tables with uneven column counts\n4. How to handle empty cells\n\nExample of \"simple\" vs \"GFM aligned\":\n\nSimple:\n```\n| Header | Header |\n|---|---|\n| Cell | Cell |\n```\n\nGFM with alignment:\n```\n| Left | Center | Right |\n|:-----|:------:|------:|\n| Cell | Cell   | Cell  |\n```\n\nThe spec should explicitly show an example of the expected table output format.\n\nLocation: features/markdown-export/spec.md lines 190, 912-913","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:56.896644-06:00","updated_at":"2025-12-16T22:23:56.896644-06:00","dependencies":[{"issue_id":"scribe-60c.15","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:56.897015-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.16","title":"Fix wiki-link capitalization inconsistency","description":"Minor inconsistency in wiki-link representation throughout the spec:\n\n- Goal #3 (line 18): \"wiki-links as `[[title]]`\" (lowercase)\n- Content Conversion table (line 188): \"wiki-link â†’ `[[Target Title]]`\" (Title Case)\n- Implementation Notes (line 203): \"Wiki-link titles are preserved as-is\"\n\nThe table shows \"Target Title\" with title case which might imply the title is transformed, but the implementation notes say titles are \"preserved as-is\".\n\nRecommendation: Update the Content Conversion table to show a more neutral example like `[[Meeting Notes]]` that doesn't imply any case transformation, and add a note that the title is preserved exactly as stored in the wiki-link node.\n\nLocation: features/markdown-export/spec.md lines 18, 188, 203","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-16T22:24:06.185802-06:00","updated_at":"2025-12-16T22:24:06.185802-06:00","dependencies":[{"issue_id":"scribe-60c.16","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:06.186195-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.17","title":"Document toast system dependency and useToast hook","description":"The spec assumes a toast notification system exists (line 648-665) with a `useToast` hook, but doesn't reference where this comes from or verify it exists.\n\nThe Toast Integration section shows:\n```typescript\nconst { showToast } = useToast();\nshowToast(`Exported to ${filename}`, 'success');\nshowToast(`Export failed: ${error}`, 'error');\n```\n\nMissing information:\n1. Where is `useToast` imported from? Is it `@scribe/design-system`? A local hook?\n2. What are the valid toast types? ('success', 'error', 'warning', 'info'?)\n3. How long do toasts display?\n4. Can toasts be dismissed?\n5. Does the toast system already exist or does it need to be created?\n\nIf the toast system doesn't exist, this becomes a dependency/blocker that should be noted in the Implementation Plan.\n\nLocation: features/markdown-export/spec.md lines 648-665","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:24:10.886339-06:00","updated_at":"2025-12-16T22:24:10.886339-06:00","dependencies":[{"issue_id":"scribe-60c.17","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:10.886753-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.18","title":"Add handling for file extension changes in save dialog","description":"The save dialog allows the user to change the filename including the extension. The spec doesn't address what happens if the user:\n\n1. Removes the `.md` extension entirely (saves as \"Meeting Notes\" with no extension)\n2. Changes the extension to something else (saves as \"Meeting Notes.txt\")\n3. Adds a double extension (saves as \"Meeting Notes.md.md\")\n\nOptions to consider:\n1. Always append `.md` if missing: `ensureExtension(filePath, '.md')`\n2. Trust the user's choice (they may want a different extension)\n3. Warn if extension is not `.md` but allow it\n\nThe `dialog.showSaveDialog` filters (lines 317-320) suggest Markdown as primary but allow \"All Files\", so users can bypass the extension.\n\nRecommendation: Document the expected behavior - probably option 2 (trust user) for flexibility, but this should be explicit.\n\nLocation: features/markdown-export/spec.md lines 315-322","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:24:16.872393-06:00","updated_at":"2025-12-16T22:24:16.872393-06:00","dependencies":[{"issue_id":"scribe-60c.18","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:16.872765-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.19","title":"Add encoding specification for exported files","description":"The spec doesn't explicitly specify the file encoding for exported Markdown. While the code shows `fs.writeFile(filePath, markdown, 'utf-8')` (line 330), this should be documented as a requirement.\n\nAdditionally, YAML frontmatter should ideally include encoding information or assume UTF-8. Some tools may have issues with non-ASCII characters if encoding isn't clear.\n\nRecommendations:\n1. Document that UTF-8 encoding is used (no BOM)\n2. Consider if a BOM should be optional for Windows compatibility\n3. Ensure the content extractor properly handles Unicode characters (emoji, international characters, etc.)\n4. Add a test case for notes with non-ASCII content\n\nLocation: features/markdown-export/spec.md - Implementation Notes section","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:24:27.634554-06:00","updated_at":"2025-12-16T22:24:27.634554-06:00","dependencies":[{"issue_id":"scribe-60c.19","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:27.634956-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.2","title":"Add consecutive dash cleanup in filename sanitization","description":"In exportHandlers.ts (spec line 309-312), the filename sanitization regex `replace(/[\u003c\u003e:\"/\\\\|?*]/g, '-')` replaces invalid characters with dashes, but a title like \"Meeting: Q\u0026A / Discussion\" would become \"Meeting- Q\u0026A - Discussion\" with potential consecutive dashes.\n\nShould add `.replace(/-+/g, '-')` to clean up multiple consecutive dashes:\n```typescript\nconst sanitizedTitle = note.title\n  .replace(/[\u003c\u003e:\"/\\\\|?*]/g, '-')\n  .replace(/-+/g, '-')  // Add this line\n  .replace(/\\s+/g, ' ')\n  .trim() || 'Untitled';\n```\n\nLocation: features/markdown-export/spec.md lines 309-313","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-16T22:22:37.76428-06:00","updated_at":"2025-12-16T22:22:37.76428-06:00","dependencies":[{"issue_id":"scribe-60c.2","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:37.764648-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.20","title":"Define behavior when vault.read fails vs note not found","description":"The export handler (lines 299-303) checks if a note exists:\n\n```typescript\nconst note = vault.read(noteId);\nif (!note) {\n  return { success: false, error: 'Note not found' };\n}\n```\n\nBut this doesn't distinguish between:\n1. Note doesn't exist (ID is invalid)\n2. Note exists but vault.read() failed (file corruption, disk error, etc.)\n\nIf `vault.read()` can throw exceptions, those aren't caught here. The error handling should be more explicit:\n\n```typescript\nlet note;\ntry {\n  note = vault.read(noteId);\n} catch (error) {\n  return { success: false, error: 'Failed to read note from vault' };\n}\nif (!note) {\n  return { success: false, error: 'Note not found' };\n}\n```\n\nShould clarify the vault.read() behavior and update error handling accordingly.\n\nLocation: features/markdown-export/spec.md lines 299-303","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:24:31.620506-06:00","updated_at":"2025-12-16T22:24:31.620506-06:00","dependencies":[{"issue_id":"scribe-60c.20","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:31.620877-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.3","title":"Replace emoji with icon from design system in ShareMenu","description":"The ShareMenu component uses an emoji `ðŸ“„` for the menu item icon (spec line 495). This has several issues:\n1. Inconsistent rendering across platforms/fonts\n2. May not be accessible to screen readers\n3. Project guidelines discourage emoji use unless explicitly requested\n\nThe spec comment on line 409 says \"(or import from design system)\" for icons. Should explicitly use a design system icon instead.\n\nRecommendation: Use a document/file icon from `@scribe/design-system/icons` or define a proper SVG icon component.\n\nLocation: features/markdown-export/spec.md line 495","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:41.289999-06:00","updated_at":"2025-12-16T22:22:41.289999-06:00","dependencies":[{"issue_id":"scribe-60c.3","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:41.290382-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.4","title":"Document the Note type fields and clarify 'type' field in frontmatter","description":"The spec has ambiguity around the Note type and frontmatter fields:\n\n1. The frontmatter example (line 169) shows `type: meeting` but this field is never defined in the `MarkdownExportOptions` interface or mentioned in the Goals section. Where does this come from? Is it a standard Note field?\n\n2. The API section imports `type { Note } from './types'` (line 128) but the IPC contract imports from `@scribe/shared`. These need to be consistent.\n\n3. The Note type's expected fields should be documented so implementers know what metadata is available for frontmatter.\n\nQuestions to resolve:\n- What fields does the Note type contain?\n- Is `type` a standard field on all notes?\n- Which fields should be included in frontmatter by default?\n\nLocation: features/markdown-export/spec.md lines 128, 159-171","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-16T22:22:50.257861-06:00","updated_at":"2025-12-16T22:22:50.257861-06:00","dependencies":[{"issue_id":"scribe-60c.4","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:50.25823-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.5","title":"Add missing imports to code snippets throughout spec","description":"Several code snippets are missing import statements, making them incomplete for copy-paste implementation:\n\n1. CLI command (lines 675-718):\n   - Missing: `import { extractMarkdown } from '@scribe/shared'`\n   - Missing: `import * as fs from 'node:fs/promises'`\n   - Missing: `import path from 'path'`\n   - Missing: `import { createNoteId } from '...'`\n   - `output()` function not imported or explained\n\n2. Handler code (line 277-338):\n   - `withEngines()` function is used but not explained - what is it and what does it return?\n   - `HandlerDependencies` type is referenced but not defined\n\n3. ShareMenu (lines 403-503):\n   - `window.scribe` TypeScript declaration not shown - how should it be typed?\n\nEach code snippet should either include all necessary imports or reference where they come from.\n\nLocation: features/markdown-export/spec.md lines 277-338, 675-718, 403-503","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:55.42621-06:00","updated_at":"2025-12-16T22:22:55.42621-06:00","dependencies":[{"issue_id":"scribe-60c.5","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:55.4266-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.6","title":"Verify design token names exist in design system","description":"The ShareMenu styles (lines 508-579) reference several design tokens that need verification:\n\n1. `tokens.shadows.dropdown` - Does this shadow token exist?\n2. `tokens.zIndices.dropdown` - Does this z-index token exist?\n3. `tokens.colors.surfaceHover` - Does this color token exist?\n4. `tokens.colors.textSecondary` - Does this color token exist?\n5. `tokens.radii.sm` and `tokens.radii.md` - Do these exist?\n\nIf any tokens don't exist, they either need to be added to the design system or the spec needs to use existing token names.\n\nShould cross-reference with `packages/design-system/src/` to verify available tokens.\n\nLocation: features/markdown-export/spec.md lines 508-579","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:59.469184-06:00","updated_at":"2025-12-16T22:22:59.469184-06:00","dependencies":[{"issue_id":"scribe-60c.6","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:59.46957-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.7","title":"Add keyboard shortcut for export functionality","description":"The spec doesn't mention any keyboard shortcut for exporting notes. Power users typically expect keyboard shortcuts for common actions.\n\nRecommendation: Add a keyboard shortcut such as:\n- macOS: Cmd+Shift+E\n- Windows/Linux: Ctrl+Shift+E\n\nThis should be documented in:\n1. The acceptance criteria (line 46-55)\n2. The ShareMenu component implementation\n3. The testing plan\n\nAlso consider whether the shortcut should:\n- Open the share menu, or\n- Directly trigger export (skip menu if only one export option)\n\nLocation: features/markdown-export/spec.md - User Stories section (line 39-68)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:10.065886-06:00","updated_at":"2025-12-16T22:23:10.065886-06:00","dependencies":[{"issue_id":"scribe-60c.7","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:10.06626-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.8","title":"Add accessibility considerations section","description":"The spec lacks explicit accessibility considerations. While there are some ARIA attributes in the ShareMenu code, several accessibility aspects are missing:\n\n1. **Screen reader announcements**: Success/error toasts should be announced to screen readers (aria-live region)\n\n2. **Focus management**: \n   - When menu closes, focus should return to the trigger button\n   - After successful export, where should focus go?\n\n3. **Keyboard navigation**:\n   - Arrow keys for menu item navigation\n   - Enter/Space to activate items\n   - Tab to move between focusable elements\n\n4. **Color contrast**: Ensure all text meets WCAG 2.1 AA contrast requirements\n\n5. **Motion preferences**: Respect `prefers-reduced-motion` for any animations\n\nRecommend adding an \"Accessibility\" section to the spec that addresses these concerns.\n\nLocation: features/markdown-export/spec.md - new section needed","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T22:23:14.777805-06:00","updated_at":"2025-12-16T22:23:14.777805-06:00","dependencies":[{"issue_id":"scribe-60c.8","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:14.778165-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.9","title":"Clarify empty note test case expected behavior","description":"In the Testing Plan unit tests table (line 748), the \"Empty note\" test case has ambiguous expected output:\n\n| Test | Input | Expected Output |\n|------|-------|-----------------|\n| Empty note | Note with empty content | Empty string (or just frontmatter) |\n\nThe \"(or just frontmatter)\" makes this test case unclear. The behavior should be explicitly defined:\n\nOption A: Empty content returns empty string (no frontmatter)\nOption B: Empty content returns only frontmatter block\nOption C: Depends on `includeFrontmatter` option\n\nThis should align with the `MarkdownExportOptions.includeFrontmatter` option (default: true per line 131).\n\nRecommendation: If `includeFrontmatter: true`, return frontmatter even for empty notes. If `includeFrontmatter: false`, return empty string.\n\nLocation: features/markdown-export/spec.md line 748","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:20.187651-06:00","updated_at":"2025-12-16T22:23:20.187651-06:00","dependencies":[{"issue_id":"scribe-60c.9","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:20.188078-06:00","created_by":"daemon"}]}
