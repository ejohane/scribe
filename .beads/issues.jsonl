{"id":"redesign-1","title":"Auto-Update for macOS Desktop App","description":"Implement automatic application updates for the macOS desktop app. When a new version is released on GitHub, the app will silently download the update in the background and display a subtle notification in the sidebar footer. Users can then restart the app at their convenience to apply the update.\n\nGoals:\n1. Enable seamless updates without manual DMG downloads\n2. Provide a non-intrusive update notification UX\n3. Check for updates on startup and periodically while running\n4. Allow users to dismiss and defer updates\n5. Respect user workflow by never forcing restarts\n\nArchitecture: Uses electron-updater with GitHub Releases as the update provider.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-05T06:31:29.84174-06:00","updated_at":"2025-12-05T19:43:10.184939-06:00","closed_at":"2025-12-05T19:43:10.184939-06:00"}
{"id":"redesign-10","title":"Create useUpdateStatus hook","description":"Create a React hook for managing update status state in the renderer.\n\n**File to create:** apps/desktop/renderer/src/hooks/useUpdateStatus.ts\n\n**Implementation:**\n\n```typescript\nimport { useState, useEffect, useCallback } from 'react';\n\ninterface UpdateStatus {\n  status: 'idle' | 'checking' | 'downloading' | 'ready' | 'error';\n  version?: string;\n  error?: string;\n}\n\nexport function useUpdateStatus() {\n  const [updateStatus, setUpdateStatus] = useState\u003cUpdateStatus\u003e({ status: 'idle' });\n  const [dismissed, setDismissed] = useState(false);\n\n  useEffect(() =\u003e {\n    const unsubChecking = window.scribe.update.onChecking(() =\u003e {\n      setUpdateStatus({ status: 'checking' });\n    });\n\n    const unsubAvailable = window.scribe.update.onAvailable((info) =\u003e {\n      setUpdateStatus({ status: 'downloading', version: info.version });\n    });\n\n    const unsubNotAvailable = window.scribe.update.onNotAvailable(() =\u003e {\n      setUpdateStatus({ status: 'idle' });\n    });\n\n    const unsubDownloaded = window.scribe.update.onDownloaded((info) =\u003e {\n      setUpdateStatus({ status: 'ready', version: info.version });\n      setDismissed(false); // Reset dismissed for new update\n    });\n\n    const unsubError = window.scribe.update.onError((error) =\u003e {\n      setUpdateStatus({ status: 'error', error: error.message });\n    });\n\n    // Cleanup all subscriptions\n    return () =\u003e {\n      unsubChecking();\n      unsubAvailable();\n      unsubNotAvailable();\n      unsubDownloaded();\n      unsubError();\n    };\n  }, []);\n\n  const installUpdate = useCallback(() =\u003e {\n    window.scribe.update.install();\n  }, []);\n\n  const dismiss = useCallback(() =\u003e {\n    setDismissed(true);\n  }, []);\n\n  return {\n    ...updateStatus,\n    dismissed,\n    installUpdate,\n    dismiss,\n    hasUpdate: updateStatus.status === 'ready',\n  };\n}\n```\n\n**Return Type:**\n```typescript\n{\n  status: 'idle' | 'checking' | 'downloading' | 'ready' | 'error';\n  version?: string;\n  error?: string;\n  dismissed: boolean;\n  installUpdate: () =\u003e void;\n  dismiss: () =\u003e void;\n  hasUpdate: boolean;\n}\n```\n\n**Acceptance Criteria:**\n- [ ] Hook exports from file\n- [ ] Initial status is 'idle'\n- [ ] All 5 event subscriptions set up correctly\n- [ ] Subscriptions cleaned up on unmount\n- [ ] dismissed resets to false on new update\n- [ ] hasUpdate is true only when status is 'ready'\n- [ ] installUpdate calls window.scribe.update.install()","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:32:53.563354-06:00","updated_at":"2025-12-05T19:29:30.83286-06:00","closed_at":"2025-12-05T19:29:30.83286-06:00","dependencies":[{"issue_id":"redesign-10","depends_on_id":"redesign-9","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-10","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-11","title":"Create VersionIndicator component","description":"Create the version indicator component for the sidebar footer.\n\n**Files to create:**\n- apps/desktop/renderer/src/components/Sidebar/VersionIndicator.tsx\n- apps/desktop/renderer/src/components/Sidebar/VersionIndicator.css.ts\n\n**Existing Codebase Patterns:** (from Sidebar.tsx and Sidebar.css.ts)\n- Use vanilla-extract for styles\n- Import design tokens from `@scribe/design-system` as `vars`\n- Use `clsx` for conditional class merging\n- Export component as named export\n\n**Component (VersionIndicator.tsx):**\n\n```typescript\nimport { useState, useRef } from 'react';\nimport { useUpdateStatus } from '../../hooks/useUpdateStatus';\nimport { UpdatePopover } from './UpdatePopover';\nimport * as styles from './VersionIndicator.css';\n\nexport function VersionIndicator() {\n  const [popoverOpen, setPopoverOpen] = useState(false);\n  const triggerRef = useRef\u003cHTMLButtonElement\u003e(null);\n  const { hasUpdate, version: newVersion, installUpdate, dismiss } = useUpdateStatus();\n\n  const handleClick = () =\u003e {\n    if (hasUpdate) {\n      setPopoverOpen(true);\n    }\n  };\n\n  const handleClose = () =\u003e {\n    setPopoverOpen(false);\n    dismiss();\n  };\n\n  return (\n    \u003cdiv className={styles.container}\u003e\n      \u003cbutton\n        ref={triggerRef}\n        className={styles.versionButton}\n        onClick={handleClick}\n        disabled={!hasUpdate}\n        type=\"button\"\n      \u003e\n        \u003cspan className={styles.versionText}\u003ev{__APP_VERSION__}\u003c/span\u003e\n        {hasUpdate \u0026\u0026 \u003cspan className={styles.updateBadge} /\u003e}\n      \u003c/button\u003e\n\n      {popoverOpen \u0026\u0026 (\n        \u003cUpdatePopover\n          version={newVersion!}\n          triggerRef={triggerRef}\n          onClose={handleClose}\n          onInstall={installUpdate}\n        /\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n**Styles (VersionIndicator.css.ts):**\n\n```typescript\nimport { style, keyframes } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const container = style({\n  position: 'relative',\n  display: 'inline-flex',\n  alignItems: 'center',\n});\n\nexport const versionButton = style({\n  background: 'none',\n  border: 'none',\n  padding: `${vars.spacing['1']} ${vars.spacing['2']}`,\n  cursor: 'default',\n  position: 'relative',\n  display: 'inline-flex',\n  alignItems: 'center',\n  gap: vars.spacing['1'],\n  borderRadius: vars.radius.sm,\n  transition: 'background-color 0.15s ease',\n  selectors: {\n    '\u0026:not(:disabled)': { cursor: 'pointer' },\n    '\u0026:not(:disabled):hover': { backgroundColor: vars.color.surfaceHover },\n  },\n});\n\nexport const versionText = style({\n  fontSize: vars.typography.size.xs,\n  color: vars.color.foregroundMuted,\n  fontFamily: 'inherit',\n});\n\nconst pulse = keyframes({\n  '0%, 100%': { opacity: 1 },\n  '50%': { opacity: 0.5 },\n});\n\nexport const updateBadge = style({\n  width: '6px',\n  height: '6px',\n  borderRadius: vars.radius.full,\n  backgroundColor: vars.color.primary,\n  animation: `${pulse} 2s ease-in-out infinite`,\n});\n```\n\n**Acceptance Criteria:**\n- [ ] Component displays current version as 'v{version}'\n- [ ] Button disabled when no update available\n- [ ] Badge only visible when hasUpdate is true\n- [ ] Badge has pulse animation\n- [ ] Clicking opens UpdatePopover (when update ready)\n- [ ] Follows existing vanilla-extract patterns\n- [ ] Uses design system tokens for all values","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:33:01.109633-06:00","updated_at":"2025-12-05T19:31:40.557873-06:00","closed_at":"2025-12-05T19:31:40.557873-06:00","dependencies":[{"issue_id":"redesign-11","depends_on_id":"redesign-10","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-11","depends_on_id":"redesign-4","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-11","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-12","title":"Create UpdatePopover component","description":"Create the update popover component that appears when clicking the version indicator.\n\n**Files to create:**\n- apps/desktop/renderer/src/components/Sidebar/UpdatePopover.tsx\n- apps/desktop/renderer/src/components/Sidebar/UpdatePopover.css.ts\n\n**Props Interface:**\n```typescript\ninterface UpdatePopoverProps {\n  version: string;                       // New version to display\n  triggerRef: RefObject\u003cHTMLElement | null\u003e;  // Reference to version button\n  onClose: () =\u003e void;                   // Called when popover should close\n  onInstall: () =\u003e void;                 // Called when 'Restart Now' clicked\n}\n```\n\n**Component (UpdatePopover.tsx):**\n\n```typescript\nimport { useEffect, useRef, type RefObject } from 'react';\nimport { Button } from '@scribe/design-system';\nimport * as styles from './UpdatePopover.css';\n\ninterface UpdatePopoverProps {\n  version: string;\n  triggerRef: RefObject\u003cHTMLElement | null\u003e;\n  onClose: () =\u003e void;\n  onInstall: () =\u003e void;\n}\n\nexport function UpdatePopover({ version, triggerRef, onClose, onInstall }: UpdatePopoverProps) {\n  const popoverRef = useRef\u003cHTMLDivElement\u003e(null);\n\n  // Close on click outside\n  useEffect(() =\u003e {\n    const handleClickOutside = (event: MouseEvent) =\u003e {\n      if (\n        popoverRef.current \u0026\u0026\n        !popoverRef.current.contains(event.target as Node) \u0026\u0026\n        triggerRef.current \u0026\u0026\n        !triggerRef.current.contains(event.target as Node)\n      ) {\n        onClose();\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () =\u003e document.removeEventListener('mousedown', handleClickOutside);\n  }, [onClose, triggerRef]);\n\n  // Close on Escape\n  useEffect(() =\u003e {\n    const handleKeyDown = (event: KeyboardEvent) =\u003e {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () =\u003e document.removeEventListener('keydown', handleKeyDown);\n  }, [onClose]);\n\n  return (\n    \u003cdiv ref={popoverRef} className={styles.popover}\u003e\n      \u003cdiv className={styles.header}\u003eUpdate Available\u003c/div\u003e\n      \u003cp className={styles.message}\u003eVersion {version} is ready to install.\u003c/p\u003e\n      \u003cButton onClick={onInstall} variant=\"primary\" size=\"sm\" fullWidth\u003e\n        Restart Now\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n**Styles (UpdatePopover.css.ts):**\n\n```typescript\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const popover = style({\n  position: 'absolute',\n  bottom: '100%',\n  right: 0,\n  marginBottom: vars.spacing['2'],\n  padding: vars.spacing['4'],\n  backgroundColor: vars.color.surface,\n  border: `1px solid ${vars.color.border}`,\n  borderRadius: vars.radius.md,\n  boxShadow: vars.shadow.lg,\n  width: '220px',\n  zIndex: 100,\n});\n\nexport const header = style({\n  fontSize: vars.typography.size.sm,\n  fontWeight: vars.typography.weight.semibold,\n  color: vars.color.foreground,\n  marginBottom: vars.spacing['2'],\n});\n\nexport const message = style({\n  fontSize: vars.typography.size.xs,\n  color: vars.color.foregroundMuted,\n  marginBottom: vars.spacing['4'],\n  lineHeight: 1.5,\n});\n```\n\n**Behavior:**\n- Click outside closes popover (check both popover AND trigger ref)\n- Escape key closes popover\n- 'Restart Now' button calls onInstall\n\n**Acceptance Criteria:**\n- [ ] Uses Button from @scribe/design-system\n- [ ] Click outside closes popover\n- [ ] Escape key closes popover\n- [ ] Displays correct version number\n- [ ] Event listeners cleaned up on unmount\n- [ ] Follows vanilla-extract patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:33:07.892392-06:00","updated_at":"2025-12-05T19:31:41.770012-06:00","closed_at":"2025-12-05T19:31:41.770012-06:00","dependencies":[{"issue_id":"redesign-12","depends_on_id":"redesign-10","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-12","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-13","title":"Integrate VersionIndicator in Sidebar","description":"Add the VersionIndicator component to the Sidebar footer.\n\n**Files to modify:**\n- apps/desktop/renderer/src/components/Sidebar/Sidebar.tsx\n- apps/desktop/renderer/src/components/Sidebar/Sidebar.css.ts\n\n**Existing Footer Structure:** The sidebar footer currently has userInfo on the left and a theme toggle button. We need to add VersionIndicator between them.\n\n**Changes to Sidebar.tsx:**\n\n1. Add import at top of file:\n```typescript\nimport { VersionIndicator } from './VersionIndicator';\n```\n\n2. Update footer JSX (find existing footer section and modify):\n```typescript\n\u003cdiv className={styles.footer}\u003e\n  \u003cdiv className={styles.userInfo}\u003e\n    \u003cdiv className={styles.userAvatar} /\u003e\n    \u003cdiv className={styles.userName}\u003eGuest User\u003c/div\u003e\n  \u003c/div\u003e\n  \n  \u003cdiv className={styles.footerRight}\u003e\n    \u003cVersionIndicator /\u003e\n    \u003cbutton\n      onClick={onThemeToggle}\n      className={styles.themeToggle}\n      title={currentTheme === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'}\n      type=\"button\"\n    \u003e\n      {currentTheme === 'dark' ? \u003cSunIcon size={16} /\u003e : \u003cMoonIcon size={16} /\u003e}\n    \u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n**Changes to Sidebar.css.ts:**\n\nAdd `footerRight` style:\n```typescript\nexport const footerRight = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['2'],\n});\n```\n\n**Layout Goal:**\n- Left: User avatar and name\n- Right: Version indicator, then theme toggle button (flex row with gap)\n- The footer should use justify-content: space-between\n\n**Note:** May need to update existing footer style to ensure space-between layout works correctly.\n\n**Acceptance Criteria:**\n- [ ] VersionIndicator imported from local directory\n- [ ] VersionIndicator rendered in footer\n- [ ] footerRight style added with flex layout\n- [ ] Version appears to the left of theme toggle\n- [ ] Proper spacing between elements\n- [ ] Visual layout matches spec mockup","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:33:13.268062-06:00","updated_at":"2025-12-05T19:32:45.570824-06:00","closed_at":"2025-12-05T19:32:45.570824-06:00","dependencies":[{"issue_id":"redesign-13","depends_on_id":"redesign-11","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-13","depends_on_id":"redesign-12","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-13","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-14","title":"Update release workflow for auto-update artifacts","description":"Update the GitHub Actions release workflow to build and upload all artifacts needed for auto-update.\n\n**File to modify:** .github/workflows/release.yml\n\n**Current Workflow Structure:**\n- `resolve-tag` job: Resolves which tag to release\n- `build-macos` job: Builds macOS DMGs with code signing/notarization\n- `publish-release` job: Uploads artifacts to GitHub Release\n\n**Changes Needed:**\n\n1. **Build step should produce these artifacts:**\n   - DMG files (already done)\n   - ZIP files (NEW - required for auto-update on macOS)\n   - `latest-mac.yml` manifest (auto-generated by electron-builder)\n\n2. **Update artifact upload step in `publish-release` job:**\n```yaml\n- name: Upload artifacts\n  uses: softprops/action-gh-release@v1\n  with:\n    files: |\n      apps/desktop/dist/*.dmg\n      apps/desktop/dist/*.zip\n      apps/desktop/dist/latest-mac.yml\n```\n\n3. **Ensure required secrets are available (already configured, verify):**\n   - GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n   - CSC_LINK: ${{ secrets.CSC_LINK }}\n   - CSC_KEY_PASSWORD: ${{ secrets.CSC_KEY_PASSWORD }}\n   - APPLE_ID: ${{ secrets.APPLE_ID }}\n   - APPLE_APP_SPECIFIC_PASSWORD: ${{ secrets.APPLE_APP_SPECIFIC_PASSWORD }}\n   - APPLE_TEAM_ID: ${{ secrets.APPLE_TEAM_ID }}\n\n**Why `latest-mac.yml` is critical:**\nThis manifest file is read by electron-updater to determine if an update is available. It contains:\n- Version information\n- File checksums (sha512)\n- File sizes\n- Download URLs\n\nelectron-builder auto-generates this file when `publish` config is present.\n\n**Note:** The ZIP target should be added in redesign-3 (electron-builder config). This task handles the CI upload of the generated files.\n\n**Acceptance Criteria:**\n- [ ] ZIP files uploaded to GitHub Release\n- [ ] latest-mac.yml uploaded to GitHub Release\n- [ ] DMG files still uploaded (regression check)\n- [ ] All architectures (x64, arm64) represented\n- [ ] Release workflow succeeds end-to-end","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:33:35.683842-06:00","updated_at":"2025-12-05T19:33:58.632327-06:00","closed_at":"2025-12-05T19:33:58.632327-06:00","dependencies":[{"issue_id":"redesign-14","depends_on_id":"redesign-3","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-14","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-15","title":"Unit tests for useUpdateStatus hook","description":"Create unit tests for the useUpdateStatus hook.\n\n**File to create:** apps/desktop/renderer/src/hooks/useUpdateStatus.test.ts\n\n**Test Setup:**\n```typescript\nimport { renderHook, act } from '@testing-library/react';\nimport { useUpdateStatus } from './useUpdateStatus';\n\n// Mock window.scribe.update\nconst mockUpdate = {\n  install: vi.fn(),\n  onChecking: vi.fn(() =\u003e vi.fn()),\n  onAvailable: vi.fn(() =\u003e vi.fn()),\n  onNotAvailable: vi.fn(() =\u003e vi.fn()),\n  onDownloaded: vi.fn(() =\u003e vi.fn()),\n  onError: vi.fn(() =\u003e vi.fn()),\n};\n\nbeforeEach(() =\u003e {\n  window.scribe = { update: mockUpdate } as any;\n  vi.clearAllMocks();\n});\n```\n\n**Test Cases:**\n\n1. **Initial state**\n   - Status should be 'idle'\n   - hasUpdate should be false\n   - dismissed should be false\n\n2. **Checking event**\n   - Capture the callback passed to onChecking\n   - Call it and verify status changes to 'checking'\n\n3. **Available event**\n   - Capture callback from onAvailable\n   - Call with { version: '1.2.0' }\n   - Verify status is 'downloading' and version is set\n\n4. **Not available event**\n   - Trigger after 'checking' state\n   - Verify status returns to 'idle'\n\n5. **Downloaded event**\n   - Call onDownloaded callback with version\n   - Verify status is 'ready', hasUpdate is true\n\n6. **Error event**\n   - Call onError with { message: 'Network error' }\n   - Verify status is 'error' and error message is captured\n\n7. **Dismiss functionality**\n   - Call dismiss()\n   - Verify dismissed becomes true\n\n8. **New update resets dismissed**\n   - Set dismissed to true\n   - Trigger onDownloaded\n   - Verify dismissed is reset to false\n\n9. **installUpdate calls API**\n   - Call installUpdate()\n   - Verify window.scribe.update.install() was called\n\n10. **Cleanup on unmount**\n    - Unmount hook\n    - Verify all unsubscribe functions were called\n\n**Acceptance Criteria:**\n- [ ] All 10 test cases pass\n- [ ] Mocks properly capture and trigger callbacks\n- [ ] Coverage of all hook return values\n- [ ] Tests follow existing patterns in codebase","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T06:33:53.23823-06:00","updated_at":"2025-12-05T19:36:09.776522-06:00","closed_at":"2025-12-05T19:36:09.776522-06:00","dependencies":[{"issue_id":"redesign-15","depends_on_id":"redesign-10","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-15","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-16","title":"Unit tests for VersionIndicator component","description":"Create unit tests for the VersionIndicator component.\n\n**File to create:** apps/desktop/renderer/src/components/Sidebar/VersionIndicator.test.tsx\n\n**Test Setup:**\n```typescript\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport { VersionIndicator } from './VersionIndicator';\nimport { useUpdateStatus } from '../../hooks/useUpdateStatus';\n\n// Mock the hook\nvi.mock('../../hooks/useUpdateStatus');\n\n// Mock __APP_VERSION__\nvi.stubGlobal('__APP_VERSION__', '1.0.0');\n\nconst mockUseUpdateStatus = vi.mocked(useUpdateStatus);\n\nbeforeEach(() =\u003e {\n  mockUseUpdateStatus.mockReturnValue({\n    status: 'idle',\n    hasUpdate: false,\n    dismissed: false,\n    installUpdate: vi.fn(),\n    dismiss: vi.fn(),\n  });\n});\n```\n\n**Test Cases:**\n\n1. **Displays version**\n   - Render component\n   - Verify text 'v1.0.0' is visible\n\n2. **No badge when no update**\n   - hasUpdate: false\n   - Badge element should not exist in DOM\n   - Button should be disabled\n\n3. **Badge appears when ready**\n   - Mock hasUpdate: true, status: 'ready', version: '1.1.0'\n   - Verify badge element exists\n   - Badge should have appropriate class for animation\n\n4. **Click opens popover**\n   - Mock hasUpdate: true\n   - Click the button\n   - Verify UpdatePopover is rendered\n\n5. **Click disabled when no update**\n   - Mock hasUpdate: false\n   - Click the button\n   - Verify popover is NOT rendered\n   - Button should have disabled attribute\n\n6. **Popover receives correct props**\n   - Mock hasUpdate: true, version: '1.1.0'\n   - Open popover\n   - Verify version '1.1.0' is displayed in popover\n\n**Testing Approach:**\n- Mock useUpdateStatus to control hook behavior\n- Use @testing-library/react for rendering\n- Don't test UpdatePopover behavior (separate test file)\n\n**Acceptance Criteria:**\n- [ ] All 6 test cases pass\n- [ ] useUpdateStatus hook properly mocked\n- [ ] __APP_VERSION__ global properly stubbed\n- [ ] Button disabled state tested\n- [ ] Badge conditional rendering tested","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T06:33:58.373607-06:00","updated_at":"2025-12-05T19:36:11.164284-06:00","closed_at":"2025-12-05T19:36:11.164284-06:00","dependencies":[{"issue_id":"redesign-16","depends_on_id":"redesign-11","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-16","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-17","title":"Unit tests for UpdatePopover component","description":"Create unit tests for the UpdatePopover component.\n\n**File to create:** apps/desktop/renderer/src/components/Sidebar/UpdatePopover.test.tsx\n\n**Test Setup:**\n```typescript\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { UpdatePopover } from './UpdatePopover';\nimport { createRef } from 'react';\n\nconst defaultProps = {\n  version: '1.2.0',\n  triggerRef: createRef\u003cHTMLElement\u003e(),\n  onClose: vi.fn(),\n  onInstall: vi.fn(),\n};\n\nbeforeEach(() =\u003e {\n  vi.clearAllMocks();\n});\n```\n\n**Test Cases:**\n\n1. **Displays version correctly**\n   - Render with version '1.2.0'\n   - Verify 'Version 1.2.0 is ready to install.' text exists\n   - Verify 'Update Available' header exists\n\n2. **Restart button calls onInstall**\n   - Render component\n   - Click 'Restart Now' button\n   - Verify onInstall was called once\n\n3. **Click outside closes popover**\n   - Render component\n   - Simulate mousedown event outside the popover\n   - Verify onClose was called\n\n4. **Click inside does NOT close**\n   - Render component\n   - Click inside the popover\n   - Verify onClose was NOT called\n\n5. **Escape key closes popover**\n   - Render component\n   - Dispatch keydown event with key 'Escape'\n   - Verify onClose was called\n\n6. **Other keys do NOT close**\n   - Render component\n   - Dispatch keydown with key 'Enter'\n   - Verify onClose was NOT called\n\n7. **Button uses design system styling**\n   - Render and find button\n   - Verify it has expected classes/attributes from Button component\n\n8. **Event listeners cleaned up on unmount**\n   - Use spies on document.addEventListener/removeEventListener\n   - Render, then unmount\n   - Verify removeEventListener called for 'mousedown' and 'keydown'\n\n**Testing Approach:**\n- Create mock triggerRef\n- Use userEvent for realistic interactions\n- Test event listener cleanup\n- Don't mock Button component (test integration)\n\n**Acceptance Criteria:**\n- [ ] All 8 test cases pass\n- [ ] Click outside logic properly tested\n- [ ] Keyboard navigation tested\n- [ ] Event listener cleanup verified\n- [ ] Follows testing-library best practices","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T06:34:02.923104-06:00","updated_at":"2025-12-05T19:36:11.946892-06:00","closed_at":"2025-12-05T19:36:11.946892-06:00","dependencies":[{"issue_id":"redesign-17","depends_on_id":"redesign-12","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-17","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-18","title":"Integration tests for update flow","description":"Create integration tests for the complete update flow.\n\n**File to create:** apps/desktop/auto-update.integration.test.ts\n\n**Note:** Follow existing integration test patterns in the project (see mvp.integration.test.ts, people.integration.test.ts).\n\n**Test Setup:**\n- Mock electron-updater at the IPC level\n- Use app.start() and app.stop() from test-helpers.ts\n- Access rendered UI via app.client\n\n**Test Flow 1: Update available and installed**\n```typescript\ntest('shows badge and installs update when available', async () =\u003e {\n  // 1. Start app\n  // 2. Emit update:downloaded event via IPC mock\n  // 3. Wait for badge to appear on version indicator\n  // 4. Click version indicator\n  // 5. Verify popover appears with correct version\n  // 6. Click 'Restart Now'\n  // 7. Verify update:install IPC was called\n});\n```\n\n**Test Flow 2: Update dismissed and re-opened**\n```typescript\ntest('badge persists after dismissing popover', async () =\u003e {\n  // 1. Emit update:downloaded event\n  // 2. Click version indicator (opens popover)\n  // 3. Press Escape or click outside\n  // 4. Verify popover closes\n  // 5. Verify badge still visible\n  // 6. Click version indicator again\n  // 7. Verify popover re-opens\n});\n```\n\n**Test Flow 3: No update available**\n```typescript\ntest('no badge when update not available', async () =\u003e {\n  // 1. App starts\n  // 2. Emit update:not-available event\n  // 3. Verify no badge visible\n  // 4. Verify version button is disabled\n});\n```\n\n**Test Flow 4: Error handling**\n```typescript\ntest('handles update errors gracefully', async () =\u003e {\n  // 1. Emit update:error event\n  // 2. Verify app continues to function (no crash)\n  // 3. Verify no visible error to user\n  // 4. Emit update:downloaded (retry succeeded)\n  // 5. Verify badge appears (recovery works)\n});\n```\n\n**IPC Mocking Strategy:**\n- Mock the main→renderer events by calling ipcRenderer.emit() in test\n- Verify renderer→main calls by checking ipcRenderer.send/invoke calls\n\n**Acceptance Criteria:**\n- [ ] All 4 flow tests pass\n- [ ] IPC communication properly mocked\n- [ ] Tests follow existing integration test patterns\n- [ ] Tests are not flaky (proper waits/assertions)\n- [ ] Clean setup/teardown between tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T06:34:09.439622-06:00","updated_at":"2025-12-05T19:42:33.254275-06:00","closed_at":"2025-12-05T19:42:33.254275-06:00","dependencies":[{"issue_id":"redesign-18","depends_on_id":"redesign-13","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-18","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-19","title":"Manual testing and verification","description":"Perform manual testing of the complete auto-update feature in a real environment.\n\n**Prerequisites:**\n- Production build of the app created\n- Access to create GitHub releases on the repository\n- Code signing certificates configured\n- Previous version of app installed (to test update from)\n\n**Testing Environment Setup:**\n1. Build a production version: `bun run dist:mac`\n2. Install the app to Applications folder\n3. Note the current version\n4. Create a new GitHub release with incremented version\n\n**Testing Checklist:**\n\n**Test 1: Fresh install checks for updates**\n- [ ] Install app fresh\n- [ ] Open Console.app and filter for 'Scribe'\n- [ ] Watch logs for update check ~10s after launch\n- [ ] Expected: Log shows 'checking-for-update'\n\n**Test 2: Hourly check fires**\n- [ ] Leave app running for \u003e1 hour (or modify CHECK_INTERVAL_MS for testing)\n- [ ] Expected: Another update check appears in logs\n\n**Test 3: Badge pulse animation**\n- [ ] Create a new release on GitHub\n- [ ] Wait for app to detect update (up to 1 hour, or trigger manually)\n- [ ] Expected: Badge appears with subtle pulsing effect\n- [ ] Verify animation is smooth, not jarring\n\n**Test 4: Popover positioning**\n- [ ] Click on version with badge\n- [ ] Expected: Popover appears above version indicator\n- [ ] Verify it doesn't overflow the sidebar\n- [ ] Verify it's properly aligned to the right\n\n**Test 5: Dark mode styling**\n- [ ] Toggle to dark mode\n- [ ] Verify version text color appropriate\n- [ ] Verify badge color works in dark mode\n- [ ] Verify popover styling (background, border, shadow)\n\n**Test 6: Notarization works**\n- [ ] Download fresh copy of app from GitHub release\n- [ ] Expected: App opens without Gatekeeper warnings\n- [ ] No 'unidentified developer' dialog\n\n**Test 7: Update installs correctly**\n- [ ] Click 'Restart Now' in popover\n- [ ] Expected: App quits\n- [ ] Expected: App restarts with new version\n- [ ] Verify version number in footer updated\n\n**Test 8: Dismiss behavior**\n- [ ] Open popover, click outside\n- [ ] Expected: Popover closes\n- [ ] Expected: Badge still visible\n- [ ] Click version again\n- [ ] Expected: Popover re-opens\n\n**Test 9: Network failure handling**\n- [ ] Disconnect from internet\n- [ ] Wait for update check\n- [ ] Expected: No error shown to user\n- [ ] Reconnect and wait\n- [ ] Expected: Next check succeeds\n\n**Document Issues:**\nIf any test fails, create a bug issue in beads with:\n- Test number that failed\n- Expected vs actual behavior\n- Screenshots if applicable\n- Console logs\n\n**Acceptance Criteria:**\n- [ ] All 9 tests pass\n- [ ] Issues documented and filed\n- [ ] Both architectures tested (if available)\n- [ ] Update cycle verified end-to-end","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T06:34:17.131674-06:00","updated_at":"2025-12-05T19:42:39.734304-06:00","closed_at":"2025-12-05T19:42:39.734304-06:00","dependencies":[{"issue_id":"redesign-19","depends_on_id":"redesign-13","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-19","depends_on_id":"redesign-14","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-19","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-2","title":"Install electron-updater dependency","description":"Add electron-updater package to the desktop app.\n\n**File to modify:** apps/desktop/package.json (add dependency)\n\n**Steps:**\n1. Navigate to apps/desktop directory\n2. Run: `bun add electron-updater`\n3. Verify the package was added to package.json dependencies\n\n**Note:** electron-updater ships with its own TypeScript types, so @types/electron-updater is NOT needed.\n\nThis is the core library that handles:\n- Checking GitHub Releases for updates\n- Downloading updates in background\n- Verifying checksums\n- Installing updates on quit\n\n**Reference:** https://www.electron.build/auto-update.html\n\n**Acceptance Criteria:**\n- [ ] electron-updater appears in package.json dependencies\n- [ ] bun.lockb is updated\n- [ ] No TypeScript errors when importing from electron-updater","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:31:36.797156-06:00","updated_at":"2025-12-05T19:23:08.698789-06:00","closed_at":"2025-12-05T19:23:08.698789-06:00","dependencies":[{"issue_id":"redesign-2","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-3","title":"Update electron-builder config for auto-updates","description":"Configure electron-builder in apps/desktop/package.json to support auto-updates.\n\n**File to modify:** apps/desktop/package.json\n\n**Current Config Structure:** The `build` section already exists at lines 26-106 with mac config at lines 41-57.\n\n**Changes needed:**\n\n1. Add `publish` config to the `build` section:\n```json\n\"publish\": {\n  \"provider\": \"github\",\n  \"owner\": \"OWNER\",   // TODO: Replace with actual GitHub owner\n  \"repo\": \"REPO\"      // TODO: Replace with actual repo name\n}\n```\n\n2. Update the mac.target array to add ZIP alongside existing DMG (required for auto-update):\n```json\n\"target\": [\n  { \"target\": \"dmg\", \"arch\": [\"x64\", \"arm64\"] },\n  { \"target\": \"zip\", \"arch\": [\"x64\", \"arm64\"] }\n]\n```\n\n**Why ZIP is required:** electron-updater uses ZIP files for updates on macOS. The DMG is for manual downloads, ZIP is for auto-update.\n\n**Auto-generated artifacts:** electron-builder will automatically generate `latest-mac.yml` manifest file containing:\n- Version information\n- File checksums (sha512)\n- File sizes\n- Download URLs\n\n**Acceptance Criteria:**\n- [ ] `publish` config added with github provider\n- [ ] ZIP target added to mac.target array\n- [ ] Both x64 and arm64 architectures specified for ZIP\n- [ ] Existing DMG configuration preserved","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:31:41.115444-06:00","updated_at":"2025-12-05T19:23:09.837763-06:00","closed_at":"2025-12-05T19:23:09.837763-06:00","dependencies":[{"issue_id":"redesign-3","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-4","title":"Configure Vite to inject app version at build time","description":"Update Vite config to inject the app version as a global constant.\n\n**Files to modify:**\n1. apps/desktop/renderer/vite.config.ts\n2. apps/desktop/renderer/src/types/scribe.d.ts (add global declaration)\n\n**Current State:** The vite config does NOT have a `define` section currently.\n\n**Changes to vite.config.ts:**\n\nAdd the `define` section and import package.json:\n```typescript\nimport pkg from '../package.json';\n\nexport default defineConfig({\n  // ... existing plugins, resolve, build, server, base sections\n  define: {\n    __APP_VERSION__: JSON.stringify(pkg.version),\n  },\n});\n```\n\n**Changes to scribe.d.ts:**\n\nAdd the global declaration (can be placed at the top of the file):\n```typescript\ndeclare const __APP_VERSION__: string;\n```\n\n**Purpose:** This allows the renderer to access the current app version at build time without IPC calls. Used by VersionIndicator component to display `v{__APP_VERSION__}`.\n\n**Note:** You may need to add `\"resolveJsonModule\": true` to tsconfig if not already present.\n\n**Acceptance Criteria:**\n- [ ] `define` section added to vite.config.ts\n- [ ] Package.json version is injected as __APP_VERSION__\n- [ ] Global declaration added to type definitions\n- [ ] No TypeScript errors when using __APP_VERSION__ in renderer code\n- [ ] Build succeeds with version injection","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:31:45.159355-06:00","updated_at":"2025-12-05T19:23:11.133859-06:00","closed_at":"2025-12-05T19:23:11.133859-06:00","dependencies":[{"issue_id":"redesign-4","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-5","title":"Create auto-updater module in main process","description":"Create the core auto-updater module that handles all update logic in the main process.\n\n**File to create:** apps/desktop/electron/main/src/auto-updater.ts\n\n**Implementation Details:**\n\n1. **Configure autoUpdater from electron-updater:**\n```typescript\nimport { autoUpdater } from 'electron-updater';\nimport { BrowserWindow, ipcMain } from 'electron';\nimport log from 'electron-log';\n\nconst CHECK_INTERVAL_MS = 60 * 60 * 1000; // 1 hour\n\nautoUpdater.logger = log;\nautoUpdater.autoDownload = true;\nautoUpdater.autoInstallOnAppQuit = true;\n```\n\n2. **Event handlers that forward events to renderer:**\n```typescript\nautoUpdater.on('checking-for-update', () =\u003e {\n  mainWindow.webContents.send('update:checking');\n});\n\nautoUpdater.on('update-available', (info) =\u003e {\n  mainWindow.webContents.send('update:available', {\n    version: info.version,\n    releaseDate: info.releaseDate,\n  });\n});\n\nautoUpdater.on('update-not-available', () =\u003e {\n  mainWindow.webContents.send('update:not-available');\n});\n\nautoUpdater.on('update-downloaded', (info) =\u003e {\n  mainWindow.webContents.send('update:downloaded', {\n    version: info.version,\n    releaseDate: info.releaseDate,\n  });\n});\n\nautoUpdater.on('error', (err) =\u003e {\n  log.error('Auto-updater error:', err);\n  mainWindow.webContents.send('update:error', { message: err.message });\n});\n```\n\n3. **Periodic checking:**\n- Initial check after 10s delay (avoid blocking startup)\n- Periodic checks every 1 hour using setInterval\n\n4. **Export function:**\n```typescript\nexport function setupAutoUpdater(mainWindow: BrowserWindow): void\n```\n\n**Error Handling:**\n- Network failures: catch and log, retry on next interval\n- GitHub rate limiting: fail silently\n- Corrupt downloads: electron-updater handles checksum validation\n\n**Acceptance Criteria:**\n- [ ] Module exports setupAutoUpdater function\n- [ ] All electron-updater events are forwarded to renderer via IPC\n- [ ] Initial check runs 10s after setup\n- [ ] Hourly check interval is established\n- [ ] Errors are logged but don't crash the app\n- [ ] TypeScript compiles without errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:32:01.36613-06:00","updated_at":"2025-12-05T19:24:52.796701-06:00","closed_at":"2025-12-05T19:24:52.796701-06:00","dependencies":[{"issue_id":"redesign-5","depends_on_id":"redesign-2","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-5","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-6","title":"Add IPC handlers for update commands","description":"Add IPC handlers in the auto-updater module for renderer-to-main communication.\n\n**File to modify:** apps/desktop/electron/main/src/auto-updater.ts (created in redesign-5)\n\n**Add inside setupAutoUpdater function:**\n\n1. **`update:check` handler (renderer → main):**\n```typescript\nipcMain.handle('update:check', async () =\u003e {\n  await autoUpdater.checkForUpdates();\n});\n```\n- Allows manual update checks from renderer\n- Returns Promise\u003cvoid\u003e\n- Uses `ipcMain.handle` for async request/response\n\n2. **`update:install` handler (renderer → main):**\n```typescript\nipcMain.on('update:install', () =\u003e {\n  autoUpdater.quitAndInstall();\n});\n```\n- Quits app and installs the downloaded update\n- One-way communication (no response needed)\n- Uses `ipcMain.on` instead of `handle` (fire-and-forget)\n\n**IPC Channel Naming Convention:**\nFollowing existing pattern in codebase: `namespace:method` (e.g., `notes:list`, `app:openDevTools`)\n\n**These handlers enable the renderer UI to:**\n- Trigger manual update checks (if needed in future)\n- Initiate the quit-and-install flow when user clicks 'Restart Now'\n\n**Acceptance Criteria:**\n- [ ] `update:check` IPC handler registered with ipcMain.handle\n- [ ] `update:install` IPC handler registered with ipcMain.on\n- [ ] Handlers added inside setupAutoUpdater function\n- [ ] No duplicate handler registration on multiple calls","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:32:06.628832-06:00","updated_at":"2025-12-05T19:25:07.69107-06:00","closed_at":"2025-12-05T19:25:07.69107-06:00","dependencies":[{"issue_id":"redesign-6","depends_on_id":"redesign-5","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-6","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-7","title":"Integrate auto-updater in main.ts","description":"Call setupAutoUpdater in the main process entry point.\n\n**File to modify:** apps/desktop/electron/main/src/main.ts\n\n**Existing Pattern:** The file defines `isDev` at line 14:\n```typescript\nconst isDev = process.env.NODE_ENV === 'development';\n```\n\n**Changes Required:**\n\n1. **Import the setup function (add near other imports):**\n```typescript\nimport { setupAutoUpdater } from './auto-updater';\n```\n\n2. **Call setup after window is ready (inside app.whenReady callback, after createWindow):**\n```typescript\napp.whenReady().then(async () =\u003e {\n  // ... existing initialization code ...\n  createWindow();\n  \n  // Only enable auto-updates in production\n  if (!isDev) {\n    setupAutoUpdater(mainWindow);\n  }\n});\n```\n\n**Important Considerations:**\n- Only enable in production builds (use existing `isDev` variable)\n- Must be called AFTER mainWindow is created and ready\n- setupAutoUpdater needs reference to mainWindow to send IPC events\n\n**Why the isDev check matters:**\n- electron-updater doesn't work in development mode (no packaged app)\n- Avoids unnecessary network calls during development\n- Prevents confusing error messages in dev console\n\n**Acceptance Criteria:**\n- [ ] Import statement added for setupAutoUpdater\n- [ ] setupAutoUpdater called only when !isDev\n- [ ] Called after createWindow() completes\n- [ ] mainWindow reference passed correctly\n- [ ] App starts successfully in both dev and production modes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:32:11.095019-06:00","updated_at":"2025-12-05T19:26:17.350029-06:00","closed_at":"2025-12-05T19:26:17.350029-06:00","dependencies":[{"issue_id":"redesign-7","depends_on_id":"redesign-5","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-7","depends_on_id":"redesign-6","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-7","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-8","title":"Extend preload API with update namespace","description":"Add the update API to the preload script to expose update functionality to the renderer.\n\n**File to modify:** apps/desktop/electron/preload/src/preload.ts\n\n**Existing Pattern:** The file uses `contextBridge.exposeInMainWorld` to expose a `scribeAPI` object with namespaced methods (e.g., `notes`, `app`, `people`).\n\n**Add to the scribeAPI object (follow existing namespace pattern):**\n\n```typescript\nupdate: {\n  /** Manually check for updates */\n  check: (): Promise\u003cvoid\u003e =\u003e ipcRenderer.invoke('update:check'),\n  \n  /** Quit and install the downloaded update */\n  install: (): void =\u003e ipcRenderer.send('update:install'),\n  \n  /** Subscribe to checking event */\n  onChecking: (callback: () =\u003e void): (() =\u003e void) =\u003e {\n    const handler = () =\u003e callback();\n    ipcRenderer.on('update:checking', handler);\n    return () =\u003e ipcRenderer.removeListener('update:checking', handler);\n  },\n  \n  /** Subscribe to available event */\n  onAvailable: (callback: (info: { version: string }) =\u003e void): (() =\u003e void) =\u003e {\n    const handler = (_event: Electron.IpcRendererEvent, info: { version: string }) =\u003e callback(info);\n    ipcRenderer.on('update:available', handler);\n    return () =\u003e ipcRenderer.removeListener('update:available', handler);\n  },\n  \n  /** Subscribe to not-available event */\n  onNotAvailable: (callback: () =\u003e void): (() =\u003e void) =\u003e {\n    const handler = () =\u003e callback();\n    ipcRenderer.on('update:not-available', handler);\n    return () =\u003e ipcRenderer.removeListener('update:not-available', handler);\n  },\n  \n  /** Subscribe to downloaded event */\n  onDownloaded: (callback: (info: { version: string }) =\u003e void): (() =\u003e void) =\u003e {\n    const handler = (_event: Electron.IpcRendererEvent, info: { version: string }) =\u003e callback(info);\n    ipcRenderer.on('update:downloaded', handler);\n    return () =\u003e ipcRenderer.removeListener('update:downloaded', handler);\n  },\n  \n  /** Subscribe to error event */\n  onError: (callback: (error: { message: string }) =\u003e void): (() =\u003e void) =\u003e {\n    const handler = (_event: Electron.IpcRendererEvent, error: { message: string }) =\u003e callback(error);\n    ipcRenderer.on('update:error', handler);\n    return () =\u003e ipcRenderer.removeListener('update:error', handler);\n  },\n},\n```\n\n**Key Pattern:** Each `on*` method returns an unsubscribe function for cleanup in React useEffect.\n\n**Acceptance Criteria:**\n- [ ] `update` namespace added to scribeAPI object\n- [ ] `check()` calls ipcRenderer.invoke\n- [ ] `install()` calls ipcRenderer.send (fire-and-forget)\n- [ ] All on* methods return unsubscribe functions\n- [ ] Event handlers properly pass data to callbacks\n- [ ] TypeScript compiles without errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:32:30.680949-06:00","updated_at":"2025-12-05T19:27:32.879158-06:00","closed_at":"2025-12-05T19:27:32.879158-06:00","dependencies":[{"issue_id":"redesign-8","depends_on_id":"redesign-6","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-8","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-9","title":"Add UpdateAPI TypeScript declarations","description":"Add TypeScript type declarations for the update API.\n\n**File to modify:** apps/desktop/renderer/src/types/scribe.d.ts\n\n**Existing Pattern:** The file defines interfaces for each API namespace (e.g., `PeopleAPI`, `NotesAPI`) and combines them in `ScribeAPI` interface, then augments `Window` globally.\n\n**Add the UpdateAPI interface (place near other API interfaces):**\n\n```typescript\n/** API for auto-update functionality */\nexport interface UpdateAPI {\n  /** Manually trigger update check */\n  check(): Promise\u003cvoid\u003e;\n  \n  /** Quit and install downloaded update */\n  install(): void;\n  \n  /** Subscribe to checking event, returns unsubscribe function */\n  onChecking(callback: () =\u003e void): () =\u003e void;\n  \n  /** Subscribe to available event with version info */\n  onAvailable(callback: (info: { version: string }) =\u003e void): () =\u003e void;\n  \n  /** Subscribe to not-available event */\n  onNotAvailable(callback: () =\u003e void): () =\u003e void;\n  \n  /** Subscribe to downloaded event with version info */\n  onDownloaded(callback: (info: { version: string }) =\u003e void): () =\u003e void;\n  \n  /** Subscribe to error event with error message */\n  onError(callback: (error: { message: string }) =\u003e void): () =\u003e void;\n}\n```\n\n**Update the ScribeAPI interface to include update:**\n\n```typescript\nexport interface ScribeAPI {\n  // ... existing properties (ping, notes, app, search, graph, people, templates, etc.)\n  \n  /** Auto-update API */\n  update: UpdateAPI;\n}\n```\n\n**Purpose:** Provides full type safety when using `window.scribe.update.*` in renderer code. Enables IDE autocomplete and compile-time error checking.\n\n**Acceptance Criteria:**\n- [ ] UpdateAPI interface defined with all methods\n- [ ] UpdateAPI added to ScribeAPI interface\n- [ ] JSDoc comments included for all methods\n- [ ] Return types specified for all methods (including unsubscribe functions)\n- [ ] No TypeScript errors in renderer code using window.scribe.update","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-05T06:32:35.395987-06:00","updated_at":"2025-12-05T19:28:30.788705-06:00","closed_at":"2025-12-05T19:28:30.788705-06:00","dependencies":[{"issue_id":"redesign-9","depends_on_id":"redesign-8","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-9","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
