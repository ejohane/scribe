{"id":"scribe-3na","title":"Meeting Note Date Selection - Past/Future Date Support","description":"## Meeting Note Date Selection - Past/Future Date Support\n\nEnhance the \"New Meeting\" modal to include a calendar date picker, allowing users to associate meetings with past or future dates. The selected date's daily note will be auto-created if it doesn't exist.\n\n**Implements:** GitHub issue #36\n\n### Key Outcomes\n- Users can create meeting notes for any date (past, present, or future)\n- New Calendar primitive in design-system using react-day-picker v9\n- New DatePicker composite component (trigger + popover + calendar)\n- New MeetingCreatePanel replacing the simple prompt-based meeting creation\n- Updated IPC contract, preload, and handlers to accept date parameter\n\n---\n\n## Architecture \u0026 Dependency Graph\n\n```\n                     ┌──────────────────────────────────────────────────────┐\n                     │                   PARALLEL START                      │\n                     │                                                       │\n                     │   ┌─────────────┐         ┌─────────────┐            │\n                     │   │  3na.1      │         │  3na.4      │            │\n                     │   │  react-day- │         │  IPC        │            │\n                     │   │  picker     │         │  Contract   │            │\n                     │   │  P0         │         │  P1         │            │\n                     │   └──────┬──────┘         └──────┬──────┘            │\n                     └──────────┼────────────────────────┼──────────────────┘\n                                │                        │\n            ┌───────────────────┼────────────┐           │\n            │                   │            │           │\n            ▼                   ▼            │           ▼\n    ┌─────────────┐     ┌─────────────┐      │   ┌─────────────┐\n    │  3na.2      │     │  3na.8      │      │   │  3na.11     │\n    │  Calendar   │     │  Calendar   │      │   │  Preload    │\n    │  Component  │     │  Tests      │      │   │  Bridge     │\n    │  P1         │     │  P2         │      │   │  P1         │\n    └──────┬──────┘     └─────────────┘      │   └──────┬──────┘\n           │                                 │          │\n           ▼                                 │          ▼\n    ┌─────────────┐                          │   ┌─────────────┐\n    │  3na.3      │                          │   │  3na.5      │\n    │  DatePicker │                          │   │  Handler    │\n    │  Composite  │                          │   │  Update     │\n    │  P1         │                          │   │  P2         │\n    └──────┬──────┘                          │   └──────┬──────┘\n           │                                 │          │\n           ├───────────────┐                 │          │\n           │               │                 │          │\n           ▼               ▼                 │          │\n    ┌─────────────┐ ┌─────────────┐          │          │\n    │  3na.6      │ │  3na.9      │          │          │\n    │  Meeting    │ │  DatePicker │          │          │\n    │  Panel      │ │  Tests      │          │          │\n    │  P2         │ │  P2         │          │          │\n    └──────┬──────┘ └─────────────┘          │          │\n           │                                 │          │\n           └─────────────────────────────────┼──────────┘\n                                             │\n                                             ▼\n                                      ┌─────────────┐\n                                      │  3na.7      │\n                                      │  WIRE UP    │\n                                      │  (converge) │\n                                      │  P2         │\n                                      └──────┬──────┘\n                                             │\n                                             ▼\n                                      ┌─────────────┐\n                                      │  3na.10     │\n                                      │  Integration│\n                                      │  Tests      │\n                                      │  P3         │\n                                      └─────────────┘\n```\n\n---\n\n## Task Summary (11 tasks)\n\n| ID | Title | Blocks | Priority | Est. Time |\n|----|-------|--------|----------|-----------|\n| **3na.1** | Add react-day-picker@^9 dep | 3na.2 | **P0** | 15m |\n| **3na.4** | IPC contract update | 3na.11 | P1 | 20m |\n| 3na.2 | Calendar component | 3na.3, 3na.8 | P1 | 2-3h |\n| 3na.3 | DatePicker composite | 3na.6, 3na.9 | P1 | 2h |\n| 3na.11 | Preload bridge update | 3na.5 | P1 | 15m |\n| 3na.5 | Handler update | 3na.7 | P2 | 1h |\n| 3na.6 | MeetingCreatePanel | 3na.7 | P2 | 1.5h |\n| 3na.7 | Wire CommandPalette | 3na.10 | P2 | 1.5h |\n| 3na.8 | Calendar tests | - | P2 | 1.5h |\n| 3na.9 | DatePicker tests | - | P2 | 1.5h |\n| 3na.10 | Integration tests | - | P3 | 2h |\n\n---\n\n## Optimal Parallelization Strategy\n\n### With 2 Workers\n```\nWorker 1 (UI Track):        3na.1 → 3na.2 → 3na.3 → 3na.6 → 3na.7\nWorker 2 (Backend Track):   3na.4 → 3na.11 → 3na.5 → (wait) → 3na.7\n```\n- **Critical path:** ~8-10 hours sequential, ~5-6 hours parallel\n- Worker 2 will be idle briefly after 3na.5 while waiting for 3na.6\n\n### With 3 Workers\n```\nWorker 1 (UI):              3na.1 → 3na.2 → 3na.3 → 3na.6\nWorker 2 (Backend):         3na.4 → 3na.11 → 3na.5\nWorker 3 (Tests):           (wait for 3na.2) → 3na.8 → 3na.9 → 3na.10\n```\n- Test worker can start once Calendar (3na.2) is complete\n- Total time: ~4-5 hours\n\n### Key Parallelization Insight\n**3na.1 and 3na.4 can start simultaneously!**\n- 3na.1 (react-day-picker install) is for UI components\n- 3na.4 (IPC contract) is pure TypeScript types with no react-day-picker dependency\n\n---\n\n## Files Affected\n\n### Design System (packages/design-system/)\n- `package.json` - add react-day-picker@^9\n- `src/primitives/Calendar/` - new component\n- `src/primitives/DatePicker/` - new component  \n- `src/primitives/index.ts` - exports\n\n### Shared (packages/shared/)\n- `src/ipc-contract.ts` - MeetingAPI.create signature\n\n### Desktop App (apps/desktop/)\n- `electron/preload/src/preload.ts` - meeting.create bridge\n- `electron/main/src/handlers/meetingHandlers.ts` - handler\n- `renderer/src/components/MeetingCreatePanel/` - new component\n- `renderer/src/commands/types.ts` - add 'meeting-create' mode\n- `renderer/src/commands/templates.ts` - update command\n- `renderer/src/components/CommandPalette/CommandPalette.tsx` - render panel\n\n---\n\n## Risk Mitigation\n\n1. **react-day-picker v9 API changes**: Task 3na.2 includes v9-specific classNames mapping\n2. **Z-index conflicts**: DatePicker popover uses z-index: 100, documented in 3na.3\n3. **Escape key propagation**: Both DatePicker and MeetingCreatePanel use stopPropagation()\n4. **Date format consistency**: ISO (YYYY-MM-DD) for IPC, MM-dd-yyyy for internal storage\n\n---\n\n## Completion Checklist\n- [ ] All 11 tasks completed\n- [ ] `bun run typecheck` passes\n- [ ] `bun run test` passes\n- [ ] Manual QA: Create meeting for today, past date, future date\n- [ ] Manual QA: Cancel from meeting create panel\n- [ ] Manual QA: Keyboard navigation works","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-18T14:48:08.412606-06:00","updated_at":"2025-12-18T15:08:32.70153-06:00"}
{"id":"scribe-3na.1","title":"Add react-day-picker dependency to design-system package","description":"## Add react-day-picker dependency to design-system package\n\n**CRITICAL PATH:** This task MUST complete before UI component work can begin.\n\n### Steps\n1. Run `bun add react-day-picker@^9` in `packages/design-system`\n2. Verify compatibility with existing React version (check peer deps)\n3. Verify date-fns compatibility (already installed at workspace level)\n\n### Verification\n```bash\ncd packages/design-system\nbun add react-day-picker@^9\nbun run typecheck\n```\n\n### Version Notes\n- **Use react-day-picker v9.x** (latest major version)\n- v9.x requires React 18+ (we have 18.x) ✓\n- v9.x has improved TypeScript support and ESM exports\n- date-fns is already a workspace dependency, used throughout codebase\n- No CSS import needed - we'll style with Vanilla Extract\n\n### Acceptance Criteria\n- [ ] react-day-picker@^9 added to packages/design-system/package.json\n- [ ] `bun install` succeeds with no peer dependency warnings\n- [ ] `bun run typecheck` passes in design-system package\n- [ ] Basic import test: `import { DayPicker } from 'react-day-picker'` compiles\n\n### Dependencies\nNone - this is a root task that unblocks the UI track.\n\n### Parallelization Note\n**scribe-3na.4 (IPC contract) can start immediately in parallel** - it has no dependency on react-day-picker.\n\n### Estimated Time\n15 minutes","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-18T14:48:08.477951-06:00","updated_at":"2025-12-18T15:04:58.822647-06:00","dependencies":[{"issue_id":"scribe-3na.1","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.478264-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.10","title":"Add integration tests for meeting creation with date selection","description":"## Add integration tests for meeting creation with date selection\n\nAdd integration tests for the complete meeting creation flow with date selection.\n\n### Dependencies\n- **Blocked by:** scribe-3na.7 (all components and wiring must be complete)\n- **This is the FINAL validation task for the epic**\n\n### Test File\n`apps/desktop/date-based-meeting.integration.test.ts` (new file)\n\n### Test Setup\n```typescript\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport { format, subDays, addDays } from 'date-fns';\nimport { setupTestVault, cleanupTestVault } from './test-helpers';\n\ndescribe('Meeting Creation with Date Selection', () =\u003e {\n  let testContext: TestContext;\n  \n  beforeEach(async () =\u003e {\n    testContext = await setupTestVault();\n  });\n  \n  afterEach(async () =\u003e {\n    await cleanupTestVault(testContext);\n  });\n});\n```\n\n### Test Scenarios\n\n#### 1. Create meeting for today (default behavior)\n```typescript\nit('creates meeting for today when no date specified', async () =\u003e {\n  const { handlers } = testContext;\n  const title = 'Sprint Planning';\n  \n  const note = await handlers.meeting.create({ title });\n  \n  expect(note.type).toBe('meeting');\n  expect(note.title).toBe(title);\n  expect(note.meeting.date).toBe(format(new Date(), 'MM-dd-yyyy'));\n  \n  // Verify daily note was created for today\n  const dailyNote = testContext.vault.read(note.meeting.dailyNoteId);\n  expect(dailyNote.type).toBe('daily');\n  expect(dailyNote.title).toBe(format(new Date(), 'MM-dd-yyyy'));\n});\n```\n\n#### 2. Create meeting for a past date\n```typescript\nit('creates meeting for a past date', async () =\u003e {\n  const { handlers } = testContext;\n  const pastDate = subDays(new Date(), 7); // 7 days ago\n  const isoDate = format(pastDate, 'yyyy-MM-dd');\n  \n  const note = await handlers.meeting.create({ \n    title: 'Retro', \n    date: isoDate \n  });\n  \n  expect(note.meeting.date).toBe(format(pastDate, 'MM-dd-yyyy'));\n  \n  // Verify correct daily note was created\n  const dailyNote = testContext.vault.read(note.meeting.dailyNoteId);\n  expect(dailyNote.title).toBe(format(pastDate, 'MM-dd-yyyy'));\n});\n```\n\n#### 3. Create meeting for a future date\n```typescript\nit('creates meeting for a future date', async () =\u003e {\n  const { handlers } = testContext;\n  const futureDate = addDays(new Date(), 14); // 2 weeks from now\n  const isoDate = format(futureDate, 'yyyy-MM-dd');\n  \n  const note = await handlers.meeting.create({ \n    title: 'Planning', \n    date: isoDate \n  });\n  \n  expect(note.meeting.date).toBe(format(futureDate, 'MM-dd-yyyy'));\n});\n```\n\n#### 4. Multiple meetings on same date share daily note\n```typescript\nit('reuses daily note for multiple meetings on same date', async () =\u003e {\n  const { handlers, vault } = testContext;\n  const date = '2025-12-25';\n  \n  const meeting1 = await handlers.meeting.create({ title: 'Meeting 1', date });\n  const meeting2 = await handlers.meeting.create({ title: 'Meeting 2', date });\n  \n  // Both should link to same daily note\n  expect(meeting1.meeting.dailyNoteId).toBe(meeting2.meeting.dailyNoteId);\n  \n  // Only one daily note should exist for that date\n  const dailyNotes = vault.list().filter(\n    n =\u003e n.type === 'daily' \u0026\u0026 n.title === '12-25-2025'\n  );\n  expect(dailyNotes).toHaveLength(1);\n});\n```\n\n#### 5. Invalid date handling\n```typescript\nit('rejects invalid date format', async () =\u003e {\n  const { handlers } = testContext;\n  \n  await expect(\n    handlers.meeting.create({ title: 'Test', date: 'invalid-date' })\n  ).rejects.toThrow(/VALIDATION_ERROR|Invalid date format/);\n});\n\nit('rejects invalid date values', async () =\u003e {\n  const { handlers } = testContext;\n  \n  await expect(\n    handlers.meeting.create({ title: 'Test', date: '2025-13-45' })\n  ).rejects.toThrow(/VALIDATION_ERROR|Invalid date format/);\n});\n\nit('treats empty string date as today', async () =\u003e {\n  const { handlers } = testContext;\n  \n  const note = await handlers.meeting.create({ title: 'Test', date: '' });\n  expect(note.meeting.date).toBe(format(new Date(), 'MM-dd-yyyy'));\n});\n```\n\n### Backward Compatibility\n```typescript\nit('maintains backward compatibility with existing calls', async () =\u003e {\n  const { handlers } = testContext;\n  \n  // Old signature: just title\n  const note = await handlers.meeting.create({ title: 'Old Style' });\n  \n  // Should default to today\n  expect(note.meeting.date).toBe(format(new Date(), 'MM-dd-yyyy'));\n});\n```\n\n### Acceptance Criteria\n- [ ] All 7 test scenarios pass\n- [ ] Tests are isolated (each test cleans up properly)\n- [ ] Daily note reuse verified\n- [ ] Error cases covered with proper error codes\n- [ ] Backward compatibility verified\n- [ ] Tests use consistent date formatting\n\n### Estimated Time\n2 hours","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-18T14:48:09.053011-06:00","updated_at":"2025-12-18T15:07:56.250181-06:00","dependencies":[{"issue_id":"scribe-3na.10","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:09.053325-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.10","depends_on_id":"scribe-3na.7","type":"blocks","created_at":"2025-12-18T14:48:14.985921-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.11","title":"Update preload bridge to pass date parameter for meeting.create","description":"## Update preload bridge to pass date parameter for meeting.create\n\nUpdate the preload bridge to pass the optional date parameter from renderer to main process.\n\n### Dependencies\n- **Blocked by:** scribe-3na.4 (IPC contract must define the new signature first)\n\n### Current Implementation (preload.ts:68-69)\n```typescript\nmeeting: {\n  create: (title: string) =\u003e ipcRenderer.invoke(IPC_CHANNELS.MEETING_CREATE, { title }),\n  // ...\n}\n```\n\n### Required Change\n```typescript\nmeeting: {\n  create: (title: string, date?: string) =\u003e \n    ipcRenderer.invoke(IPC_CHANNELS.MEETING_CREATE, { title, date }),\n  // ...\n}\n```\n\n### Files Changed\n- `apps/desktop/electron/preload/src/preload.ts` (line 69)\n\n### Why This Task Exists\nThe data flow for IPC in Electron is:\n\n```\nRenderer (React) \n    → window.scribe.meeting.create(title, date)\n    → Preload Bridge (this task)\n    → ipcRenderer.invoke('meeting:create', { title, date })\n    → Main Process Handler (scribe-3na.5)\n```\n\nThe IPC contract (scribe-3na.4) defines TypeScript types, but the preload bridge is the actual runtime implementation that serializes and forwards the call.\n\n### Verification\n```bash\ncd apps/desktop\nbun run typecheck\n```\n\nAfter this change:\n1. Renderer can call `window.scribe.meeting.create('Title', '2025-12-25')`\n2. Preload forwards `{ title: 'Title', date: '2025-12-25' }` to main\n3. Handler receives and processes both parameters\n\n### Type Safety\nThe preload must match the `MeetingAPI` interface from `@scribe/shared`. After scribe-3na.4 completes, TypeScript will enforce that this implementation matches.\n\n### Acceptance Criteria\n- [ ] Preload `meeting.create` accepts optional `date?: string` parameter\n- [ ] Date is included in IPC payload: `{ title, date }`\n- [ ] TypeScript compiles without errors\n- [ ] Existing calls without date parameter still work (backward compatible)\n\n### Estimated Time\n15 minutes","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T14:56:50.888195-06:00","updated_at":"2025-12-18T15:06:03.281528-06:00","dependencies":[{"issue_id":"scribe-3na.11","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:56:50.888563-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.11","depends_on_id":"scribe-3na.4","type":"blocks","created_at":"2025-12-18T15:04:27.470466-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.2","title":"Create Calendar primitive component with Vanilla Extract styling","description":"## Create Calendar primitive component with Vanilla Extract styling\n\nCreate a Calendar primitive component in the design-system using react-day-picker with Vanilla Extract styling.\n\n### Dependencies\n- **Blocked by:** scribe-3na.1 (react-day-picker must be installed first)\n\n### Files to Create\n```\npackages/design-system/src/primitives/Calendar/\n├── index.ts           # Re-export\n├── Calendar.tsx       # Main component\n└── Calendar.css.ts    # Vanilla Extract styles\n```\n\n### Component API\n```typescript\nimport { DayPicker } from 'react-day-picker';\n\nexport interface CalendarProps {\n  mode?: 'single';           // Only single selection needed for now\n  selected?: Date;\n  onSelect?: (date: Date | undefined) =\u003e void;\n  defaultMonth?: Date;\n  disabled?: Date[] | ((date: Date) =\u003e boolean);\n  className?: string;\n}\n\nexport function Calendar({ mode = 'single', selected, onSelect, ...props }: CalendarProps) {\n  return (\n    \u003cDayPicker\n      mode={mode}\n      selected={selected}\n      onSelect={onSelect}\n      classNames={calendarClassNames}  // Map to our VE styles\n      {...props}\n    /\u003e\n  );\n}\n```\n\n### Design Tokens Location\nUse tokens from `packages/design-system/src/theme/vars.css.ts`:\n- `vars.colors.surface`, `vars.colors.border`, `vars.colors.primary`\n- `vars.spacing.xs`, `vars.spacing.sm`, `vars.spacing.md`\n- `vars.radii.sm`, `vars.radii.md`\n- `vars.shadows.sm`\n\n### react-day-picker v9 classNames to Style\n```typescript\nconst calendarClassNames = {\n  root: styles.root,\n  months: styles.months,\n  month: styles.month,\n  month_caption: styles.monthCaption,      // v9 renamed from caption\n  caption_label: styles.captionLabel,\n  nav: styles.nav,\n  button_previous: styles.navButton,       // v9 renamed\n  button_next: styles.navButton,           // v9 renamed  \n  month_grid: styles.table,                // v9 renamed from table\n  weekdays: styles.headRow,                // v9 renamed\n  weekday: styles.headCell,                // v9 renamed\n  week: styles.row,                        // v9 renamed\n  day: styles.cell,                        // v9: wrapper element\n  day_button: styles.dayButton,            // v9: the clickable button\n  selected: styles.daySelected,\n  today: styles.dayToday,\n  disabled: styles.dayDisabled,\n  outside: styles.dayOutside,\n};\n```\n\n### Styling Requirements\n- Day cells: 32x32px minimum touch target\n- States: default, hover (scale up slightly), selected (primary color), today (ring), disabled (opacity)\n- Navigation: ChevronLeft/ChevronRight icons from lucide-react\n- Font: Use `vars.fontFamily.sans`\n\n### Export from primitives/index.ts\n```typescript\nexport { Calendar } from './Calendar';\nexport type { CalendarProps } from './Calendar';\n```\n\n### Acceptance Criteria\n- [ ] Calendar component renders react-day-picker v9\n- [ ] All visual states styled (hover, selected, today, disabled, outside)\n- [ ] Keyboard navigation works (arrow keys, Enter to select)\n- [ ] Uses design system tokens for colors/spacing\n- [ ] Exported from @scribe/design-system\n- [ ] `bun run typecheck` passes\n- [ ] No console warnings about missing classNames\n\n### Estimated Time\n2-3 hours","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T14:48:08.543549-06:00","updated_at":"2025-12-18T15:05:15.356032-06:00","dependencies":[{"issue_id":"scribe-3na.2","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.54387-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.2","depends_on_id":"scribe-3na.1","type":"blocks","created_at":"2025-12-18T14:48:14.563193-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.3","title":"Create DatePicker composite component (trigger + popover + calendar)","description":"## Create DatePicker composite component (trigger + popover + calendar)\n\nCreate a DatePicker composite component that combines a trigger button, popover container, and the Calendar component.\n\n### Dependencies\n- **Blocked by:** scribe-3na.2 (Calendar component must exist)\n\n### Files to Create\n```\npackages/design-system/src/primitives/DatePicker/\n├── index.ts           # Re-export\n├── DatePicker.tsx     # Main component\n└── DatePicker.css.ts  # Vanilla Extract styles\n```\n\n### Component API\n```typescript\nimport { useState, useRef, useEffect } from 'react';\nimport { format, isToday } from 'date-fns';\nimport { CalendarIcon, ChevronDownIcon } from 'lucide-react';\nimport { Calendar } from '../Calendar';\n\nexport interface DatePickerProps {\n  value?: Date;\n  onChange: (date: Date) =\u003e void;\n  placeholder?: string;    // Default: \"Select date\"\n  disabled?: boolean;\n}\n\nexport function DatePicker({ \n  value, \n  onChange, \n  placeholder = 'Select date', \n  disabled \n}: DatePickerProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const containerRef = useRef\u003cHTMLDivElement\u003e(null);\n  \n  // Format display text\n  const displayText = value\n    ? isToday(value)\n      ? `Today (${format(value, 'MMM d')})`  // \"Today (Dec 18)\"\n      : format(value, 'MMM d, yyyy')          // \"Dec 25, 2025\"\n    : placeholder;\n  \n  // Click outside handler\n  useEffect(() =\u003e {\n    if (!isOpen) return;\n    const handleClickOutside = (e: MouseEvent) =\u003e {\n      if (containerRef.current \u0026\u0026 !containerRef.current.contains(e.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () =\u003e document.removeEventListener('mousedown', handleClickOutside);\n  }, [isOpen]);\n\n  // Escape key handler\n  useEffect(() =\u003e {\n    if (!isOpen) return;\n    const handleEscape = (e: KeyboardEvent) =\u003e {\n      if (e.key === 'Escape') {\n        e.stopPropagation(); // Prevent closing parent modals\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('keydown', handleEscape);\n    return () =\u003e document.removeEventListener('keydown', handleEscape);\n  }, [isOpen]);\n\n  return (\n    \u003cdiv ref={containerRef} className={styles.container}\u003e\n      \u003cbutton\n        type=\"button\"\n        className={styles.trigger}\n        onClick={() =\u003e !disabled \u0026\u0026 setIsOpen(true)}\n        disabled={disabled}\n      \u003e\n        \u003cCalendarIcon size={16} /\u003e\n        \u003cspan\u003e{displayText}\u003c/span\u003e\n        \u003cChevronDownIcon size={16} /\u003e\n      \u003c/button\u003e\n      \n      {isOpen \u0026\u0026 (\n        \u003cdiv className={styles.popover}\u003e\n          \u003cCalendar\n            mode=\"single\"\n            selected={value}\n            onSelect={(date) =\u003e {\n              if (date) {\n                onChange(date);\n                setIsOpen(false);\n              }\n            }}\n          /\u003e\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n### Styling with Proper Z-Index\n```typescript\n// DatePicker.css.ts\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '../../theme/vars.css';\n\nexport const container = style({\n  position: 'relative',\n  display: 'inline-block',\n});\n\nexport const trigger = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing.sm,\n  padding: `${vars.spacing.sm} ${vars.spacing.md}`,\n  border: `1px solid ${vars.colors.border}`,\n  borderRadius: vars.radii.md,\n  background: vars.colors.surface,\n  color: vars.colors.text,\n  cursor: 'pointer',\n  fontSize: vars.fontSize.sm,\n  transition: 'border-color 0.15s ease',\n  ':hover': {\n    borderColor: vars.colors.borderHover,\n  },\n  ':focus': {\n    outline: 'none',\n    borderColor: vars.colors.primary,\n    boxShadow: `0 0 0 2px ${vars.colors.primaryAlpha}`,\n  },\n  ':disabled': {\n    opacity: 0.5,\n    cursor: 'not-allowed',\n  },\n});\n\nexport const popover = style({\n  position: 'absolute',\n  top: '100%',\n  left: 0,\n  marginTop: vars.spacing.xs,\n  zIndex: 100, // Above command palette content but below overlays\n  background: vars.colors.surface,\n  borderRadius: vars.radii.lg,\n  boxShadow: vars.shadows.lg,\n  border: `1px solid ${vars.colors.border}`,\n});\n```\n\n### Export from primitives/index.ts\n```typescript\nexport { DatePicker } from './DatePicker';\nexport type { DatePickerProps } from './DatePicker';\n```\n\n### Edge Cases to Handle\n1. **Escape key**: Stop propagation to prevent closing parent command palette\n2. **Click outside**: Must check containerRef.contains() properly\n3. **Focus management**: Return focus to trigger after selection\n4. **Disabled state**: Prevent opening and show visual feedback\n\n### Acceptance Criteria\n- [ ] Trigger button shows placeholder or formatted date\n- [ ] \"Today (Dec 18)\" label shown for today's date\n- [ ] Popover opens on trigger click\n- [ ] Popover closes on date selection\n- [ ] Popover closes on Escape (without closing parent modals)\n- [ ] Popover closes on click outside\n- [ ] Disabled state prevents interaction\n- [ ] Proper z-index layering in command palette context\n- [ ] Exported from @scribe/design-system\n\n### Estimated Time\n2 hours","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T14:48:08.608577-06:00","updated_at":"2025-12-18T15:05:34.804208-06:00","dependencies":[{"issue_id":"scribe-3na.3","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.608889-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.3","depends_on_id":"scribe-3na.2","type":"blocks","created_at":"2025-12-18T14:48:14.611826-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.4","title":"Update IPC contract to accept optional date parameter for meeting.create","description":"## Update IPC contract to accept optional date parameter for meeting.create\n\nUpdate the IPC contract in packages/shared/src/ipc-contract.ts to accept an optional date parameter for meeting creation.\n\n### Dependencies\n- **None** - This task can start immediately, in parallel with scribe-3na.1\n\n### Parallelization Note\nThis task is on the **Backend Track** and has NO dependency on react-day-picker. Start this task immediately alongside scribe-3na.1 to maximize parallelization.\n\n### Changes Required\n\n#### 1. Update MeetingAPI interface (ipc-contract.ts:292-298)\n```typescript\n// Before (line 292-298)\nexport interface MeetingAPI {\n  /**\n   * Create a new meeting note for today.\n   * Auto-creates daily note if needed and links the meeting to it.\n   * @param title - The meeting title (required, cannot be empty)\n   */\n  create(title: string): Promise\u003cNote\u003e;\n  // ...\n}\n\n// After\nexport interface MeetingAPI {\n  /**\n   * Create a new meeting note for a specific date.\n   * Auto-creates the daily note for that date if needed and links the meeting to it.\n   * \n   * @param title - The meeting title (required, cannot be empty)\n   * @param date - Optional ISO date string (YYYY-MM-DD). Defaults to today if not provided.\n   * @returns The newly created meeting note\n   * \n   * @example\n   * // Create meeting for today (default)\n   * const note = await window.scribe.meeting.create('Sprint Planning');\n   * \n   * // Create meeting for a specific date\n   * const note = await window.scribe.meeting.create('Retro', '2025-12-25');\n   */\n  create(title: string, date?: string): Promise\u003cNote\u003e;\n  // ...\n}\n```\n\n#### 2. Why ISO date string (not Date object)?\n- **IPC serialization**: Date objects don't serialize well over Electron IPC\n- **JSON-safe**: ISO strings are native JSON format\n- **Explicit format**: YYYY-MM-DD is unambiguous across locales\n- **Renderer responsibility**: Convert Date to string before IPC call\n- **Handler responsibility**: Parse string back to Date for processing\n\n### Files Changed\n- `packages/shared/src/ipc-contract.ts` (only this file)\n\n### Verification\n```bash\nbun run typecheck\n```\n\nThis will surface any type errors in:\n- preload.ts (scribe-3na.11)\n- meetingHandlers.ts (scribe-3na.5)\n- templates.ts (scribe-3na.7)\n\nThese errors are expected until subsequent tasks complete.\n\n### Acceptance Criteria\n- [ ] MeetingAPI.create signature updated with optional `date?: string` parameter\n- [ ] JSDoc documentation updated with @param for date\n- [ ] JSDoc includes @example showing both usage patterns\n- [ ] Date parameter documented as ISO format (YYYY-MM-DD)\n- [ ] `bun run typecheck` passes in shared package\n\n### Estimated Time\n20 minutes","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T14:48:08.672204-06:00","updated_at":"2025-12-18T15:05:51.675988-06:00","dependencies":[{"issue_id":"scribe-3na.4","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.672556-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.5","title":"Update meeting IPC handler to accept and process date parameter","description":"## Update meeting IPC handler to accept and process date parameter\n\nUpdate the meeting IPC handler in meetingHandlers.ts to accept and process the optional date parameter.\n\n### Dependencies\n- **Blocked by:** scribe-3na.11 (preload bridge must pass the date parameter)\n\n### Current Implementation (meetingHandlers.ts:140-184)\n```typescript\nipcMain.handle('meeting:create', async (_, { title }: { title: string }) =\u003e {\n  // ...\n  const today = new Date();\n  const dateStr = format(today, 'MM-dd-yyyy');\n  // ... creates daily note for today\n  // ... creates meeting linked to today's daily\n});\n```\n\n### Required Changes\n\n#### 1. Update handler parameter type and add date parsing\n```typescript\nimport { parse, isValid, format } from 'date-fns';\n\n/**\n * IPC: `meeting:create`\n *\n * Creates a new meeting note and links it to a daily note.\n * If a date is provided, creates/finds the daily note for that date.\n * Otherwise defaults to today.\n *\n * @param title - The meeting title (required, non-empty string)\n * @param date - Optional ISO date string (YYYY-MM-DD). Defaults to today.\n * @returns The newly created meeting note\n * @throws VALIDATION_ERROR if title is empty or date format is invalid\n */\nipcMain.handle(\n  'meeting:create',\n  async (_, { title, date }: { title: string; date?: string }) =\u003e {\n    const vault = requireVault(deps);\n    const graphEngine = requireGraphEngine(deps);\n    const searchEngine = requireSearchEngine(deps);\n\n    if (!title?.trim()) {\n      throw new ScribeError(ErrorCode.VALIDATION_ERROR, 'Meeting title required');\n    }\n\n    // Parse date parameter or default to today\n    let targetDate: Date;\n    if (date) {\n      // Parse ISO date string (YYYY-MM-DD)\n      targetDate = parse(date, 'yyyy-MM-dd', new Date());\n      if (!isValid(targetDate)) {\n        throw new ScribeError(\n          ErrorCode.VALIDATION_ERROR,\n          `Invalid date format: \"${date}\". Expected YYYY-MM-DD (e.g., \"2025-12-25\").`\n        );\n      }\n    } else {\n      targetDate = new Date(); // Default to today\n    }\n\n    const dateStr = format(targetDate, 'MM-dd-yyyy'); // Internal format for daily note ID\n\n    // Rest of implementation unchanged - uses dateStr for daily note lookup/creation\n    // ...\n  }\n);\n```\n\n### Edge Cases to Handle\n1. **Invalid date format**: `\"invalid-date\"` → VALIDATION_ERROR with helpful message\n2. **Invalid date values**: `\"2025-13-45\"` → `isValid()` returns false\n3. **Empty string date**: Treat same as `undefined` (use today)\n4. **Whitespace-only date**: Treat same as `undefined` (use today)\n\n#### 2. Handle empty string edge case\n```typescript\n// At the start of date parsing:\nconst effectiveDate = date?.trim() || undefined;\nif (effectiveDate) {\n  targetDate = parse(effectiveDate, 'yyyy-MM-dd', new Date());\n  // ...\n}\n```\n\n### Files Changed\n- `apps/desktop/electron/main/src/handlers/meetingHandlers.ts`\n\n### Imports to Add\n```typescript\nimport { parse, isValid, format } from 'date-fns';\n// Note: format is likely already imported, add parse and isValid\n```\n\n### Verification\n```bash\ncd apps/desktop\nbun run typecheck\nbun run test -- meetingHandlers\n```\n\n### Acceptance Criteria\n- [ ] Handler accepts optional `date?: string` parameter\n- [ ] ISO date string (YYYY-MM-DD) parsed correctly with date-fns\n- [ ] Invalid date formats return VALIDATION_ERROR with helpful message\n- [ ] Empty/undefined date defaults to today\n- [ ] Daily note created for the correct date (not always today)\n- [ ] Meeting linked to correct daily note\n- [ ] JSDoc updated to document date parameter\n- [ ] Existing integration tests still pass\n\n### Estimated Time\n1 hour","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:48:08.735129-06:00","updated_at":"2025-12-18T15:06:20.983841-06:00","dependencies":[{"issue_id":"scribe-3na.5","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.735442-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.5","depends_on_id":"scribe-3na.4","type":"blocks","created_at":"2025-12-18T14:48:14.657535-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.5","depends_on_id":"scribe-3na.11","type":"blocks","created_at":"2025-12-18T15:04:28.11662-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.6","title":"Create MeetingCreatePanel component with title input and date picker","description":"## Create MeetingCreatePanel component with title input and date picker\n\nCreate a new MeetingCreatePanel component that provides a rich UI for meeting creation, replacing the simple text prompt.\n\n### Dependencies\n- **Blocked by:** scribe-3na.3 (DatePicker component must exist)\n\n### Files to Create\n```\napps/desktop/renderer/src/components/MeetingCreatePanel/\n├── index.ts                   # Re-export\n├── MeetingCreatePanel.tsx\n└── MeetingCreatePanel.css.ts\n```\n\n### Component Design (matches design spec from GH issue #36)\n```\n┌─────────────────────────────────────────┐\n│           New Meeting                   │\n├─────────────────────────────────────────┤\n│  Meeting title                          │\n│  ┌─────────────────────────────────┐    │\n│  │ [text input - autofocus]        │    │\n│  └─────────────────────────────────┘    │\n│                                         │\n│  Date                                   │\n│  ┌─────────────────────┐                │\n│  │ Today (Dec 18) ▼    │  ← DatePicker  │\n│  └─────────────────────┘                │\n│                                         │\n│          [Cancel]  [Create]             │\n└─────────────────────────────────────────┘\n```\n\n### Component Implementation\n```typescript\nimport { useState } from 'react';\nimport { Button, Text, DatePicker } from '@scribe/design-system';\nimport * as styles from './MeetingCreatePanel.css';\n\nexport interface MeetingCreatePanelProps {\n  onSubmit: (title: string, date: Date) =\u003e void;\n  onCancel: () =\u003e void;\n  initialDate?: Date;  // Defaults to today\n}\n\nexport function MeetingCreatePanel({ \n  onSubmit, \n  onCancel, \n  initialDate = new Date() \n}: MeetingCreatePanelProps) {\n  const [title, setTitle] = useState('');\n  const [selectedDate, setSelectedDate] = useState(initialDate);\n  \n  const handleSubmit = () =\u003e {\n    if (title.trim()) {\n      onSubmit(title.trim(), selectedDate);\n    }\n  };\n  \n  const handleKeyDown = (e: React.KeyboardEvent) =\u003e {\n    if (e.key === 'Enter' \u0026\u0026 !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit();\n    }\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      e.stopPropagation(); // Don't close the entire command palette\n      onCancel();\n    }\n  };\n  \n  const isValid = title.trim().length \u003e 0;\n  \n  return (\n    \u003cdiv className={styles.container}\u003e\n      \u003cText as=\"h2\" variant=\"heading\" size=\"md\" className={styles.header}\u003e\n        New Meeting\n      \u003c/Text\u003e\n      \n      \u003cdiv className={styles.field}\u003e\n        \u003cText as=\"label\" variant=\"body\" size=\"sm\" className={styles.label}\u003e\n          Meeting title\n        \u003c/Text\u003e\n        \u003cinput\n          type=\"text\"\n          className={styles.input}\n          value={title}\n          onChange={(e) =\u003e setTitle(e.target.value)}\n          onKeyDown={handleKeyDown}\n          placeholder=\"Sprint Planning\"\n          autoFocus\n        /\u003e\n      \u003c/div\u003e\n      \n      \u003cdiv className={styles.field}\u003e\n        \u003cText as=\"label\" variant=\"body\" size=\"sm\" className={styles.label}\u003e\n          Date\n        \u003c/Text\u003e\n        \u003cDatePicker\n          value={selectedDate}\n          onChange={setSelectedDate}\n        /\u003e\n      \u003c/div\u003e\n      \n      \u003cdiv className={styles.actions}\u003e\n        \u003cButton variant=\"ghost\" onClick={onCancel}\u003e\n          Cancel\n        \u003c/Button\u003e\n        \u003cButton \n          variant=\"primary\" \n          onClick={handleSubmit}\n          disabled={!isValid}\n        \u003e\n          Create\n        \u003c/Button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Styling Notes\n- Match existing command palette styling from `CommandPalette.css.ts`\n- Use same padding, background colors as other palette panels\n- Input styling should match `PromptInputPanel` for consistency\n- Actions row: `justify-content: flex-end` with gap between buttons\n\n### Styling Reference\n```typescript\n// MeetingCreatePanel.css.ts\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const container = style({\n  padding: vars.spacing.lg,\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing.md,\n});\n\nexport const header = style({\n  marginBottom: vars.spacing.sm,\n});\n\nexport const field = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing.xs,\n});\n\nexport const label = style({\n  color: vars.colors.textMuted,\n  fontWeight: 500,\n});\n\nexport const input = style({\n  padding: `${vars.spacing.sm} ${vars.spacing.md}`,\n  border: `1px solid ${vars.colors.border}`,\n  borderRadius: vars.radii.md,\n  background: vars.colors.surfaceAlt,\n  color: vars.colors.text,\n  fontSize: vars.fontSize.md,\n  ':focus': {\n    outline: 'none',\n    borderColor: vars.colors.primary,\n  },\n});\n\nexport const actions = style({\n  display: 'flex',\n  justifyContent: 'flex-end',\n  gap: vars.spacing.sm,\n  marginTop: vars.spacing.md,\n});\n```\n\n### Keyboard Behavior\n- **Enter** on title input: Submit if valid\n- **Escape** anywhere: Cancel (stop propagation so command palette doesn't close)\n- **Tab**: Navigate between title input, DatePicker trigger, and buttons\n- DatePicker handles its own keyboard navigation internally\n\n### Acceptance Criteria\n- [ ] Panel renders with title input and DatePicker\n- [ ] Title input has autofocus\n- [ ] DatePicker defaults to today\n- [ ] Create button disabled when title is empty\n- [ ] Enter key submits form (when valid)\n- [ ] Escape key cancels (without closing entire palette)\n- [ ] onSubmit receives title string and Date object\n- [ ] Styling matches existing command palette panels\n\n### Estimated Time\n1.5 hours","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:48:08.799473-06:00","updated_at":"2025-12-18T15:06:44.531184-06:00","dependencies":[{"issue_id":"scribe-3na.6","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.799799-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.6","depends_on_id":"scribe-3na.3","type":"blocks","created_at":"2025-12-18T14:48:14.701537-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.7","title":"Wire command palette to use new MeetingCreatePanel for meeting creation","description":"## Wire command palette to use new MeetingCreatePanel for meeting creation\n\nWire the command palette to use the new MeetingCreatePanel instead of the simple prompt-based meeting creation.\n\n### Dependencies\n- **Blocked by:** scribe-3na.5 (handler must accept date) AND scribe-3na.6 (panel must exist)\n- **This is the CONVERGENCE POINT** where both UI and Backend tracks merge\n\n### Changes Required\n\n#### 1. Update PaletteMode type (types.ts:19-25)\n```typescript\n// apps/desktop/renderer/src/commands/types.ts\nexport type PaletteMode =\n  | 'command'\n  | 'file-browse'\n  | 'delete-browse'\n  | 'delete-confirm'\n  | 'person-browse'\n  | 'prompt-input'\n  | 'meeting-create';  // NEW MODE\n```\n\n#### 2. Update CommandPalette.tsx renderContent()\nAdd handling for the new mode (around line 256):\n```typescript\nimport { MeetingCreatePanel } from '../MeetingCreatePanel';\nimport { format } from 'date-fns';\n\n// Inside renderContent():\nif (mode === 'meeting-create') {\n  return (\n    \u003cMeetingCreatePanel\n      onSubmit={async (title, date) =\u003e {\n        try {\n          onClose();\n          const isoDate = format(date, 'yyyy-MM-dd');\n          const note = await window.scribe.meeting.create(title, isoDate);\n          onNoteSelect?.(note.id);\n        } catch (error) {\n          handleError(error, 'Failed to create meeting');\n        }\n      }}\n      onCancel={() =\u003e {\n        setMode('command');\n        onModeChange?.('command');\n      }}\n    /\u003e\n  );\n}\n```\n\n#### 3. Update the meeting:create command (templates.ts:31-49)\n```typescript\n// apps/desktop/renderer/src/commands/templates.ts\n{\n  id: 'meeting:create',\n  title: 'New Meeting',\n  description: 'Create a new meeting note',\n  group: 'notes',\n  keywords: ['meeting', 'notes', 'agenda', 'sync'],\n  closeOnSelect: false,\n  icon: createElement(CalendarDaysIcon, { size: 16 }),\n  run: async (context) =\u003e {\n    // Switch to meeting-create mode instead of using promptInput\n    context.setPaletteMode('meeting-create');\n  },\n},\n```\n\n### Files Changed\n1. `apps/desktop/renderer/src/commands/types.ts` - Add 'meeting-create' to PaletteMode\n2. `apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx` - Render MeetingCreatePanel\n3. `apps/desktop/renderer/src/commands/templates.ts` - Update command to use new mode\n\n### Import Changes in CommandPalette.tsx\n```typescript\nimport { MeetingCreatePanel } from '../MeetingCreatePanel';\nimport { format } from 'date-fns';\n```\n\n### Error Handling\nThe existing `handleError` hook is already available in CommandPalette.tsx (line 81). Use it to handle IPC failures gracefully:\n```typescript\n} catch (error) {\n  handleError(error, 'Failed to create meeting');\n}\n```\n\n### Edge Cases\n1. **Cancel from MeetingCreatePanel**: Return to command mode, don't close palette\n2. **Date conversion**: Use `format(date, 'yyyy-MM-dd')` for ISO string\n3. **IPC failure**: Show toast via handleError, don't crash\n4. **Navigation after create**: Use `onNoteSelect?.(note.id)` for proper navigation\n\n### Acceptance Criteria\n- [ ] PaletteMode type includes 'meeting-create'\n- [ ] \"New Meeting\" command switches to meeting-create mode\n- [ ] MeetingCreatePanel renders correctly in command palette\n- [ ] Submit creates meeting with selected date via IPC\n- [ ] Cancel returns to command mode (not closing palette)\n- [ ] Created meeting navigates to new note\n- [ ] IPC errors handled gracefully with toast\n- [ ] Existing command palette tests still pass\n- [ ] Keyboard shortcuts work (Enter to submit, Escape to cancel)\n\n### Verification\n```bash\ncd apps/desktop\nbun run typecheck\nbun run test -- CommandPalette\n```\n\n### Estimated Time\n1.5 hours","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:48:08.863433-06:00","updated_at":"2025-12-18T15:07:06.903836-06:00","dependencies":[{"issue_id":"scribe-3na.7","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.863771-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.7","depends_on_id":"scribe-3na.6","type":"blocks","created_at":"2025-12-18T14:48:14.748077-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.7","depends_on_id":"scribe-3na.5","type":"blocks","created_at":"2025-12-18T14:48:14.800618-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.8","title":"Add unit tests for Calendar component","description":"## Add unit tests for Calendar component\n\nAdd unit tests for the Calendar component created in scribe-3na.2.\n\n### Dependencies\n- **Blocked by:** scribe-3na.2 (Calendar must exist to test)\n- **Can run in parallel with:** scribe-3na.3, scribe-3na.4, scribe-3na.5, scribe-3na.6\n\n### Test File\n`packages/design-system/src/primitives/Calendar/Calendar.test.tsx`\n\n### Test Setup\n```typescript\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { vi, describe, it, expect, beforeAll, afterAll } from 'vitest';\nimport { Calendar } from './Calendar';\n\n// Mock date for consistent tests\nbeforeAll(() =\u003e {\n  vi.useFakeTimers();\n  vi.setSystemTime(new Date('2025-12-18T12:00:00'));\n});\n\nafterAll(() =\u003e {\n  vi.useRealTimers();\n});\n```\n\n### Test Cases\n\n#### Rendering\n```typescript\ndescribe('Calendar', () =\u003e {\n  describe('rendering', () =\u003e {\n    it('renders with default props');\n    it('shows current month by default');\n    it('displays day headers (Su, Mo, Tu, etc.)');\n    it('renders all days of December 2025');\n  });\n});\n```\n\n#### Navigation\n```typescript\ndescribe('navigation', () =\u003e {\n  it('navigates to previous month on prev button click');\n  it('navigates to next month on next button click');\n  it('respects defaultMonth prop');\n});\n```\n\n#### Selection\n```typescript\ndescribe('selection', () =\u003e {\n  it('calls onSelect when date is clicked');\n  it('highlights the selected date with selected class');\n  it('highlights today with today class');\n  it('does not highlight unselected dates');\n});\n```\n\n#### Disabled Dates\n```typescript\ndescribe('disabled dates', () =\u003e {\n  it('applies disabled styling to dates in disabled array');\n  it('applies disabled styling when disabled function returns true');\n  it('does not call onSelect for disabled dates');\n});\n```\n\n#### Keyboard Navigation\n```typescript\ndescribe('keyboard navigation', () =\u003e {\n  it('arrow keys navigate between days');\n  it('Enter key selects focused date');\n  // Note: Most keyboard behavior is handled by react-day-picker\n});\n```\n\n### Important Notes for react-day-picker v9\n- v9 uses different class names than v8 (see scribe-3na.2 for mapping)\n- Test against the rendered DOM, not internal implementation\n- react-day-picker handles most keyboard navigation internally\n\n### Acceptance Criteria\n- [ ] All test cases implemented\n- [ ] Tests pass consistently (no flaky tests)\n- [ ] Coverage \u003e 80% for Calendar component\n- [ ] Tests use fake timers for date consistency\n\n### Estimated Time\n1.5 hours","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:48:08.926695-06:00","updated_at":"2025-12-18T15:07:22.054416-06:00","dependencies":[{"issue_id":"scribe-3na.8","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.927006-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.8","depends_on_id":"scribe-3na.2","type":"blocks","created_at":"2025-12-18T14:48:14.865194-06:00","created_by":"daemon"}]}
{"id":"scribe-3na.9","title":"Add unit tests for DatePicker component","description":"## Add unit tests for DatePicker component\n\nAdd unit tests for the DatePicker component created in scribe-3na.3.\n\n### Dependencies\n- **Blocked by:** scribe-3na.3 (DatePicker must exist to test)\n- **Can run in parallel with:** scribe-3na.6, scribe-3na.7, scribe-3na.5\n\n### Test File\n`packages/design-system/src/primitives/DatePicker/DatePicker.test.tsx`\n\n### Test Setup\n```typescript\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { vi, describe, it, expect, beforeAll, afterAll } from 'vitest';\nimport { DatePicker } from './DatePicker';\n\nbeforeAll(() =\u003e {\n  vi.useFakeTimers();\n  vi.setSystemTime(new Date('2025-12-18T12:00:00'));\n});\n\nafterAll(() =\u003e {\n  vi.useRealTimers();\n});\n```\n\n### Test Cases\n\n#### Trigger Rendering\n```typescript\ndescribe('DatePicker', () =\u003e {\n  describe('trigger', () =\u003e {\n    it('renders trigger button with placeholder when no value');\n    it('shows \"Today (Dec 18)\" for today\\'s date');\n    it('shows \"Dec 25, 2025\" format for other dates');\n    it('shows calendar and chevron icons');\n  });\n});\n```\n\n#### Popover Behavior\n```typescript\ndescribe('popover', () =\u003e {\n  it('opens popover on trigger click');\n  it('closes popover on date selection');\n  it('closes popover on Escape key');\n  it('closes popover on click outside');\n  it('does NOT close on click inside popover');\n  it('stops Escape propagation to prevent closing parent modals');\n});\n```\n\n#### Selection\n```typescript\ndescribe('selection', () =\u003e {\n  it('calls onChange with selected date');\n  it('updates trigger text after selection');\n  it('closes popover after selection');\n});\n```\n\n#### Disabled State\n```typescript\ndescribe('disabled', () =\u003e {\n  it('disabled prop prevents opening popover');\n  it('trigger shows disabled styling (opacity)');\n  it('trigger has disabled attribute');\n});\n```\n\n#### Keyboard\n```typescript\ndescribe('keyboard', () =\u003e {\n  it('Enter on trigger opens popover');\n  it('Escape closes popover without bubbling');\n  it('Tab can navigate into calendar');\n});\n```\n\n### Testing Click Outside\n```typescript\nit('closes popover on click outside', async () =\u003e {\n  const onChange = vi.fn();\n  render(\n    \u003cdiv\u003e\n      \u003cDatePicker value={new Date()} onChange={onChange} /\u003e\n      \u003cbutton data-testid=\"outside\"\u003eOutside\u003c/button\u003e\n    \u003c/div\u003e\n  );\n  \n  // Open popover\n  await userEvent.click(screen.getByRole('button', { name: /today/i }));\n  expect(screen.getByRole('grid')).toBeInTheDocument(); // Calendar grid\n  \n  // Click outside\n  fireEvent.mouseDown(screen.getByTestId('outside'));\n  \n  await waitFor(() =\u003e {\n    expect(screen.queryByRole('grid')).not.toBeInTheDocument();\n  });\n});\n```\n\n### Testing Escape Key\n```typescript\nit('closes popover on Escape without bubbling', async () =\u003e {\n  const onEscape = vi.fn();\n  render(\n    \u003cdiv onKeyDown={(e) =\u003e e.key === 'Escape' \u0026\u0026 onEscape()}\u003e\n      \u003cDatePicker value={new Date()} onChange={() =\u003e {}} /\u003e\n    \u003c/div\u003e\n  );\n  \n  // Open popover\n  await userEvent.click(screen.getByRole('button'));\n  \n  // Press Escape\n  fireEvent.keyDown(document, { key: 'Escape' });\n  \n  // Popover should close but parent should NOT receive event\n  await waitFor(() =\u003e {\n    expect(screen.queryByRole('grid')).not.toBeInTheDocument();\n  });\n  expect(onEscape).not.toHaveBeenCalled(); // stopPropagation worked\n});\n```\n\n### Acceptance Criteria\n- [ ] All test cases implemented\n- [ ] Tests pass consistently\n- [ ] Coverage \u003e 80% for DatePicker component\n- [ ] Click-outside handler verified\n- [ ] Escape key propagation verified\n- [ ] Disabled state behavior verified\n\n### Estimated Time\n1.5 hours","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:48:08.989122-06:00","updated_at":"2025-12-18T15:07:37.075486-06:00","dependencies":[{"issue_id":"scribe-3na.9","depends_on_id":"scribe-3na","type":"parent-child","created_at":"2025-12-18T14:48:08.98944-06:00","created_by":"daemon"},{"issue_id":"scribe-3na.9","depends_on_id":"scribe-3na.3","type":"blocks","created_at":"2025-12-18T14:48:14.927172-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r","title":"Technical Debt Reduction Initiative","description":"Comprehensive technical debt reduction effort - consolidated from scribe-q3n and scribe-g9r epics.\n\n## Scope\n1. **Test Infrastructure** - Vitest configs, shared test utilities\n2. **Type System** - Split types.ts, migrate deprecated aliases\n3. **Test Coverage** - Critical utilities, design system, handlers, hooks\n4. **Code Deduplication** - Date utils, content helpers, validation\n5. **Refactoring** - CLI notes.ts, content-extractor, TableKeyboardPlugin\n6. **Architecture** - EngineOrchestrator, decouple storage-fs\n7. **Documentation** - Package READMEs, architecture docs, JSDoc\n\n## Remaining from q3n (reparented)\n- q3n.3, q3n.4, q3n.5, q3n.6, q3n.7, q3n.8, q3n.10, q3n.11\n- q3n.14, q3n.15, q3n.16, q3n.18, q3n.19, q3n.20\n- q3n.29, q3n.30, q3n.31\n\n## Parallelization Tracks\n- Track 1: Infrastructure (g9r.5, g9r.7) - do first\n- Track 2: Type system (g9r.12, g9r.8)\n- Track 3: Test coverage (g9r.2, g9r.4, g9r.11, q3n.*)\n- Track 4: Deduplication (g9r.6, g9r.14, q3n.14-16, q3n.19)\n- Track 5: Documentation (g9r.1, q3n.29, q3n.30)\n- Track 6: Architecture (g9r.9, g9r.13, g9r.10)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-18T11:10:16.527157-06:00","updated_at":"2025-12-18T11:53:13.675385-06:00","closed_at":"2025-12-18T11:53:13.675385-06:00"}
{"id":"scribe-g9r.1","title":"Create package README documentation","description":"Created README.md files for all 8 packages: @scribe/design-system, @scribe/engine-core, @scribe/engine-graph, @scribe/engine-search, @scribe/shared, @scribe/storage-fs, @scribe/cli, and @scribe/desktop","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T11:10:16.599853-06:00","updated_at":"2025-12-18T11:49:04.460742-06:00","closed_at":"2025-12-18T11:49:04.460742-06:00","dependencies":[{"issue_id":"scribe-g9r.1","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:16.600209-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.10","title":"Standardize ESLint configurations","description":"## Problem\nESLint configurations in `apps/` directory don't use the shared `@scribe/eslint-config` base, leading to:\n- Duplicated parser/plugin setup (30-50 lines each)\n- Potential configuration drift between packages\n- More maintenance burden\n\n## Current State\n\n### Packages using shared config (good - ~9 lines each):\n- `packages/engine-core/eslint.config.js`\n- `packages/shared/eslint.config.js`\n- `packages/engine-graph/eslint.config.js`\n- `packages/engine-search/eslint.config.js`\n- `packages/storage-fs/eslint.config.js`\n- `packages/design-system/eslint.config.js`\n\n### Apps NOT using shared config (problematic):\n- `apps/cli/eslint.config.js` - 33 lines, standalone config\n- `apps/desktop/electron/main/eslint.config.js` - 32 lines, standalone\n- `apps/desktop/electron/preload/eslint.config.js` - 29 lines, standalone\n- `apps/desktop/renderer/eslint.config.js` - 48 lines, standalone with React\n\n## Proposed Solution\n\n### 1. Update apps/cli/eslint.config.js:\n```javascript\nimport baseConfig from '@scribe/eslint-config/base.js';\n\nexport default [\n  ...baseConfig,\n  // CLI-specific overrides if needed\n];\n```\n\n### 2. Update Electron configs similarly\n\n### 3. Create React preset if needed:\n`config/eslint/react.js` for renderer-specific rules\n\n## Shared Config Location\n`config/eslint/` contains:\n- `base.js` - Base TypeScript config\n- `index.js` - Main export\n- `react.js` - React-specific rules (may need creation/update)\n\n## Acceptance Criteria\n- [ ] `apps/cli/eslint.config.js` extends shared base\n- [ ] `apps/desktop/electron/main/eslint.config.js` extends shared base\n- [ ] `apps/desktop/electron/preload/eslint.config.js` extends shared base\n- [ ] `apps/desktop/renderer/eslint.config.js` extends shared React config\n- [ ] All lint checks pass\n- [ ] No duplicate parser/plugin configuration\n- [ ] Each config file \u003c15 lines\n\n## Files to Modify\n- apps/cli/eslint.config.js\n- apps/desktop/electron/main/eslint.config.js\n- apps/desktop/electron/preload/eslint.config.js\n- apps/desktop/renderer/eslint.config.js\n\n## Files to Potentially Create/Update\n- config/eslint/react.js (if React preset needs enhancement)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:10:17.255121-06:00","updated_at":"2025-12-18T11:49:12.303353-06:00","closed_at":"2025-12-18T11:49:12.303353-06:00","dependencies":[{"issue_id":"scribe-g9r.10","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.255457-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.11","title":"Add design system component tests","description":"## Problem\nThe design system package has only ~8% test coverage with only 2 components tested (`Button.test.tsx`, `Overlay.test.tsx`), leaving 8+ primitive components untested.\n\n## Current Test Coverage\n\n### Components WITH tests:\n- `primitives/Button/Button.test.tsx`\n- `primitives/Overlay/Overlay.test.tsx`\n\n### Components WITHOUT tests:\n1. `primitives/Text/Text.tsx` - Typography component\n2. `primitives/Surface/Surface.tsx` - Container component\n3. `primitives/FloatingMenu/FloatingMenu.tsx` - Dropdown/popover menus\n4. `primitives/Icon/Icon.tsx` - Icon wrapper\n5. `primitives/CollapsiblePanel/CollapsiblePanel.tsx` - Expandable panel\n6. `primitives/EmptyState/EmptyState.tsx` - Empty state display\n7. `ThemeProvider.tsx` - Theme context provider\n8. `icons/icons.tsx` - Icon definitions\n\n## Testing Approach\n\n### For each component, test:\n1. **Renders without crashing** - Basic smoke test\n2. **Props work correctly** - Variants, sizes, colors\n3. **Accessibility** - ARIA attributes, keyboard navigation\n4. **User interactions** - Click handlers, focus states\n5. **Theme integration** - Responds to theme changes\n\n### Example test structure:\n```typescript\ndescribe('Text', () =\u003e {\n  it('renders children correctly', () =\u003e {});\n  it('applies variant styles', () =\u003e {});\n  it('applies size styles', () =\u003e {});\n  it('applies color from theme', () =\u003e {});\n  it('forwards ref correctly', () =\u003e {});\n});\n```\n\n## Testing Tools\n- Vitest + React Testing Library (already configured)\n- @testing-library/user-event for interactions\n- Consider adding visual regression tests (future)\n\n## Acceptance Criteria\n- [ ] All 8 untested components have test files\n- [ ] Each component has at least render + props tests\n- [ ] Interactive components have interaction tests\n- [ ] ThemeProvider has context tests\n- [ ] Coverage \u003e60% for design-system package\n- [ ] All tests pass in CI\n\n## Files to Create\n- packages/design-system/src/primitives/Text/Text.test.tsx\n- packages/design-system/src/primitives/Surface/Surface.test.tsx\n- packages/design-system/src/primitives/FloatingMenu/FloatingMenu.test.tsx\n- packages/design-system/src/primitives/Icon/Icon.test.tsx\n- packages/design-system/src/primitives/CollapsiblePanel/CollapsiblePanel.test.tsx\n- packages/design-system/src/primitives/EmptyState/EmptyState.test.tsx\n- packages/design-system/src/ThemeProvider.test.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:10:17.327477-06:00","updated_at":"2025-12-18T11:49:13.090332-06:00","closed_at":"2025-12-18T11:49:13.090332-06:00","dependencies":[{"issue_id":"scribe-g9r.11","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.327817-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.12","title":"Split types.ts into domain modules","description":"## Problem\n`packages/shared/src/types.ts` is 1,120 lines containing all type definitions for the entire application, making it:\n- Hard to navigate and find specific types\n- Growing continuously as features are added\n- Mixing unrelated domain concepts\n\n## Current Contents of types.ts\n\nThe file contains types for multiple domains:\n1. **Core types**: Note, NoteId, VaultPath, branded types\n2. **Note variants**: DailyNote, MeetingNote, PersonNote, etc.\n3. **Type guards**: isDailyNote, isMeetingNote, isSystemNote, etc.\n4. **Task types**: TaskId, Task, TaskFilter, TaskChangeEvent\n5. **Search types**: SearchResult, SearchOptions\n6. **Graph types**: GraphNode, GraphEdge\n7. **Editor types**: EditorContent, EditorNode (abstraction layer)\n8. **Metadata types**: NoteMetadata, extractors\n\n## Proposed Structure\n\nCreate `packages/shared/src/types/` directory:\n\n```\npackages/shared/src/types/\n├── index.ts           # Barrel export (re-exports all)\n├── branded.ts         # NoteId, VaultPath, createNoteId, etc.\n├── note.ts            # Note, NoteMetadata, note variants\n├── note-guards.ts     # isDailyNote, isMeetingNote, etc.\n├── task.ts            # Task, TaskId, TaskFilter, TaskChangeEvent\n├── search.ts          # SearchResult, SearchOptions\n├── graph.ts           # GraphNode, GraphEdge\n└── editor.ts          # EditorContent, EditorNode\n```\n\n## Migration Strategy\n\n### Phase 1: Create new structure\n- Create types/ directory\n- Split types.ts into domain files\n- Keep types.ts as re-export for backward compatibility\n\n### Phase 2: Update types.ts to re-export\n```typescript\n// packages/shared/src/types.ts\nexport * from './types/branded';\nexport * from './types/note';\nexport * from './types/note-guards';\nexport * from './types/task';\nexport * from './types/search';\nexport * from './types/graph';\nexport * from './types/editor';\n```\n\n### Phase 3: Verify no breaking changes\n- All existing imports should continue to work\n- Run full test suite\n\n## Acceptance Criteria\n- [ ] types/ directory created with domain-specific files\n- [ ] Each file \u003c200 lines\n- [ ] Existing `import { X } from '@scribe/shared'` still works\n- [ ] All tests pass\n- [ ] No circular dependencies between type files\n- [ ] JSDoc comments preserved\n\n## Files to Create\n- packages/shared/src/types/index.ts\n- packages/shared/src/types/branded.ts\n- packages/shared/src/types/note.ts\n- packages/shared/src/types/note-guards.ts\n- packages/shared/src/types/task.ts\n- packages/shared/src/types/search.ts\n- packages/shared/src/types/graph.ts\n- packages/shared/src/types/editor.ts\n\n## Files to Modify\n- packages/shared/src/types.ts (convert to re-exports)\n- packages/shared/src/index.ts (may need updates)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:10:17.40048-06:00","updated_at":"2025-12-18T11:49:13.981289-06:00","closed_at":"2025-12-18T11:49:13.981289-06:00","dependencies":[{"issue_id":"scribe-g9r.12","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.403338-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.13","title":"Decouple storage-fs from engine-core","description":"## Problem\nThe storage layer (`storage-fs`) depends on the engine layer (`engine-core`) for metadata extraction, violating the layered architecture.\n\n## Current Violation\n\n**File:** `packages/storage-fs/src/storage.ts` (line 21)\n```typescript\nimport { extractMetadata } from '@scribe/engine-core';\n```\n\n**Usage in save():**\n```typescript\nasync save(note: Note): Promise\u003cvoid\u003e {\n  // ...\n  const metadata = extractMetadata(note);  // \u003c-- Storage doing engine work\n  // ...\n}\n```\n\n## Architecture Decision Violation\nDecision 3 (Internal Architecture) states:\n- Storage layer should be \"intentionally simple and transparent\"\n- Focus on \"Serializing/deserializing notes as JSON files on disk\"\n- Should NOT contain business logic like metadata extraction\n\n## Impact of Current Design\n1. **Testing complexity**: Storage tests must mock engine-core\n2. **Circular dependency risk**: If engine-core ever needs storage directly\n3. **Tight coupling**: Storage cannot be used without metadata engine\n4. **Responsibility blurring**: Storage layer doing business logic\n\n## Proposed Solution\n\n### Option A: Move extraction to orchestration layer (Recommended)\nThe caller (main process handler or EngineOrchestrator) should extract metadata before saving:\n\n```typescript\n// In EngineOrchestrator or handler\nasync saveNote(note: Note): Promise\u003cvoid\u003e {\n  const metadata = extractMetadata(note);  // Engine responsibility\n  const noteWithMetadata = { ...note, metadata };\n  await this.vault.save(noteWithMetadata);  // Storage just persists\n}\n```\n\n### Option B: Pass extractor as dependency injection\n```typescript\nclass FileSystemVault {\n  constructor(\n    private vaultPath: VaultPath,\n    private metadataExtractor?: (note: Note) =\u003e NoteMetadata\n  ) {}\n}\n```\n\n## Recommended Approach\nOption A is cleaner - the orchestration layer (see scribe-g9r.9) handles the coordination. Storage layer becomes pure persistence.\n\n## Acceptance Criteria\n- [ ] `storage-fs` no longer imports from `engine-core`\n- [ ] Metadata extraction moved to orchestration layer\n- [ ] Storage tests don't need engine-core mocks\n- [ ] All integration tests pass\n- [ ] Package dependencies updated in package.json\n\n## Files to Modify\n- packages/storage-fs/src/storage.ts (remove extractMetadata call)\n- packages/storage-fs/package.json (remove @scribe/engine-core dep)\n- apps/desktop/electron/main/src/EngineOrchestrator.ts (add extraction)\n- apps/desktop/electron/main/src/handlers/notesHandlers.ts (if not using orchestrator)\n\n## Dependencies\n- Consider doing after scribe-g9r.9 (EngineOrchestrator) is complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:10:17.475215-06:00","updated_at":"2025-12-18T11:49:14.614326-06:00","closed_at":"2025-12-18T11:49:14.614326-06:00","dependencies":[{"issue_id":"scribe-g9r.13","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.47557-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.14","title":"Clean up unused exports and dead code","description":"Completed dead code cleanup for packages/shared. Removed orphaned metadata-extraction.ts file (170 lines). Identified unused exports that are kept for future use.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T11:10:17.547585-06:00","updated_at":"2025-12-18T11:49:15.190088-06:00","closed_at":"2025-12-18T11:49:15.190088-06:00","dependencies":[{"issue_id":"scribe-g9r.14","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.548089-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.2","title":"Add tests for critical shared utilities","description":"Added comprehensive unit tests for critical utility files: ast-utils.ts (34 tests), note-validator.ts (48 tests), text-extraction.ts (40 tests). Total: 122 tests covering traversal, validation, and text extraction utilities.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T11:10:16.672291-06:00","updated_at":"2025-12-18T11:49:05.450295-06:00","closed_at":"2025-12-18T11:49:05.450295-06:00","dependencies":[{"issue_id":"scribe-g9r.2","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:16.672634-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.3","title":"Refactor large CLI notes command file","description":"## Problem\n`apps/cli/src/commands/notes.ts` is 847 lines with 10+ command handlers, mixed responsibilities, and utility functions that should be extracted.\n\n## Current Issues\n1. **Too many commands in one file**: list, show, append, create, add-task, update, find, delete, export\n2. **Mixed concerns**: Fuzzy matching utilities mixed with command registration\n3. **Date parsing utilities** embedded in command file\n4. **Hard to navigate and maintain**\n\n## Proposed Refactoring\n\n### Extract Utilities\n1. `apps/cli/src/utils/fuzzy-match.ts`\n   - `levenshteinDistance()`\n   - `fuzzyMatchScore()`\n   - `fuzzyMatch()`\n\n2. `apps/cli/src/utils/date-parse.ts`\n   - `parseDate()`\n   - (coordinate with date utilities consolidation issue)\n\n### Split Commands\nCreate `apps/cli/src/commands/notes/` directory:\n- `index.ts` - Main export, registers all sub-commands\n- `list.ts` - List notes command\n- `show.ts` - Show note details\n- `create.ts` - Create new note\n- `update.ts` - Update existing note\n- `delete.ts` - Delete note\n- `find.ts` - Find/search notes\n- `export.ts` - Export note to markdown\n- `append.ts` - Append content to note\n- `add-task.ts` - Add task to note\n\n## Acceptance Criteria\n- [ ] Each command in its own file (\u003c150 lines each)\n- [ ] Fuzzy matching extracted to utility module\n- [ ] All existing CLI tests still pass\n- [ ] No functionality changes (pure refactor)\n- [ ] Main `notes.ts` file deleted or becomes thin orchestrator\n\n## Files to Create\n- apps/cli/src/commands/notes/index.ts\n- apps/cli/src/commands/notes/list.ts\n- apps/cli/src/commands/notes/show.ts\n- apps/cli/src/commands/notes/create.ts\n- apps/cli/src/commands/notes/update.ts\n- apps/cli/src/commands/notes/delete.ts\n- apps/cli/src/commands/notes/find.ts\n- apps/cli/src/commands/notes/export.ts\n- apps/cli/src/commands/notes/append.ts\n- apps/cli/src/commands/notes/add-task.ts\n- apps/cli/src/utils/fuzzy-match.ts\n\n## Files to Delete\n- apps/cli/src/commands/notes.ts (after migration)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T11:10:16.744789-06:00","updated_at":"2025-12-18T11:49:06.365245-06:00","closed_at":"2025-12-18T11:49:06.365245-06:00","dependencies":[{"issue_id":"scribe-g9r.3","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:16.745141-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.4","title":"Fix flaky tests","description":"Fixed flaky tests in CommandPalette and useNoteState","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T11:10:16.816476-06:00","updated_at":"2025-12-18T11:49:07.304103-06:00","closed_at":"2025-12-18T11:49:07.304103-06:00","dependencies":[{"issue_id":"scribe-g9r.4","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:16.816817-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.5","title":"Create shared test utilities package","description":"Created @scribe/test-utils package with consolidated test helpers: note-factory.ts (createTestNote, createMockNote, createGraphTestNote, createContentTestNote), vault-factory.ts (createTestVault, initializeTestVault, writeNoteToVault, cleanupTestVault), content-factory.ts (fluent API for EditorContent). All TypeScript compilation successful.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T11:10:16.88869-06:00","updated_at":"2025-12-18T11:49:08.214281-06:00","closed_at":"2025-12-18T11:49:08.214281-06:00","dependencies":[{"issue_id":"scribe-g9r.5","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:16.889023-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.6","title":"Extract and consolidate date utilities","description":"Consolidated date utilities into packages/shared/src/date-utils.ts with comprehensive tests. Created 16 functions covering formatting, parsing, comparison, and day boundary operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:10:16.960335-06:00","updated_at":"2025-12-18T11:49:08.934571-06:00","closed_at":"2025-12-18T11:49:08.934571-06:00","dependencies":[{"issue_id":"scribe-g9r.6","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:16.960684-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.7","title":"Add vitest config to all packages","description":"Created vitest.config.ts for 5 packages with 60% coverage thresholds","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T11:10:17.031983-06:00","updated_at":"2025-12-18T11:49:09.832021-06:00","closed_at":"2025-12-18T11:49:09.832021-06:00","dependencies":[{"issue_id":"scribe-g9r.7","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.032329-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.8","title":"Migrate deprecated type aliases","description":"## Problem\nDeprecated type aliases are still actively used across 39+ files in the codebase, creating confusion and technical debt.\n\n## Deprecated Types (from packages/shared/src/types.ts)\n\n### 1. `LexicalState` (lines 174-179)\n- **Deprecated**: Use `EditorContent` instead\n- **Reason**: Name was Lexical-specific, but abstraction is editor-agnostic\n\n### 2. `LexicalNode` (lines 182-187)\n- **Deprecated**: Use `EditorNode` instead\n- **Reason**: Same as above - editor abstraction layer\n\n### 3. `NoteMetadata.title` (lines 193-199)\n- **Deprecated**: Use `Note.title` instead\n- **Reason**: Title moved to top-level Note type\n\n## Files Using Deprecated Types (39+ files)\n\n### High-traffic files:\n- `packages/engine-core/src/task-index.test.ts`\n- `apps/desktop/electron/main/src/handlers/tasksHandlers.ts`\n- `packages/engine-core/src/task-extraction.ts`\n- `apps/desktop/renderer/src/hooks/useNoteState.ts`\n- Multiple integration test files\n\n## Migration Strategy\n\n### Phase 1: Find and Replace\n```typescript\n// Before\nimport { LexicalState, LexicalNode } from '@scribe/shared';\nconst content: LexicalState = ...;\nconst node: LexicalNode = ...;\n\n// After\nimport { EditorContent, EditorNode } from '@scribe/shared';\nconst content: EditorContent = ...;\nconst node: EditorNode = ...;\n```\n\n### Phase 2: Update NoteMetadata.title usage\n```typescript\n// Before\nconst title = note.metadata.title;\n\n// After\nconst title = note.title;\n```\n\n### Phase 3: Remove deprecated aliases\nAfter migration complete, remove from types.ts:\n- `LexicalState` type alias\n- `LexicalNode` type alias\n- `NoteMetadata.title` field\n\n## Acceptance Criteria\n- [ ] All `LexicalState` references replaced with `EditorContent`\n- [ ] All `LexicalNode` references replaced with `EditorNode`\n- [ ] All `note.metadata.title` replaced with `note.title`\n- [ ] Deprecated type aliases removed from types.ts\n- [ ] All tests pass after migration\n- [ ] No TypeScript errors\n\n## Search Commands\n```bash\n# Find LexicalState usage\nrg \"LexicalState\" --type ts\n\n# Find LexicalNode usage\nrg \"LexicalNode\" --type ts\n\n# Find metadata.title usage\nrg \"metadata\\.title\" --type ts\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T11:10:17.105142-06:00","updated_at":"2025-12-18T11:49:10.669834-06:00","closed_at":"2025-12-18T11:49:10.669834-06:00","dependencies":[{"issue_id":"scribe-g9r.8","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.105486-06:00","created_by":"daemon"}]}
{"id":"scribe-g9r.9","title":"Create EngineOrchestrator class","description":"EngineOrchestrator class created and tested. All 29 unit tests passing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T11:10:17.180585-06:00","updated_at":"2025-12-18T11:49:11.592718-06:00","closed_at":"2025-12-18T11:49:11.592718-06:00","dependencies":[{"issue_id":"scribe-g9r.9","depends_on_id":"scribe-g9r","type":"parent-child","created_at":"2025-12-18T11:10:17.180968-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n","title":"Tech Debt Reduction: Comprehensive Codebase Cleanup","description":"A comprehensive initiative to address technical debt identified across the Scribe codebase. This epic covers:\n\n1. **Large File Refactoring** - Breaking down god files and monolithic modules\n2. **Test Coverage Gaps** - Adding tests for critical untested areas (~35% of codebase)\n3. **Code Duplication** - Consolidating duplicate utilities and patterns\n4. **Dead/Legacy Code** - Removing orphaned files and migrating deprecated patterns\n5. **Documentation Gaps** - Adding package READMEs and updating outdated architecture docs\n6. **Minor Architecture Improvements** - Error codes, abstractions, and consistency\n\n**Priority Guidelines:**\n- P0 (Critical): Test coverage for data integrity and core functionality\n- P1 (High): Large file refactoring that blocks maintainability\n- P2 (Medium): Code duplication and documentation\n- P3 (Low): Nice-to-have improvements and polish\n\n**Estimated Total Effort:** 40-60 hours across all tasks","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-18T10:07:37.276018-06:00","updated_at":"2025-12-18T11:19:35.12758-06:00","closed_at":"2025-12-18T11:19:35.12758-06:00"}
{"id":"scribe-q3n.1","title":"Split types.ts into domain-specific modules","description":"## Summary\nSplit the monolithic `types.ts` (1,120 lines) into domain-specific modules for better maintainability.\n\n## Problem\nThe file is a \"god file\" containing 7+ different domain concepts:\n- Editor abstraction types (EditorNode, EditorContent) \n- Note types and discriminated unions (6+ note type interfaces)\n- Graph types (GraphNode, GraphEdge)\n- Search types (SearchResult)\n- Task types and functions (Task, TaskId, serialization)\n- Configuration types (VaultConfig)\n- System constants (SYSTEM_NOTE_IDS)\n\n## Proposed Structure\n```\npackages/shared/src/types/\n├── index.ts          # Re-exports all types\n├── note.ts           # Note, BaseNote, NoteId, discriminated unions, type guards\n├── editor.ts         # EditorNode, EditorContent, LexicalState (deprecated alias)\n├── task.ts           # Task, TaskId, TaskFilter, TaskChangeEvent, serialization\n├── graph.ts          # GraphNode, GraphEdge, GraphData\n├── search.ts         # SearchResult, SearchOptions\n├── config.ts         # VaultConfig, VaultPath\n└── constants.ts      # SYSTEM_NOTE_IDS, other constants\n```\n\n## Implementation Steps\n1. Create `packages/shared/src/types/` directory\n2. Extract note types (lines ~200-695) to `note.ts`\n3. Extract editor types (lines ~100-190) to `editor.ts`\n4. Extract task types (lines ~857-1121) to `task.ts`\n5. Extract graph types (lines ~696-772) to `graph.ts`\n6. Extract search types (lines ~774-829) to `search.ts`\n7. Create `index.ts` that re-exports everything\n8. Update `packages/shared/src/index.ts` to export from `types/`\n9. Run `bun run typecheck` to verify no breakages\n10. Run full test suite\n\n## Acceptance Criteria\n- [ ] All types accessible via same import paths (backward compatible)\n- [ ] No circular dependencies between type modules\n- [ ] All tests pass\n- [ ] TypeScript compilation succeeds across all packages\n\n## Estimated Effort\n4-6 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:37.351333-06:00","updated_at":"2025-12-18T11:19:20.520304-06:00","closed_at":"2025-12-18T11:19:20.520304-06:00","dependencies":[{"issue_id":"scribe-q3n.1","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.351675-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.10","title":"Add tests for untested Electron handlers","description":"## Summary\nAdd tests for 5 untested Electron main process handlers.\n\n## Problem\nThese handlers manage critical IPC operations but lack tests:\n- `cliHandlers.ts` - CLI installation and invocation\n- `dailyHandlers.ts` - Daily note CRUD operations\n- `dictionaryHandlers.ts` - Spell check dictionary management\n- `meetingHandlers.ts` - Meeting creation, attendee management\n- `peopleHandlers.ts` - People/contact operations\n\n## File Locations\n```\napps/desktop/electron/main/src/handlers/\n├── cliHandlers.ts\n├── dailyHandlers.ts\n├── dictionaryHandlers.ts\n├── meetingHandlers.ts\n└── peopleHandlers.ts\n```\n\n## Test Structure\nCreate corresponding test files:\n```\napps/desktop/\n├── cli-handlers.integration.test.ts\n├── daily-handlers.integration.test.ts\n├── dictionary-handlers.integration.test.ts\n├── meeting-handlers.integration.test.ts\n└── people-handlers.integration.test.ts\n```\n\n## Test Cases per Handler\n\n### cliHandlers.ts\n```typescript\ndescribe('CLI Handlers', () =\u003e {\n  describe('cli:install', () =\u003e {\n    it('installs CLI to expected location');\n    it('handles permission errors');\n    it('returns success status');\n  });\n  describe('cli:invoke', () =\u003e {\n    it('executes CLI command');\n    it('returns command output');\n    it('handles command failures');\n  });\n});\n```\n\n### dailyHandlers.ts\n```typescript\ndescribe('Daily Handlers', () =\u003e {\n  describe('daily:today', () =\u003e {\n    it('returns existing daily note');\n    it('creates new daily note if not exists');\n    it('uses correct date format in ID');\n  });\n  describe('daily:getByDate', () =\u003e {\n    it('returns note for specified date');\n    it('returns null for missing date');\n  });\n  describe('daily:list', () =\u003e {\n    it('returns daily notes in date range');\n    it('supports pagination');\n  });\n});\n```\n\n### dictionaryHandlers.ts\n```typescript\ndescribe('Dictionary Handlers', () =\u003e {\n  describe('dictionary:add', () =\u003e {\n    it('adds word to custom dictionary');\n    it('persists across sessions');\n  });\n  describe('dictionary:remove', () =\u003e {\n    it('removes word from dictionary');\n  });\n  describe('dictionary:list', () =\u003e {\n    it('returns all custom words');\n  });\n});\n```\n\n### meetingHandlers.ts\n```typescript\ndescribe('Meeting Handlers', () =\u003e {\n  describe('meeting:create', () =\u003e {\n    it('creates meeting note with attendees');\n    it('validates required fields');\n    it('sets correct note type');\n  });\n  describe('meeting:addAttendee', () =\u003e {\n    it('adds attendee to existing meeting');\n    it('creates person if not exists');\n  });\n  describe('meeting:list', () =\u003e {\n    it('returns meetings in date range');\n  });\n});\n```\n\n### peopleHandlers.ts\n```typescript\ndescribe('People Handlers', () =\u003e {\n  describe('people:list', () =\u003e {\n    it('returns all people');\n    it('supports pagination');\n  });\n  describe('people:get', () =\u003e {\n    it('returns person by ID');\n    it('includes related notes');\n  });\n  describe('people:create', () =\u003e {\n    it('creates new person');\n    it('validates name field');\n  });\n});\n```\n\n## Implementation Steps\n1. Use existing test helpers from `test-helpers.ts`\n2. Create mock engines following established patterns\n3. Implement tests for each handler file\n4. Ensure tests clean up after themselves\n5. Add to CI pipeline\n\n## Acceptance Criteria\n- [ ] All 5 handler files have test coverage\n- [ ] Coverage \u003e80% per handler file\n- [ ] Tests are integration-style (test IPC contract)\n- [ ] Tests run in \u003c60 seconds total\n- [ ] No flaky tests\n\n## Estimated Effort\n4-6 hours (1 hour per handler)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:38.009462-06:00","updated_at":"2025-12-18T15:02:11.308112-06:00","closed_at":"2025-12-18T15:02:11.308112-06:00","dependencies":[{"issue_id":"scribe-q3n.10","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.009784-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.11","title":"Add tests for untested renderer hooks","description":"## Summary\nAdd tests for 6 untested renderer hooks that manage application state.\n\n## Problem\nThese hooks manage critical UI state but lack tests:\n- `useAppKeyboardShortcuts.ts` - Global keyboard shortcuts\n- `useMouseActivity.ts` - Mouse activity tracking\n- `useHistoryEntries.ts` - Navigation history\n- `useCommandPalette.ts` - Command palette state\n- `useBacklinks.ts` - Backlink data fetching\n- `usePanelState.ts` - Panel open/close state\n\n## File Locations\n```\napps/desktop/renderer/src/hooks/\n├── useAppKeyboardShortcuts.ts\n├── useMouseActivity.ts\n├── useHistoryEntries.ts\n├── useCommandPalette.ts\n├── useBacklinks.ts\n└── usePanelState.ts\n```\n\n## Test Cases per Hook\n\n### useAppKeyboardShortcuts\n```typescript\ndescribe('useAppKeyboardShortcuts', () =\u003e {\n  it('registers keyboard event listeners on mount');\n  it('calls handler for Cmd+K');\n  it('calls handler for Cmd+N');\n  it('calls handler for Cmd+/');\n  it('unregisters listeners on unmount');\n  it('prevents default for handled shortcuts');\n});\n```\n\n### useMouseActivity\n```typescript\ndescribe('useMouseActivity', () =\u003e {\n  it('tracks mouse movement');\n  it('detects idle state after timeout');\n  it('resets idle timer on activity');\n  it('cleans up listeners on unmount');\n});\n```\n\n### useHistoryEntries\n```typescript\ndescribe('useHistoryEntries', () =\u003e {\n  it('fetches history entries on mount');\n  it('returns loading state initially');\n  it('returns entries after fetch');\n  it('handles fetch errors');\n  it('supports refresh trigger');\n});\n```\n\n### useCommandPalette\n```typescript\ndescribe('useCommandPalette', () =\u003e {\n  it('starts closed');\n  it('opens on trigger');\n  it('closes on escape');\n  it('tracks current mode');\n  it('resets state on close');\n});\n```\n\n### useBacklinks\n```typescript\ndescribe('useBacklinks', () =\u003e {\n  it('fetches backlinks for note ID');\n  it('returns empty array for no backlinks');\n  it('updates when note ID changes');\n  it('handles loading state');\n});\n```\n\n### usePanelState\n```typescript\ndescribe('usePanelState', () =\u003e {\n  it('tracks open/closed state');\n  it('persists state to localStorage');\n  it('restores state from localStorage');\n  it('supports multiple panel IDs');\n});\n```\n\n## Testing Strategy\n- Use `@testing-library/react` with `renderHook`\n- Mock `window.api` (IPC bridge)\n- Mock `localStorage` for persistence tests\n- Use `userEvent` for keyboard/mouse simulation\n\n## Implementation Steps\n1. Create test files in `apps/desktop/renderer/src/hooks/__tests__/`\n2. Set up common test utilities (mock IPC, localStorage)\n3. Implement tests for each hook\n4. Verify cleanup on unmount for all hooks\n5. Ensure no memory leaks\n\n## Acceptance Criteria\n- [ ] All 6 hooks have test files\n- [ ] Coverage \u003e80% per hook\n- [ ] Cleanup behavior tested\n- [ ] No memory leak warnings\n- [ ] Tests run in \u003c30 seconds\n\n## Estimated Effort\n3-4 hours","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:38.083531-06:00","updated_at":"2025-12-18T15:03:20.324962-06:00","dependencies":[{"issue_id":"scribe-q3n.11","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.083875-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.12","title":"Add tests for design-system primitives","description":"## Summary\nAdd tests for 4 untested design-system primitives.\n\n## Problem\nThese UI primitives lack tests:\n- `Text/Text.tsx` - Typography component\n- `Surface/Surface.tsx` - Container component\n- `Icon/Icon.tsx` - Icon wrapper\n- `FloatingMenu/FloatingMenu.tsx` - Popover menu\n\n## File Locations\n```\npackages/design-system/src/primitives/\n├── Text/Text.tsx\n├── Surface/Surface.tsx\n├── Icon/Icon.tsx\n└── FloatingMenu/FloatingMenu.tsx\n```\n\n## Test Cases per Component\n\n### Text.tsx\n```typescript\ndescribe('Text', () =\u003e {\n  it('renders children');\n  it('applies variant styles (body, heading, caption)');\n  it('applies size styles (sm, md, lg)');\n  it('applies weight styles (normal, medium, bold)');\n  it('applies color from theme');\n  it('renders as correct element (span, p, h1-h6)');\n  it('forwards className prop');\n  it('forwards other HTML attributes');\n});\n```\n\n### Surface.tsx\n```typescript\ndescribe('Surface', () =\u003e {\n  it('renders children');\n  it('applies elevation styles (0, 1, 2, 3)');\n  it('applies border radius');\n  it('applies padding variants');\n  it('applies background color from theme');\n  it('supports as prop for semantic HTML');\n  it('forwards className prop');\n});\n```\n\n### Icon.tsx\n```typescript\ndescribe('Icon', () =\u003e {\n  it('renders SVG icon');\n  it('applies size (sm, md, lg)');\n  it('applies color from theme');\n  it('applies custom color');\n  it('supports aria-label for accessibility');\n  it('sets aria-hidden when decorative');\n});\n```\n\n### FloatingMenu.tsx\n```typescript\ndescribe('FloatingMenu', () =\u003e {\n  it('renders trigger element');\n  it('shows menu on trigger click');\n  it('hides menu on outside click');\n  it('hides menu on Escape key');\n  it('positions menu correctly (top, bottom, left, right)');\n  it('renders menu items');\n  it('calls onSelect when item clicked');\n  it('supports keyboard navigation');\n});\n```\n\n## Testing Strategy\n- Use `@testing-library/react`\n- Use `vitest` for assertions\n- Test with ThemeProvider wrapper\n- Test accessibility with `@testing-library/jest-dom`\n\n## Implementation Steps\n1. Create test files alongside components:\n   - `Text/Text.test.tsx`\n   - `Surface/Surface.test.tsx`\n   - `Icon/Icon.test.tsx`\n   - `FloatingMenu/FloatingMenu.test.tsx`\n2. Set up ThemeProvider wrapper utility\n3. Implement tests for each component\n4. Add accessibility assertions\n5. Verify all prop variations work\n\n## Acceptance Criteria\n- [ ] All 4 components have test files\n- [ ] Coverage \u003e85% per component\n- [ ] Accessibility tested (aria attributes)\n- [ ] Theme integration tested\n- [ ] Tests run in \u003c10 seconds\n\n## Estimated Effort\n2-3 hours","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:38.157022-06:00","updated_at":"2025-12-18T11:19:22.595831-06:00","closed_at":"2025-12-18T11:19:22.595831-06:00","dependencies":[{"issue_id":"scribe-q3n.12","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.15751-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.13","title":"Fix flaky/skipped tests","description":"## Summary\nFix 5 flaky/skipped tests that are currently disabled due to timing issues.\n\n## Problem\nThese tests are skipped and not providing coverage:\n\n1. **useNoteState.test.ts** (entire suite) - Race conditions with hook initialization\n2. **CommandPalette.keyboard.test.tsx** (entire suite) - Keyboard event timing in CI\n3. **CommandPalette.delete-confirm.test.tsx** (2 tests) - Dialog transition timing\n4. **CommandPalette.command-mode.test.tsx** (1 test) - Selection state reset timing\n\n## File Locations\n```\napps/desktop/renderer/src/hooks/useNoteState.test.ts\napps/desktop/renderer/src/components/CommandPalette/CommandPalette.keyboard.test.tsx\napps/desktop/renderer/src/components/CommandPalette/CommandPalette.delete-confirm.test.tsx\napps/desktop/renderer/src/components/CommandPalette/CommandPalette.command-mode.test.tsx\n```\n\n## Investigation Steps\n\n### useNoteState.test.ts\n1. Identify the race condition:\n   - Look for async state updates without proper awaiting\n   - Check if `waitFor` timeouts are sufficient\n   - Look for missing `act()` wrappers\n2. Fix approach:\n   - Use `waitFor` with proper predicates\n   - Add proper cleanup between tests\n   - Consider using `fake-timers` if timeout-related\n\n### CommandPalette.keyboard.test.tsx\n1. Identify timing issue:\n   - Keyboard events may fire before component is ready\n   - Event propagation timing in jsdom\n2. Fix approach:\n   - Add `waitFor` after keyboard events\n   - Ensure focus is properly set before triggering\n   - Consider `userEvent.setup()` for better event timing\n\n### CommandPalette.delete-confirm.test.tsx\n1. Identify dialog transition issue:\n   - CSS transitions may affect test timing\n   - Dialog open/close state not awaited\n2. Fix approach:\n   - Wait for dialog elements to appear/disappear\n   - Use `findBy*` queries instead of `getBy*`\n   - Add transition mocking if needed\n\n### CommandPalette.command-mode.test.tsx\n1. Identify selection reset issue:\n   - Selection state updates may be batched\n   - State not settled before assertion\n2. Fix approach:\n   - Add explicit wait for selection state\n   - Check for intermediate states\n\n## Common Fixes to Try\n```typescript\n// 1. Proper async handling\nawait waitFor(() =\u003e {\n  expect(screen.getByText('expected')).toBeInTheDocument();\n});\n\n// 2. Better event timing\nconst user = userEvent.setup();\nawait user.keyboard('{Enter}');\nawait waitFor(() =\u003e expect(handler).toHaveBeenCalled());\n\n// 3. Fake timers for transitions\nvi.useFakeTimers();\n// ... trigger action ...\nawait vi.runAllTimersAsync();\nvi.useRealTimers();\n\n// 4. Proper cleanup\nafterEach(() =\u003e {\n  vi.clearAllMocks();\n  cleanup();\n});\n```\n\n## Implementation Steps\n1. Run each test in isolation to understand failure mode\n2. Add debug logging to identify exact timing issue\n3. Apply appropriate fix for each test\n4. Remove `.skip` and verify passing locally\n5. Run in CI multiple times to confirm no flakiness\n6. Document any remaining timing sensitivities\n\n## Acceptance Criteria\n- [ ] All 5 test files have `.skip` removed\n- [ ] All tests pass consistently (10 runs)\n- [ ] No flakiness in CI (check 5 CI runs)\n- [ ] Root cause documented in test comments\n- [ ] No increase in test runtime \u003e20%\n\n## Estimated Effort\n3-4 hours (may require debugging time)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:38.230743-06:00","updated_at":"2025-12-18T11:19:23.279149-06:00","closed_at":"2025-12-18T11:19:23.279149-06:00","dependencies":[{"issue_id":"scribe-q3n.13","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.231088-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.14","title":"Consolidate createEmptyContent() to shared package","description":"## Summary\nConsolidate `createEmptyContent()` function to `@scribe/shared` package.\n\n## Problem\nThis utility is duplicated in 4 locations with slight variations:\n1. `packages/storage-fs/src/storage.ts` (line 568) - includes `version: 1`\n2. `apps/cli/src/node-builder.ts` (line 165) - includes `format: '', indent: 0, direction: null`\n3. `apps/desktop/test-helpers.ts` (line 190) - minimal version\n4. `apps/desktop/renderer/src/templates/daily.ts` (line 10) - similar pattern as `createDailyContent()`\n\n## Current Implementations\n```typescript\n// storage.ts\nprivate createEmptyContent(): EditorContent {\n  return {\n    root: {\n      type: 'root',\n      children: [{ type: 'paragraph', children: [], ... }],\n      ...\n    },\n    version: 1,\n  };\n}\n\n// node-builder.ts\nexport function createEmptyContent(): LexicalState {\n  return {\n    root: {\n      type: 'root',\n      children: [{ type: 'paragraph', children: [], format: '', indent: 0, direction: null }],\n      ...\n    },\n  };\n}\n```\n\n## Proposed Shared Implementation\n```typescript\n// packages/shared/src/content.ts\n\n/**\n * Creates an empty Lexical editor content structure.\n * Use this as the initial content for new notes.\n * \n * @param options.version - Content version (default: 1)\n * @returns Empty EditorContent with single paragraph\n * \n * @example\n * const content = createEmptyContent();\n * const note = { id: 'note-1', content, ... };\n */\nexport function createEmptyContent(options?: { version?: number }): EditorContent {\n  return {\n    root: {\n      type: 'root',\n      children: [{\n        type: 'paragraph',\n        children: [],\n        format: '',\n        indent: 0,\n        direction: null,\n        version: 1,\n      }],\n      format: '',\n      indent: 0,\n      direction: null,\n      version: 1,\n    },\n    version: options?.version ?? 1,\n  };\n}\n```\n\n## Implementation Steps\n1. Create `packages/shared/src/content.ts`\n2. Implement `createEmptyContent()` with comprehensive JSDoc\n3. Export from `packages/shared/src/index.ts`\n4. Update `packages/storage-fs/src/storage.ts`:\n   - Import `createEmptyContent` from `@scribe/shared`\n   - Remove private method\n5. Update `apps/cli/src/node-builder.ts`:\n   - Import from `@scribe/shared`\n   - Remove local implementation\n6. Update `apps/desktop/test-helpers.ts`:\n   - Import from `@scribe/shared`\n   - Remove local implementation\n7. Update `apps/desktop/renderer/src/templates/daily.ts`:\n   - Use shared utility as base for `createDailyContent()`\n8. Run all tests to verify\n9. Run typecheck across all packages\n\n## Acceptance Criteria\n- [ ] Single `createEmptyContent()` in `@scribe/shared`\n- [ ] All 4 locations updated to use shared version\n- [ ] No behavior changes in any package\n- [ ] All tests pass\n- [ ] Full JSDoc documentation\n\n## Estimated Effort\n1 hour","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:38.304436-06:00","updated_at":"2025-12-18T15:00:03.146918-06:00","closed_at":"2025-12-18T15:00:03.146918-06:00","dependencies":[{"issue_id":"scribe-q3n.14","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.304794-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.15","title":"Remove duplicate CLI content-extractor","description":"## Summary\nRemove duplicate CLI content-extractor and use `@scribe/shared` instead.\n\n## Problem\n`apps/cli/src/content-extractor.ts` (115 lines) duplicates logic from `packages/shared/src/content-extractor.ts` (1033 lines):\n\n- Both define local `LexicalNode` interface\n- Both have `extractBlock()`/`convertBlockNode()` patterns\n- Both have `extractInline()`/`extractInlineContent()` patterns\n- CLI version is simpler but unmaintained separately\n\n## Current CLI Implementation\n```typescript\n// apps/cli/src/content-extractor.ts\ninterface LexicalNode { ... }  // Duplicated!\n\nexport function extractPlainText(content: LexicalState): string {\n  // Simplified extraction for CLI output\n}\n\nfunction extractBlock(node: LexicalNode): string { ... }\nfunction extractInline(node: LexicalNode): string { ... }\n```\n\n## Migration Options\n\n### Option A: Use extractMarkdown() from shared\nThe shared package's `extractMarkdown()` already handles full content extraction. The CLI could use it with options to strip formatting:\n\n```typescript\nimport { extractMarkdown } from '@scribe/shared';\n\n// In CLI commands\nconst text = extractMarkdown(note.content, { \n  includeFrontmatter: false,\n  // Could add: format: 'plain' option\n});\n```\n\n### Option B: Add extractPlainText() to shared\nIf plain text (non-Markdown) is specifically needed:\n\n```typescript\n// packages/shared/src/content-extractor.ts\nexport function extractPlainText(content: EditorContent): string {\n  // Move CLI logic here\n}\n```\n\n## Implementation Steps\n1. Analyze CLI usage of `extractPlainText()`:\n   - `apps/cli/src/commands/notes.ts` - for `show` command output\n   - Check if Markdown output would be acceptable\n2. If plain text is required:\n   - Add `extractPlainText()` to `@scribe/shared/content-extractor.ts`\n   - Export from `@scribe/shared/index.ts`\n3. Update CLI imports:\n   ```typescript\n   import { extractPlainText } from '@scribe/shared';\n   ```\n4. Delete `apps/cli/src/content-extractor.ts`\n5. Update `apps/cli/tests/unit/content-extractor.test.ts`:\n   - Either delete (if tests are for shared now)\n   - Or keep as integration tests for CLI-specific behavior\n6. Run CLI tests\n7. Manual testing of `scribe notes show` command\n\n## Acceptance Criteria\n- [ ] `apps/cli/src/content-extractor.ts` deleted\n- [ ] CLI uses `@scribe/shared` for content extraction\n- [ ] `scribe notes show` produces same output\n- [ ] CLI tests pass\n- [ ] No duplicate `LexicalNode` interface in CLI\n\n## Estimated Effort\n1-2 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:38.378437-06:00","updated_at":"2025-12-18T14:50:27.670688-06:00","closed_at":"2025-12-18T14:50:27.670688-06:00","dependencies":[{"issue_id":"scribe-q3n.15","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.378763-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.16","title":"Remove duplicate LexicalNode interface definitions","description":"## Summary\nRemove duplicate `LexicalNode` interface definitions and import from `@scribe/shared`.\n\n## Problem\nThe `LexicalNode` interface is defined locally in 4 locations instead of importing from shared:\n1. `apps/cli/src/node-builder.ts` (line 6)\n2. `apps/cli/src/content-extractor.ts` (line 3) - will be deleted in scribe-q3n.15\n3. `packages/shared/src/content-extractor.ts` (line 409)\n4. `packages/shared/src/types.ts` - canonical definition (exported as `EditorNode`)\n\n## Current Duplicate Definitions\n```typescript\n// apps/cli/src/node-builder.ts:6\ninterface LexicalNode {\n  type: string;\n  children?: LexicalNode[];\n  text?: string;\n  // ... other properties\n}\n\n// packages/shared/src/content-extractor.ts:409\ninterface LexicalNode {\n  type: string;\n  // ... similar definition\n}\n```\n\n## Canonical Definition\n```typescript\n// packages/shared/src/types.ts\nexport interface EditorNode {\n  type: string;\n  children?: EditorNode[];\n  text?: string;\n  format?: string | number;\n  indent?: number;\n  direction?: 'ltr' | 'rtl' | null;\n  version?: number;\n  // ... comprehensive definition\n}\n\n/** @deprecated Use EditorNode instead */\nexport type LexicalNode = EditorNode;\n```\n\n## Implementation Steps\n1. **apps/cli/src/node-builder.ts**:\n   ```typescript\n   // Remove local interface\n   - interface LexicalNode { ... }\n   \n   // Add import\n   + import { EditorNode } from '@scribe/shared';\n   // Or if still using deprecated name:\n   + import { LexicalNode } from '@scribe/shared';\n   ```\n\n2. **packages/shared/src/content-extractor.ts**:\n   - This is within the same package, so import from `./types`\n   ```typescript\n   - interface LexicalNode { ... }\n   + import { EditorNode } from './types';\n   // Update all usages of LexicalNode to EditorNode\n   ```\n\n3. Run typecheck to find any type mismatches\n4. Fix any property differences between local and canonical definitions\n5. Run tests\n\n## Property Reconciliation\nEnsure all properties used in local definitions exist in canonical:\n- `type: string` ✓\n- `children?: EditorNode[]` ✓\n- `text?: string` ✓\n- `format?: string | number` ✓\n- `indent?: number` ✓\n- `direction?: 'ltr' | 'rtl' | null` ✓\n- `version?: number` ✓\n- `url?: string` - may need to add for link nodes\n- `listType?: string` - may need to add for list nodes\n\n## Acceptance Criteria\n- [ ] No local `LexicalNode` interface definitions\n- [ ] All files import from `@scribe/shared`\n- [ ] Type compatibility verified\n- [ ] All tests pass\n- [ ] TypeScript compiles successfully\n\n## Estimated Effort\n1 hour","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:38.457147-06:00","updated_at":"2025-12-18T15:02:01.701912-06:00","closed_at":"2025-12-18T15:02:01.701912-06:00","dependencies":[{"issue_id":"scribe-q3n.16","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.457455-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.17","title":"Create shared date formatting utilities","description":"## Summary\nCreate shared date formatting utilities to replace 4 duplicate implementations.\n\n## Problem\nDate formatting is implemented differently in multiple locations:\n1. `apps/cli/src/output.ts` - `formatDate(iso)` using `toLocaleString()`\n2. `apps/cli/src/commands/daily.ts` - `formatDateYMD(date)` for \"YYYY-MM-DD\"\n3. `apps/cli/src/commands/daily.ts` - `formatDateTitle(dateStr)` for \"January 15, 2025\"\n4. `apps/desktop/renderer/src/templates/daily.ts` - `getDailyDisplayTitle()` for \"Today\" or \"MM/dd/yyyy\"\n\nThis leads to inconsistent date displays and duplicated logic.\n\n## Proposed Shared Module\n```typescript\n// packages/shared/src/date-utils.ts\n\nimport { format, isToday, isYesterday, isTomorrow, parseISO } from 'date-fns';\n\n/**\n * Format date as ISO date string (YYYY-MM-DD).\n * Used for daily note IDs and file naming.\n */\nexport function formatDateISO(date: Date): string {\n  return format(date, 'yyyy-MM-dd');\n}\n\n/**\n * Format date for display in UI.\n * Returns \"Today\", \"Yesterday\", \"Tomorrow\" for relative dates,\n * or formatted date string otherwise.\n */\nexport function formatDateDisplay(date: Date | string): string {\n  const d = typeof date === 'string' ? parseISO(date) : date;\n  if (isToday(d)) return 'Today';\n  if (isYesterday(d)) return 'Yesterday';\n  if (isTomorrow(d)) return 'Tomorrow';\n  return format(d, 'MMMM d, yyyy'); // \"January 15, 2025\"\n}\n\n/**\n * Format date for CLI output with time.\n */\nexport function formatDateTime(date: Date | string): string {\n  const d = typeof date === 'string' ? parseISO(date) : date;\n  return format(d, 'MMM d, yyyy h:mm a'); // \"Jan 15, 2025 3:30 PM\"\n}\n\n/**\n * Format date as human-readable title.\n * Used for note titles and headings.\n */\nexport function formatDateTitle(date: Date | string): string {\n  const d = typeof date === 'string' ? parseISO(date) : date;\n  return format(d, 'MMMM d, yyyy'); // \"January 15, 2025\"\n}\n\n/**\n * Parse daily note ID to Date object.\n */\nexport function parseDailyId(dailyId: string): Date | null {\n  // daily-YYYY-MM-DD format\n  const match = dailyId.match(/^daily-(\\d{4}-\\d{2}-\\d{2})$/);\n  if (!match) return null;\n  return parseISO(match[1]);\n}\n```\n\n## Implementation Steps\n1. Create `packages/shared/src/date-utils.ts`\n2. Add `date-fns` as dependency to `@scribe/shared` (if not already)\n3. Export from `packages/shared/src/index.ts`\n4. Update `apps/cli/src/output.ts`:\n   - Import `formatDateTime` from `@scribe/shared`\n   - Remove local `formatDate()`\n5. Update `apps/cli/src/commands/daily.ts`:\n   - Import `formatDateISO`, `formatDateTitle` from `@scribe/shared`\n   - Remove local implementations\n6. Update `apps/desktop/renderer/src/templates/daily.ts`:\n   - Import `formatDateDisplay` from `@scribe/shared`\n   - Remove/simplify local `getDailyDisplayTitle()`\n7. Add tests for date utilities\n8. Run all tests\n\n## Acceptance Criteria\n- [ ] Single date formatting module in `@scribe/shared`\n- [ ] All 4 locations use shared utilities\n- [ ] Consistent date formatting across CLI and desktop\n- [ ] Tests for all date utilities\n- [ ] No duplicate date-fns usage patterns\n\n## Estimated Effort\n1-2 hours","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:38.534522-06:00","updated_at":"2025-12-18T11:19:23.987121-06:00","closed_at":"2025-12-18T11:19:23.987121-06:00","dependencies":[{"issue_id":"scribe-q3n.17","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.534911-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.18","title":"Create shared pagination validation utilities","description":"## Summary\nCreate shared pagination validation utilities for CLI commands.\n\n## Problem\nThe same limit/offset validation pattern is repeated in 4+ CLI commands:\n\n```typescript\n// Repeated in notes.ts, tasks.ts, people.ts, tags.ts\nif (options.limit !== undefined \u0026\u0026 (!Number.isInteger(options.limit) || options.limit \u003c 0)) {\n  throw new Error('--limit must be a non-negative integer');\n}\nif (options.offset !== undefined \u0026\u0026 (!Number.isInteger(options.offset) || options.offset \u003c 0)) {\n  throw new Error('--offset must be a non-negative integer');\n}\n```\n\n## Proposed Shared Utilities\n```typescript\n// packages/shared/src/validation.ts\n\nimport { ValidationError } from './errors';\n\nexport interface PaginationOptions {\n  limit?: number;\n  offset?: number;\n}\n\n/**\n * Validates pagination options (limit and offset).\n * @throws ValidationError if options are invalid\n * \n * @example\n * validatePaginationOptions({ limit: 10, offset: 0 }); // OK\n * validatePaginationOptions({ limit: -1 }); // throws\n */\nexport function validatePaginationOptions(options: PaginationOptions): void {\n  if (options.limit !== undefined) {\n    if (!Number.isInteger(options.limit) || options.limit \u003c 0) {\n      throw new ValidationError('--limit must be a non-negative integer');\n    }\n  }\n  if (options.offset !== undefined) {\n    if (!Number.isInteger(options.offset) || options.offset \u003c 0) {\n      throw new ValidationError('--offset must be a non-negative integer');\n    }\n  }\n}\n\n/**\n * Validates a date string in YYYY-MM-DD format.\n * @throws ValidationError if date is invalid\n */\nexport function validateDateString(date: string, paramName: string): void {\n  if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n    throw new ValidationError(`${paramName} must be in YYYY-MM-DD format`);\n  }\n  const parsed = new Date(date);\n  if (isNaN(parsed.getTime())) {\n    throw new ValidationError(`${paramName} is not a valid date`);\n  }\n}\n\n/**\n * Validates a positive integer.\n * @throws ValidationError if value is not a positive integer\n */\nexport function validatePositiveInteger(value: unknown, paramName: string): asserts value is number {\n  if (typeof value !== 'number' || !Number.isInteger(value) || value \u003c 1) {\n    throw new ValidationError(`${paramName} must be a positive integer`);\n  }\n}\n```\n\n## Implementation Steps\n1. Create `packages/shared/src/validation.ts`\n2. Implement `validatePaginationOptions()` with JSDoc\n3. Add other common validation utilities\n4. Export from `packages/shared/src/index.ts`\n5. Update CLI commands:\n   - `apps/cli/src/commands/notes.ts`\n   - `apps/cli/src/commands/tasks.ts`\n   - `apps/cli/src/commands/people.ts`\n   - `apps/cli/src/commands/tags.ts`\n6. Add tests for validation utilities\n7. Run CLI tests\n\n## Usage After Change\n```typescript\n// In CLI commands\nimport { validatePaginationOptions } from '@scribe/shared';\n\n.action(async (options) =\u003e {\n  validatePaginationOptions(options); // throws ValidationError if invalid\n  // ... rest of command\n});\n```\n\n## Acceptance Criteria\n- [ ] Shared validation module created\n- [ ] All 4 CLI commands use shared validation\n- [ ] Consistent error messages\n- [ ] Uses `ValidationError` from errors.ts\n- [ ] Tests for validation utilities\n- [ ] CLI tests pass\n\n## Estimated Effort\n1 hour","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:38.609004-06:00","updated_at":"2025-12-18T14:58:54.922041-06:00","closed_at":"2025-12-18T14:58:54.922041-06:00","dependencies":[{"issue_id":"scribe-q3n.18","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.609377-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.19","title":"Create deepClone utility in shared package","description":"## Summary\nCreate a `deepClone\u003cT\u003e()` utility to replace `JSON.parse(JSON.stringify())` pattern.\n\n## Problem\nDeep cloning using JSON serialization appears in multiple locations:\n```typescript\nconst updated = JSON.parse(JSON.stringify(content)) as LexicalState;\n```\n\nFound in:\n- `apps/cli/src/node-builder.ts` (lines 113, 130, 151)\n- `apps/desktop/tasks.integration.test.ts` (line 168)\n\nThis pattern:\n- Is slow for large objects\n- Loses `undefined` values\n- Loses Date objects (become strings)\n- Loses Map/Set/RegExp\n\n## Proposed Utility\n```typescript\n// packages/shared/src/utils.ts\n\n/**\n * Deep clone an object using structured cloning.\n * Handles circular references and special types better than JSON.parse(JSON.stringify()).\n * \n * @param obj - Object to clone\n * @returns Deep copy of the object\n * \n * @example\n * const original = { nested: { value: 1 } };\n * const cloned = deepClone(original);\n * cloned.nested.value = 2;\n * console.log(original.nested.value); // Still 1\n */\nexport function deepClone\u003cT\u003e(obj: T): T {\n  // Use structuredClone if available (Node 17+, modern browsers)\n  if (typeof structuredClone === 'function') {\n    return structuredClone(obj);\n  }\n  \n  // Fallback for older environments\n  return JSON.parse(JSON.stringify(obj));\n}\n```\n\n## Implementation Steps\n1. Add `deepClone()` to `packages/shared/src/utils.ts` (or create file)\n2. Export from `packages/shared/src/index.ts`\n3. Update `apps/cli/src/node-builder.ts`:\n   ```typescript\n   import { deepClone } from '@scribe/shared';\n   \n   // Replace:\n   - const updated = JSON.parse(JSON.stringify(content)) as LexicalState;\n   + const updated = deepClone(content);\n   ```\n4. Update `apps/desktop/tasks.integration.test.ts` similarly\n5. Add tests for `deepClone()`\n6. Run all tests\n\n## Test Cases\n```typescript\ndescribe('deepClone', () =\u003e {\n  it('creates independent copy of nested objects');\n  it('handles arrays');\n  it('handles null and undefined');\n  it('handles Date objects');\n  it('handles circular references (if using structuredClone)');\n  it('preserves object types');\n});\n```\n\n## Acceptance Criteria\n- [ ] `deepClone()` utility created\n- [ ] All JSON.parse(JSON.stringify()) replaced\n- [ ] Uses `structuredClone` when available\n- [ ] Tests for edge cases\n- [ ] No behavior changes\n\n## Estimated Effort\n30 minutes","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-18T10:07:38.682648-06:00","updated_at":"2025-12-18T10:18:22.691269-06:00","dependencies":[{"issue_id":"scribe-q3n.19","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.682988-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.2","title":"Split CLI notes.ts into individual command modules","description":"## Summary\nSplit the monolithic `notes.ts` (847 lines) CLI command into individual command modules.\n\n## Problem\n- Single `registerNotesCommands()` function spans ~625 lines (lines 224-847)\n- Handles 8+ commands: list, show, append, create, add-task, update, find, delete, export\n- Code duplication in context initialization, error handling, output formatting\n- Difficult to maintain and test individual commands\n\n## Proposed Structure\n```\napps/cli/src/commands/notes/\n├── index.ts          # registerNotesCommands() that imports and registers all\n├── list.ts           # notes list command\n├── show.ts           # notes show command  \n├── create.ts         # notes create command\n├── update.ts         # notes update command\n├── append.ts         # notes append command\n├── delete.ts         # notes delete command\n├── find.ts           # notes find command (fuzzy search)\n├── export.ts         # notes export command\n├── add-task.ts       # notes add-task command\n└── shared.ts         # Shared utilities (fuzzy matching from lines 37-130)\n```\n\n## Implementation Steps\n1. Create `apps/cli/src/commands/notes/` directory\n2. Extract fuzzy matching utilities (lines 37-130) to `shared.ts`\n3. Create command factory for shared boilerplate (context init, error handling)\n4. Extract each command to its own file with consistent pattern:\n   ```typescript\n   export function registerListCommand(program: Command, getContext: () =\u003e LazyContext) {\n     program\n       .command('list')\n       .description('...')\n       .action(async (options) =\u003e { ... });\n   }\n   ```\n5. Create `index.ts` that imports and calls all register functions\n6. Update `apps/cli/src/cli.ts` to use new module structure\n7. Run CLI tests to verify functionality\n\n## Acceptance Criteria\n- [ ] All CLI commands work identically to before\n- [ ] Each command is in its own file (\u003c150 lines each)\n- [ ] Shared utilities are extracted and reused\n- [ ] CLI integration tests pass\n\n## Estimated Effort\n3-4 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:37.427069-06:00","updated_at":"2025-12-18T11:19:21.235118-06:00","closed_at":"2025-12-18T11:19:21.235118-06:00","dependencies":[{"issue_id":"scribe-q3n.2","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.427417-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.20","title":"Sync dependency versions across packages","description":"## Summary\nSync dependency versions across all packages for consistency.\n\n## Problem\nVersion inconsistencies found:\n\n| Dependency | Expected | Outdated Package |\n|------------|----------|------------------|\n| vitest | ^2.1.8 | renderer uses ^2.1.5 |\n| @vitest/coverage-v8 | ^2.1.8 | renderer uses ^2.1.5 |\n| typescript | ^5.7.2 | design-system uses ^5.6.3 |\n\n## Files to Update\n\n### apps/desktop/renderer/package.json\n```json\n{\n  \"devDependencies\": {\n-   \"vitest\": \"^2.1.5\",\n+   \"vitest\": \"^2.1.8\",\n-   \"@vitest/coverage-v8\": \"^2.1.5\",\n+   \"@vitest/coverage-v8\": \"^2.1.8\"\n  }\n}\n```\n\n### packages/design-system/package.json\n```json\n{\n  \"devDependencies\": {\n-   \"typescript\": \"^5.6.3\",\n+   \"typescript\": \"^5.7.2\"\n  }\n}\n```\n\n## Implementation Steps\n1. Update `apps/desktop/renderer/package.json`:\n   - vitest: ^2.1.5 → ^2.1.8\n   - @vitest/coverage-v8: ^2.1.5 → ^2.1.8\n2. Update `packages/design-system/package.json`:\n   - typescript: ^5.6.3 → ^5.7.2\n3. Run `bun install` to update lockfile\n4. Run `bun run typecheck` to verify TS compatibility\n5. Run `bun run test` to verify vitest compatibility\n6. Check for any deprecation warnings\n\n## Verification\n```bash\n# After updates\nbun install\nbun run typecheck\nbun run test\nbun run build\n```\n\n## Acceptance Criteria\n- [ ] All vitest versions are ^2.1.8\n- [ ] All typescript versions are ^5.7.2\n- [ ] Lockfile updated\n- [ ] All tests pass\n- [ ] Build succeeds\n- [ ] No new deprecation warnings\n\n## Estimated Effort\n30 minutes","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:38.756014-06:00","updated_at":"2025-12-18T10:18:32.319836-06:00","dependencies":[{"issue_id":"scribe-q3n.20","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.756354-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.21","title":"Remove orphaned /deletions.jsonl file","description":"## Summary\nRemove the orphaned `/deletions.jsonl` file from repository root.\n\n## Problem\nA `deletions.jsonl` file exists in the repository root that appears to be a duplicate of `.beads/deletions.jsonl`:\n- Root file: `/deletions.jsonl` (230 entries)\n- Beads file: `/.beads/deletions.jsonl`\n\nThe root-level file was likely accidentally committed or auto-generated in the wrong location.\n\n## Verification Steps\n1. Compare contents of both files:\n   ```bash\n   diff deletions.jsonl .beads/deletions.jsonl\n   ```\n2. Check git history to understand how it was created:\n   ```bash\n   git log --oneline deletions.jsonl | head -5\n   ```\n3. Verify `.beads/deletions.jsonl` is the canonical location\n\n## Implementation Steps\n1. Verify the root file is indeed a duplicate/orphan\n2. Remove the file:\n   ```bash\n   git rm deletions.jsonl\n   ```\n3. Consider adding to `.gitignore` if it might be regenerated:\n   ```\n   # Root-level Beads artifacts (should be in .beads/)\n   /deletions.jsonl\n   ```\n4. Commit the removal\n\n## Acceptance Criteria\n- [ ] Root-level `deletions.jsonl` removed\n- [ ] `.beads/deletions.jsonl` still exists and functional\n- [ ] Beads commands still work correctly\n- [ ] Added to `.gitignore` if needed\n\n## Estimated Effort\n15 minutes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T10:07:38.828102-06:00","updated_at":"2025-12-18T11:19:33.187188-06:00","closed_at":"2025-12-18T11:19:33.187188-06:00","dependencies":[{"issue_id":"scribe-q3n.21","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.828471-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.22","title":"Plan migration from LexicalState to EditorContent","description":"## Summary\nCreate a migration plan for replacing deprecated `LexicalState`/`LexicalNode` with `EditorContent`/`EditorNode`.\n\n## Problem\nThe codebase uses deprecated type aliases extensively:\n- `LexicalState` → should be `EditorContent`\n- `LexicalNode` → should be `EditorNode`\n\nThese are marked `@deprecated` in `types.ts` but still used in 100+ files.\n\n## Current State\n```typescript\n// packages/shared/src/types.ts\n\n/** @deprecated Use EditorContent instead */\nexport type LexicalState = EditorContent;\n\n/** @deprecated Use EditorNode instead */\nexport type LexicalNode = EditorNode;\n```\n\n## Scope Assessment\nFiles using deprecated types (approximate):\n- `apps/desktop/` - 60+ files\n- `apps/cli/` - 10+ files\n- `packages/storage-fs/` - 5+ files\n- `packages/engine-core/` - 5+ files\n- Test files - 30+ files\n\n## Migration Strategy Options\n\n### Option A: Automated Codemod\nCreate a jscodeshift codemod:\n```typescript\n// transforms/lexical-to-editor.ts\nexport default function transform(file, api) {\n  const j = api.jscodeshift;\n  return j(file.source)\n    .find(j.TSTypeReference)\n    .filter(path =\u003e \n      path.node.typeName.name === 'LexicalState' ||\n      path.node.typeName.name === 'LexicalNode'\n    )\n    .replaceWith(path =\u003e {\n      const newName = path.node.typeName.name === 'LexicalState' \n        ? 'EditorContent' \n        : 'EditorNode';\n      return j.tsTypeReference(j.identifier(newName));\n    })\n    .toSource();\n}\n```\n\n### Option B: Find-and-Replace with Review\n1. Use IDE find-replace for each type\n2. Review each change for context\n3. Update imports as needed\n\n### Option C: Gradual Migration\n1. Update new code to use EditorContent/EditorNode\n2. Migrate existing code package-by-package\n3. Remove deprecated aliases when complete\n\n## Deliverables for This Task\nThis task is **planning only** - create a detailed migration plan document:\n\n1. **Full file inventory** - List all files using deprecated types\n2. **Dependency order** - Which packages should be migrated first\n3. **Risk assessment** - Identify any tricky migrations\n4. **Timeline estimate** - Hours per package\n5. **Rollback plan** - How to revert if issues arise\n6. **Codemod script** (if Option A chosen)\n\n## Implementation Steps\n1. Run grep to get full file list:\n   ```bash\n   rg -l \"LexicalState|LexicalNode\" --type ts\n   ```\n2. Categorize files by package\n3. Identify any non-trivial usages (generic constraints, etc.)\n4. Write migration plan document\n5. Create codemod if automated approach chosen\n6. Estimate effort per package\n\n## Acceptance Criteria\n- [ ] Complete inventory of files to migrate\n- [ ] Migration order documented\n- [ ] Effort estimate per package\n- [ ] Codemod script (if applicable)\n- [ ] Plan reviewed and approved\n- [ ] NOT executing migration (that's separate work)\n\n## Estimated Effort\n2 hours (planning only)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T10:07:38.901527-06:00","updated_at":"2025-12-18T11:19:24.718932-06:00","closed_at":"2025-12-18T11:19:24.718932-06:00","dependencies":[{"issue_id":"scribe-q3n.22","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.901887-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.23","title":"Create README for @scribe/engine-core","description":"## Summary\nCreate README.md for `@scribe/engine-core` package.\n\n## Package Overview\n`@scribe/engine-core` provides:\n- Metadata extraction from Lexical content (tags, links, mentions)\n- Task extraction and management\n- In-memory metadata indexing\n- Note content hashing\n\n## Proposed README Structure\n\n```markdown\n# @scribe/engine-core\n\nCore note operations, metadata extraction, and task management for Scribe.\n\n## Installation\n\nThis package is internal to the Scribe monorepo.\n\n\\`\\`\\`typescript\nimport { extractMetadata, TaskIndex } from '@scribe/engine-core';\n\\`\\`\\`\n\n## Exports\n\n### Metadata Extraction\n\n| Export | Description |\n|--------|-------------|\n| `extractMetadata(content)` | Extract tags, links, and mentions from EditorContent |\n| `extractTags(nodes)` | Extract hashtags from AST nodes |\n| `extractLinks(nodes)` | Extract wiki-links from AST nodes |\n| `MetadataIndex` | In-memory index for fast metadata lookups |\n\n### Task Management\n\n| Export | Description |\n|--------|-------------|\n| `TaskIndex` | Index for tracking tasks across notes |\n| `TaskQuery` | Fluent query builder for tasks |\n| `extractTasksFromNote(note)` | Extract checklist items as Task objects |\n\n### Utilities\n\n| Export | Description |\n|--------|-------------|\n| `computeTextHash(text)` | DJB2 hash for content deduplication |\n\n## Usage Examples\n\n### Extracting Metadata\n\n\\`\\`\\`typescript\nimport { extractMetadata } from '@scribe/engine-core';\n\nconst metadata = extractMetadata(note.content);\nconsole.log(metadata.tags);  // ['project', 'meeting']\nconsole.log(metadata.links); // ['daily-2024-01-15', 'person-john']\n\\`\\`\\`\n\n### Querying Tasks\n\n\\`\\`\\`typescript\nimport { TaskQuery } from '@scribe/engine-core';\n\nconst overdueTasks = new TaskQuery(taskIndex)\n  .withStatus('pending')\n  .dueBefore(new Date())\n  .execute();\n\\`\\`\\`\n\n## Architecture\n\nSee [Decision 3: Internal Architecture](/architecture/decision_3_internal_architecture.md) for design details.\n\n## Related Packages\n\n- `@scribe/shared` - Type definitions and utilities\n- `@scribe/storage-fs` - Note persistence (uses this package)\n- `@scribe/engine-search` - Full-text search (parallel to this)\n```\n\n## Implementation Steps\n1. Create `packages/engine-core/README.md`\n2. Document all public exports from `index.ts`\n3. Add usage examples for key functions\n4. Link to architecture documentation\n5. Review for accuracy\n\n## Acceptance Criteria\n- [ ] README created at `packages/engine-core/README.md`\n- [ ] All public exports documented\n- [ ] Usage examples for common operations\n- [ ] Links to related packages\n- [ ] Accurate and up-to-date\n\n## Estimated Effort\n30-45 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:38.973811-06:00","updated_at":"2025-12-18T11:19:25.433753-06:00","closed_at":"2025-12-18T11:19:25.433753-06:00","dependencies":[{"issue_id":"scribe-q3n.23","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:38.97422-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.24","title":"Create README for @scribe/shared","description":"## Summary\nCreate README.md for `@scribe/shared` package.\n\n## Package Overview\n`@scribe/shared` is the foundational package providing:\n- Type definitions (Note, EditorContent, Task, etc.)\n- Error classes (ScribeError hierarchy)\n- IPC contract definitions\n- AST traversal utilities\n- Content extraction (Markdown export)\n\n## Proposed README Structure\n\n```markdown\n# @scribe/shared\n\nShared types, utilities, and contracts for the Scribe application.\n\n## Installation\n\nThis package is internal to the Scribe monorepo and is a dependency of all other packages.\n\n\\`\\`\\`typescript\nimport { Note, EditorContent, ScribeError } from '@scribe/shared';\n\\`\\`\\`\n\n## Exports\n\n### Types\n\n| Type | Description |\n|------|-------------|\n| `Note` | Base note type (discriminated union) |\n| `DailyNote` | Daily journal note type |\n| `MeetingNote` | Meeting note with attendees |\n| `EditorContent` | Lexical editor content structure |\n| `EditorNode` | Individual AST node |\n| `Task` | Task/checklist item |\n| `NoteId`, `VaultPath` | Branded types for type safety |\n\n### Error Classes\n\n| Class | Code | Description |\n|-------|------|-------------|\n| `ScribeError` | - | Base error class |\n| `NotFoundError` | NOT_FOUND | Resource not found |\n| `ValidationError` | VALIDATION_ERROR | Invalid input |\n| `StorageError` | STORAGE_ERROR | File system issues |\n\n### Utilities\n\n| Export | Description |\n|--------|-------------|\n| `extractMarkdown(content)` | Convert EditorContent to Markdown |\n| `traverseNodes(root, cb)` | Depth-first AST traversal |\n| `extractTextFromNodes(nodes)` | Extract plain text from AST |\n\n### IPC Contract\n\n| Export | Description |\n|--------|-------------|\n| `IpcContract` | Type-safe IPC channel definitions |\n| `IpcChannels` | Channel name constants |\n\n## Usage Examples\n\n### Working with Notes\n\n\\`\\`\\`typescript\nimport { Note, isDaily, isMeeting } from '@scribe/shared';\n\nfunction processNote(note: Note) {\n  if (isDaily(note)) {\n    console.log('Daily note for:', note.daily.date);\n  } else if (isMeeting(note)) {\n    console.log('Meeting with:', note.meeting.attendees);\n  }\n}\n\\`\\`\\`\n\n### Error Handling\n\n\\`\\`\\`typescript\nimport { NotFoundError, isScribeError } from '@scribe/shared';\n\ntry {\n  await loadNote(id);\n} catch (error) {\n  if (isScribeError(error) \u0026\u0026 error.code === 'NOT_FOUND') {\n    console.log('Note not found:', error.getUserMessage());\n  }\n}\n\\`\\`\\`\n\n### Markdown Export\n\n\\`\\`\\`typescript\nimport { extractMarkdown } from '@scribe/shared';\n\nconst markdown = extractMarkdown(note.content, {\n  includeFrontmatter: true,\n  frontmatterFields: { title: note.title, tags: note.tags }\n});\n\\`\\`\\`\n\n## Architecture\n\nThis package has no internal `@scribe/*` dependencies and sits at the bottom of the dependency tree.\n\n## Related Packages\n\nAll other `@scribe/*` packages depend on this one.\n```\n\n## Implementation Steps\n1. Create `packages/shared/README.md`\n2. Document key type exports\n3. Document error class hierarchy\n4. Document utility functions\n5. Add practical usage examples\n6. Review for accuracy\n\n## Acceptance Criteria\n- [ ] README created at `packages/shared/README.md`\n- [ ] All major export categories documented\n- [ ] Usage examples for types, errors, utilities\n- [ ] Explains position in dependency tree\n- [ ] Accurate and comprehensive\n\n## Estimated Effort\n45 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:39.045657-06:00","updated_at":"2025-12-18T11:19:26.006743-06:00","closed_at":"2025-12-18T11:19:26.006743-06:00","dependencies":[{"issue_id":"scribe-q3n.24","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.045995-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.25","title":"Create README for @scribe/storage-fs","description":"## Summary\nCreate README.md for `@scribe/storage-fs` package.\n\n## Package Overview\n`@scribe/storage-fs` provides:\n- File-based note storage with atomic writes\n- Vault management and initialization\n- Note validation and migration\n- Quarantine for corrupt notes\n\n## Proposed README Structure\n\n```markdown\n# @scribe/storage-fs\n\nFile system storage layer for Scribe notes with atomic writes and data integrity.\n\n## Installation\n\nThis package is internal to the Scribe monorepo.\n\n\\`\\`\\`typescript\nimport { Storage, initializeVault } from '@scribe/storage-fs';\n\\`\\`\\`\n\n## Exports\n\n### Core Classes\n\n| Export | Description |\n|--------|-------------|\n| `Storage` | Main note storage class with CRUD operations |\n| `AtomicFileWriter` | Ensures atomic file writes (write-rename pattern) |\n| `QuarantineManager` | Manages corrupt/invalid notes |\n| `NoteMigrator` | Handles note format upgrades |\n| `NoteValidator` | Validates note structure before save |\n\n### Vault Operations\n\n| Export | Description |\n|--------|-------------|\n| `initializeVault(path)` | Create new vault directory structure |\n| `loadVault(path)` | Load existing vault configuration |\n\n## Architecture\n\n### Atomic Writes\nAll file operations use a write-to-temp-then-rename pattern to prevent corruption:\n\n\\`\\`\\`typescript\n// Internally:\n// 1. Write to .note-id.json.tmp\n// 2. Rename to note-id.json\n// 3. Delete temp on failure\n\\`\\`\\`\n\n### Concurrency\nUses per-note mutex locks to prevent concurrent modifications to the same note.\n\n### Data Flow\n\\`\\`\\`\nStorage.save(note)\n  → NoteValidator.validate(note)\n  → AtomicFileWriter.write(path, content)\n  → [Update indexes]\n\\`\\`\\`\n\n## Usage Examples\n\n### Loading and Saving Notes\n\n\\`\\`\\`typescript\nimport { Storage } from '@scribe/storage-fs';\n\nconst storage = await Storage.open('/path/to/vault');\n\n// Load all notes\nconst notes = await storage.load();\n\n// Save a note\nawait storage.save(note);\n\n// Delete a note\nawait storage.delete(note.id);\n\\`\\`\\`\n\n### Initializing a Vault\n\n\\`\\`\\`typescript\nimport { initializeVault } from '@scribe/storage-fs';\n\nawait initializeVault('/path/to/new/vault');\n// Creates:\n// - /path/to/new/vault/notes/\n// - /path/to/new/vault/.scribe/config.json\n\\`\\`\\`\n\n## Related Packages\n\n- `@scribe/shared` - Type definitions\n- `@scribe/engine-core` - Uses `extractMetadata` for indexing\n```\n\n## Implementation Steps\n1. Create `packages/storage-fs/README.md`\n2. Document Storage class and methods\n3. Explain atomic write pattern\n4. Document vault structure\n5. Add usage examples\n\n## Acceptance Criteria\n- [ ] README created at `packages/storage-fs/README.md`\n- [ ] All public exports documented\n- [ ] Atomic write pattern explained\n- [ ] Vault structure documented\n- [ ] Usage examples included\n\n## Estimated Effort\n30-45 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:39.118667-06:00","updated_at":"2025-12-18T11:19:26.637565-06:00","closed_at":"2025-12-18T11:19:26.637565-06:00","dependencies":[{"issue_id":"scribe-q3n.25","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.119048-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.26","title":"Create README for @scribe/engine-search","description":"## Summary\nCreate README.md for `@scribe/engine-search` package.\n\n## Package Overview\n`@scribe/engine-search` provides:\n- Full-text search using FlexSearch\n- Text extraction from Lexical content\n- Search result snippets with context\n\n## Proposed README Structure\n\n```markdown\n# @scribe/engine-search\n\nFull-text search engine for Scribe notes using FlexSearch.\n\n## Installation\n\nThis package is internal to the Scribe monorepo.\n\n\\`\\`\\`typescript\nimport { SearchEngine } from '@scribe/engine-search';\n\\`\\`\\`\n\n## Exports\n\n| Export | Description |\n|--------|-------------|\n| `SearchEngine` | Main search engine class |\n| `extractTextForSearch` | Extract searchable text from content |\n| `generateSnippet` | Create search result snippets |\n\n## Features\n\n- **Fast indexing**: FlexSearch with tokenization and stemming\n- **Relevance scoring**: Weighted search across title, content, tags\n- **Context snippets**: Shows matching text with surrounding context\n- **Incremental updates**: Add/remove notes without full reindex\n\n## Architecture\n\n### Indexing Strategy\nUses FlexSearch's document index with three fields:\n- `title` (weight: 3x) - Note title, highest relevance\n- `content` (weight: 1x) - Full note text\n- `tags` (weight: 2x) - Note tags\n\n### Search Flow\n\\`\\`\\`\nquery → tokenize → search indexes → merge results → rank → generate snippets\n\\`\\`\\`\n\n## Usage Examples\n\n### Basic Search\n\n\\`\\`\\`typescript\nimport { SearchEngine } from '@scribe/engine-search';\n\nconst searchEngine = new SearchEngine();\n\n// Index notes\nfor (const note of notes) {\n  searchEngine.addNote(note);\n}\n\n// Search\nconst results = searchEngine.search('meeting notes', { limit: 10 });\nfor (const result of results) {\n  console.log(result.noteId, result.score, result.snippet);\n}\n\\`\\`\\`\n\n### Updating Index\n\n\\`\\`\\`typescript\n// After note update\nsearchEngine.updateNote(updatedNote);\n\n// After note deletion\nsearchEngine.removeNote(noteId);\n\\`\\`\\`\n\n## Configuration\n\n| Constant | Default | Description |\n|----------|---------|-------------|\n| `MAX_INDEXED_CONTENT_LENGTH` | 1000 | Max chars indexed per note |\n| `SNIPPET_CONTEXT_CHARS` | 50 | Chars around match in snippet |\n| `SEARCH_WEIGHT_TITLE` | 3 | Title match weight |\n| `SEARCH_WEIGHT_TAGS` | 2 | Tag match weight |\n\n## Related Packages\n\n- `@scribe/shared` - Type definitions\n- `@scribe/engine-core` - Parallel metadata engine\n```\n\n## Implementation Steps\n1. Create `packages/engine-search/README.md`\n2. Document SearchEngine class\n3. Explain indexing strategy and weights\n4. Add usage examples\n5. Document configuration constants\n\n## Acceptance Criteria\n- [ ] README created at `packages/engine-search/README.md`\n- [ ] All public exports documented\n- [ ] Indexing strategy explained\n- [ ] Search weights documented\n- [ ] Usage examples included\n\n## Estimated Effort\n30 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:39.190999-06:00","updated_at":"2025-12-18T11:19:27.212811-06:00","closed_at":"2025-12-18T11:19:27.212811-06:00","dependencies":[{"issue_id":"scribe-q3n.26","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.191337-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.27","title":"Create README for @scribe/engine-graph","description":"## Summary\nCreate README.md for `@scribe/engine-graph` package.\n\n## Package Overview\n`@scribe/engine-graph` provides:\n- Note relationship graph (backlinks, forward links)\n- Graph queries (neighbors, connected notes)\n- Tag-based grouping\n\n## Proposed README Structure\n\n```markdown\n# @scribe/engine-graph\n\nNote relationship graph for Scribe, enabling backlinks and connected notes.\n\n## Installation\n\nThis package is internal to the Scribe monorepo.\n\n\\`\\`\\`typescript\nimport { GraphEngine } from '@scribe/engine-graph';\n\\`\\`\\`\n\n## Exports\n\n| Export | Description |\n|--------|-------------|\n| `GraphEngine` | Main graph engine class |\n| `GraphNode` | Node in the graph (represents a note) |\n| `GraphEdge` | Edge between nodes (represents a link) |\n\n## Features\n\n- **Backlinks**: Find all notes that link to a given note\n- **Forward links**: Find all notes a given note links to\n- **Neighbors**: Get connected notes within N hops\n- **Tag grouping**: Find notes sharing tags\n\n## Architecture\n\n### Data Structure\nUses an adjacency list representation:\n\\`\\`\\`typescript\n{\n  nodes: Map\u003cNoteId, GraphNode\u003e,\n  edges: {\n    outgoing: Map\u003cNoteId, Set\u003cNoteId\u003e\u003e,  // noteId → linked notes\n    incoming: Map\u003cNoteId, Set\u003cNoteId\u003e\u003e,  // noteId → notes that link here\n  }\n}\n\\`\\`\\`\n\n### Update Strategy\nGraph updates are incremental:\n- `addNote()`: Extract links, add edges\n- `updateNote()`: Remove old edges, add new\n- `removeNote()`: Remove node and all edges\n\n## Usage Examples\n\n### Finding Backlinks\n\n\\`\\`\\`typescript\nimport { GraphEngine } from '@scribe/engine-graph';\n\nconst graph = new GraphEngine();\n\n// Build graph from notes\nfor (const note of notes) {\n  graph.addNote(note);\n}\n\n// Find notes that link to this note\nconst backlinks = graph.backlinks('note-123');\n// Returns: ['note-456', 'note-789']\n\\`\\`\\`\n\n### Finding Connected Notes\n\n\\`\\`\\`typescript\n// Get directly connected notes\nconst neighbors = graph.neighbors('note-123');\n\n// Get notes within 2 hops\nconst extended = graph.neighbors('note-123', { depth: 2 });\n\\`\\`\\`\n\n### Finding Notes by Tag\n\n\\`\\`\\`typescript\n// Find all notes with a specific tag\nconst projectNotes = graph.notesWithTag('project');\n\\`\\`\\`\n\n## Related Packages\n\n- `@scribe/shared` - Type definitions (GraphNode, GraphEdge)\n- `@scribe/engine-core` - Metadata extraction for link detection\n```\n\n## Implementation Steps\n1. Create `packages/engine-graph/README.md`\n2. Document GraphEngine class and methods\n3. Explain adjacency list structure\n4. Add usage examples for common queries\n5. Review for accuracy\n\n## Acceptance Criteria\n- [ ] README created at `packages/engine-graph/README.md`\n- [ ] GraphEngine methods documented\n- [ ] Data structure explained\n- [ ] Usage examples for backlinks, neighbors\n- [ ] Related packages listed\n\n## Estimated Effort\n30 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:39.264487-06:00","updated_at":"2025-12-18T11:19:27.853398-06:00","closed_at":"2025-12-18T11:19:27.853398-06:00","dependencies":[{"issue_id":"scribe-q3n.27","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.264831-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.28","title":"Create README for @scribe/design-system","description":"## Summary\nCreate README.md for `@scribe/design-system` package.\n\n## Package Overview\n`@scribe/design-system` provides:\n- UI primitive components (Button, Text, Surface, etc.)\n- Design tokens (colors, spacing, typography)\n- Theme system (light/dark)\n- Icon library\n\n## Proposed README Structure\n\n```markdown\n# @scribe/design-system\n\nDesign system for the Scribe application with themed primitives and tokens.\n\n## Installation\n\nThis package is internal to the Scribe monorepo.\n\n\\`\\`\\`typescript\nimport { Button, Text, ThemeProvider } from '@scribe/design-system';\n\\`\\`\\`\n\n## Exports\n\n### Primitives\n\n| Component | Description |\n|-----------|-------------|\n| `Button` | Primary action button with variants |\n| `Text` | Typography component with size/weight props |\n| `Surface` | Container with elevation and padding |\n| `Icon` | Icon wrapper with size and color |\n| `Overlay` | Modal/popover backdrop |\n| `FloatingMenu` | Dropdown menu component |\n\n### Theme\n\n| Export | Description |\n|--------|-------------|\n| `ThemeProvider` | Context provider for theming |\n| `useTheme` | Hook to access current theme |\n| `lightTheme` | Light mode token values |\n| `darkTheme` | Dark mode token values |\n\n### Tokens\n\n| Category | Examples |\n|----------|----------|\n| Colors | `primary`, `background`, `text`, `border` |\n| Spacing | `xs`, `sm`, `md`, `lg`, `xl` |\n| Typography | `fontSizes`, `fontWeights`, `lineHeights` |\n| Radii | `sm`, `md`, `lg`, `full` |\n\n### Icons\n\nOver 30 icons available:\n\\`\\`\\`typescript\nimport { \n  PlusIcon, \n  SearchIcon, \n  TrashIcon,\n  // ... see icons/index.ts for full list\n} from '@scribe/design-system';\n\\`\\`\\`\n\n## Usage Examples\n\n### Setting Up Theme\n\n\\`\\`\\`tsx\nimport { ThemeProvider } from '@scribe/design-system';\n\nfunction App() {\n  return (\n    \u003cThemeProvider defaultTheme=\"system\"\u003e\n      \u003cYourApp /\u003e\n    \u003c/ThemeProvider\u003e\n  );\n}\n\\`\\`\\`\n\n### Using Primitives\n\n\\`\\`\\`tsx\nimport { Button, Text, Surface } from '@scribe/design-system';\n\nfunction Card() {\n  return (\n    \u003cSurface elevation={1} padding=\"md\"\u003e\n      \u003cText variant=\"heading\" size=\"lg\"\u003eTitle\u003c/Text\u003e\n      \u003cText variant=\"body\"\u003eDescription\u003c/Text\u003e\n      \u003cButton variant=\"primary\"\u003eAction\u003c/Button\u003e\n    \u003c/Surface\u003e\n  );\n}\n\\`\\`\\`\n\n### Using Icons\n\n\\`\\`\\`tsx\nimport { SearchIcon, Button } from '@scribe/design-system';\n\n\u003cButton\u003e\n  \u003cSearchIcon size=\"sm\" /\u003e\n  Search\n\u003c/Button\u003e\n\\`\\`\\`\n\n## Design Guidelines\n\nSee `/docs/design-system/` for detailed usage guidelines:\n- `scribe_design_tokens.md` - Token values and usage\n- `scribe_primitives_spec.md` - Component specifications\n- `scribe_ds_usage_guidelines.md` - Best practices\n\n## Related Packages\n\n- `apps/desktop/renderer` - Main consumer of design system\n```\n\n## Implementation Steps\n1. Create `packages/design-system/README.md`\n2. Document all primitive components\n3. Document theme system\n4. List available tokens\n5. List available icons\n6. Add usage examples\n7. Link to docs/design-system/\n\n## Acceptance Criteria\n- [ ] README created at `packages/design-system/README.md`\n- [ ] All primitives documented\n- [ ] Theme setup explained\n- [ ] Token categories listed\n- [ ] Icons listed or link to full list\n- [ ] Usage examples included\n\n## Estimated Effort\n45 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:39.337918-06:00","updated_at":"2025-12-18T11:19:28.434983-06:00","closed_at":"2025-12-18T11:19:28.434983-06:00","dependencies":[{"issue_id":"scribe-q3n.28","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.338282-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.29","title":"Fix outdated architecture documentation","description":"Fixed outdated architecture documentation:\n1. Updated package paths in architecture/README.md (/packages/graph/ → /packages/engine-graph/, /packages/search/ → /packages/engine-search/)\n2. Updated Note interface in decision_3_internal_architecture.md to match actual types (NoteId branded type, title field, tags field, EditorContent instead of LexicalState, NoteMetadata with mentions)\n3. Deleted scribe_architecture_spec.md (was marked as draft, incomplete, and redundant with Decisions 1-8)\n4. Removed references to scribe_architecture_spec.md from README.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:39.411587-06:00","updated_at":"2025-12-18T14:48:01.154256-06:00","closed_at":"2025-12-18T14:48:01.154259-06:00","dependencies":[{"issue_id":"scribe-q3n.29","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.411919-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.3","title":"Refactor content-extractor.ts escape logic","description":"## Summary\nRefactor the complex `escapeMarkdownText()` function (155 lines, 15+ branches) in content-extractor.ts.\n\n## Problem\n- Function spans lines 247-402\n- 15+ branching conditions with deep nesting\n- Handles multiple escape contexts: backslash, heading markers, list markers, emphasis, links, etc.\n- Lines 340-390: Emphasis escaping logic alone is 50+ lines\n- Hard to understand, test, and maintain\n\n## Proposed Refactoring\nExtract escape strategies into separate pure functions:\n\n```typescript\n// Separate escape handlers\nfunction escapeBackslash(char: string, nextChar: string): string | null\nfunction escapeHeadingMarker(char: string, isLineStart: boolean, index: number, text: string): string | null\nfunction escapeListMarker(char: string, nextChar: string, isLineStart: boolean): string | null\nfunction escapeEmphasis(char: string, prevChar: string, nextChar: string, context: EscapeContext): string | null\nfunction escapeBlockquote(char: string, isLineStart: boolean): string | null\nfunction escapeLinkBrackets(char: string): string | null\nfunction escapeCodeBackticks(char: string): string | null\nfunction escapeHorizontalRule(char: string, text: string, index: number): string | null\n\n// Main function becomes orchestrator\nfunction escapeMarkdownText(text: string, context: EscapeContext): string {\n  const handlers = [\n    escapeBackslash,\n    escapeHeadingMarker,\n    escapeListMarker,\n    // ... etc\n  ];\n  // Apply handlers in order\n}\n```\n\n## Alternative: State Machine Approach\nConsider a state machine for line-start detection and context tracking:\n```typescript\ninterface EscapeState {\n  isLineStart: boolean;\n  inEmphasis: boolean;\n  emphasisChar: string | null;\n  position: number;\n}\n```\n\n## Implementation Steps\n1. Add comprehensive tests for `escapeMarkdownText()` first (if not exists)\n2. Extract each escape type to a separate function\n3. Create `EscapeContext` interface for shared state\n4. Refactor main function to use extracted handlers\n5. Ensure all existing tests pass\n6. Add tests for edge cases discovered during refactoring\n\n## Acceptance Criteria\n- [ ] Main function is \u003c50 lines\n- [ ] Each escape handler is \u003c30 lines\n- [ ] No nesting deeper than 2 levels\n- [ ] All existing markdown export tests pass\n- [ ] Edge cases are documented in tests\n\n## Estimated Effort\n2-3 hours","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:37.500103-06:00","updated_at":"2025-12-18T14:41:53.976134-06:00","closed_at":"2025-12-18T14:41:53.976134-06:00","dependencies":[{"issue_id":"scribe-q3n.3","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.500472-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.30","title":"Add JSDoc to design-system primitives","description":"## Summary\nAdd JSDoc documentation to all design-system primitive components.\n\n## Problem\nThe design-system primitives lack proper documentation:\n- No JSDoc on component functions\n- No @param tags for props\n- No @example tags for usage\n- No documentation of design tokens used\n\n## Files to Document\n```\npackages/design-system/src/primitives/\n├── Button/Button.tsx\n├── Text/Text.tsx\n├── Surface/Surface.tsx\n├── Icon/Icon.tsx\n├── FloatingMenu/FloatingMenu.tsx\n└── Overlay/Overlay.tsx\n```\n\n## Documentation Template\n\n```typescript\n/**\n * Button component for triggering actions.\n * \n * Uses design tokens: `colors.primary`, `spacing.md`, `radii.sm`\n * \n * @param variant - Visual style: 'primary' | 'secondary' | 'ghost'\n * @param size - Button size: 'sm' | 'md' | 'lg'\n * @param disabled - Whether button is disabled\n * @param loading - Show loading spinner\n * @param children - Button content\n * \n * @example\n * // Primary button\n * \u003cButton variant=\"primary\" onClick={handleClick}\u003e\n *   Save\n * \u003c/Button\u003e\n * \n * @example\n * // Button with icon\n * \u003cButton variant=\"secondary\" size=\"sm\"\u003e\n *   \u003cPlusIcon /\u003e Add item\n * \u003c/Button\u003e\n */\nexport function Button({ variant = 'primary', size = 'md', ...props }: ButtonProps) {\n  // ...\n}\n```\n\n## Documentation Requirements per Component\n\n### Button.tsx\n- Document all variants (primary, secondary, ghost, danger)\n- Document all sizes\n- Document loading and disabled states\n- Example with icon\n\n### Text.tsx\n- Document variant (body, heading, caption, code)\n- Document size (xs, sm, md, lg, xl)\n- Document weight (normal, medium, bold)\n- Document color prop\n- Document `as` prop for semantic HTML\n\n### Surface.tsx\n- Document elevation levels (0, 1, 2, 3)\n- Document padding variants\n- Document border radius\n- Document background color theming\n\n### Icon.tsx\n- Document size prop\n- Document color prop\n- Document accessibility (aria-label, aria-hidden)\n- List commonly used icons\n\n### FloatingMenu.tsx\n- Document trigger mechanism\n- Document positioning (placement prop)\n- Document keyboard navigation\n- Document onSelect callback\n\n### Overlay.tsx\n- Document backdrop behavior\n- Document close on click outside\n- Document close on Escape\n- Document z-index layering\n\n## Implementation Steps\n1. Open each primitive file\n2. Add JSDoc to main component function\n3. Document all props with @param\n4. Add 2-3 @example tags\n5. Note which design tokens are used\n6. Run `bun run typecheck` to verify syntax\n7. Review in IDE for tooltip rendering\n\n## Acceptance Criteria\n- [ ] All 6 primitives have JSDoc\n- [ ] All props documented with @param\n- [ ] At least 2 examples per component\n- [ ] Design tokens mentioned\n- [ ] Documentation renders in IDE tooltips\n- [ ] TypeScript compiles successfully\n\n## Estimated Effort\n2-3 hours","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:39.485513-06:00","updated_at":"2025-12-18T15:06:22.983732-06:00","closed_at":"2025-12-18T15:06:22.983732-06:00","dependencies":[{"issue_id":"scribe-q3n.30","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.485886-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.31","title":"Add missing error codes to errors.ts","description":"## Summary\nAdd missing error codes to the ScribeError hierarchy.\n\n## Problem\nThe current `ErrorCode` enum in `errors.ts` is comprehensive but missing some codes for specific operations:\n- No `TASK_NOT_FOUND` for task operations\n- No `SYNC_CONFLICT` for future multi-device scenarios\n- No `MIGRATION_FAILED` for format upgrade failures\n\n## Current Error Codes\n```typescript\n// packages/shared/src/errors.ts\nexport enum ErrorCode {\n  NOT_FOUND = 'NOT_FOUND',\n  VALIDATION_ERROR = 'VALIDATION_ERROR',\n  STORAGE_ERROR = 'STORAGE_ERROR',\n  PARSE_ERROR = 'PARSE_ERROR',\n  // ... others\n}\n```\n\n## Proposed Additions\n```typescript\nexport enum ErrorCode {\n  // Existing codes...\n  \n  // New task-related codes\n  TASK_NOT_FOUND = 'TASK_NOT_FOUND',\n  TASK_INVALID = 'TASK_INVALID',\n  \n  // Future sync-related codes\n  SYNC_CONFLICT = 'SYNC_CONFLICT',\n  SYNC_FAILED = 'SYNC_FAILED',\n  \n  // Migration codes\n  MIGRATION_FAILED = 'MIGRATION_FAILED',\n  MIGRATION_REQUIRED = 'MIGRATION_REQUIRED',\n  \n  // CLI-specific codes\n  CLI_INVALID_ARGUMENT = 'CLI_INVALID_ARGUMENT',\n  CLI_MISSING_VAULT = 'CLI_MISSING_VAULT',\n}\n```\n\n## New Error Classes\n```typescript\n/**\n * Error thrown when a task is not found.\n */\nexport class TaskNotFoundError extends ScribeError {\n  constructor(taskId: string) {\n    super(\n      ErrorCode.TASK_NOT_FOUND,\n      `Task not found: ${taskId}`,\n      `The task you're looking for doesn't exist.`\n    );\n  }\n}\n\n/**\n * Error thrown when sync encounters a conflict.\n */\nexport class SyncConflictError extends ScribeError {\n  constructor(noteId: string, details?: string) {\n    super(\n      ErrorCode.SYNC_CONFLICT,\n      `Sync conflict for note ${noteId}: ${details}`,\n      `This note was modified elsewhere. Please resolve the conflict.`\n    );\n  }\n}\n\n/**\n * Error thrown when note migration fails.\n */\nexport class MigrationError extends ScribeError {\n  constructor(noteId: string, fromVersion: number, toVersion: number, reason: string) {\n    super(\n      ErrorCode.MIGRATION_FAILED,\n      `Failed to migrate note ${noteId} from v${fromVersion} to v${toVersion}: ${reason}`,\n      `Unable to upgrade this note to the new format.`\n    );\n  }\n}\n```\n\n## Implementation Steps\n1. Open `packages/shared/src/errors.ts`\n2. Add new error codes to `ErrorCode` enum\n3. Create new error classes extending `ScribeError`\n4. Export new classes from `packages/shared/src/index.ts`\n5. Add tests for new error classes\n6. Update existing code to use new specific errors where appropriate\n\n## Usage Locations\nAfter implementation, update these to use specific errors:\n- `packages/engine-core/src/task-index.ts` - use `TaskNotFoundError`\n- `packages/storage-fs/src/note-migrator.ts` - use `MigrationError`\n\n## Acceptance Criteria\n- [ ] New error codes added to enum\n- [ ] New error classes created with proper messages\n- [ ] User-friendly messages for each error\n- [ ] Exported from @scribe/shared\n- [ ] Tests for new error classes\n- [ ] At least one usage location updated\n\n## Estimated Effort\n1 hour","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:39.557697-06:00","updated_at":"2025-12-18T14:55:50.525836-06:00","closed_at":"2025-12-18T14:55:50.525836-06:00","dependencies":[{"issue_id":"scribe-q3n.31","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.558031-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.32","title":"Document /node sub-export pattern","description":"## Summary\nDocument the `/node` sub-export pattern used in `@scribe/engine-core`.\n\n## Problem\nThe `@scribe/engine-core` package has a dual-export strategy that isn't documented:\n- Main export (`@scribe/engine-core`) - Browser-safe, excludes Node.js-specific code\n- Node sub-export (`@scribe/engine-core/node`) - Includes Node.js-specific exports\n\nApps use:\n```typescript\n// Browser-safe imports\nimport { extractMetadata } from '@scribe/engine-core';\n\n// Node.js-specific imports  \nimport { TaskIndex, TaskPersistence } from '@scribe/engine-core/node';\n```\n\nThis pattern prevents bundler issues when engine-core is used in renderer processes.\n\n## Files Affected\n```\npackages/engine-core/package.json - defines exports\napps/desktop/electron/main/src/main.ts - uses /node\napps/cli/src/context.ts - uses /node\napps/desktop/electron/main/src/handlers/types.ts - uses /node\n```\n\n## Documentation to Add\n\n### CONTRIBUTING.md\nAdd a section explaining the pattern:\n\n```markdown\n## Package Export Patterns\n\n### Browser vs Node.js Exports\n\nSome packages have dual exports to support both browser and Node.js environments:\n\n#### @scribe/engine-core\n\n| Export Path | Environment | Includes |\n|------------|-------------|----------|\n| `@scribe/engine-core` | Browser + Node | Metadata extraction, pure functions |\n| `@scribe/engine-core/node` | Node.js only | TaskIndex, TaskPersistence (uses fs) |\n\n**Why?** The renderer process (Electron/browser) cannot import Node.js modules like `fs`. The `/node` sub-export isolates Node-specific code.\n\n**Usage:**\n\\`\\`\\`typescript\n// In renderer (browser context)\nimport { extractMetadata } from '@scribe/engine-core';\n\n// In main process or CLI (Node.js context)\nimport { TaskIndex } from '@scribe/engine-core/node';\n\\`\\`\\`\n\n**Adding new exports:**\n- Browser-safe code → add to `src/index.ts`\n- Node.js-specific code → add to `src/node.ts`\n```\n\n### packages/engine-core/package.json\nAdd a comment explaining the exports field:\n\n```json\n{\n  \"exports\": {\n    \".\": \"./src/index.ts\",\n    \"./node\": \"./src/node.ts\"\n  },\n  \"// exports-note\": \"Main export is browser-safe. /node sub-export includes Node.js-specific code (fs operations).\"\n}\n```\n\nNote: JSON doesn't support comments, so this would be in a `package.json.md` or the package README.\n\n### packages/engine-core/README.md\nAdd section documenting the exports:\n\n```markdown\n## Exports\n\n### Browser-Safe (`@scribe/engine-core`)\n- `extractMetadata`\n- `extractTags`\n- `extractLinks`\n- `MetadataIndex`\n- `computeTextHash`\n\n### Node.js Only (`@scribe/engine-core/node`)\n- `TaskIndex` - Persists to file system\n- `TaskPersistence` - File-based task storage\n- `TaskQuery` - Query builder (re-exported)\n```\n\n## Implementation Steps\n1. Add section to `CONTRIBUTING.md` under package patterns\n2. Update `packages/engine-core/README.md` (if exists) or create it\n3. Add inline comment in `packages/engine-core/src/node.ts` explaining its purpose\n4. Review if other packages need similar documentation\n\n## Acceptance Criteria\n- [ ] CONTRIBUTING.md updated with export pattern explanation\n- [ ] engine-core README documents both export paths\n- [ ] Clear examples of when to use each export\n- [ ] Explanation of why this pattern exists\n\n## Estimated Effort\n30-45 minutes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-18T10:07:39.6298-06:00","updated_at":"2025-12-18T11:19:34.065185-06:00","closed_at":"2025-12-18T11:19:34.065185-06:00","dependencies":[{"issue_id":"scribe-q3n.32","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:39.630169-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.4","title":"Refactor TableKeyboardPlugin into focused hooks","description":"## Summary\nRefactor TableKeyboardPlugin's monolithic useEffect (247 lines) into focused, reusable hooks.\n\n## Problem\n- Single `useEffect` block spans lines 265-512\n- Registers 6 different command handlers (Tab, Enter, Escape, Cmd+A, Backspace, Delete)\n- Backspace handler (lines 417-458) duplicates logic with Delete handler (lines 461-502)\n- Hard to test individual behaviors\n- All keyboard logic coupled together\n\n## Proposed Structure\n```typescript\n// Separate hooks for each keyboard behavior\nfunction useTableTabNavigation(editor: LexicalEditor)      // Tab/Shift+Tab cell navigation\nfunction useTableEnterBehavior(editor: LexicalEditor)      // Enter key handling\nfunction useTableEscape(editor: LexicalEditor)             // Escape to deselect\nfunction useTableSelectAll(editor: LexicalEditor)          // Cmd+A behavior\nfunction useTableDeletion(editor: LexicalEditor)           // Backspace + Delete (shared logic)\n\n// Main plugin composes hooks\nexport function TableKeyboardPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  \n  useTableTabNavigation(editor);\n  useTableEnterBehavior(editor);\n  useTableEscape(editor);\n  useTableSelectAll(editor);\n  useTableDeletion(editor);\n  \n  return null;\n}\n```\n\n## Implementation Steps\n1. Create `apps/desktop/renderer/src/components/Editor/plugins/table/` directory\n2. Extract shared deletion logic into `useTableDeletion.ts`\n   - Consolidate Backspace (lines 417-458) and Delete (lines 461-502) handlers\n   - They differ only in direction; parameterize this\n3. Extract `useTableTabNavigation.ts` for Tab handling\n4. Extract `useTableEnterBehavior.ts` for Enter key\n5. Extract `useTableEscape.ts` for Escape key\n6. Extract `useTableSelectAll.ts` for Cmd+A\n7. Create lean `TableKeyboardPlugin.tsx` that composes all hooks\n8. Add unit tests for each hook in isolation\n\n## Files to Create\n```\napps/desktop/renderer/src/components/Editor/plugins/table/\n├── index.ts                    # Re-exports TableKeyboardPlugin\n├── TableKeyboardPlugin.tsx     # Lean composition of hooks\n├── useTableTabNavigation.ts\n├── useTableEnterBehavior.ts\n├── useTableEscape.ts\n├── useTableSelectAll.ts\n├── useTableDeletion.ts\n└── __tests__/\n    ├── useTableTabNavigation.test.ts\n    └── useTableDeletion.test.ts\n```\n\n## Acceptance Criteria\n- [ ] Each hook is \u003c80 lines\n- [ ] No duplicated deletion logic\n- [ ] All existing table keyboard tests pass\n- [ ] Hooks can be tested in isolation\n- [ ] Main plugin is \u003c30 lines\n\n## Estimated Effort\n2-3 hours","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-18T10:07:37.574102-06:00","updated_at":"2025-12-18T15:03:32.618688-06:00","dependencies":[{"issue_id":"scribe-q3n.4","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.57446-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.5","title":"Add unit tests for CLI commands","description":"## Summary\nAdd comprehensive unit tests for all 9 CLI command modules (currently 0% coverage).\n\n## Problem\nThe CLI commands represent core user functionality but have zero test coverage:\n- `notes.ts` - CRUD operations, fuzzy matching (~847 lines)\n- `daily.ts` - Daily note management\n- `search.ts` - Search functionality\n- `graph.ts` - Graph queries (backlinks, neighbors)\n- `people.ts` - People/contact management\n- `tags.ts` - Tag operations\n- `tasks.ts` - Task management\n- `vault.ts` - Vault operations\n- `completion.ts` - Shell completion\n\n## Testing Strategy\n\n### Unit Test Structure\n```\napps/cli/tests/unit/commands/\n├── notes.test.ts\n├── daily.test.ts\n├── search.test.ts\n├── graph.test.ts\n├── people.test.ts\n├── tags.test.ts\n├── tasks.test.ts\n├── vault.test.ts\n└── completion.test.ts\n```\n\n### Mock Strategy\n- Mock `LazyContext` to provide stubbed engines\n- Mock file system operations via `@scribe/storage-fs` mocks\n- Use vitest's `vi.mock()` for engine dependencies\n\n### Test Cases per Command\n\n**notes.ts:**\n- `list`: pagination, filtering by type, JSON output\n- `show`: by ID, by fuzzy match, not found handling\n- `create`: with stdin, with file, with inline content\n- `update`: content update, tag modification\n- `delete`: confirmation flow, force flag\n- `find`: fuzzy matching accuracy, multiple results\n- `export`: markdown format, file writing\n\n**daily.ts:**\n- `today`: creates if not exists, returns existing\n- `yesterday/tomorrow`: date calculation\n- `list`: date range filtering\n\n**search.ts:**\n- Basic search, relevance scoring\n- Limit/offset pagination\n- JSON vs text output\n\n**graph.ts:**\n- `backlinks`: finds incoming links\n- `neighbors`: finds connected notes\n- Empty graph handling\n\n**people.ts:**\n- `list`: pagination, sorting\n- `show`: person details, related notes\n- `create/update`: validation\n\n**tasks.ts:**\n- `list`: status filtering, date filtering\n- `complete/uncomplete`: state changes\n- JSON output format\n\n## Implementation Steps\n1. Create test directory structure\n2. Create shared test helpers (mock context, mock engines)\n3. Implement tests for `notes.ts` first (highest complexity)\n4. Add tests for remaining commands\n5. Ensure coverage \u003e80% per file\n6. Add to CI pipeline\n\n## Acceptance Criteria\n- [ ] All 9 command files have corresponding test files\n- [ ] Coverage \u003e80% for each command module\n- [ ] Tests run in \u003c30 seconds\n- [ ] No flaky tests\n- [ ] CI pipeline includes CLI command tests\n\n## Estimated Effort\n8-12 hours (1-1.5 hours per command)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T10:07:37.647325-06:00","updated_at":"2025-12-18T14:52:23.746295-06:00","closed_at":"2025-12-18T14:52:23.746295-06:00","dependencies":[{"issue_id":"scribe-q3n.5","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.647665-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.6","title":"Add tests for note-validator.ts","description":"## Summary\nAdd comprehensive tests for `note-validator.ts` (188 lines) - critical for data integrity.\n\n## Problem\nThe NoteValidator class validates note structure before persistence but has no tests:\n- Validates required fields (id, title, content)\n- Validates tag format\n- Validates daily note structure\n- Validates meeting note structure\n- No tests to ensure validation catches malformed data\n\n## File Location\n`packages/storage-fs/src/note-validator.ts`\n\n## Test Cases Needed\n\n### Core Field Validation\n```typescript\ndescribe('NoteValidator', () =\u003e {\n  describe('validateNote', () =\u003e {\n    it('accepts valid note with all required fields');\n    it('rejects note without id');\n    it('rejects note without title');\n    it('rejects note without content');\n    it('rejects note with invalid id format');\n    it('accepts note with optional fields missing');\n  });\n});\n```\n\n### Tag Validation\n```typescript\ndescribe('tag validation', () =\u003e {\n  it('accepts valid tags: alphanumeric, hyphen, underscore');\n  it('rejects tags with spaces');\n  it('rejects tags with special characters');\n  it('rejects empty tag strings');\n  it('accepts empty tags array');\n});\n```\n\n### Daily Note Validation\n```typescript\ndescribe('daily note validation', () =\u003e {\n  it('accepts valid daily note with date');\n  it('rejects daily note without date field');\n  it('rejects daily note with invalid date format');\n  it('accepts daily note with all optional fields');\n});\n```\n\n### Meeting Note Validation\n```typescript\ndescribe('meeting note validation', () =\u003e {\n  it('accepts valid meeting note');\n  it('rejects meeting without required fields');\n  it('validates attendee structure');\n  it('validates date/time fields');\n});\n```\n\n### Edge Cases\n```typescript\ndescribe('edge cases', () =\u003e {\n  it('handles null content gracefully');\n  it('handles undefined optional fields');\n  it('validates deeply nested content structure');\n  it('returns specific error messages for each validation failure');\n});\n```\n\n## Implementation Steps\n1. Create `packages/storage-fs/src/note-validator.test.ts`\n2. Import NoteValidator and test fixtures\n3. Create factory functions for valid/invalid notes\n4. Implement all test cases above\n5. Ensure error messages are clear and actionable\n6. Verify coverage is \u003e90%\n\n## Acceptance Criteria\n- [ ] Test file created with comprehensive cases\n- [ ] All validation paths tested (happy + error)\n- [ ] Error messages verified in assertions\n- [ ] Coverage \u003e90% for note-validator.ts\n- [ ] Tests run in \u003c5 seconds\n\n## Estimated Effort\n2-3 hours","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T10:07:37.720262-06:00","updated_at":"2025-12-18T14:41:54.730731-06:00","closed_at":"2025-12-18T14:41:54.730731-06:00","dependencies":[{"issue_id":"scribe-q3n.6","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.720611-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.7","title":"Add tests for CLI context.ts","description":"## Summary\nAdd tests for `context.ts` (312 lines) - the core CLI initialization and engine lifecycle module.\n\n## Problem\nLazyContext class manages:\n- Lazy loading of Storage, SearchEngine, GraphEngine\n- Vault path resolution\n- Engine lifecycle (initialization, cleanup)\n- Error handling for vault loading failures\n\nNo tests exist for this critical orchestration code.\n\n## File Location\n`apps/cli/src/context.ts`\n\n## Key Classes/Functions to Test\n\n### LazyContext Class\n```typescript\nclass LazyContext {\n  // Lazy-loaded engines\n  get storage(): Promise\u003cStorage\u003e\n  get searchEngine(): Promise\u003cSearchEngine\u003e\n  get graphEngine(): Promise\u003cGraphEngine\u003e\n  \n  // Require methods (throw if not initialized)\n  requireVault(): VaultConfig\n  requireStorage(): Storage\n  requireSearchEngine(): SearchEngine\n  requireGraphEngine(): GraphEngine\n  \n  // Lifecycle\n  async initialize(): Promise\u003cvoid\u003e\n  async cleanup(): Promise\u003cvoid\u003e\n}\n```\n\n## Test Cases Needed\n\n### Initialization\n```typescript\ndescribe('LazyContext', () =\u003e {\n  describe('initialization', () =\u003e {\n    it('initializes with valid vault path');\n    it('throws VaultNotFoundError for invalid path');\n    it('lazily loads storage only when accessed');\n    it('lazily loads search engine only when accessed');\n    it('lazily loads graph engine only when accessed');\n    it('reuses initialized engines on subsequent access');\n  });\n});\n```\n\n### Require Methods\n```typescript\ndescribe('require methods', () =\u003e {\n  it('requireVault() throws if vault not set');\n  it('requireVault() returns vault after initialization');\n  it('requireStorage() throws if not initialized');\n  it('requireStorage() returns storage after init');\n  // ... same pattern for other engines\n});\n```\n\n### Error Handling\n```typescript\ndescribe('error handling', () =\u003e {\n  it('handles storage initialization failure gracefully');\n  it('propagates vault loading errors with context');\n  it('cleanup succeeds even if not fully initialized');\n});\n```\n\n### Lifecycle\n```typescript\ndescribe('lifecycle', () =\u003e {\n  it('cleanup releases all engine resources');\n  it('cannot use engines after cleanup');\n  it('can reinitialize after cleanup');\n});\n```\n\n## Mock Strategy\n- Mock `@scribe/storage-fs` Storage class\n- Mock `@scribe/engine-search` SearchEngine class\n- Mock `@scribe/engine-graph` GraphEngine class\n- Use temp directories for vault path testing\n\n## Implementation Steps\n1. Create `apps/cli/tests/unit/context.test.ts`\n2. Set up mocks for all engine classes\n3. Create helper to initialize context with test vault\n4. Implement initialization tests\n5. Implement require method tests\n6. Implement error handling tests\n7. Implement lifecycle tests\n8. Verify coverage \u003e85%\n\n## Acceptance Criteria\n- [ ] All LazyContext methods have test coverage\n- [ ] Error paths tested with specific error types\n- [ ] Lazy loading behavior verified\n- [ ] Cleanup behavior verified\n- [ ] Coverage \u003e85%\n\n## Estimated Effort\n2-3 hours","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-18T10:07:37.792091-06:00","updated_at":"2025-12-18T14:49:59.641971-06:00","closed_at":"2025-12-18T14:49:59.641971-06:00","dependencies":[{"issue_id":"scribe-q3n.7","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.792463-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.8","title":"Add tests for text-extraction.ts","description":"## Summary\nAdd tests for `text-extraction.ts` (80 lines) - search indexing utilities.\n\n## Problem\nThis module provides 3 functions used by SearchEngine for indexing:\n- `extractTextForSearch(content)` - Extracts searchable text from Lexical content\n- `extractTextWithContext(content)` - Extracts text with positional context\n- `generateSnippet(text, query, maxLength)` - Generates search result snippets\n\nThese affect search quality but have no dedicated tests.\n\n## File Location\n`packages/engine-search/src/text-extraction.ts`\n\n## Test Cases Needed\n\n### extractTextForSearch\n```typescript\ndescribe('extractTextForSearch', () =\u003e {\n  it('extracts text from simple paragraph');\n  it('extracts text from nested nodes');\n  it('handles heading nodes');\n  it('handles list nodes');\n  it('handles code blocks');\n  it('handles table cells');\n  it('strips formatting but preserves text');\n  it('handles empty content');\n  it('handles null/undefined content');\n  it('respects MAX_INDEXED_CONTENT_LENGTH');\n});\n```\n\n### extractTextWithContext\n```typescript\ndescribe('extractTextWithContext', () =\u003e {\n  it('returns text with line numbers');\n  it('preserves paragraph boundaries');\n  it('tracks heading context');\n  it('includes list item markers');\n});\n```\n\n### generateSnippet\n```typescript\ndescribe('generateSnippet', () =\u003e {\n  it('generates snippet around query match');\n  it('respects maxLength parameter');\n  it('handles query at start of text');\n  it('handles query at end of text');\n  it('handles multiple query matches (uses first)');\n  it('handles query not found');\n  it('adds ellipsis when truncating');\n  it('handles case-insensitive matching');\n});\n```\n\n## Test Fixtures Needed\nCreate Lexical content fixtures:\n```typescript\nconst fixtures = {\n  simpleParagraph: { /* EditorContent */ },\n  nestedHeadings: { /* EditorContent */ },\n  listContent: { /* EditorContent */ },\n  tableContent: { /* EditorContent */ },\n  codeBlock: { /* EditorContent */ },\n  mixedContent: { /* EditorContent */ },\n  emptyContent: { /* EditorContent */ },\n};\n```\n\n## Implementation Steps\n1. Create `packages/engine-search/src/text-extraction.test.ts`\n2. Create Lexical content fixtures\n3. Test `extractTextForSearch` with all node types\n4. Test `extractTextWithContext` for positional accuracy\n5. Test `generateSnippet` edge cases\n6. Verify coverage \u003e90%\n\n## Acceptance Criteria\n- [ ] All 3 functions have comprehensive tests\n- [ ] All Lexical node types covered in extraction tests\n- [ ] Snippet generation edge cases covered\n- [ ] Coverage \u003e90%\n\n## Estimated Effort\n1-2 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:37.864199-06:00","updated_at":"2025-12-18T14:41:55.232172-06:00","closed_at":"2025-12-18T14:41:55.232172-06:00","dependencies":[{"issue_id":"scribe-q3n.8","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.864537-06:00","created_by":"daemon"}]}
{"id":"scribe-q3n.9","title":"Add tests for ast-utils.ts","description":"## Summary\nAdd tests for `ast-utils.ts` - shared AST traversal utilities used across packages.\n\n## Problem\nThis module provides core traversal utilities:\n- `traverseNodes(root, callback)` - Depth-first traversal\n- `traverseNodesWithAncestors(root, callback)` - Traversal with parent context\n- `extractTextFromNodes(nodes)` - Extract text content\n- `extractTextFromNode(node)` - Extract from single node\n\nUsed by `engine-core`, `engine-search`, and `content-extractor` but has no tests.\n\n## File Location\n`packages/shared/src/ast-utils.ts`\n\n## Test Cases Needed\n\n### traverseNodes\n```typescript\ndescribe('traverseNodes', () =\u003e {\n  it('visits all nodes in depth-first order');\n  it('visits root node first');\n  it('visits children before siblings');\n  it('handles nodes without children');\n  it('handles empty children array');\n  it('handles deeply nested structures');\n  it('callback can return false to stop traversal');\n});\n```\n\n### traverseNodesWithAncestors\n```typescript\ndescribe('traverseNodesWithAncestors', () =\u003e {\n  it('provides empty ancestors array for root');\n  it('provides parent in ancestors for direct children');\n  it('provides full ancestor chain for deep nodes');\n  it('ancestors array is in order: [grandparent, parent]');\n});\n```\n\n### extractTextFromNodes\n```typescript\ndescribe('extractTextFromNodes', () =\u003e {\n  it('extracts text from single text node');\n  it('concatenates text from multiple nodes');\n  it('handles paragraph nodes');\n  it('handles heading nodes');\n  it('handles list item nodes');\n  it('handles link nodes (extracts text, not URL)');\n  it('handles code nodes');\n  it('skips non-text nodes');\n  it('handles empty nodes array');\n});\n```\n\n### extractTextFromNode\n```typescript\ndescribe('extractTextFromNode', () =\u003e {\n  it('returns text property for text nodes');\n  it('recursively extracts from children');\n  it('returns empty string for null/undefined');\n  it('handles node without text or children');\n});\n```\n\n## Test Fixtures\n```typescript\nconst fixtures = {\n  textNode: { type: 'text', text: 'Hello' },\n  paragraphWithText: { type: 'paragraph', children: [...] },\n  nestedStructure: { type: 'root', children: [...deeply nested...] },\n  linkNode: { type: 'link', url: 'http://...', children: [...] },\n  emptyNode: { type: 'paragraph', children: [] },\n};\n```\n\n## Implementation Steps\n1. Create `packages/shared/src/ast-utils.test.ts`\n2. Create comprehensive node fixtures\n3. Test traversal order with mock callbacks\n4. Test ancestor chain correctness\n5. Test text extraction with all node types\n6. Verify coverage \u003e95%\n\n## Acceptance Criteria\n- [ ] All exported functions tested\n- [ ] Traversal order verified with sequence assertions\n- [ ] Ancestor chain verified at each depth\n- [ ] All node types handled in text extraction\n- [ ] Coverage \u003e95%\n\n## Estimated Effort\n1-2 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T10:07:37.936203-06:00","updated_at":"2025-12-18T11:19:21.951927-06:00","closed_at":"2025-12-18T11:19:21.951927-06:00","dependencies":[{"issue_id":"scribe-q3n.9","depends_on_id":"scribe-q3n","type":"parent-child","created_at":"2025-12-18T10:07:37.936555-06:00","created_by":"daemon"}]}
