{"id":"scribe-g6j","title":"Tech Debt Remediation Q1 2025","description":"Comprehensive tech debt remediation epic based on thorough codebase analysis. Covers:\n- Large file refactoring (10+ files over 400 lines)\n- Code duplication elimination (9 major duplication patterns)\n- Dead code removal (~40 unused exports)\n- Test coverage improvements (CLI utilities, Lexical nodes)\n- Documentation gaps (5 modules lacking docs)\n- Legacy patterns cleanup (any usage, inconsistent handler patterns)\n\n## Priority Areas\n1. content-extractor.ts (1031 lines) - highest impact refactor\n2. Duplicate content creation functions (6+ locations)\n3. CLI utilities missing tests (cli-installer.ts, input.ts)\n4. Error system consolidation (2 separate ErrorCode enums)\n\n## Refined Dependency Graph\n\n### Wave 1: Fully Parallel (No blockers - start immediately)\nThese 22 tasks can run in parallel with no dependencies:\n\n**P1 (Critical Path):**\n- g6j.1: Refactor content-extractor.ts → UNBLOCKS g6j.28\n- g6j.5: Merge CLI ErrorCode enum into shared package\n- g6j.21: Add unit tests for cli-installer.ts\n- g6j.22: Add unit tests for CLI input.ts\n\n**P1 Content Consolidation (parallel with each other):**\n- g6j.7: Consolidate createDailyContent → UNBLOCKS g6j.12, g6j.2\n- g6j.8: Consolidate createMeetingContent → UNBLOCKS g6j.12, g6j.2\n- g6j.9: Consolidate createPersonContent → UNBLOCKS g6j.12, g6j.2\n\n**P2 Independent:**\n- g6j.3: Split TableKeyboardPlugin.tsx into modules\n- g6j.6: Consolidate wrapError function\n- g6j.10: Standardize createEmptyContent\n- g6j.16: Remove deprecated LexicalState/LexicalNode\n- g6j.23-26: Unit tests (config.ts, PersonMentionNode, InlineLinkNode, tasksHandlers)\n- g6j.27: Fix skipped rollback tests\n- g6j.33: Refactor handlers to use EngineOrchestrator\n\n**P3 Dead Code Removal (fully parallel):**\n- g6j.13: Remove unused error exports\n- g6j.14: Remove unused date utility exports\n- g6j.15: Remove unused note type guards\n- g6j.17: Clean up storage-fs internal exports\n\n**P3 Documentation (fully parallel):**\n- g6j.29: JSDoc for createCLI\n- g6j.30: JSDoc for createWindow\n- g6j.31: Document magic numbers\n- g6j.34: Convert Promise .then() to async/await\n\n**P3 Hooks Refactoring:**\n- g6j.4: Extract autocomplete hooks\n- g6j.11: Consolidate desktop logger\n\n### Wave 2: After Content Consolidation (g6j.7, g6j.8, g6j.9)\n- g6j.2: Consolidate note-factory.ts patterns (needs content functions)\n- g6j.12: Migrate test helpers to @scribe/test-utils\n\n### Wave 3: After g6j.1\n- g6j.28: Document escapeMarkdownText algorithm (after refactor)\n\n### Wave 4: After g6j.12 + g6j.2\n- g6j.32: Create test utilities to eliminate `as any` casts\n\n## Closed as Already Done\n- g6j.18, g6j.19, g6j.20 (design-system primitive tests already exist)\n\n## Recommended Execution Order\n1. Start Wave 1 tasks in parallel (max parallelism)\n2. As g6j.7, g6j.8, g6j.9 complete → start g6j.2, g6j.12\n3. As g6j.1 completes → start g6j.28\n4. As g6j.12 + g6j.2 complete → start g6j.32","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T13:26:29.700381-06:00","updated_at":"2025-12-23T14:37:57.01957-06:00","closed_at":"2025-12-23T14:37:57.01957-06:00"}
{"id":"scribe-g6j.1","title":"Refactor content-extractor.ts (1031 lines) into modular components","description":"Refactor content-extractor.ts (1031 lines) into modular components.\n\nThe largest file in the codebase. Converts Scribe notes (Lexical editor format) to Markdown format.\n\n**Current responsibilities (too many):**\n- Markdown escaping logic (~156 lines, lines 247-402 - `escapeMarkdownText`)\n- Block-level node conversion (headings, paragraphs, lists, tables, code)\n- Inline content extraction (text, links, mentions)\n- YAML frontmatter generation\n- Context tracking during conversion\n\n**Proposed refactor - create new files in packages/shared/src/:**\n1. `markdown-escaper.ts` - All escapeMarkdownText logic (~156 lines)\n2. `block-converters.ts` - Block-level node conversion\n3. `inline-converters.ts` - Inline content extraction\n4. `frontmatter.ts` - YAML frontmatter generation\n5. Keep `content-extractor.ts` as orchestrator (public API only, ~100 lines)\n\n**Implementation Steps:**\n1. Extract escapeMarkdownText to markdown-escaper.ts first (most isolated, lines 247-402)\n2. Extract frontmatter generation to frontmatter.ts\n3. Extract block converters (maintains internal helper functions)\n4. Extract inline converters\n5. Update content-extractor.ts to import and orchestrate\n6. Ensure all tests pass: `bun test packages/shared`\n7. Update package exports in packages/shared/src/index.ts if needed\n\n**Key files:**\n- packages/shared/src/content-extractor.ts (source)\n- packages/shared/src/content-extractor.test.ts (verify with existing tests)\n\n**Parallel safe:** No dependencies on other tasks.\n\n**UNBLOCKS:** scribe-g6j.28 (documentation of escapeMarkdownText algorithm)\n\nFiles: packages/shared/src/content-extractor.ts, packages/shared/src/markdown-escaper.ts (NEW), packages/shared/src/block-converters.ts (NEW), packages/shared/src/inline-converters.ts (NEW), packages/shared/src/frontmatter.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T13:26:29.775576-06:00","updated_at":"2025-12-23T14:02:26.403019-06:00","closed_at":"2025-12-23T14:02:26.403019-06:00","dependencies":[{"issue_id":"scribe-g6j.1","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:29.77592-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.10","title":"Standardize createEmptyContent across packages","description":"Standardize createEmptyContent across packages.\n\nThree different createEmptyContent implementations with structural differences:\n\n**Shared (packages/shared/src/content.ts, lines 17-36):** ✓ CANONICAL\n- Returns root with empty paragraph including format, indent, direction, version properties\n- Already exported from @scribe/shared\n\n**CLI (apps/cli/src/node-builder.ts, lines 149-159):** DIFFERENT STRUCTURE\n- Returns root with empty children array (no paragraph)\n- Inconsistent with shared package\n\n**Test-utils (packages/test-utils/src/note-factory.ts, lines 113-120):**\n- Returns root with empty children array\n- Re-exports from @scribe/shared in index.ts\n\n**Implementation Steps:**\n1. Verify shared createEmptyContent is the correct structure (with empty paragraph)\n2. Update CLI `apps/cli/src/node-builder.ts` to import from @scribe/shared instead of defining locally\n3. Remove local createEmptyContent from node-builder.ts\n4. Verify test-utils already re-exports from shared (it does in index.ts, but has local copy in note-factory.ts)\n5. Remove duplicate from note-factory.ts, use import from shared\n6. Run `bun test apps/cli` and `bun test packages/test-utils` to verify\n\n**Parallel safe:** No dependencies on other tasks. Can run in parallel with g6j.7, g6j.8, g6j.9.\n\nFiles: packages/shared/src/content.ts, apps/cli/src/node-builder.ts, packages/test-utils/src/note-factory.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:30.497212-06:00","updated_at":"2025-12-23T14:02:09.321195-06:00","closed_at":"2025-12-23T14:02:09.321195-06:00","dependencies":[{"issue_id":"scribe-g6j.10","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.497714-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.11","title":"Consolidate desktop logger to extend shared logger","description":"Two separate logger systems with different APIs:\n\nShared (packages/shared/src/logger.ts, 265 lines):\n- Full-featured with child loggers and structured context\n- Uses LOG_LEVEL environment variable\n- API: log.debug('message', { key: value })\n\nDesktop (apps/desktop/electron/main/src/logger.ts, 125 lines):\n- Simpler logger with pre-configured contexts\n- Different API: log.debug('message', value1, value2)\n- Different output format\n\nSolution: Desktop logger should extend or use the shared logger for consistency. This ensures logging behavior is uniform across CLI and desktop.\n\nFiles: apps/desktop/electron/main/src/logger.ts, packages/shared/src/logger.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:30.580902-06:00","updated_at":"2025-12-23T14:33:38.69032-06:00","closed_at":"2025-12-23T14:33:38.69032-06:00","dependencies":[{"issue_id":"scribe-g6j.11","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.581249-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.12","title":"Migrate test helpers to @scribe/test-utils package","description":"Migrate test helper code from desktop to @scribe/test-utils package.\n\n**BLOCKED BY:** scribe-g6j.7, scribe-g6j.8, scribe-g6j.9 (content function consolidation must complete first)\n\nDesktop (apps/desktop/test-helpers.ts):\n- setupTestContext, cleanupTestContext (lines 54-94)\n- createNoteContent, createNoteWithTitle, createAndIndexNote (lines 163-396)\n- createPersonContent, createDailyContent, createMeetingContent re-exports\n\nTest-utils (packages/test-utils/):\n- vault-factory.ts: createTestVault, cleanupTestVault (lines 76-182)\n- note-factory.ts: createTestNote, createMockNote, createGraphTestNote (lines 343-576)\n\n**Implementation Steps:**\n1. Wait for content function consolidation (g6j.7, g6j.8, g6j.9) to complete\n2. Import consolidated content functions into test-utils from @scribe/shared or templates\n3. Move desktop test helpers that create content to use shared imports\n4. Migrate commonly-used helpers from desktop/test-helpers.ts to @scribe/test-utils\n5. Update desktop integration tests to use @scribe/test-utils\n6. Run all integration tests to verify migration: `bun test apps/desktop`\n\n**UNBLOCKS:** scribe-g6j.32 (test utilities for `as any` elimination)\n\nFiles: apps/desktop/test-helpers.ts, packages/test-utils/src/vault-factory.ts, packages/test-utils/src/note-factory.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:30.660177-06:00","updated_at":"2025-12-23T14:18:49.872744-06:00","closed_at":"2025-12-23T14:18:49.872744-06:00","dependencies":[{"issue_id":"scribe-g6j.12","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.660589-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.12","depends_on_id":"scribe-g6j.7","type":"blocks","created_at":"2025-12-23T13:33:09.820129-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.12","depends_on_id":"scribe-g6j.8","type":"blocks","created_at":"2025-12-23T13:33:10.759456-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.12","depends_on_id":"scribe-g6j.9","type":"blocks","created_at":"2025-12-23T13:33:11.571243-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.13","title":"Remove unused error type exports (SyncConflictError, MigrationError, etc)","description":"Unused error type exports in packages/shared/src/errors.ts:\n\nNever imported outside test files or exports:\n- SyncConflictError, isSyncConflictError (lines 362-370, 437-439)\n- MigrationError, isMigrationError (lines 375-383, 444-446)\n- TaskNotFoundError, isTaskNotFoundError (lines 352-357, 430-432)\n- isFileSystemError (lines 395-397) - only test file\n- isNoteError (lines 402-404) - only test file\n- isVaultError (lines 409-411) - never imported\n- isEngineError (lines 416-418) - never imported\n- isValidationError (lines 423-425) - only test file\n- getErrorMessageWithContext (lines 506-513) - only test file\n- FileSystemError, NoteError, VaultError, EngineError classes - never imported from package\n\nOptions:\n1. Remove unused exports from barrel\n2. Mark as internal-only\n3. Document as future API\n\nFiles: packages/shared/src/errors.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:30.743631-06:00","updated_at":"2025-12-23T14:18:13.383099-06:00","closed_at":"2025-12-23T14:18:13.383099-06:00","dependencies":[{"issue_id":"scribe-g6j.13","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.744032-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.14","title":"Remove unused date utility exports (formatDateMMDDYYYY, startOfDay, etc)","description":"Unused date utility exports in packages/shared/src/date-utils.ts:\n\nNever imported anywhere:\n- formatDateMMDDYYYY (lines 108-117)\n- parseDateMMDDYYYY (lines 271-285)\n- startOfDay (lines 409-418)\n- endOfDay (lines 429-438)\n- getDaysBetween (lines 379-394)\n\nThese may be useful future APIs but are currently dead code.\n\nOptions:\n1. Remove from barrel export, keep in file for future use\n2. Remove entirely if not planned\n3. Document as available utilities\n\nFiles: packages/shared/src/date-utils.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:30.829382-06:00","updated_at":"2025-12-23T14:20:27.944773-06:00","closed_at":"2025-12-23T14:20:27.944773-06:00","dependencies":[{"issue_id":"scribe-g6j.14","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.829781-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.15","title":"Remove unused note type guards (isRegularNote, isProjectNote, etc)","description":"Unused note type guards in packages/shared/src/types/note-types.ts:\n\nNever imported outside the file:\n- isRegularNote (lines 472-474)\n- isProjectNote (lines 516-518)\n- isTemplateNote (lines 538-540)\n- isSystemNote (lines 561-563)\n\nThese type guards are exported but never used in the codebase.\n\nOptions:\n1. Remove from exports if truly unused\n2. Keep if planned for future discriminated union handling\n3. Document intended usage\n\nFiles: packages/shared/src/types/note-types.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:30.916949-06:00","updated_at":"2025-12-23T14:18:52.980651-06:00","closed_at":"2025-12-23T14:18:52.980651-06:00","dependencies":[{"issue_id":"scribe-g6j.15","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.917414-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.16","title":"Remove deprecated LexicalState and LexicalNode type aliases","description":"Deprecated type aliases still in codebase (packages/shared/src/types/editor-types.ts):\n\n- LexicalState (line 97) - @deprecated, use EditorContent\n- LexicalNode (line 102) - @deprecated, use EditorNode\n\nThese are marked deprecated but still exported. No imports found outside exports.\n\nSolution:\n1. Search for any remaining usages\n2. Remove the deprecated aliases\n3. Update any remaining code to use EditorContent/EditorNode\n\nFiles: packages/shared/src/types/editor-types.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.00205-06:00","updated_at":"2025-12-23T14:09:35.758767-06:00","closed_at":"2025-12-23T14:09:35.758767-06:00","dependencies":[{"issue_id":"scribe-g6j.16","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.002415-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.17","title":"Clean up storage-fs internal exports (NoteValidator, AtomicFileWriter, etc)","description":"Internal utilities exported publicly from storage-fs (packages/storage-fs/src/index.ts):\n\nExported but only used internally or in tests:\n- NoteValidator, INoteValidator, ValidationResult (lines 10-14)\n- AtomicFileWriter, IAtomicFileWriter, AtomicWriteOptions (lines 16-20)\n- NoteMigrator, INoteMigrator, NOTE_FORMAT_VERSION (lines 22-26)\n- QuarantineManager, createQuarantineManager, IQuarantineManager (lines 27-31)\n\nThese are implementation details, not public API. QuarantineManager is accessed via vault method.\n\nSolution: Make these internal-only, remove from barrel export. If external testing needs access, expose via test-utils package instead.\n\nFiles: packages/storage-fs/src/index.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:31.093468-06:00","updated_at":"2025-12-23T14:21:29.36849-06:00","closed_at":"2025-12-23T14:21:29.36849-06:00","dependencies":[{"issue_id":"scribe-g6j.17","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.093871-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.18","title":"Add unit tests for design-system Button primitive","description":"Design system Button primitive has no unit tests.\n\nFile: packages/design-system/src/primitives/Button/Button.tsx\n\nCurrent coverage: 0%\nPackage coverage: 17% overall\n\nTests needed:\n- Render with different variants\n- Click handler invocation\n- Disabled state\n- Loading state (if applicable)\n- Accessibility attributes\n\nFiles: packages/design-system/src/primitives/Button/Button.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.181248-06:00","updated_at":"2025-12-23T13:33:01.52612-06:00","closed_at":"2025-12-23T13:33:01.52612-06:00","dependencies":[{"issue_id":"scribe-g6j.18","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.181637-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.19","title":"Add unit tests for design-system Calendar primitive","description":"Design system Calendar primitive has no unit tests.\n\nFile: packages/design-system/src/primitives/Calendar/Calendar.tsx\n\nCurrent coverage: 0%\nPackage coverage: 17% overall\n\nTests needed:\n- Date selection\n- Month navigation\n- Disabled dates\n- Date range handling\n- Keyboard navigation\n- Accessibility\n\nFiles: packages/design-system/src/primitives/Calendar/Calendar.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.268078-06:00","updated_at":"2025-12-23T13:33:03.131318-06:00","closed_at":"2025-12-23T13:33:03.131318-06:00","dependencies":[{"issue_id":"scribe-g6j.19","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.268425-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.2","title":"Consolidate duplicate note-factory.ts patterns (619 lines)","description":"Consolidate duplicate note-factory.ts patterns (619 lines).\n\nThe note-factory.ts file has 619 lines with significant code duplication between factory functions.\n\n**Duplication pattern:** createTestNote, createMockNote, createGraphTestNote, and createContentTestNote all have nearly identical switch statements for handling note types (daily, meeting, person, etc.).\n\n**Content helpers (lines 109-291):** Should move to separate content-factory.ts or use imports from consolidated content functions (g6j.7, g6j.8, g6j.9).\n\n**BLOCKED BY:** Should wait for g6j.7, g6j.8, g6j.9 to complete so content functions are consolidated first.\n\n**Implementation Steps:**\n1. Wait for content consolidation tasks (g6j.7, g6j.8, g6j.9) to complete\n2. Import createDailyContent, createMeetingContent, createPersonContent from canonical sources\n3. Remove duplicate content creation logic from note-factory.ts\n4. Create a single base factory function with builder pattern\n5. Reduce 4 factory functions to 1 configurable factory OR keep named exports but share implementation\n6. Run `bun test packages/test-utils` to verify\n\n**UNBLOCKS:** scribe-g6j.32 (test utilities for `as any` elimination)\n\nFiles: packages/test-utils/src/note-factory.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:29.851436-06:00","updated_at":"2025-12-23T14:26:53.292548-06:00","closed_at":"2025-12-23T14:26:53.292548-06:00","dependencies":[{"issue_id":"scribe-g6j.2","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:29.851808-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.2","depends_on_id":"scribe-g6j.7","type":"blocks","created_at":"2025-12-23T13:39:06.20779-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.2","depends_on_id":"scribe-g6j.8","type":"blocks","created_at":"2025-12-23T13:39:06.254808-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.2","depends_on_id":"scribe-g6j.9","type":"blocks","created_at":"2025-12-23T13:39:06.299885-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.20","title":"Add unit tests for design-system FloatingMenu primitive","description":"Design system FloatingMenu primitive has no unit tests.\n\nFile: packages/design-system/src/primitives/FloatingMenu/FloatingMenu.tsx (307 lines)\n\nCurrent coverage: 0%\nPackage coverage: 17% overall\n\nThis is one of the larger primitives. Tests needed:\n- Positioning calculations\n- Show/hide behavior\n- Keyboard navigation\n- Click outside handling\n- Anchor element tracking\n\nFiles: packages/design-system/src/primitives/FloatingMenu/FloatingMenu.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.354317-06:00","updated_at":"2025-12-23T13:33:04.669834-06:00","closed_at":"2025-12-23T13:33:04.669834-06:00","dependencies":[{"issue_id":"scribe-g6j.20","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.354648-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.21","title":"Add unit tests for cli-installer.ts (312 lines, complex symlink logic)","description":"Add unit tests for cli-installer.ts (311 lines, complex symlink logic).\n\nFile: apps/desktop/electron/main/src/cli-installer.ts\n\nComplex logic includes:\n- Symlink creation and verification\n- PATH configuration detection (bash, zsh, fish)\n- Existing file handling (overwrite, skip)\n- Error recovery scenarios\n- Multiple file system operations\n- Cross-platform considerations (Darwin)\n\n**Tests needed:**\n- Test symlink creation success/failure\n- Test PATH detection for different shells (~/.zshrc, ~/.bashrc, ~/.config/fish/config.fish)\n- Test existing file handling (overwrite, skip, backup)\n- Mock filesystem operations for isolation\n- Error scenario coverage (permission denied, file exists, etc.)\n- Test uninstall/cleanup logic\n\n**Implementation approach:**\n1. Create `apps/desktop/electron/main/src/cli-installer.test.ts`\n2. Mock `fs` module for file system operations\n3. Mock `child_process` for shell detection\n4. Test each public function in isolation\n5. Test integration scenarios\n\nThis is HIGH PRIORITY - complex logic with file system side effects.\n\n**Parallel safe:** No dependencies on other tasks.\n\nFiles: apps/desktop/electron/main/src/cli-installer.ts, apps/desktop/electron/main/src/cli-installer.test.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T13:26:31.439187-06:00","updated_at":"2025-12-23T14:10:10.331267-06:00","closed_at":"2025-12-23T14:10:10.331267-06:00","dependencies":[{"issue_id":"scribe-g6j.21","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.439552-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.22","title":"Add unit tests for CLI input.ts (stdin/file reading)","description":"CLI input.ts (154 lines) has no tests for stdin/file reading logic.\n\nFile: apps/cli/src/input.ts\n\nComplex logic includes:\n- stdin reading with size limits\n- File input handling\n- Escape sequence processing\n- Error handling for edge cases\n\nTests needed:\n- Test stdin reading\n- Test file reading\n- Test escape sequence processing\n- Test size limit enforcement\n- Test error handling\n\nThis is HIGH PRIORITY - input handling is critical for CLI reliability.\n\n**Parallel safe:** No dependencies on other tasks.\n\nFiles: apps/cli/src/input.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T13:26:31.516639-06:00","updated_at":"2025-12-23T14:07:38.7699-06:00","closed_at":"2025-12-23T14:07:38.7699-06:00","dependencies":[{"issue_id":"scribe-g6j.22","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.517013-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.23","title":"Add unit tests for CLI config.ts","description":"CLI config.ts (50 lines) has no tests.\n\nFile: apps/cli/src/config.ts\n\nLogic includes:\n- Configuration file loading\n- JSON parsing error handling\n- Missing config file handling\n\nTests needed:\n- Test config loading success\n- Test malformed JSON handling\n- Test missing config file behavior\n- Test default values\n\n**Parallel safe:** No dependencies on other tasks.\n\nFiles: apps/cli/src/config.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.596928-06:00","updated_at":"2025-12-23T14:10:09.147322-06:00","closed_at":"2025-12-23T14:10:09.147322-06:00","dependencies":[{"issue_id":"scribe-g6j.23","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.597351-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.24","title":"Add unit tests for PersonMentionNode.ts","description":"PersonMentionNode.ts (183 lines) is a Lexical decorator node with no tests.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionNode.ts\n\nComplex logic includes:\n- Serialization/deserialization\n- Clone operation\n- DOM creation\n- Click handling and navigation\n\nTests needed:\n- Test serialization to JSON\n- Test deserialization from JSON\n- Test clone produces correct copy\n- Test DOM output structure\n- Test click handler navigation\n\nFiles: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionNode.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.673279-06:00","updated_at":"2025-12-23T14:13:43.69751-06:00","closed_at":"2025-12-23T14:13:43.69751-06:00","dependencies":[{"issue_id":"scribe-g6j.24","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.67363-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.25","title":"Add unit tests for InlineLinkNode.ts","description":"InlineLinkNode.ts has no tests.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/InlineLinkNode.ts\n\nHandles external link rendering and URL validation.\n\nTests needed:\n- Test URL validation\n- Test rendering output\n- Test serialization/deserialization\n- Test link click behavior\n\nFiles: apps/desktop/renderer/src/components/Editor/plugins/InlineLinkNode.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.746966-06:00","updated_at":"2025-12-23T14:15:35.120599-06:00","closed_at":"2025-12-23T14:15:35.120599-06:00","dependencies":[{"issue_id":"scribe-g6j.25","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.750781-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.26","title":"Add unit tests for tasksHandlers.ts toggleChecklistNode logic","description":"tasksHandlers.ts has integration tests but lacks unit tests for the toggleChecklistNode logic.\n\nFile: apps/desktop/electron/main/src/handlers/tasksHandlers.ts\n\nThe toggleChecklistNode function has complex fallback logic for finding and toggling task nodes in the editor state. This deserves isolated unit testing.\n\nTests needed:\n- Test finding checklist node by various identifiers\n- Test toggle behavior (checked -\u003e unchecked, unchecked -\u003e checked)\n- Test fallback logic when node not found\n- Test error handling\n\nFiles: apps/desktop/electron/main/src/handlers/tasksHandlers.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.824093-06:00","updated_at":"2025-12-23T14:25:48.079038-06:00","closed_at":"2025-12-23T14:25:48.079038-06:00","dependencies":[{"issue_id":"scribe-g6j.26","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.824476-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.27","title":"Fix skipped rollback tests in useNoteState.test.ts","description":"Two tests are skipped in useNoteState.test.ts indicating incomplete rollback functionality.\n\nFile: apps/desktop/renderer/src/hooks/useNoteState.test.ts\n\nSkipped tests (lines 473-527):\n1. 'rolls back on save failure (success: false)' (line 475)\n2. 'rolls back on save exception' (line 501)\n\nComment: \"TODO: Fix rollback tests - they have timing issues with hook's ref-based rollback mechanism\"\n\nThis indicates:\n- Rollback functionality may not work correctly\n- Tests have timing issues with ref-based mechanism\n- Technical debt in both implementation and tests\n\nSolution: Fix the underlying rollback implementation, then unskip tests.\n\nFiles: apps/desktop/renderer/src/hooks/useNoteState.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.901162-06:00","updated_at":"2025-12-23T14:15:22.124183-06:00","closed_at":"2025-12-23T14:15:22.124183-06:00","dependencies":[{"issue_id":"scribe-g6j.27","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.901532-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.28","title":"Document escapeMarkdownText algorithm in content-extractor.ts","description":"Document escapeMarkdownText algorithm in markdown-escaper.ts.\n\n**BLOCKED BY:** scribe-g6j.1 (refactor content-extractor first - this function will move to markdown-escaper.ts)\n\nThe escapeMarkdownText function (~156 lines, currently lines 247-402) is complex pattern matching without algorithmic documentation.\n\n**Current state:** No high-level comment explaining the algorithm approach, the state machine used for tracking line starts, emphasis characters, etc.\n\nThe function handles:\n- Detecting emphasis patterns (*bold*, _italic_, **strong**, __strong__)\n- Tracking line state (isAtLineStart for # \u003e - + * escaping)\n- Complex character escaping rules for Markdown special chars\n- Table context handling (pipe escaping)\n- Ordered list detection (1. 2. etc.)\n- Link bracket escaping\n\n**Implementation Steps:**\n1. Wait for g6j.1 to complete (function will move to markdown-escaper.ts)\n2. Add JSDoc block comment at function start explaining:\n   - Overall algorithm approach (character-by-character state machine)\n   - State tracking: isAtLineStart, context.isInTable\n   - Key decision points for escaping\n   - Edge cases handled (nested emphasis, line boundaries, mid-word patterns)\n3. Add inline comments for non-obvious patterns\n4. Consider adding ASCII diagrams for complex logic\n\nFiles: packages/shared/src/markdown-escaper.ts (after g6j.1)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:31.984868-06:00","updated_at":"2025-12-23T14:12:49.660642-06:00","closed_at":"2025-12-23T14:12:49.660642-06:00","dependencies":[{"issue_id":"scribe-g6j.28","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:31.985293-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.28","depends_on_id":"scribe-g6j.1","type":"blocks","created_at":"2025-12-23T13:33:08.834167-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.29","title":"Add JSDoc to createCLI function in cli.ts","description":"The createCLI function in cli.ts lacks JSDoc documentation.\n\nFile: apps/cli/src/cli.ts\n\nMissing documentation for:\n- Function purpose\n- Return value (Command object)\n- Available global options\n- Subcommand organization\n- How to extend the CLI\n\nExample JSDoc needed:\n```typescript\n/**\n * Creates and configures the Scribe CLI application.\n * \n * @returns Configured Commander.js Command instance\n * \n * @example\n * const cli = createCLI();\n * cli.parseAsync(process.argv);\n */\n```\n\nFiles: apps/cli/src/cli.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:32.067917-06:00","updated_at":"2025-12-23T14:28:58.95387-06:00","closed_at":"2025-12-23T14:28:58.95387-06:00","dependencies":[{"issue_id":"scribe-g6j.29","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:32.068288-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.3","title":"Split TableKeyboardPlugin.tsx into table utility modules","description":"TableKeyboardPlugin.tsx is 515 lines with ~15 internal helper functions for table manipulation.\n\nCurrent structure: All helper functions are internal but could be extracted:\n- tableSelectionUtils.ts - Selection-related helpers ($isSelectionInTable, $getTableCellFromSelection, etc.)\n- tableNavigationUtils.ts - Navigation helpers ($isFirstCellInTable, $isLastCellInTable, $exitTableBefore/After)\n- TableKeyboardPlugin.tsx - Just the React component registering commands\n\nBenefits: Reduces cognitive load when debugging table issues, enables reuse of table utilities.\n\nFiles: apps/desktop/renderer/src/components/Editor/plugins/TableKeyboardPlugin.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:29.926283-06:00","updated_at":"2025-12-23T14:11:01.556072-06:00","closed_at":"2025-12-23T14:11:01.556072-06:00","dependencies":[{"issue_id":"scribe-g6j.3","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:29.926671-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.30","title":"Add JSDoc to createWindow function in main.ts","description":"The createWindow function in main.ts (lines 107-192) is 85 lines with no JSDoc.\n\nFile: apps/desktop/electron/main/src/main.ts\n\nComplex configuration includes:\n- Window dimensions and bounds\n- Preload script path\n- Web preferences (security settings)\n- Context menu setup\n- State restoration\n\nMissing documentation for:\n- Security settings rationale\n- Window configuration choices\n- Context menu behavior\n- State persistence\n\nFiles: apps/desktop/electron/main/src/main.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:32.149659-06:00","updated_at":"2025-12-23T14:29:06.711179-06:00","closed_at":"2025-12-23T14:29:06.711179-06:00","dependencies":[{"issue_id":"scribe-g6j.30","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:32.149997-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.31","title":"Document magic numbers in fuzzy-search.ts and hash-utils.ts","description":"Magic numbers in fuzzy-search.ts and hash-utils.ts lack rationale documentation.\n\nfuzzy-search.ts:\n- FUZZY_MATCH_THRESHOLD = 0.3 (why 0.3?)\n- SUBSTRING_MATCH_BASE = 0.9 (why 0.9?)\n- ALL_WORDS_MATCH_SCORE = 0.85 (why 0.85?)\n\nhash-utils.ts:\n- DJB2_HASH_INITIAL = 5381 (why 5381?)\n- DJB2_HASH_MULTIPLIER = 33 (why 33?)\n- TEXT_HASH_LENGTH = 16 (why 16?)\n\nAdd inline comments explaining:\n- Why these specific values were chosen\n- What user testing/research informed the fuzzy search thresholds\n- That 5381 is a prime for good hash distribution\n- That 33 is traditional in DJB2 algorithm\n\nFiles: packages/shared/src/fuzzy-search.ts, packages/shared/src/hash-utils.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:32.232644-06:00","updated_at":"2025-12-23T14:27:57.539355-06:00","closed_at":"2025-12-23T14:27:57.539355-06:00","dependencies":[{"issue_id":"scribe-g6j.31","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:32.233034-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.32","title":"Create test utilities to eliminate as any casts in integration tests","description":"Create test utilities to eliminate `as any` casts in integration tests.\n\n**BLOCKED BY:** scribe-g6j.12, scribe-g6j.2 (test infrastructure must be consolidated first)\n\nHigh-priority files with `as any` casts:\n- templates.integration.test.ts (lines 372, 509-510, 522) - child nodes\n- linked-notes.integration.test.ts (lines 145, 333, 648, 688, 789, 860) - paragraph content\n- date-based-mentions.integration.test.ts (lines 226-227, 593-594, 682-683) - timestamp overrides\n- delete-note.integration.test.ts (lines 420, 471) - test data\n- meeting.test.ts (lines 9, 17-18, 26-31, 42) - content types\n\n**Common patterns requiring utilities:**\n1. Timestamp overrides for deterministic testing\n2. Content type coercion for factory functions\n3. Child node access in editor content\n\n**Implementation Steps:**\n1. Wait for g6j.12 (test helpers migration) and g6j.2 (note-factory consolidation)\n2. Add to @scribe/test-utils:\n   - `function createTestNoteWithOverrides\u003cT extends Note\u003e(base: Partial\u003cT\u003e): T`\n   - `function withTimestamp\u003cT\u003e(obj: T, timestamp: number): T \u0026 { createdAt: number; updatedAt: number }`\n   - Generic content builders with proper typing\n3. Update integration tests to use new utilities\n4. Run linter to verify no new `as any` casts remain\n\nFiles: apps/desktop/test-helpers.ts, packages/test-utils/src/note-factory.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:32.311068-06:00","updated_at":"2025-12-23T14:36:39.938629-06:00","closed_at":"2025-12-23T14:36:39.938629-06:00","dependencies":[{"issue_id":"scribe-g6j.32","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:32.311422-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.32","depends_on_id":"scribe-g6j.12","type":"blocks","created_at":"2025-12-23T13:33:14.797595-06:00","created_by":"daemon"},{"issue_id":"scribe-g6j.32","depends_on_id":"scribe-g6j.2","type":"blocks","created_at":"2025-12-23T13:33:15.622359-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.33","title":"Refactor handlers to use EngineOrchestrator consistently","description":"IPC handlers use inconsistent patterns for accessing engines.\n\nPattern A - Direct vault access (read-only):\n```typescript\nipcMain.handle('notes:list', async () =\u003e {\n  const vault = requireVault(deps);\n  return vault.list();\n});\n```\n\nPattern B - Using withEngines helper (write operations):\n```typescript\nipcMain.handle('notes:save', withEngines(deps, async (engines, note) =\u003e {...}));\n```\n\nThe EngineOrchestrator (apps/desktop/electron/main/src/EngineOrchestrator.ts) exists but isn't used consistently in all handlers.\n\nSolution:\n1. Document the intentional difference between patterns in code comments\n2. Refactor write operations to use EngineOrchestrator consistently\n3. Add CONTRIBUTING.md documentation for when to use each pattern\n\nFiles: apps/desktop/electron/main/src/handlers/notesHandlers.ts, apps/desktop/electron/main/src/EngineOrchestrator.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:32.38807-06:00","updated_at":"2025-12-23T14:27:32.742682-06:00","closed_at":"2025-12-23T14:27:32.742682-06:00","dependencies":[{"issue_id":"scribe-g6j.33","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:32.388416-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.34","title":"Convert remaining Promise .then()/.catch() to async/await","description":"Legacy Promise .then()/.catch() patterns should be converted to async/await.\n\nLocations:\n1. packages/engine-core/src/task-index.ts line 206:\n   this.persist().catch((err) =\u003e {...})\n\n2. packages/test-utils/src/vault-factory.ts lines 98, 179:\n   .catch(() =\u003e {}) for cleanup\n\n3. apps/cli/src/index.ts line 16:\n   cli.parseAsync(process.argv).catch(...)\n\n4. apps/desktop/electron/main/src/main.ts line 194:\n   app.whenReady().then(async () =\u003e {...})\n\nThe app.whenReady().then() is borderline acceptable for entry point code, but the others should use try/catch with async/await for consistency.\n\nFiles: packages/engine-core/src/task-index.ts, apps/desktop/electron/main/src/main.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:32.461623-06:00","updated_at":"2025-12-23T14:30:04.344281-06:00","closed_at":"2025-12-23T14:30:04.344281-06:00","dependencies":[{"issue_id":"scribe-g6j.34","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:32.461959-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.4","title":"Extract autocomplete hooks into separate files","description":"useTriggerableAutocomplete.ts is 498 lines with three hooks in one file:\n1. useTriggerableAutocomplete - Main hook for wiki-links [[  and mentions @\n2. useAutocompleteKeyboardNavigation - Keyboard navigation\n3. useClickOutside - Generic click outside detection\n\nProposed split:\n- useTriggerableAutocomplete.ts - Main hook only\n- useAutocompleteKeyboard.ts - Keyboard navigation hook\n- useClickOutside.ts - Generic reusable click outside hook\n\nThe useClickOutside hook is generic and could be reused elsewhere in the codebase.\n\nFiles: apps/desktop/renderer/src/components/Editor/hooks/useTriggerableAutocomplete.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:26:30.000154-06:00","updated_at":"2025-12-23T14:32:47.050644-06:00","closed_at":"2025-12-23T14:32:47.050644-06:00","dependencies":[{"issue_id":"scribe-g6j.4","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.000698-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.5","title":"Merge CLI ErrorCode enum into shared package","description":"Merge CLI ErrorCode enum into shared package.\n\nTwo separate ErrorCode enums exist with overlapping codes:\n\n**CLI (apps/cli/src/errors.ts) - 7 codes:**\n- INTERNAL_ERROR, VAULT_NOT_FOUND, NOTE_NOT_FOUND\n- INVALID_INPUT, WRITE_FAILED, PERMISSION_DENIED, HAS_BACKLINKS\n\n**Shared (packages/shared/src/errors.ts) - 20+ codes:**\n- FILE_NOT_FOUND, FILE_READ_ERROR, FILE_WRITE_ERROR...\n- NOTE_NOT_FOUND (duplicate!), INVALID_NOTE_FORMAT, NOTE_CORRUPT\n- VAULT_NOT_INITIALIZED, VALIDATION_ERROR, etc.\n\n**Implementation Steps:**\n1. Add CLI-specific codes to shared ErrorCode enum:\n   - INTERNAL_ERROR (if not present)\n   - HAS_BACKLINKS\n   - VAULT_NOT_FOUND (map to VAULT_NOT_INITIALIZED or add)\n2. Update CLI to import ErrorCode from @scribe/shared\n3. CLIError can extend ScribeError or use shared codes\n4. Update EXIT_CODES mapping in CLI to use shared codes\n5. Remove duplicate enum from apps/cli/src/errors.ts\n6. Run `bun test apps/cli` to verify\n\n**Parallel safe:** No dependencies on other tasks.\n\nFiles: apps/cli/src/errors.ts, packages/shared/src/errors.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T13:26:30.076838-06:00","updated_at":"2025-12-23T13:58:11.749827-06:00","closed_at":"2025-12-23T13:58:11.749827-06:00","dependencies":[{"issue_id":"scribe-g6j.5","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.077178-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.6","title":"Consolidate wrapError function into shared handler utilities","description":"Consolidate wrapError function into shared handler utilities.\n\nIdentical wrapError function duplicated in two handler files:\n\n**notesHandlers.ts (lines 52-59):**\n```typescript\nfunction wrapError(error: unknown): never {\n  if (error instanceof ScribeError) {\n    const userError = new Error(error.getUserMessage());\n    userError.name = error.code;\n    throw userError;\n  }\n  throw error;\n}\n```\n\n**peopleHandlers.ts (lines 43-50):** Identical implementation\n\n**Implementation Steps:**\n1. Add wrapError to `apps/desktop/electron/main/src/handlers/types.ts`\n2. Export from types.ts alongside requireVault, withEngines, etc.\n3. Update notesHandlers.ts to import wrapError from './types'\n4. Update peopleHandlers.ts to import wrapError from './types'\n5. Remove local wrapError definitions\n6. Search for other handlers that might benefit (meetingHandlers, dailyHandlers)\n7. Run `bun test apps/desktop` to verify\n\n**Parallel safe:** No dependencies on other tasks.\n\nFiles: apps/desktop/electron/main/src/handlers/notesHandlers.ts, apps/desktop/electron/main/src/handlers/peopleHandlers.ts, apps/desktop/electron/main/src/handlers/types.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:30.15794-06:00","updated_at":"2025-12-23T13:55:51.289724-06:00","closed_at":"2025-12-23T13:55:51.289724-06:00","dependencies":[{"issue_id":"scribe-g6j.6","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.158313-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.7","title":"Consolidate createDailyContent into single source of truth","description":"Consolidate createDailyContent into single source of truth.\n\ncreateDailyContent function is duplicated in 6+ locations with identical logic:\n\n1. `apps/desktop/renderer/src/templates/daily.ts` (lines 10-40) - **Canonical source (already exists!)**\n2. `apps/desktop/electron/main/src/handlers/dailyHandlers.ts` (lines 51-81) - DUPLICATE\n3. `apps/desktop/daily-handlers.integration.test.ts` (lines 31-68) - DUPLICATE\n4. `apps/desktop/meeting-handlers.integration.test.ts` (lines 34-67) - DUPLICATE\n5. `apps/desktop/date-based-meeting.integration.test.ts` (lines 30-63) - DUPLICATE\n6. `apps/desktop/templates.integration.test.ts` (lines 37-72) - DUPLICATE\n\n**Key insight:** The canonical source already exists at `apps/desktop/renderer/src/templates/daily.ts` and is exported!\n\n**Implementation Steps:**\n1. Update `dailyHandlers.ts` to import createDailyContent from `../../renderer/src/templates/daily.ts`\n2. Remove local createDailyContent definition from dailyHandlers.ts (keep the export)\n3. Update integration tests to import from canonical source OR use test-helpers\n4. Add re-export to test-helpers.ts: `export { createDailyContent } from './renderer/src/templates/daily';`\n5. Update test imports to use test-helpers\n6. Run `bun test apps/desktop` to verify all tests pass\n\n**Parallel safe:** Runs in parallel with g6j.8 and g6j.9.\n\n**UNBLOCKS:** scribe-g6j.12 (test helpers migration)\n\nFiles: apps/desktop/renderer/src/templates/daily.ts, apps/desktop/electron/main/src/handlers/dailyHandlers.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T13:26:30.239801-06:00","updated_at":"2025-12-23T13:47:23.911245-06:00","closed_at":"2025-12-23T13:47:23.911245-06:00","dependencies":[{"issue_id":"scribe-g6j.7","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.24019-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.8","title":"Consolidate createMeetingContent into single source of truth","description":"Consolidate createMeetingContent into single source of truth.\n\ncreateMeetingContent function duplicated in 5+ locations:\n\n1. `apps/desktop/renderer/src/templates/meeting.ts` (lines 52-70) - **Canonical source (already exists!)**\n2. `apps/desktop/electron/main/src/handlers/meetingHandlers.ts` (lines 54-104) - DUPLICATE\n3. `apps/desktop/meeting-handlers.integration.test.ts` (lines 69-103) - DUPLICATE\n4. `apps/desktop/date-based-meeting.integration.test.ts` (lines 65-100) - DUPLICATE\n5. `apps/desktop/templates.integration.test.ts` (lines 73-108) - DUPLICATE\n\n**Key insight:** The canonical source already exists at `apps/desktop/renderer/src/templates/meeting.ts`!\n\n**Implementation Steps:**\n1. Update `meetingHandlers.ts` to import createMeetingContent from `../../renderer/src/templates/meeting.ts`\n2. Remove local createMeetingContent definition from meetingHandlers.ts\n3. Add re-export to test-helpers.ts: `export { createMeetingContent } from './renderer/src/templates/meeting';`\n4. Update test imports to use test-helpers\n5. Run `bun test apps/desktop` to verify all tests pass\n\n**Parallel safe:** Runs in parallel with g6j.7 and g6j.9.\n\n**UNBLOCKS:** scribe-g6j.12 (test helpers migration)\n\nFiles: apps/desktop/renderer/src/templates/meeting.ts, apps/desktop/electron/main/src/handlers/meetingHandlers.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T13:26:30.325653-06:00","updated_at":"2025-12-23T13:51:23.868306-06:00","closed_at":"2025-12-23T13:51:23.868306-06:00","dependencies":[{"issue_id":"scribe-g6j.8","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.326044-06:00","created_by":"daemon"}]}
{"id":"scribe-g6j.9","title":"Consolidate createPersonContent into single source of truth","description":"Consolidate createPersonContent into single source of truth.\n\n**IMPORTANT:** No person template file exists yet! This task should CREATE the canonical source.\n\nCurrent locations:\n1. apps/desktop/test-helpers.ts (lines 237-255) - Used by tests\n2. apps/desktop/electron/main/src/handlers/peopleHandlers.ts (lines 63-92) - Used at runtime\n3. apps/desktop/people-handlers.integration.test.ts (as createPersonContentInternal, lines 34-56)\n\n**Implementation Steps:**\n1. Create `apps/desktop/renderer/src/templates/person.ts` (canonical source like daily.ts/meeting.ts)\n2. Export `createPersonContent(name: string): EditorContent \u0026 { type: 'person' }`\n3. Add to `apps/desktop/renderer/src/templates/index.ts` exports\n4. Update `peopleHandlers.ts` to import from templates/person.ts\n5. Update `test-helpers.ts` to re-export from templates/person.ts\n6. Remove createPersonContentInternal from integration tests, use canonical import\n7. Run `bun test apps/desktop` to verify all tests pass\n\n**Parallel safe:** Runs in parallel with g6j.7 and g6j.8.\n\n**UNBLOCKS:** scribe-g6j.12 (test helpers migration)\n\nFiles: apps/desktop/renderer/src/templates/person.ts (NEW), apps/desktop/electron/main/src/handlers/peopleHandlers.ts, apps/desktop/test-helpers.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:26:30.409757-06:00","updated_at":"2025-12-23T13:53:31.787659-06:00","closed_at":"2025-12-23T13:53:31.787659-06:00","dependencies":[{"issue_id":"scribe-g6j.9","depends_on_id":"scribe-g6j","type":"parent-child","created_at":"2025-12-23T13:26:30.410158-06:00","created_by":"daemon"}]}
{"id":"scribe-lg3","title":"Remove dead TableKeyboardPlugin.tsx from plugins/ directory","description":"The old 516-line TableKeyboardPlugin.tsx in plugins/ directory is dead code. The refactored version lives in plugins/table/ and is already being used by EditorRoot.tsx. Safe to delete the old file.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T14:11:12.453197-06:00","updated_at":"2025-12-23T14:11:43.259697-06:00","closed_at":"2025-12-23T14:11:43.259697-06:00"}
{"id":"scribe-roo","title":"Settings Page - Full Implementation (GH Issue #50)","description":"# Settings Page Epic\n\n## Overview\nThis epic implements a comprehensive Settings page for the Scribe desktop application, accessible via a gear icon in the sidebar footer. The settings page opens as a full-screen modal with a VS Code/macOS System Settings-style sidebar navigation pattern.\n\n## Background \u0026 Motivation\nCurrently, Scribe has limited configurability exposed to users:\n- Theme toggle is buried in the sidebar footer\n- Vault location is hardcoded/undiscoverable\n- Update checking requires manual intervention\n- No centralized place for user preferences\n\nA proper Settings page serves several goals:\n1. **Discoverability** - Users can find and modify all app preferences in one place\n2. **Professional UX** - Aligns with user expectations from VS Code, macOS, and modern Electron apps\n3. **Foundation for Growth** - Establishes patterns for future settings (CLI, spellcheck, plugins, etc.)\n4. **Vault Management** - Critical for users with multiple vaults or who need to relocate their data\n\n## Architecture Decision: Full-Screen Modal Pattern\nWe chose a full-screen modal (hiding the sidebar) rather than:\n- **Inline panel**: Would compete with editor space, complex state management\n- **Separate window**: Electron multi-window adds complexity, feels disconnected\n- **Route-based**: Would require router setup, loses context of current session\n\nThe full-screen modal pattern:\n- Familiar from macOS System Preferences, VS Code Settings\n- Clear entry/exit points (gear icon → modal → X/Escape)\n- Can reuse existing Overlay primitive for backdrop and escape handling\n- Sidebar navigation scales well as settings sections grow\n\n## Technical Approach\n\n### Phase 1: Infrastructure (Foundation)\nBuild reusable primitives and IPC infrastructure that enable the feature:\n1. **SegmentedControl** - New design system primitive for theme picker\n2. **Folder Picker IPC** - dialog:selectFolder for vault management\n3. **Vault IPC Channels** - vault:getPath, vault:setPath, vault:create\n\n### Phase 2: UI Shell (Scaffolding)\nBuild the settings page structure without full functionality:\n1. **Sidebar gear icon** - Replace footer with settings trigger\n2. **SettingsPage modal** - Full-screen container with sidebar layout\n3. **Section navigation** - General and Changelog sections\n\n### Phase 3: Settings Functionality (Features)\nImplement actual settings with full behavior:\n1. **Theme setting** - SegmentedControl with immediate apply\n2. **Version + Updates** - Display version, check/install updates\n3. **Vault display** - Show current path (read-only initially)\n4. **Vault switching** - Full hot-reload implementation\n5. **Create new vault** - initializeVault integration\n\n## Key Technical Challenges\n\n### Engine Hot-Reload (Most Complex)\nSwitching vaults at runtime requires:\n- Proper cleanup of existing FileSystemVault instance\n- Re-initialization of SearchEngine, GraphEngine, TaskEngine\n- Renderer state refresh (note list, current note, etc.)\n- Graceful handling of \"current note doesn't exist in new vault\"\n\n**Mitigation**: We'll implement vault switching in waves:\n1. First: Display current path (read-only)\n2. Second: Full switching with engine hot-reload\n3. Fallback: If hot-reload proves too risky, require app restart\n\n### State Synchronization\nSettings changes need to:\n- Persist to config.json (already exists via app:setConfig)\n- Reflect immediately in UI (theme, vault)\n- Handle errors gracefully (invalid vault, failed update)\n\n## Success Criteria\n1. Gear icon visible in sidebar footer, clickable to open settings\n2. Settings modal opens full-screen, closes via X or Escape\n3. Theme switching works immediately with Dark/Light/System options\n4. Version displayed, update checking functional\n5. Vault path displayed, switching to valid vaults works\n6. Create new vault initializes structure correctly\n\n## Out of Scope (Future Work)\n- CLI installation from Settings (separate feature)\n- Actual changelog content (placeholder only)\n- Keyboard shortcuts customization\n- Plugin management\n- Multiple simultaneous vaults\n\n## References\n- GitHub Issue: #50\n- Existing IPC contract: packages/shared/src/ipc-contract.ts\n- Theme system: packages/design-system/src/ThemeProvider.tsx\n- Update hooks: apps/desktop/renderer/src/hooks/useUpdateStatus.ts\n- Vault utilities: packages/storage-fs/src/vault.ts\n\n## Dependency Graph Summary\nWave 1 (Parallel - No blockers): SegmentedControl, Sidebar gear icon, Folder picker IPC, Vault IPC basics\nWave 2 (Depends on Wave 1): SettingsPage shell, Theme setting\nWave 3 (Depends on Wave 2): Version/Update section, Vault display\nWave 4 (Depends on Wave 3): Vault switching (engine hot-reload)\nWave 5 (Depends on Wave 4): Create new vault","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-23T14:56:09.822152-06:00","updated_at":"2025-12-23T14:56:09.822152-06:00"}
{"id":"scribe-roo.1","title":"Create SegmentedControl design system primitive","description":"# Create SegmentedControl Design System Primitive\n\n## What\nBuild a new reusable SegmentedControl component for the design system. This is a mutually exclusive toggle group (like iOS segmented controls or radio button groups styled as connected buttons).\n\n## Why\n- **Required for Theme Picker**: The Settings page needs Dark | Light | System options displayed as a segmented control per the spec\n- **Design System Gap**: No existing component handles this pattern\n- **Reusability**: This pattern will be useful elsewhere (view toggles, filter switches, etc.)\n\n## Technical Approach\n\n### Component API\n```typescript\ninterface SegmentedControlProps\u003cT extends string\u003e {\n  options: Array\u003c{ value: T; label: string; disabled?: boolean }\u003e;\n  value: T;\n  onChange: (value: T) =\u003e void;\n  size?: 'sm' | 'md' | 'lg';\n  fullWidth?: boolean;\n  disabled?: boolean;\n  'aria-label'?: string;\n}\n```\n\n### Styling Requirements\n- Connected buttons with shared border (first/last have rounded corners)\n- Active segment has distinct background (accent color or elevated surface)\n- Smooth transition between states (use vars.animation.duration.fast)\n- Keyboard navigation: arrow keys to move between options\n- Focus visible state on the entire group and active segment\n\n### CSS Variables to Use\n- `vars.color.surface` - Inactive segment background\n- `vars.color.accent` or `vars.color.backgroundAlt` - Active segment\n- `vars.color.border` - Shared border between segments\n- `vars.radius.md` - Corner radius for first/last segments\n- `vars.spacing.2`, `vars.spacing.3` - Internal padding\n\n### Accessibility\n- Role: `radiogroup` on container\n- Each segment: `role=\"radio\"`, `aria-checked`\n- Keyboard: Arrow keys navigate, Enter/Space select\n- Focus management: Roving tabindex pattern\n\n### Files to Create\n1. `SegmentedControl.tsx` - Main component\n2. `SegmentedControl.css.ts` - vanilla-extract styles\n3. `index.ts` - Barrel export\n4. `SegmentedControl.test.tsx` - Unit tests\n\n### Test Cases\n- Renders all options\n- Correct option selected on mount\n- onChange called with correct value on click\n- Keyboard navigation (arrow keys)\n- Disabled state (entire control and individual options)\n- Accessibility attributes present\n\n## Implementation Reference\nSimilar components for reference:\n- Radix UI ToggleGroup: https://www.radix-ui.com/primitives/docs/components/toggle-group\n- Headless UI RadioGroup: https://headlessui.com/react/radio-group\n\n## Parallel Safe\nYes - no dependencies on other tasks. Can be built independently.\n\n## Files\n- packages/design-system/src/primitives/SegmentedControl/SegmentedControl.tsx\n- packages/design-system/src/primitives/SegmentedControl/SegmentedControl.css.ts\n- packages/design-system/src/primitives/SegmentedControl/index.ts\n- packages/design-system/src/primitives/SegmentedControl/SegmentedControl.test.tsx\n- packages/design-system/src/index.ts (add export)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T14:56:09.88867-06:00","updated_at":"2025-12-23T19:16:17.084862-06:00","closed_at":"2025-12-23T19:16:17.084862-06:00","dependencies":[{"issue_id":"scribe-roo.1","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:09.889037-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.10","title":"Implement theme setting with SegmentedControl","description":"# Implement Theme Setting with SegmentedControl\n\n## What\nBuild the theme setting UI using the new SegmentedControl component, integrating with the existing useTheme hook.\n\n## Why\n- **Core Settings Feature**: Theme switching is one of the most commonly used settings\n- **Demonstrates SegmentedControl**: First real usage of the new primitive\n- **Leverages Existing Infrastructure**: useTheme hook already handles persistence and system preference detection\n\n## Technical Approach\n\n### Component Implementation\n```tsx\n// ThemeSetting.tsx (or inline in GeneralSettings.tsx)\nimport { SegmentedControl } from '@scribe/design-system';\nimport { useTheme } from '@scribe/design-system';\n\nexport function ThemeSetting() {\n  const { theme, setTheme } = useTheme();\n  \n  const options = [\n    { value: 'dark', label: 'Dark' },\n    { value: 'light', label: 'Light' },\n    { value: 'system', label: 'System' },\n  ];\n  \n  return (\n    \u003cSegmentedControl\n      options={options}\n      value={theme}\n      onChange={setTheme}\n      aria-label=\"Theme preference\"\n    /\u003e\n  );\n}\n```\n\n### Integration with GeneralSettings\n```tsx\n// In GeneralSettings.tsx\n\u003cSettingsGroup title=\"Theme\"\u003e\n  \u003cThemeSetting /\u003e\n\u003c/SettingsGroup\u003e\n```\n\n### Behavior\n- **Immediate Apply**: Theme changes instantly when user clicks a segment\n- **Persistence**: useTheme hook already persists to config.json via ThemeStorage adapter\n- **System Detection**: \"System\" option follows OS dark/light preference via media query\n\n### Existing Infrastructure (No Changes Needed)\nThe useTheme hook already provides:\n```typescript\ninterface ThemeContextValue {\n  theme: Theme;                        // User's preference ('dark' | 'light' | 'system')\n  resolvedTheme: 'light' | 'dark';     // Actual applied theme\n  setTheme: (theme: Theme) =\u003e void;    // Persists and applies\n}\n```\n\nThe ThemeProvider already:\n- Loads from config.json on mount\n- Saves to config.json on change\n- Listens to `prefers-color-scheme: dark` media query\n- Applies theme class to document.documentElement\n\n### UX Considerations\n- **Visual Feedback**: Active segment should clearly stand out\n- **System Label**: Consider showing \"(Dark)\" or \"(Light)\" next to \"System\" to indicate resolved value\n- **No Confirmation**: Changes apply immediately, no save button needed\n\n### Enhanced: Show Resolved Theme for System\n```tsx\nexport function ThemeSetting() {\n  const { theme, resolvedTheme, setTheme } = useTheme();\n  \n  const options = [\n    { value: 'dark', label: 'Dark' },\n    { value: 'light', label: 'Light' },\n    { \n      value: 'system', \n      label: theme === 'system' \n        ? `System (${resolvedTheme === 'dark' ? 'Dark' : 'Light'})` \n        : 'System' \n    },\n  ];\n  \n  return (\n    \u003cSegmentedControl\n      options={options}\n      value={theme}\n      onChange={setTheme}\n      aria-label=\"Theme preference\"\n    /\u003e\n  );\n}\n```\n\n## BLOCKED BY\n- scribe-roo.1 (SegmentedControl primitive) - Need the component\n- scribe-roo.8 (GeneralSettings structure) - Need the container\n\n## Files\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.tsx (add ThemeSetting)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.513271-06:00","updated_at":"2025-12-23T14:58:35.723108-06:00","dependencies":[{"issue_id":"scribe-roo.10","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.514023-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.10","depends_on_id":"scribe-roo.1","type":"blocks","created_at":"2025-12-23T15:01:07.392049-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.10","depends_on_id":"scribe-roo.8","type":"blocks","created_at":"2025-12-23T15:01:07.443377-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.11","title":"Implement version display and update checking UI","description":"# Implement Version Display and Update Checking UI\n\n## What\nBuild the version and update checking section in GeneralSettings, showing current version and providing update management.\n\n## Why\n- **User Visibility**: Users should know what version they're running\n- **Update Management**: Centralized place for checking and installing updates\n- **Leverages Existing Hook**: useUpdateStatus already tracks all update states\n\n## Technical Approach\n\n### Component Implementation\n```tsx\n// VersionSetting.tsx\nimport { Button, Text } from '@scribe/design-system';\nimport { useUpdateStatus } from '../../../hooks/useUpdateStatus';\n\nexport function VersionSetting() {\n  const { status, version, error, installUpdate } = useUpdateStatus();\n  \n  const checkForUpdates = () =\u003e {\n    window.scribe.update.check();\n  };\n  \n  return (\n    \u003cdiv className={styles.versionSetting}\u003e\n      \u003cText variant=\"body\"\u003ev{__APP_VERSION__}\u003c/Text\u003e\n      \n      \u003cdiv className={styles.updateControls}\u003e\n        {renderUpdateButton()}\n        {renderStatusMessage()}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n  \n  function renderUpdateButton() {\n    switch (status) {\n      case 'idle':\n        return \u003cButton onClick={checkForUpdates}\u003eCheck for Updates\u003c/Button\u003e;\n      case 'checking':\n        return \u003cButton disabled\u003eChecking...\u003c/Button\u003e;\n      case 'downloading':\n        return \u003cButton disabled\u003eDownloading...\u003c/Button\u003e;\n      case 'ready':\n        return \u003cButton onClick={installUpdate}\u003eRestart to Update\u003c/Button\u003e;\n      case 'error':\n        return \u003cButton onClick={checkForUpdates}\u003eRetry Check\u003c/Button\u003e;\n    }\n  }\n  \n  function renderStatusMessage() {\n    switch (status) {\n      case 'ready':\n        return \u003cText variant=\"body\" color=\"success\"\u003eUpdate ready: v{version}\u003c/Text\u003e;\n      case 'error':\n        return \u003cText variant=\"body\" color=\"danger\"\u003e{error}\u003c/Text\u003e;\n      default:\n        return null;\n    }\n  }\n}\n```\n\n### State Machine (from useUpdateStatus)\n```\nidle -\u003e checking -\u003e downloading -\u003e ready\n  |        |            |           |\n  v        v            v           v\nerror   (idle)       (idle)     (restart)\n```\n\n### Update Flow\n1. **Idle**: Show \"Check for Updates\" button\n2. **Checking**: Show \"Checking...\" (disabled)\n3. **Downloading**: Show \"Downloading...\" (disabled)\n4. **Ready**: Show \"Restart to Update\" (enabled, calls installUpdate)\n5. **Error**: Show error message, \"Retry Check\" button\n\n### After \"No Update Available\"\nThe useUpdateStatus hook returns to 'idle' when no update is found. We could enhance to show a brief \"You're up to date\" message:\n```tsx\nconst [lastCheckResult, setLastCheckResult] = useState\u003c'none' | 'up-to-date' | null\u003e(null);\n\n// After checking completes with no update\nuseEffect(() =\u003e {\n  if (status === 'idle' \u0026\u0026 lastStatus === 'checking') {\n    setLastCheckResult('up-to-date');\n    setTimeout(() =\u003e setLastCheckResult(null), 3000);\n  }\n}, [status]);\n```\n\n### Toast on Download Complete\nThe spec mentions showing the existing toast notification when download completes. This already happens via UpdateToast component in App.tsx. No changes needed.\n\n### Styling\n```typescript\n// Add to GeneralSettings.css.ts\nexport const versionSetting = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing[2],\n});\n\nexport const updateControls = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing[3],\n});\n```\n\n## BLOCKED BY\n- scribe-roo.8 (GeneralSettings structure) - Need the container\n\n## Files\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.tsx (add VersionSetting)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.581522-06:00","updated_at":"2025-12-23T14:58:50.1796-06:00","dependencies":[{"issue_id":"scribe-roo.11","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.582402-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.11","depends_on_id":"scribe-roo.8","type":"blocks","created_at":"2025-12-23T15:01:07.491226-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.12","title":"Create useVaultPath hook for vault state management","description":"# Create useVaultPath Hook for Vault State Management\n\n## What\nCreate a custom hook that manages vault path state: fetching current path, tracking loading/error states, and providing methods to change vaults.\n\n## Why\n- **Centralized Vault State**: Keep vault-related state and logic in one place\n- **Loading States**: Handle async vault operations gracefully\n- **Error Handling**: Manage validation errors from vault switching\n- **Reusability**: Can be used in GeneralSettings and potentially elsewhere\n\n## Technical Approach\n\n### Hook API\n```typescript\n// useVaultPath.ts\nexport interface UseVaultPathReturn {\n  // Current vault state\n  path: string | null;\n  isLoading: boolean;\n  error: string | null;\n  \n  // Actions\n  refresh: () =\u003e Promise\u003cvoid\u003e;\n  setVaultPath: (newPath: string) =\u003e Promise\u003cVaultSwitchResult\u003e;\n  createVault: (newPath: string) =\u003e Promise\u003cVaultCreateResult\u003e;\n  validatePath: (path: string) =\u003e Promise\u003cVaultValidationResult\u003e;\n  \n  // Derived state\n  isValid: boolean;\n}\n\nexport function useVaultPath(): UseVaultPathReturn {\n  const [path, setPath] = useState\u003cstring | null\u003e(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  // Fetch current vault path on mount\n  useEffect(() =\u003e {\n    refresh();\n  }, []);\n  \n  const refresh = useCallback(async () =\u003e {\n    setIsLoading(true);\n    setError(null);\n    try {\n      const currentPath = await window.scribe.vault.getPath();\n      setPath(currentPath);\n    } catch (err) {\n      setError('Failed to load vault path');\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n  \n  const setVaultPath = useCallback(async (newPath: string) =\u003e {\n    setIsLoading(true);\n    setError(null);\n    try {\n      const result = await window.scribe.vault.setPath(newPath);\n      if (result.success) {\n        setPath(result.path);\n      } else {\n        setError(result.error || 'Failed to switch vault');\n      }\n      return result;\n    } catch (err) {\n      const errorMsg = 'Failed to switch vault';\n      setError(errorMsg);\n      return { success: false, path: newPath, error: errorMsg };\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n  \n  const createVault = useCallback(async (newPath: string) =\u003e {\n    setIsLoading(true);\n    setError(null);\n    try {\n      const result = await window.scribe.vault.create(newPath);\n      if (result.success) {\n        setPath(result.path);\n      } else {\n        setError(result.error || 'Failed to create vault');\n      }\n      return result;\n    } catch (err) {\n      const errorMsg = 'Failed to create vault';\n      setError(errorMsg);\n      return { success: false, path: newPath, error: errorMsg };\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n  \n  const validatePath = useCallback(async (pathToValidate: string) =\u003e {\n    try {\n      return await window.scribe.vault.validate(pathToValidate);\n    } catch {\n      return { valid: false, missingDirs: ['unknown'] };\n    }\n  }, []);\n  \n  return {\n    path,\n    isLoading,\n    error,\n    refresh,\n    setVaultPath,\n    createVault,\n    validatePath,\n    isValid: path !== null \u0026\u0026 !error,\n  };\n}\n```\n\n### Usage in GeneralSettings\n```tsx\nfunction VaultLocationSetting() {\n  const { path, isLoading, error, setVaultPath, createVault } = useVaultPath();\n  \n  if (isLoading \u0026\u0026 !path) {\n    return \u003cText variant=\"body\" color=\"muted\"\u003eLoading...\u003c/Text\u003e;\n  }\n  \n  return (\n    \u003cdiv\u003e\n      \u003cText variant=\"code\"\u003e{path}\u003c/Text\u003e\n      {error \u0026\u0026 \u003cText variant=\"body\" color=\"danger\"\u003e{error}\u003c/Text\u003e}\n      \u003cdiv className={styles.vaultButtons}\u003e\n        \u003cButton onClick={handleChange}\u003eChange\u003c/Button\u003e\n        \u003cButton onClick={handleCreateNew}\u003eCreate New\u003c/Button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Error States\nThe hook tracks:\n- **Load errors**: Failed to fetch current path\n- **Switch errors**: Invalid vault, permission denied\n- **Create errors**: Path exists, permission denied\n\n## BLOCKED BY\n- scribe-roo.3 (Vault IPC handlers) - Need window.scribe.vault API\n\n## UNBLOCKS\n- scribe-roo.13 (Vault path display)\n- scribe-roo.15 (Vault switching UI)\n- scribe-roo.16 (Create new vault)\n\n## Files\n- apps/desktop/renderer/src/hooks/useVaultPath.ts (NEW)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.649771-06:00","updated_at":"2025-12-23T15:07:42.785943-06:00","closed_at":"2025-12-23T15:07:42.785943-06:00","dependencies":[{"issue_id":"scribe-roo.12","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.650357-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.12","depends_on_id":"scribe-roo.3","type":"blocks","created_at":"2025-12-23T15:01:07.536607-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.13","title":"Implement vault path display (read-only)","description":"# Implement Vault Path Display (Read-Only)\n\n## What\nDisplay the current vault path in GeneralSettings. This is the first step before implementing full vault switching.\n\n## Why\n- **User Visibility**: Users should know where their notes are stored\n- **Incremental Delivery**: Ship read-only display before full switching capability\n- **Foundation**: UI structure needed for vault management buttons\n\n## Technical Approach\n\n### Component Implementation\n```tsx\n// VaultLocationSetting.tsx\nimport { Text, Button } from '@scribe/design-system';\nimport { useVaultPath } from '../../../hooks/useVaultPath';\n\nexport function VaultLocationSetting() {\n  const { path, isLoading, error } = useVaultPath();\n  \n  if (isLoading) {\n    return (\n      \u003cdiv className={styles.vaultLocation}\u003e\n        \u003cText variant=\"body\" color=\"muted\"\u003eLoading vault path...\u003c/Text\u003e\n      \u003c/div\u003e\n    );\n  }\n  \n  if (error) {\n    return (\n      \u003cdiv className={styles.vaultLocation}\u003e\n        \u003cText variant=\"body\" color=\"danger\"\u003e{error}\u003c/Text\u003e\n      \u003c/div\u003e\n    );\n  }\n  \n  return (\n    \u003cdiv className={styles.vaultLocation}\u003e\n      \u003cText variant=\"code\" className={styles.vaultPath}\u003e\n        {path}\n      \u003c/Text\u003e\n      \n      \u003cdiv className={styles.vaultActions}\u003e\n        \u003cButton variant=\"secondary\" disabled\u003e\n          Change\n        \u003c/Button\u003e\n        \u003cButton variant=\"secondary\" disabled\u003e\n          Create New\n        \u003c/Button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Path Display Styling\n```typescript\n// Add to GeneralSettings.css.ts\nexport const vaultLocation = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing[3],\n});\n\nexport const vaultPath = style({\n  fontFamily: 'var(--font-mono)',\n  backgroundColor: vars.color.backgroundAlt,\n  padding: `${vars.spacing[2]} ${vars.spacing[3]}`,\n  borderRadius: vars.radius.sm,\n  wordBreak: 'break-all',  // Handle long paths\n});\n\nexport const vaultActions = style({\n  display: 'flex',\n  gap: vars.spacing[2],\n});\n```\n\n### Initial State (Buttons Disabled)\nFor this task, buttons are disabled placeholders. They'll be enabled in subsequent tasks:\n- **Change**: Enabled in scribe-roo.15\n- **Create New**: Enabled in scribe-roo.16\n\n### Path Truncation (Optional)\nFor very long paths, consider truncating with ellipsis in the middle:\n```typescript\nfunction truncatePath(path: string, maxLength = 50): string {\n  if (path.length \u003c= maxLength) return path;\n  \n  const start = path.slice(0, 20);\n  const end = path.slice(-25);\n  return `${start}...${end}`;\n}\n```\n\nOr use CSS text-overflow with a title attribute for full path on hover.\n\n### Accessibility\n- Path should be selectable for copy/paste\n- Consider adding a \"Copy path\" button for convenience\n\n## BLOCKED BY\n- scribe-roo.8 (GeneralSettings structure) - Need the container\n- scribe-roo.12 (useVaultPath hook) - Need the data hook\n\n## UNBLOCKS\n- scribe-roo.15 (Vault switching UI)\n\n## Files\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.tsx (add VaultLocationSetting)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.718636-06:00","updated_at":"2025-12-23T14:59:15.925955-06:00","dependencies":[{"issue_id":"scribe-roo.13","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.719083-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.13","depends_on_id":"scribe-roo.8","type":"blocks","created_at":"2025-12-23T15:01:07.583518-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.13","depends_on_id":"scribe-roo.3","type":"blocks","created_at":"2025-12-23T15:11:22.986261-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.14","title":"Implement vault switching backend (restart-based MVP)","description":"# Implement Vault Switching (Restart Required - MVP)\n\n## What\nImplement vault switching that requires an app restart. This is the **safe MVP approach** - full hot-reload is a stretch goal in a separate task.\n\n## Why\n- **Lower Risk**: App restart is a known-safe state transition\n- **Simpler Implementation**: No engine cleanup/re-initialization logic needed\n- **User Acceptable**: Most settings changes in desktop apps require restart\n- **Foundation**: Config persistence is needed for hot-reload anyway\n\n## Technical Approach\n\n### Implementation (Simple)\n```typescript\n// In vaultHandlers.ts\nipcMain.handle(IPC_CHANNELS.VAULT_SET_PATH, async (_, newPath: string) =\u003e {\n  // 1. Validate the new path is a valid vault\n  const isValid = await isValidVault(newPath);\n  if (!isValid) {\n    return { \n      success: false, \n      path: newPath, \n      error: 'Not a valid Scribe vault. Missing required folders.' \n    };\n  }\n  \n  // 2. Save new path to config\n  const config = await loadConfig();\n  await saveConfig({ ...config, vaultPath: newPath });\n  \n  // 3. Return success with restart required flag\n  return { \n    success: true, \n    path: newPath, \n    requiresRestart: true \n  };\n});\n```\n\n### UI Flow\n1. User selects new vault via folder picker\n2. System validates it's a valid vault\n3. If valid: Save path to config, show \"Restart Required\" dialog\n4. User clicks \"Restart Now\" → app.relaunch() + app.exit()\n5. On restart, app loads with new vault path from config\n\n### Config Integration\n```typescript\n// AppConfig extension\ninterface AppConfig {\n  lastOpenedNoteId?: string;\n  theme?: 'light' | 'dark' | 'system';\n  vaultPath?: string;  // NEW\n}\n```\n\n### Restart Dialog\n```tsx\n// In GeneralSettings after successful vault switch\n\u003cDialog\u003e\n  \u003cDialogTitle\u003eRestart Required\u003c/DialogTitle\u003e\n  \u003cDialogContent\u003e\n    Scribe needs to restart to switch to the new vault.\n  \u003c/DialogContent\u003e\n  \u003cDialogActions\u003e\n    \u003cButton onClick={handleRestartLater}\u003eLater\u003c/Button\u003e\n    \u003cButton onClick={handleRestartNow} variant=\"primary\"\u003eRestart Now\u003c/Button\u003e\n  \u003c/DialogActions\u003e\n\u003c/Dialog\u003e\n```\n\n### Main Process: Load Vault from Config\n```typescript\n// In main.ts initialization\nconst config = await loadConfig();\nconst vaultPath = config.vaultPath || getDefaultVaultPath();\nconst vault = new FileSystemVault(createVaultPath(vaultPath));\n```\n\n## Scope\n- Vault path validation ✓\n- Config persistence ✓\n- Restart dialog UI ✓\n- app.relaunch() integration ✓\n- **NOT in scope**: Engine hot-reload (separate stretch goal task)\n\n## Files\n- apps/desktop/electron/main/src/handlers/vaultHandlers.ts\n- apps/desktop/electron/main/src/main.ts (load vault from config)\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.tsx (restart dialog)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-23T14:56:10.788654-06:00","updated_at":"2025-12-23T15:09:13.627694-06:00","dependencies":[{"issue_id":"scribe-roo.14","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.789417-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.14","depends_on_id":"scribe-roo.3","type":"blocks","created_at":"2025-12-23T15:01:15.912593-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.14","depends_on_id":"scribe-roo.21","type":"blocks","created_at":"2025-12-23T15:11:41.398372-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.15","title":"Implement vault switching UI with validation","description":"# Implement Vault Switching UI with Validation\n\n## What\nEnable the \"Change\" button in vault settings, allowing users to select and switch to a different vault folder. Uses the restart-based approach (not hot-reload).\n\n## Why\n- **Primary Vault Management Feature**: Users need to switch between vaults\n- **Validation Feedback**: Clear errors when selected folder isn't a valid vault\n- **Complete User Flow**: From folder selection to restart prompt\n\n## Technical Approach\n\n### UI Flow (Restart-Based)\n1. User clicks \"Change\" button\n2. Native folder picker opens (via dialog:selectFolder)\n3. User selects a folder\n4. System validates the folder is a valid vault\n5. If invalid: Show inline error message\n6. If valid: Save to config, show restart dialog\n7. User clicks \"Restart Now\" or \"Later\"\n\n### Component Implementation\n```tsx\nfunction VaultLocationSetting() {\n  const [currentPath, setCurrentPath] = useState\u003cstring | null\u003e(null);\n  const [validationError, setValidationError] = useState\u003cstring | null\u003e(null);\n  const [showRestartDialog, setShowRestartDialog] = useState(false);\n  \n  // Load current vault path on mount\n  useEffect(() =\u003e {\n    window.scribe.vault.getPath().then(setCurrentPath);\n  }, []);\n  \n  const handleChangeVault = async () =\u003e {\n    setValidationError(null);\n    \n    // 1. Open folder picker\n    const selectedPath = await window.scribe.dialog.selectFolder({\n      title: 'Select Scribe Vault',\n      defaultPath: currentPath || undefined,\n    });\n    \n    if (!selectedPath) return; // User cancelled\n    \n    // 2. Validate and set path (handler does validation)\n    const result = await window.scribe.vault.setPath(selectedPath);\n    \n    if (!result.success) {\n      setValidationError(result.error || 'Failed to switch vault');\n      return;\n    }\n    \n    // 3. Show restart dialog\n    if (result.requiresRestart) {\n      setShowRestartDialog(true);\n    }\n  };\n  \n  return (\n    \u003cdiv\u003e\n      \u003cText variant=\"code\"\u003e{currentPath}\u003c/Text\u003e\n      {validationError \u0026\u0026 \u003cText color=\"danger\"\u003e{validationError}\u003c/Text\u003e}\n      \u003cButton onClick={handleChangeVault}\u003eChange\u003c/Button\u003e\n      \n      {showRestartDialog \u0026\u0026 (\n        \u003cRestartDialog \n          onRestartNow={() =\u003e window.scribe.app.relaunch()}\n          onLater={() =\u003e setShowRestartDialog(false)}\n        /\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n### Restart Dialog\n```tsx\nfunction RestartDialog({ onRestartNow, onLater }) {\n  return (\n    \u003cOverlay open onClose={onLater}\u003e\n      \u003cSurface\u003e\n        \u003cText variant=\"heading3\"\u003eRestart Required\u003c/Text\u003e\n        \u003cText\u003eScribe needs to restart to use the new vault.\u003c/Text\u003e\n        \u003cdiv\u003e\n          \u003cButton variant=\"secondary\" onClick={onLater}\u003eLater\u003c/Button\u003e\n          \u003cButton variant=\"primary\" onClick={onRestartNow}\u003eRestart Now\u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/Surface\u003e\n    \u003c/Overlay\u003e\n  );\n}\n```\n\n### Error Messages (per spec)\n- Invalid vault: \"Not a valid Scribe vault. Missing required folders.\"\n\n## Dependencies\n- scribe-roo.2 (Folder picker IPC) - Need dialog:selectFolder\n- scribe-roo.3 (Vault IPC handlers) - Need vault:setPath, vault:validate  \n- scribe-roo.13 (Vault display) - Need existing UI structure\n- scribe-roo.14 (Vault switching backend) - Need restart-based switching logic\n\nNote: Does NOT require hot-reload (scribe-roo.19). Restart is acceptable for MVP.\n\n## Files\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.tsx","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.857309-06:00","updated_at":"2025-12-23T15:07:31.083292-06:00","dependencies":[{"issue_id":"scribe-roo.15","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.857995-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.15","depends_on_id":"scribe-roo.2","type":"blocks","created_at":"2025-12-23T15:01:15.962011-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.15","depends_on_id":"scribe-roo.3","type":"blocks","created_at":"2025-12-23T15:01:16.006785-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.15","depends_on_id":"scribe-roo.13","type":"blocks","created_at":"2025-12-23T15:01:16.096382-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.15","depends_on_id":"scribe-roo.14","type":"blocks","created_at":"2025-12-23T15:01:16.14141-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.15","depends_on_id":"scribe-roo.21","type":"blocks","created_at":"2025-12-23T15:11:41.44607-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.16","title":"Implement create new vault functionality","description":"# Implement Create New Vault Functionality\n\n## What\nEnable the \"Create New\" button to create a fresh vault at a user-selected location, then prompt for restart.\n\n## Why\n- **New User Onboarding**: First-time users need to create their initial vault\n- **Multiple Vaults**: Power users may want separate vaults for different purposes\n\n## Technical Approach\n\n### UI Flow (Restart-Based)\n1. User clicks \"Create New\" button\n2. Native folder picker opens\n3. User selects a location\n4. System calls vault:create to initialize vault structure\n5. If success: Show restart dialog\n6. On restart: App loads with new vault\n\n### Component Implementation\n```tsx\nconst handleCreateVault = async () =\u003e {\n  const selectedPath = await window.scribe.dialog.selectFolder({\n    title: 'Choose Location for New Vault',\n  });\n  \n  if (!selectedPath) return;\n  \n  const result = await window.scribe.vault.create(selectedPath);\n  \n  if (!result.success) {\n    setCreationError(result.error);\n    return;\n  }\n  \n  // Show restart dialog (vault:create sets config)\n  setShowRestartDialog(true);\n};\n```\n\n### Backend Handler\n```typescript\nipcMain.handle(IPC_CHANNELS.VAULT_CREATE, async (_, path: string) =\u003e {\n  // Check if vault already exists\n  const exists = await isValidVault(path);\n  if (exists) {\n    return { success: false, error: 'A vault already exists here' };\n  }\n  \n  // Create vault structure\n  await initializeVault(createVaultPath(path));\n  \n  // Save to config for restart\n  await saveConfig({ ...config, vaultPath: path });\n  \n  return { success: true, path, requiresRestart: true };\n});\n```\n\n### Vault Structure Created\n```\nselected-path/\n├── notes/\n└── quarantine/\n```\n\n## Dependencies\n- scribe-roo.2 (Folder picker)\n- scribe-roo.3 (Vault IPC)\n- scribe-roo.14 (Vault switching backend - for config persistence)\n- scribe-roo.15 (Vault switching UI - for restart dialog pattern)\n\n## Files\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.tsx\n- apps/desktop/electron/main/src/handlers/vaultHandlers.ts","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.927967-06:00","updated_at":"2025-12-23T15:08:06.746601-06:00","dependencies":[{"issue_id":"scribe-roo.16","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.92858-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.16","depends_on_id":"scribe-roo.2","type":"blocks","created_at":"2025-12-23T15:01:23.608534-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.16","depends_on_id":"scribe-roo.3","type":"blocks","created_at":"2025-12-23T15:01:23.660811-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.16","depends_on_id":"scribe-roo.14","type":"blocks","created_at":"2025-12-23T15:01:23.757372-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.16","depends_on_id":"scribe-roo.15","type":"blocks","created_at":"2025-12-23T15:01:23.804487-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.17","title":"Add integration tests for Settings page","description":"# Add Integration Tests for Settings Page\n\n## What\nCreate comprehensive integration tests for the Settings page functionality.\n\n## Why\n- **Confidence**: Ensure settings page works end-to-end\n- **Regression Prevention**: Catch breaking changes in future updates\n- **Documentation**: Tests serve as living documentation of expected behavior\n\n## Technical Approach\n\n### Test Structure\n```typescript\n// settings.integration.test.ts\ndescribe('Settings Page', () =\u003e {\n  describe('Opening/Closing', () =\u003e {\n    it('opens settings when gear icon is clicked');\n    it('closes settings when X button is clicked');\n    it('closes settings when Escape key is pressed');\n    it('opens with General section selected by default');\n  });\n  \n  describe('Section Navigation', () =\u003e {\n    it('switches to Changelog section when clicked');\n    it('switches back to General section when clicked');\n    it('maintains section selection while open');\n  });\n  \n  describe('Theme Setting', () =\u003e {\n    it('displays current theme selection');\n    it('changes theme to Dark when Dark segment clicked');\n    it('changes theme to Light when Light segment clicked');\n    it('changes theme to System when System segment clicked');\n    it('persists theme selection after closing settings');\n  });\n  \n  describe('Version Setting', () =\u003e {\n    it('displays current app version');\n    it('shows Check for Updates button in idle state');\n    it('shows Checking... when update check in progress');\n    it('shows Restart to Update when update ready');\n  });\n  \n  describe('Vault Location', () =\u003e {\n    it('displays current vault path');\n    it('opens folder picker when Change button clicked');\n    it('shows error for invalid vault selection');\n    it('switches vault when valid vault selected');\n    it('creates new vault when Create New selected');\n  });\n});\n```\n\n### Test Setup\n```typescript\n// Test setup with mock vault\nbeforeEach(async () =\u003e {\n  testContext = await setupTestContext();\n  // Create test vaults for switching tests\n  testVault1 = await createTestVault('vault-1');\n  testVault2 = await createTestVault('vault-2');\n});\n\nafterEach(async () =\u003e {\n  await cleanupTestContext(testContext);\n  await cleanupTestVault(testVault1);\n  await cleanupTestVault(testVault2);\n});\n```\n\n### Key Test Scenarios\n\n#### Theme Switching\n```typescript\nit('changes theme to Dark when Dark segment clicked', async () =\u003e {\n  // Open settings\n  await clickGearIcon();\n  \n  // Click Dark segment\n  const darkSegment = screen.getByRole('radio', { name: /dark/i });\n  await userEvent.click(darkSegment);\n  \n  // Verify theme changed\n  expect(document.documentElement.classList.contains('darkTheme')).toBe(true);\n  \n  // Verify persisted to config\n  const config = await window.scribe.app.getConfig();\n  expect(config.theme).toBe('dark');\n});\n```\n\n#### Vault Switching\n```typescript\nit('switches vault when valid vault selected', async () =\u003e {\n  // Mock folder picker to return testVault2 path\n  vi.spyOn(window.scribe.dialog, 'selectFolder').mockResolvedValue(testVault2.path);\n  \n  // Open settings and click Change\n  await clickGearIcon();\n  await userEvent.click(screen.getByText('Change'));\n  \n  // Wait for switch to complete\n  await waitFor(() =\u003e {\n    expect(screen.getByText(testVault2.path)).toBeInTheDocument();\n  });\n  \n  // Verify note list refreshed\n  const notes = await window.scribe.notes.list();\n  expect(notes).toEqual(testVault2.expectedNotes);\n});\n```\n\n#### Invalid Vault Error\n```typescript\nit('shows error for invalid vault selection', async () =\u003e {\n  // Mock folder picker to return invalid path\n  const invalidPath = '/tmp/not-a-vault';\n  vi.spyOn(window.scribe.dialog, 'selectFolder').mockResolvedValue(invalidPath);\n  \n  // Open settings and click Change\n  await clickGearIcon();\n  await userEvent.click(screen.getByText('Change'));\n  \n  // Verify error shown\n  expect(screen.getByText(/not a valid scribe vault/i)).toBeInTheDocument();\n  \n  // Verify vault path unchanged\n  expect(screen.getByText(testVault1.path)).toBeInTheDocument();\n});\n```\n\n### Test Coverage Goals\n- All happy paths for settings interactions\n- Error states for vault operations\n- Keyboard navigation (Escape to close)\n- State persistence (theme, vault path)\n- UI state management (loading, disabled buttons)\n\n## BLOCKED BY\n- scribe-roo.7 (App.tsx integration) - Need complete Settings page\n- scribe-roo.15 (Vault switching UI) - Need vault switching implemented\n- scribe-roo.16 (Create new vault) - Need vault creation implemented\n\n## Files\n- apps/desktop/settings.integration.test.ts (NEW)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.99816-06:00","updated_at":"2025-12-23T15:00:35.120616-06:00","dependencies":[{"issue_id":"scribe-roo.17","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.99919-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.17","depends_on_id":"scribe-roo.7","type":"blocks","created_at":"2025-12-23T15:01:31.588742-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.17","depends_on_id":"scribe-roo.15","type":"blocks","created_at":"2025-12-23T15:01:31.63723-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.17","depends_on_id":"scribe-roo.16","type":"blocks","created_at":"2025-12-23T15:01:31.684028-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.18","title":"Add unit tests for vault IPC handlers","description":"# Add Unit Tests for Vault IPC Handlers\n\n## What\nCreate unit tests for the vault IPC handlers (vault:getPath, vault:setPath, vault:create, vault:validate).\n\n## Why\n- **Isolated Testing**: Test main process logic without full app\n- **Error Scenarios**: Easy to simulate error conditions\n- **Fast Feedback**: Unit tests run much faster than integration tests\n\n## Technical Approach\n\n### Test Structure\n```typescript\n// vaultHandlers.test.ts\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { registerVaultHandlers } from './vaultHandlers';\nimport * as vaultModule from '@scribe/storage-fs';\n\n// Mock ipcMain\nconst mockIpcMain = {\n  handle: vi.fn(),\n};\n\ndescribe('Vault Handlers', () =\u003e {\n  beforeEach(() =\u003e {\n    vi.clearAllMocks();\n  });\n  \n  describe('vault:getPath', () =\u003e {\n    it('returns current vault path from config');\n    it('returns default path if none configured');\n  });\n  \n  describe('vault:validate', () =\u003e {\n    it('returns valid:true for valid vault');\n    it('returns valid:false with missing dirs for invalid vault');\n    it('handles non-existent path gracefully');\n  });\n  \n  describe('vault:setPath', () =\u003e {\n    it('validates path before saving');\n    it('returns error for invalid vault');\n    it('saves new path to config on success');\n    it('returns requiresRestart: true on success');\n  });\n  \n  describe('vault:create', () =\u003e {\n    it('returns error if vault already exists');\n    it('calls initializeVault for new path');\n    it('saves path to config after creation');\n    it('returns requiresRestart: true on success');\n    it('returns error if creation fails');\n    it('handles permission denied gracefully');\n  });\n});\n```\n\n### Mock Setup\n```typescript\nconst mockConfig = {\n  vaultPath: '/mock/vault',\n};\n\n// Mock storage-fs module\nvi.mock('@scribe/storage-fs', () =\u003e ({\n  isValidVault: vi.fn(),\n  initializeVault: vi.fn(),\n  createVaultPath: vi.fn((p) =\u003e p),\n}));\n\n// Mock config module\nvi.mock('./config', () =\u003e ({\n  loadConfig: vi.fn(() =\u003e mockConfig),\n  saveConfig: vi.fn(),\n}));\n```\n\n### Key Test Cases\n\n#### vault:validate\n```typescript\nit('returns valid:false with missing dirs for invalid vault', async () =\u003e {\n  vi.mocked(vaultModule.isValidVault).mockResolvedValue(false);\n  \n  const handler = getRegisteredHandler('vault:validate');\n  const result = await handler({}, '/some/path');\n  \n  expect(result).toEqual({\n    valid: false,\n    missingDirs: ['notes', 'quarantine'],\n  });\n});\n```\n\n#### vault:setPath (MVP - restart-based)\n```typescript\nit('saves new path to config and returns requiresRestart', async () =\u003e {\n  vi.mocked(vaultModule.isValidVault).mockResolvedValue(true);\n  \n  const handler = getRegisteredHandler('vault:setPath');\n  const result = await handler({}, '/new/path');\n  \n  expect(saveConfig).toHaveBeenCalledWith(\n    expect.objectContaining({ vaultPath: '/new/path' })\n  );\n  expect(result).toEqual({ \n    success: true, \n    path: '/new/path',\n    requiresRestart: true \n  });\n});\n\nit('returns error for invalid vault without saving', async () =\u003e {\n  vi.mocked(vaultModule.isValidVault).mockResolvedValue(false);\n  \n  const handler = getRegisteredHandler('vault:setPath');\n  const result = await handler({}, '/invalid/path');\n  \n  expect(saveConfig).not.toHaveBeenCalled();\n  expect(result).toEqual({\n    success: false,\n    path: '/invalid/path',\n    error: 'Not a valid Scribe vault. Missing required folders.',\n  });\n});\n```\n\n#### vault:create\n```typescript\nit('returns error if vault already exists', async () =\u003e {\n  vi.mocked(vaultModule.isValidVault).mockResolvedValue(true);\n  \n  const handler = getRegisteredHandler('vault:create');\n  const result = await handler({}, '/existing/vault');\n  \n  expect(vaultModule.initializeVault).not.toHaveBeenCalled();\n  expect(result).toEqual({\n    success: false,\n    path: '/existing/vault',\n    error: 'A vault already exists at this location',\n  });\n});\n\nit('creates vault, saves config, and returns requiresRestart', async () =\u003e {\n  vi.mocked(vaultModule.isValidVault).mockResolvedValue(false);\n  vi.mocked(vaultModule.initializeVault).mockResolvedValue(undefined);\n  \n  const handler = getRegisteredHandler('vault:create');\n  const result = await handler({}, '/new/vault');\n  \n  expect(vaultModule.initializeVault).toHaveBeenCalledWith('/new/vault');\n  expect(saveConfig).toHaveBeenCalledWith(\n    expect.objectContaining({ vaultPath: '/new/vault' })\n  );\n  expect(result).toEqual({\n    success: true,\n    path: '/new/vault',\n    requiresRestart: true,\n  });\n});\n\nit('handles permission denied gracefully', async () =\u003e {\n  vi.mocked(vaultModule.isValidVault).mockResolvedValue(false);\n  vi.mocked(vaultModule.initializeVault).mockRejectedValue(\n    new Error('EACCES: permission denied')\n  );\n  \n  const handler = getRegisteredHandler('vault:create');\n  const result = await handler({}, '/protected/path');\n  \n  expect(result).toEqual({\n    success: false,\n    path: '/protected/path',\n    error: expect.stringContaining('permission'),\n  });\n});\n```\n\n### Helper Function\n```typescript\nfunction getRegisteredHandler(channel: string) {\n  const call = mockIpcMain.handle.mock.calls.find(\n    ([c]) =\u003e c === channel\n  );\n  if (!call) throw new Error(\\`Handler for ${channel} not registered\\`);\n  return call[1];\n}\n```\n\n## BLOCKED BY\n- scribe-roo.3 (Vault IPC handlers) - Need handlers to test\n\n## Files\n- apps/desktop/electron/main/src/handlers/vaultHandlers.test.ts (NEW)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-23T14:56:11.070483-06:00","updated_at":"2025-12-23T15:13:24.181772-06:00","dependencies":[{"issue_id":"scribe-roo.18","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:11.071198-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.18","depends_on_id":"scribe-roo.3","type":"blocks","created_at":"2025-12-23T15:01:31.729838-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.19","title":"Implement engine hot-reload for vault switching (stretch goal)","description":"# Engine Hot-Reload for Vault Switching (Stretch Goal)\n\n## What\nEnable switching vaults at runtime without requiring an app restart. This is a **stretch goal** that builds on the MVP restart-based approach.\n\n## Why\n- **Better UX**: No restart interruption\n- **Power User Feature**: Frequent vault switchers benefit\n- **Technical Achievement**: Shows robust engine architecture\n\n## Prerequisites\n- scribe-roo.14 (restart-based switching) must be complete first\n- All other Settings page features working\n\n## Technical Approach\n\n### EngineOrchestrator.switchVault()\n```typescript\nasync switchVault(newVaultPath: string): Promise\u003cVaultSwitchResult\u003e {\n  // 1. Validate new vault\n  const isValid = await isValidVault(newVaultPath);\n  if (!isValid) {\n    return { success: false, error: 'Not a valid vault' };\n  }\n  \n  // 2. Cleanup existing engines\n  await this.shutdown();\n  \n  // 3. Create new vault instance\n  this.vault = new FileSystemVault(createVaultPath(newVaultPath));\n  await this.vault.load();\n  \n  // 4. Re-initialize engines\n  this.graphEngine = new GraphEngine();\n  this.searchEngine = new SearchEngine();\n  this.taskIndex = new TaskIndex(...);\n  \n  // 5. Rebuild indexes\n  await this.initialize();\n  \n  return { success: true, path: newVaultPath };\n}\n```\n\n### Renderer Notification\n```typescript\n// Main process after switch\nBrowserWindow.getAllWindows().forEach(win =\u003e {\n  win.webContents.send('vault:switched', { path: newVaultPath });\n});\n\n// Renderer subscription\nuseEffect(() =\u003e {\n  return window.scribe.vault.onSwitched((newPath) =\u003e {\n    // Clear current note\n    // Refresh note list\n    // Reset navigation history\n  });\n}, []);\n```\n\n### Edge Cases\n- Current note doesn't exist in new vault → show welcome state\n- Switch fails mid-operation → attempt rollback\n- Large vault → show loading indicator during reindex\n\n## Risk Assessment\n- **High Complexity**: Engine lifecycle management\n- **Testing Critical**: Need extensive integration tests\n- **Rollback Difficult**: If switch fails partially\n\n## Recommendation\nImplement only after restart-based switching is stable and well-tested. Consider this for v1.1 or later.\n\n## Files\n- apps/desktop/electron/main/src/EngineOrchestrator.ts\n- apps/desktop/electron/main/src/handlers/vaultHandlers.ts\n- packages/shared/src/ipc-contract.ts (vault:switched event)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T15:06:57.582811-06:00","updated_at":"2025-12-23T15:06:57.582811-06:00","dependencies":[{"issue_id":"scribe-roo.19","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T15:06:57.583245-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.19","depends_on_id":"scribe-roo.14","type":"blocks","created_at":"2025-12-23T15:07:01.833734-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.2","title":"Add folder picker IPC handler (dialog:selectFolder)","description":"# Add Folder Picker IPC Handler (dialog:selectFolder)\n\n## What\nAdd a new IPC channel that opens the native OS folder picker dialog and returns the selected path.\n\n## Why\n- **Required for Vault Management**: Users need to select folders when changing vault location or creating new vaults\n- **No Existing Handler**: The current IPC contract doesn't include folder/file dialogs\n- **Security**: Renderer process can't access dialog.showOpenDialog directly due to sandboxing\n\n## Technical Approach\n\n### IPC Contract Addition\n```typescript\n// In packages/shared/src/ipc-contract.ts\nexport const IPC_CHANNELS = {\n  // ... existing channels\n  DIALOG_SELECT_FOLDER: 'dialog:selectFolder',\n} as const;\n\n// Add to ScribeAPI interface\nexport interface DialogAPI {\n  selectFolder(options?: { title?: string; defaultPath?: string }): Promise\u003cstring | null\u003e;\n}\n```\n\n### Main Process Handler\n```typescript\n// In apps/desktop/electron/main/src/handlers/dialogHandlers.ts\nimport { dialog } from 'electron';\nimport { IPC_CHANNELS } from '@scribe/shared';\n\nexport function registerDialogHandlers(): void {\n  ipcMain.handle(\n    IPC_CHANNELS.DIALOG_SELECT_FOLDER,\n    async (_, options?: { title?: string; defaultPath?: string }) =\u003e {\n      const result = await dialog.showOpenDialog({\n        title: options?.title ?? 'Select Folder',\n        defaultPath: options?.defaultPath,\n        properties: ['openDirectory', 'createDirectory'],\n      });\n      \n      if (result.canceled || result.filePaths.length === 0) {\n        return null;\n      }\n      \n      return result.filePaths[0];\n    }\n  );\n}\n```\n\n### Preload Bridge\n```typescript\n// Add to window.scribe in preload.ts\ndialog: {\n  selectFolder: (options?: { title?: string; defaultPath?: string }) =\u003e\n    ipcRenderer.invoke(IPC_CHANNELS.DIALOG_SELECT_FOLDER, options),\n}\n```\n\n### Options\n- `title`: Dialog window title (default: \"Select Folder\")\n- `defaultPath`: Initial directory to display (useful for showing current vault path)\n- `properties`: `openDirectory` (folders only), `createDirectory` (allow new folder button)\n\n### Return Value\n- `string`: Absolute path to selected folder\n- `null`: User cancelled the dialog\n\n### Platform Considerations\n- macOS: Native NSOpenPanel\n- Windows: Native folder browser\n- Linux: GTK file chooser (if available)\n\n## Parallel Safe\nYes - no dependencies on other tasks.\n\n## Files\n- packages/shared/src/ipc-contract.ts\n- apps/desktop/electron/main/src/handlers/dialogHandlers.ts (NEW)\n- apps/desktop/electron/preload/src/preload.ts\n- apps/desktop/electron/main/src/main.ts (register handlers)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T14:56:09.954885-06:00","updated_at":"2025-12-23T19:07:58.807399-06:00","closed_at":"2025-12-23T19:07:58.807399-06:00","dependencies":[{"issue_id":"scribe-roo.2","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:09.955256-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.20","title":"Add SettingsIcon to design system icons","description":"# Add SettingsIcon to Design System\n\n## What\nExport the Settings (gear/cog) icon from Lucide React in the design system icons.\n\n## Why\n- **Required for scribe-roo.4**: The sidebar gear icon needs this icon\n- **Common Pattern**: Settings icon will be used in multiple places\n\n## Implementation\n```typescript\n// In packages/design-system/src/icons/icons.ts (or index.ts)\nexport { Settings as SettingsIcon } from 'lucide-react';\n```\n\nOr if using a custom mapping:\n```typescript\n// Add to the exports\nSettingsIcon,\n```\n\n## Verification\nLucide React has the Settings icon (gear/cog shape). Verify it exists:\nhttps://lucide.dev/icons/settings\n\n## Files\n- packages/design-system/src/icons/index.ts (add export)\n\n## Parallel Safe\nYES - no dependencies.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:08:43.778268-06:00","updated_at":"2025-12-23T19:03:22.758797-06:00","closed_at":"2025-12-23T19:03:22.758797-06:00","dependencies":[{"issue_id":"scribe-roo.20","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T15:08:43.77863-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.21","title":"Add app:relaunch IPC handler for vault switching restart","description":"# Add app:relaunch IPC Handler\n\n## What\nAdd an IPC handler that relaunches the Electron app. Required for vault switching to take effect.\n\n## Why\n- **Vault Switching Requires Restart**: The restart-based vault switching approach (scribe-roo.14) needs a way to restart the app\n- **No Existing Handler**: There's currently no IPC channel for app.relaunch()\n- **Clean Restart**: app.relaunch() + app.exit() provides a clean restart\n\n## Technical Approach\n\n### IPC Contract\n```typescript\n// In packages/shared/src/ipc-contract.ts\nexport const IPC_CHANNELS = {\n  // ... existing\n  APP_RELAUNCH: 'app:relaunch',\n} as const;\n```\n\n### Main Process Handler\n```typescript\n// In appHandlers.ts\nipcMain.handle(IPC_CHANNELS.APP_RELAUNCH, () =\u003e {\n  app.relaunch();\n  app.exit(0);\n});\n```\n\n### Preload Bridge\n```typescript\n// Add to window.scribe.app\napp: {\n  // ... existing\n  relaunch: () =\u003e ipcRenderer.invoke(IPC_CHANNELS.APP_RELAUNCH),\n}\n```\n\n## Files\n- packages/shared/src/ipc-contract.ts\n- apps/desktop/electron/main/src/handlers/appHandlers.ts\n- apps/desktop/electron/preload/src/preload.ts\n\n## Parallel Safe\nYES - No dependencies on other Settings tasks. Can be done alongside scribe-roo.2 and scribe-roo.3.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:11:37.305926-06:00","updated_at":"2025-12-23T19:05:19.179193-06:00","closed_at":"2025-12-23T19:05:19.179193-06:00","dependencies":[{"issue_id":"scribe-roo.21","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T15:11:37.306337-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.3","title":"Add vault IPC handlers (vault:getPath, vault:setPath, vault:create)","description":"# Add Vault IPC Handlers (vault:getPath, vault:setPath, vault:create)\n\n## What\nAdd IPC channels for vault management: reading current path, switching vaults, and creating new vaults.\n\n## Why\n- **Settings Page Requirement**: Users need to see their current vault location and optionally change it\n- **Multi-Vault Support Foundation**: Enables users to work with different vaults\n- **New User Onboarding**: Creating a vault is essential for first-time setup\n\n## Technical Approach\n\n### IPC Contract Additions\n```typescript\n// In packages/shared/src/ipc-contract.ts\nexport const IPC_CHANNELS = {\n  // ... existing\n  VAULT_GET_PATH: 'vault:getPath',\n  VAULT_SET_PATH: 'vault:setPath',\n  VAULT_CREATE: 'vault:create',\n  VAULT_VALIDATE: 'vault:validate',\n} as const;\n\nexport interface VaultAPI {\n  getPath(): Promise\u003cstring\u003e;\n  setPath(path: string): Promise\u003cVaultSwitchResult\u003e;\n  create(path: string): Promise\u003cVaultCreateResult\u003e;\n  validate(path: string): Promise\u003cVaultValidationResult\u003e;\n}\n\nexport interface VaultSwitchResult {\n  success: boolean;\n  path: string;\n  error?: string;\n}\n\nexport interface VaultCreateResult {\n  success: boolean;\n  path: string;\n  error?: string;\n}\n\nexport interface VaultValidationResult {\n  valid: boolean;\n  missingDirs?: string[];\n}\n```\n\n### Handler Implementations\n\n#### vault:getPath\nSimply returns the current vault path from EngineOrchestrator or config.\n\n#### vault:validate\nUses existing `isValidVault()` from storage-fs to check if path is valid vault.\n\n#### vault:setPath (Complex - See scribe-roo.14)\nThis is the complex one that requires engine hot-reload. Initial implementation:\n1. Validate the new path is a valid vault\n2. If invalid, return error\n3. If valid, update config and notify renderer\n4. Full engine hot-reload handled in separate task (scribe-roo.14)\n\n#### vault:create\nUses existing `initializeVault()` from storage-fs:\n1. Validate path doesn't already contain a vault\n2. Call `initializeVault(path)` to create structure\n3. Optionally switch to the new vault\n\n### AppConfig Extension\n```typescript\n// In apps/desktop/electron/main/src/handlers/types.ts\nexport interface AppConfig {\n  lastOpenedNoteId?: string;\n  theme?: 'light' | 'dark' | 'system';\n  vaultPath?: string;  // NEW - stores current vault location\n}\n```\n\n### Error Handling\n- Invalid path: Return `{ success: false, error: 'Path does not exist' }`\n- Not a vault: Return `{ success: false, error: 'Not a valid Scribe vault. Missing required folders.' }`\n- Permission denied: Return `{ success: false, error: 'Permission denied' }`\n- Path already exists (for create): Return `{ success: false, error: 'Vault already exists at this location' }`\n\n## Dependencies\n- scribe-roo.14 (Engine hot-reload) - Full vault switching implementation depends on this\n\n## Parallel Safe\nPartially - Basic handlers can be built independently, but full vault switching needs scribe-roo.14.\n\n## Files\n- packages/shared/src/ipc-contract.ts\n- apps/desktop/electron/main/src/handlers/vaultHandlers.ts (NEW)\n- apps/desktop/electron/preload/src/preload.ts\n- apps/desktop/electron/main/src/handlers/types.ts (AppConfig extension)\n- apps/desktop/electron/main/src/main.ts (register handlers)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T14:56:10.026087-06:00","updated_at":"2025-12-23T19:11:15.68551-06:00","closed_at":"2025-12-23T19:11:15.68551-06:00","dependencies":[{"issue_id":"scribe-roo.3","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.027219-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.4","title":"Replace sidebar footer with settings gear icon","description":"# Replace Sidebar Footer with Settings Gear Icon\n\n## What\nRemove the current sidebar footer (avatar, \"Guest User\", version indicator, theme toggle) and replace it with a minimal settings gear icon button.\n\n## Why\n- **Settings Access Point**: The gear icon is the entry point to the Settings page\n- **Cleaner UI**: Current footer is cluttered; settings belong in a dedicated page\n- **Familiar Pattern**: Gear icon for settings is a universal UI convention\n\n## Current Footer Structure (to be replaced)\n```tsx\n// Current footer in Sidebar.tsx\n\u003cdiv className={footerSection}\u003e\n  \u003cdiv className={footerUser}\u003e\n    \u003cimg src={avatarPlaceholder} className={footerAvatar} /\u003e\n    \u003cspan className={footerUsername}\u003eGuest User\u003c/span\u003e\n  \u003c/div\u003e\n  \u003cdiv className={footerControls}\u003e\n    \u003cspan className={versionIndicator}\u003ev{__APP_VERSION__}\u003c/span\u003e\n    \u003cbutton onClick={onThemeToggle}\u003e\n      {currentTheme === 'dark' ? \u003cSunIcon /\u003e : \u003cMoonIcon /\u003e}\n    \u003c/button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n## New Footer Structure\n```tsx\n\u003cdiv className={footerSection}\u003e\n  \u003cbutton \n    className={settingsButton}\n    onClick={onOpenSettings}\n    aria-label=\"Open settings\"\n  \u003e\n    \u003cSettingsIcon size={20} /\u003e\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\n## Technical Changes\n\n### Props Update\n```typescript\n// Remove from SidebarProps\n- onThemeToggle: () =\u003e void;\n- currentTheme: 'light' | 'dark';\n\n// Add to SidebarProps\n+ onOpenSettings: () =\u003e void;\n```\n\n### CSS Updates\n- Keep footerSection styling (positioning at bottom)\n- Remove footerUser, footerAvatar, footerUsername, footerControls styles\n- Add settingsButton style (centered, hover state, icon sizing)\n\n### Icon\nUse existing `SettingsIcon` from design system, or add one if missing. Fallback to a gear SVG:\n```tsx\n// Gear icon (cog) - common settings icon\n\u003csvg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"\u003e\n  \u003cpath d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\" /\u003e\n  \u003cpath d=\"M19.4 15a1.65 1.65 0 00.33 1.82l...\" /\u003e\n\u003c/svg\u003e\n```\n\n### App.tsx Integration\nThe Sidebar already receives callbacks from App.tsx. Add `onOpenSettings` that calls `setIsSettingsOpen(true)` (state managed by useSettingsPage hook).\n\n## Considerations\n- **Version Display**: Moves to Settings \u003e General section\n- **Theme Toggle**: Moves to Settings \u003e General section\n- **Guest User**: Can be removed entirely (no login system yet)\n- **Tooltip**: Consider adding \"Settings\" tooltip on hover\n\n## Parallel Safe\nYes - no dependencies on other tasks. Can be built before SettingsPage exists (just need the onClick handler stub).\n\n## Files\n- apps/desktop/renderer/src/components/Sidebar/Sidebar.tsx\n- apps/desktop/renderer/src/components/Sidebar/Sidebar.css.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T14:56:10.095631-06:00","updated_at":"2025-12-23T19:19:44.787276-06:00","closed_at":"2025-12-23T19:19:44.787276-06:00","dependencies":[{"issue_id":"scribe-roo.4","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.098956-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.4","depends_on_id":"scribe-roo.20","type":"blocks","created_at":"2025-12-23T15:08:48.699715-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.5","title":"Create SettingsPage modal shell with sidebar layout","description":"# Create SettingsPage Modal Shell with Sidebar Layout\n\n## What\nBuild the main SettingsPage component: a full-screen modal with a VS Code/macOS Settings-style sidebar navigation pattern. This task includes:\n- The useSettingsPage hook (previously scribe-roo.6)\n- The ChangelogSettings placeholder section (previously scribe-roo.9)\n\nBoth are trivially small and tightly coupled to this shell.\n\n## Why\n- **Core UI Container**: This is the main shell that houses all settings sections\n- **UX Pattern**: Sidebar + content area is the most scalable pattern for settings\n- **Reuses Overlay**: Leverages existing design system Overlay primitive for modal behavior\n\n## Technical Approach\n\n### useSettingsPage Hook (inline with component)\n```typescript\nexport type SettingsSection = 'general' | 'changelog';\n\nexport function useSettingsPage() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [activeSection, setActiveSection] = useState\u003cSettingsSection\u003e('general');\n  \n  const open = useCallback(() =\u003e {\n    setIsOpen(true);\n    setActiveSection('general');\n  }, []);\n  \n  const close = useCallback(() =\u003e setIsOpen(false), []);\n  \n  return { isOpen, open, close, activeSection, setActiveSection };\n}\n```\n\n### ChangelogSettings (placeholder)\n```tsx\nexport function ChangelogSettings() {\n  return (\n    \u003cdiv className={styles.changelogSettings}\u003e\n      \u003cText variant=\"heading3\"\u003eChangelog\u003c/Text\u003e\n      \u003cText variant=\"body\" color=\"muted\"\u003e\n        Release notes and version history will appear here in a future update.\n      \u003c/Text\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Component Structure\n```tsx\nexport function SettingsPage({ isOpen, onClose }: SettingsPageProps) {\n  const [activeSection, setActiveSection] = useState\u003cSettingsSection\u003e('general');\n  \n  if (!isOpen) return null;\n  \n  return (\n    \u003cOverlay open={isOpen} onClose={onClose} closeOnEscape\u003e\n      \u003cSurface className={styles.settingsContainer}\u003e\n        \u003cheader className={styles.header}\u003e\n          \u003cText variant=\"heading2\"\u003eSettings\u003c/Text\u003e\n          \u003cbutton onClick={onClose} aria-label=\"Close settings\"\u003e\u003cXIcon /\u003e\u003c/button\u003e\n        \u003c/header\u003e\n        \u003cdiv className={styles.content}\u003e\n          \u003cSettingsSidebar activeSection={activeSection} onSelect={setActiveSection} /\u003e\n          \u003cmain className={styles.mainContent}\u003e\n            {activeSection === 'general' \u0026\u0026 \u003cGeneralSettings /\u003e}\n            {activeSection === 'changelog' \u0026\u0026 \u003cChangelogSettings /\u003e}\n          \u003c/main\u003e\n        \u003c/div\u003e\n      \u003c/Surface\u003e\n    \u003c/Overlay\u003e\n  );\n}\n```\n\n### Layout (sidebar + content, VS Code pattern)\n- Full viewport (100vw x 100vh)\n- Sidebar: ~200px fixed width\n- Content: Flex grow, scrollable\n- Header: Fixed top with title + close button\n\n### Files to Create\n- SettingsPage.tsx (component + hook)\n- SettingsPage.css.ts\n- SettingsSidebar.tsx + css\n- ChangelogSettings.tsx (simple placeholder)\n- index.ts (barrel export)\n\n## Parallel Safe\nYES - No dependencies. Can be built independently of the gear icon.\n\n## Files\n- apps/desktop/renderer/src/components/Settings/SettingsPage.tsx (NEW)\n- apps/desktop/renderer/src/components/Settings/SettingsPage.css.ts (NEW)\n- apps/desktop/renderer/src/components/Settings/SettingsSidebar.tsx (NEW)\n- apps/desktop/renderer/src/components/Settings/ChangelogSettings.tsx (NEW)\n- apps/desktop/renderer/src/hooks/useSettingsPage.ts (NEW)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.16838-06:00","updated_at":"2025-12-23T15:12:03.398089-06:00","dependencies":[{"issue_id":"scribe-roo.5","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.169409-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.6","title":"Create useSettingsPage hook for state management","description":"# Create useSettingsPage Hook for State Management\n\n## What\nCreate a custom hook to manage Settings page state: open/close, active section, and any transient settings state.\n\n## Why\n- **Centralized State**: Keep settings-related state in one place\n- **Reusability**: Can be used from App.tsx and passed down\n- **Separation of Concerns**: UI logic separate from component rendering\n- **Future Expansion**: Easy to add more state (unsaved changes warning, etc.)\n\n## Technical Approach\n\n### Hook API\n```typescript\n// useSettingsPage.ts\nexport type SettingsSection = 'general' | 'changelog';\n\nexport interface UseSettingsPageReturn {\n  // Modal state\n  isOpen: boolean;\n  open: () =\u003e void;\n  close: () =\u003e void;\n  toggle: () =\u003e void;\n  \n  // Section navigation\n  activeSection: SettingsSection;\n  setActiveSection: (section: SettingsSection) =\u003e void;\n}\n\nexport function useSettingsPage(): UseSettingsPageReturn {\n  const [isOpen, setIsOpen] = useState(false);\n  const [activeSection, setActiveSection] = useState\u003cSettingsSection\u003e('general');\n  \n  const open = useCallback(() =\u003e {\n    setIsOpen(true);\n    setActiveSection('general'); // Reset to default on open\n  }, []);\n  \n  const close = useCallback(() =\u003e {\n    setIsOpen(false);\n  }, []);\n  \n  const toggle = useCallback(() =\u003e {\n    setIsOpen(prev =\u003e !prev);\n  }, []);\n  \n  return {\n    isOpen,\n    open,\n    close,\n    toggle,\n    activeSection,\n    setActiveSection,\n  };\n}\n```\n\n### Usage in App.tsx\n```tsx\nfunction App() {\n  const settings = useSettingsPage();\n  \n  return (\n    \u003cdiv className={styles.app}\u003e\n      \u003cSidebar \n        onOpenSettings={settings.open}\n        // ... other props\n      /\u003e\n      \n      \u003cSettingsPage \n        isOpen={settings.isOpen}\n        onClose={settings.close}\n        activeSection={settings.activeSection}\n        onSelectSection={settings.setActiveSection}\n      /\u003e\n      \n      {/* ... rest of app */}\n    \u003c/div\u003e\n  );\n}\n```\n\n### Future Extensions\nThis hook can be extended to support:\n- **Dirty state tracking**: Warn before closing with unsaved changes\n- **Keyboard shortcuts**: Cmd+, to open settings\n- **Deep linking**: Open to specific section (e.g., from toast \"Update Settings\")\n- **History**: Remember last visited section\n\n### Potential Addition: Keyboard Shortcut\n```typescript\n// Inside the hook\nuseEffect(() =\u003e {\n  const handleKeyDown = (e: KeyboardEvent) =\u003e {\n    // Cmd+, (macOS) or Ctrl+, (Windows/Linux) opens settings\n    if ((e.metaKey || e.ctrlKey) \u0026\u0026 e.key === ',') {\n      e.preventDefault();\n      toggle();\n    }\n  };\n  \n  window.addEventListener('keydown', handleKeyDown);\n  return () =\u003e window.removeEventListener('keydown', handleKeyDown);\n}, [toggle]);\n```\n\n## Parallel Safe\nYes - no dependencies. Can be built independently.\n\n## Files\n- apps/desktop/renderer/src/hooks/useSettingsPage.ts (NEW)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.237266-06:00","updated_at":"2025-12-23T15:05:58.864121-06:00","closed_at":"2025-12-23T15:05:58.864121-06:00","dependencies":[{"issue_id":"scribe-roo.6","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.237929-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.7","title":"Integrate SettingsPage into App.tsx","description":"# Integrate SettingsPage into App.tsx\n\n## What\nWire up the SettingsPage component and useSettingsPage hook into the main App.tsx, connecting it to the sidebar gear icon.\n\n## Why\n- **Entry Point Connection**: Links the gear icon click to opening settings\n- **State Hosting**: App.tsx is the appropriate level to host settings state\n- **Coordinated Rendering**: Settings modal needs to render at the app level to overlay everything\n\n## Technical Approach\n\n### App.tsx Changes\n```tsx\n// App.tsx\nimport { SettingsPage } from './components/Settings';\nimport { useSettingsPage } from './hooks/useSettingsPage';\n\nfunction App() {\n  // ... existing hooks\n  const settings = useSettingsPage();\n  \n  return (\n    \u003cdiv className={styles.app}\u003e\n      \u003cdiv className={styles.titlebarDragRegion} /\u003e\n      \n      \u003cErrorBoundary name=\"Sidebar\"\u003e\n        \u003cSidebar \n          // ... existing props\n          onOpenSettings={settings.open}  // NEW: replace onThemeToggle\n          // REMOVE: onThemeToggle, currentTheme\n        /\u003e\n      \u003c/ErrorBoundary\u003e\n      \n      {/* Main content area */}\n      \u003cEditorCommandProvider\u003e\n        \u003cdiv className={styles.mainContent}\u003e\n          {/* ... existing content */}\n        \u003c/div\u003e\n      \u003c/EditorCommandProvider\u003e\n      \n      {/* Settings modal - renders at app level to overlay everything */}\n      \u003cSettingsPage \n        isOpen={settings.isOpen}\n        onClose={settings.close}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Remove Theme Toggle Props\nSince theme toggle moves to Settings, remove from Sidebar props:\n```typescript\n// Before\n\u003cSidebar\n  onThemeToggle={() =\u003e setTheme(resolvedTheme === 'dark' ? 'light' : 'dark')}\n  currentTheme={resolvedTheme}\n  // ...\n/\u003e\n\n// After\n\u003cSidebar\n  onOpenSettings={settings.open}\n  // ...\n/\u003e\n```\n\n### Rendering Order\nSettingsPage should render AFTER the main content but is a portal-based overlay, so order in JSX doesn't strictly matter. However, for clarity:\n```tsx\n{/* Main app UI */}\n\u003cSidebar ... /\u003e\n\u003cmain ... /\u003e\n\n{/* Overlays (render last for z-index clarity) */}\n\u003cCommandPalette ... /\u003e\n\u003cSettingsPage ... /\u003e\n\u003cToast ... /\u003e\n```\n\n### ErrorBoundary\nConsider wrapping SettingsPage in ErrorBoundary:\n```tsx\n\u003cErrorBoundary name=\"Settings\"\u003e\n  \u003cSettingsPage ... /\u003e\n\u003c/ErrorBoundary\u003e\n```\n\n## BLOCKED BY\n- scribe-roo.4 (Sidebar gear icon) - Need onOpenSettings prop\n- scribe-roo.5 (SettingsPage shell) - Need component to render\n- scribe-roo.6 (useSettingsPage hook) - Need state management\n\n## Files\n- apps/desktop/renderer/src/App.tsx","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.306119-06:00","updated_at":"2025-12-23T14:57:55.291619-06:00","dependencies":[{"issue_id":"scribe-roo.7","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.307382-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.7","depends_on_id":"scribe-roo.5","type":"blocks","created_at":"2025-12-23T15:00:59.586308-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.8","title":"Implement GeneralSettings section structure","description":"# Implement GeneralSettings Section Structure\n\n## What\nBuild the GeneralSettings component that contains Vault Location, Version, and Theme settings.\n\n## Why\n- **Main Settings Section**: General is the default and most important section\n- **Organizes Related Settings**: Groups vault, version, and theme logically\n- **Foundation for Functionality**: This structure enables the actual setting implementations\n\n## Technical Approach\n\n### Component Structure\n```tsx\n// GeneralSettings.tsx\nexport function GeneralSettings() {\n  return (\n    \u003cdiv className={styles.generalSettings}\u003e\n      \u003cSettingsGroup title=\"Vault Location\"\u003e\n        \u003cVaultLocationSetting /\u003e\n      \u003c/SettingsGroup\u003e\n      \n      \u003cSettingsGroup title=\"Version\"\u003e\n        \u003cVersionSetting /\u003e\n      \u003c/SettingsGroup\u003e\n      \n      \u003cSettingsGroup title=\"Theme\"\u003e\n        \u003cThemeSetting /\u003e\n      \u003c/SettingsGroup\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### SettingsGroup Helper\n```tsx\n// SettingsGroup - reusable container for each setting\ninterface SettingsGroupProps {\n  title: string;\n  description?: string;\n  children: ReactNode;\n}\n\nfunction SettingsGroup({ title, description, children }: SettingsGroupProps) {\n  return (\n    \u003csection className={styles.settingsGroup}\u003e\n      \u003cdiv className={styles.settingsGroupHeader}\u003e\n        \u003cText variant=\"label\" className={styles.settingsGroupTitle}\u003e{title}\u003c/Text\u003e\n        {description \u0026\u0026 (\n          \u003cText variant=\"body\" color=\"muted\"\u003e{description}\u003c/Text\u003e\n        )}\n      \u003c/div\u003e\n      \u003cdiv className={styles.settingsGroupContent}\u003e\n        {children}\n      \u003c/div\u003e\n    \u003c/section\u003e\n  );\n}\n```\n\n### Layout Pattern\n```\nVault Location\n------------------------------------------------\n/Users/erik/Scribe/vault\n[Change]  [Create New]\n\nVersion\n------------------------------------------------\nv1.2.3\n[Check for Updates]\n\nTheme\n------------------------------------------------\n[Dark | Light | System]\n```\n\n### Styling\n```typescript\n// GeneralSettings.css.ts\nexport const generalSettings = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing[8],  // Large gap between groups\n});\n\nexport const settingsGroup = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing[3],\n});\n\nexport const settingsGroupHeader = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing[1],\n  borderBottom: `1px solid ${vars.color.border}`,\n  paddingBottom: vars.spacing[2],\n});\n\nexport const settingsGroupContent = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing[2],\n});\n```\n\n### Placeholder Content (Initial)\nInitially, each setting can be a placeholder:\n```tsx\nfunction VaultLocationSetting() {\n  return (\n    \u003cdiv\u003e\n      \u003cText variant=\"body\" color=\"muted\"\u003eLoading vault path...\u003c/Text\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## BLOCKED BY\n- scribe-roo.5 (SettingsPage shell) - Needs to render inside SettingsPage\n\n## UNBLOCKS\n- scribe-roo.10 (Theme setting)\n- scribe-roo.11 (Version/Update setting)\n- scribe-roo.13 (Vault display)\n\n## Files\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.tsx (NEW)\n- apps/desktop/renderer/src/components/Settings/GeneralSettings.css.ts (NEW)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T14:56:10.374812-06:00","updated_at":"2025-12-23T14:58:05.565311-06:00","dependencies":[{"issue_id":"scribe-roo.8","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.376172-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.8","depends_on_id":"scribe-roo.5","type":"blocks","created_at":"2025-12-23T15:00:59.679146-06:00","created_by":"daemon"}]}
{"id":"scribe-roo.9","title":"Create ChangelogSettings placeholder section","description":"# Create ChangelogSettings Placeholder Section\n\n## What\nCreate a placeholder Changelog section that displays \"Coming soon\" or similar placeholder content.\n\n## Why\n- **Spec Requirement**: The spec explicitly includes Changelog as a section (placeholder for now)\n- **UI Completeness**: Users can see the section exists even if not functional\n- **Future Foundation**: Easy to implement actual changelog later\n\n## Technical Approach\n\n### Simple Placeholder\n```tsx\n// ChangelogSettings.tsx\nimport { Text } from '@scribe/design-system';\nimport * as styles from './ChangelogSettings.css';\n\nexport function ChangelogSettings() {\n  return (\n    \u003cdiv className={styles.changelogSettings}\u003e\n      \u003cText variant=\"heading3\"\u003eChangelog\u003c/Text\u003e\n      \u003cText variant=\"body\" color=\"muted\"\u003e\n        Release notes and version history will appear here in a future update.\n      \u003c/Text\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Alternative: Fetch from CHANGELOG.md\nFor a more useful placeholder, could display the CHANGELOG.md content:\n```tsx\nexport function ChangelogSettings() {\n  // Could fetch CHANGELOG.md content and render as markdown\n  // For now, just placeholder\n  return (\n    \u003cdiv className={styles.changelogSettings}\u003e\n      \u003cText variant=\"heading3\"\u003eWhat's New\u003c/Text\u003e\n      \u003cdiv className={styles.placeholder}\u003e\n        \u003cText variant=\"body\" color=\"muted\"\u003e\n          Changelog coming soon. For now, see release notes on GitHub.\n        \u003c/Text\u003e\n        \u003cButton \n          variant=\"secondary\" \n          onClick={() =\u003e window.scribe.shell.openExternal('https://github.com/scribe/releases')}\n        \u003e\n          View on GitHub\n        \u003c/Button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Styling\n```typescript\n// ChangelogSettings.css.ts\nexport const changelogSettings = style({\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing[4],\n});\n\nexport const placeholder = style({\n  display: 'flex',\n  flexDirection: 'column',\n  alignItems: 'flex-start',\n  gap: vars.spacing[3],\n  padding: vars.spacing[6],\n  backgroundColor: vars.color.backgroundAlt,\n  borderRadius: vars.radius.md,\n});\n```\n\n## Low Priority\nThis is P3 as it's just a placeholder. Can be implemented quickly after the main settings structure is in place.\n\n## BLOCKED BY\n- scribe-roo.5 (SettingsPage shell) - Needs to render inside SettingsPage\n\n## Files\n- apps/desktop/renderer/src/components/Settings/ChangelogSettings.tsx (NEW)\n- apps/desktop/renderer/src/components/Settings/ChangelogSettings.css.ts (NEW, optional)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T14:56:10.443953-06:00","updated_at":"2025-12-23T15:12:08.006803-06:00","closed_at":"2025-12-23T15:12:08.006803-06:00","dependencies":[{"issue_id":"scribe-roo.9","depends_on_id":"scribe-roo","type":"parent-child","created_at":"2025-12-23T14:56:10.444505-06:00","created_by":"daemon"},{"issue_id":"scribe-roo.9","depends_on_id":"scribe-roo.5","type":"blocks","created_at":"2025-12-23T15:00:59.723951-06:00","created_by":"daemon"}]}
