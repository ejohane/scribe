{"id":"scribe-0nf","title":"Technical Debt: Dead Code \u0026 Deprecated API Cleanup","description":"# Technical Debt: Dead Code \u0026 Deprecated API Cleanup\n\n## Strategic Context\n\nCode analysis revealed several categories of dead or deprecated code:\n1. **Deprecated type aliases** still in use (`LexicalState`, `LexicalNode`)\n2. **Deprecated methods** with migration paths (`getQuarantinedFiles()`)\n3. **Unused validation utilities** (tested but never called in production)\n4. **Disabled features** with TODO comments (AI commands, Link formatting)\n5. **Commented-out code blocks**\n\n### Why This Matters\n\n1. **Confusion**: Deprecated APIs confuse new contributors about what to use.\n2. **Bundle Size**: Unused code increases bundle size and parse time.\n3. **Maintenance Debt**: Dead code still gets touched during refactors.\n4. **False Confidence**: Test coverage numbers include unused code.\n\n### Decision Framework\n\nFor each item, we ask:\n1. **Is it documented as deprecated?** → Migrate usages, then remove\n2. **Is it used anywhere?** → If no, remove\n3. **Is it a disabled feature?** → Either implement or remove entirely\n4. **Is it commented-out code?** → Remove (we have git history)\n\n## Scope\n\nThis epic covers:\n- Removing deprecated type aliases after migration\n- Removing deprecated methods after migration period\n- Removing unused validation utilities OR adding production usage\n- Deciding fate of disabled features\n- Removing commented-out code\n\n## Out of Scope\n\n- Implementing disabled features (separate epic if decided)\n- Major refactoring\n\n## Success Criteria\n\n- [ ] No deprecated type aliases in codebase\n- [ ] All deprecated methods have clear removal timeline\n- [ ] Unused utilities either used or removed\n- [ ] No commented-out code blocks\n- [ ] Bundle size measurably reduced\n\n## Technical Notes\n\n### Deprecated Type Aliases\n\n```typescript\n// packages/shared/src/types/editor-types.ts\n/** @deprecated Use EditorContent instead */\nexport type LexicalState = EditorContent;\n/** @deprecated Use EditorNode instead */\nexport type LexicalNode = EditorNode;\n```\n\nOnly usage found: `apps/cli/src/node-builder.ts`\n\n### Deprecated Methods\n\n```typescript\n// packages/storage-fs/src/storage.ts\n/** @deprecated Use getQuarantineManager().listQuarantined() */\nlistQuarantined(): Promise\u003cQuarantinedFile[]\u003e\n```\n\n### Unused Validation Utilities\n\n```typescript\n// packages/shared/src/validation.ts\n// These have tests but are never called in production:\n- validateDateString\n- validatePositiveInteger\n- validateNonNegativeInteger\n- validateInRange\n```\n\n## Dependencies\n\n- scribe-ndr (Test Coverage) should complete first so we can verify nothing breaks","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:35:16.202825-06:00","updated_at":"2025-12-21T22:35:16.202825-06:00"}
{"id":"scribe-0nf.1","title":"Migrate LexicalState/LexicalNode usages to EditorContent/EditorNode","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:35:16.264487-06:00","updated_at":"2025-12-22T12:36:46.337165-06:00","closed_at":"2025-12-22T12:36:46.337165-06:00","dependencies":[{"issue_id":"scribe-0nf.1","depends_on_id":"scribe-0nf","type":"parent-child","created_at":"2025-12-21T22:35:16.264836-06:00","created_by":"daemon"}]}
{"id":"scribe-0nf.2","title":"Remove deprecated getQuarantinedFiles method","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:35:16.327225-06:00","updated_at":"2025-12-21T22:35:16.327225-06:00","dependencies":[{"issue_id":"scribe-0nf.2","depends_on_id":"scribe-0nf","type":"parent-child","created_at":"2025-12-21T22:35:16.327585-06:00","created_by":"daemon"}]}
{"id":"scribe-0nf.3","title":"Audit and remove unused validation utilities","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:35:16.388659-06:00","updated_at":"2025-12-21T22:35:16.388659-06:00","dependencies":[{"issue_id":"scribe-0nf.3","depends_on_id":"scribe-0nf","type":"parent-child","created_at":"2025-12-21T22:35:16.388998-06:00","created_by":"daemon"}]}
{"id":"scribe-0nf.4","title":"Remove commented-out code in SelectionToolbarPlugin","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:35:16.449485-06:00","updated_at":"2025-12-21T22:35:16.449485-06:00","dependencies":[{"issue_id":"scribe-0nf.4","depends_on_id":"scribe-0nf","type":"parent-child","created_at":"2025-12-21T22:35:16.449803-06:00","created_by":"daemon"}]}
{"id":"scribe-0nf.5","title":"Remove or implement disabled AI commands in SlashMenu","description":"# Remove or implement disabled AI commands in SlashMenu\n\n## Context\n\nThe file `apps/desktop/renderer/src/components/Editor/SlashMenu/commands.ts` contains disabled AI commands with a TODO comment:\n\n```typescript\n// Line 139\n// TODO: Re-enable AI commands when AI functionality is implemented\n```\n\nThis code has been disabled for an unknown period, creating technical debt.\n\n## Decision Required\n\n**Option A: Remove the dead code**\n- Pros: Cleaner codebase, no misleading code\n- Cons: Need to re-implement when AI is ready\n- Recommended if: No AI feature planned in next 6 months\n\n**Option B: Keep as-is with explicit timeline**\n- Pros: Implementation ready when AI arrives\n- Cons: Dead code remains\n- Recommended if: AI feature actively planned\n\n**Option C: Move to feature flag**\n- Pros: Can enable for testing without full release\n- Cons: More complexity\n- Recommended if: AI feature in active development\n\n## Current State\n\nThe disabled code likely includes:\n- AI-powered text completion\n- AI summarization\n- AI formatting suggestions\n\n## Recommendation\n\nUnless there's an active AI roadmap item, **remove the disabled code**. Benefits:\n1. Reduces cognitive load\n2. Prevents misleading code reviews\n3. Git history preserves the implementation if needed later\n4. Forces fresh design when AI is actually prioritized\n\n## Action Required\n\n1. **Check with product/team**: Is AI planned for next 2 quarters?\n2. **If no**: Remove disabled AI commands entirely\n3. **If yes**: Add feature flag and keep code, but document timeline\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/components/Editor/SlashMenu/commands.ts`\n\n## Acceptance Criteria\n\n- [ ] Decision made: remove or keep with feature flag\n- [ ] If removing: Clean removal with git commit message explaining why\n- [ ] If keeping: Feature flag added, timeline documented\n- [ ] No orphaned TODO comments","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:35:16.512033-06:00","updated_at":"2025-12-21T22:39:08.117271-06:00","dependencies":[{"issue_id":"scribe-0nf.5","depends_on_id":"scribe-0nf","type":"parent-child","created_at":"2025-12-21T22:35:16.512342-06:00","created_by":"daemon"}]}
{"id":"scribe-0nf.6","title":"Remove commented-out migration placeholder in note-migrator","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:35:16.58126-06:00","updated_at":"2025-12-21T22:35:16.58126-06:00","dependencies":[{"issue_id":"scribe-0nf.6","depends_on_id":"scribe-0nf","type":"parent-child","created_at":"2025-12-21T22:35:16.581569-06:00","created_by":"daemon"}]}
{"id":"scribe-0nf.7","title":"Clean up disabled Link/AI features in SelectionToolbar","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:35:16.650068-06:00","updated_at":"2025-12-21T22:35:16.650068-06:00","dependencies":[{"issue_id":"scribe-0nf.7","depends_on_id":"scribe-0nf","type":"parent-child","created_at":"2025-12-21T22:35:16.650383-06:00","created_by":"daemon"}]}
{"id":"scribe-1","title":"Daily Note Navigation Epic","description":"# Daily Note Navigation\n\nEnhance the note header date display with navigation controls that allow users to quickly move between daily notes. This is a cornerstone UX improvement that makes Scribe's daily journaling workflow feel as natural as flipping through a physical calendar.\n\n## Strategic Value\n\n- **Reduces friction**: Currently navigating daily notes requires command palette → search → select. This adds chevron-click and calendar-pick alternatives.\n- **Supports chronological review**: Users reviewing project timelines or past decisions can flip through days naturally.\n- **Progressive disclosure**: Clean default UI with power features revealed on hover.\n\n## Scope\n\n- Update `getDailyDisplayTitle` to show Yesterday/Tomorrow/ordinal dates\n- Create `DateNavigator` component with chevrons and Calendar popover\n- Integrate into NoteHeader with proper accessibility\n- Add comprehensive tests at unit, component, and E2E levels\n\n## Dependencies\n\n- Existing `Calendar` component from design-system\n- Existing `daily:getOrCreate` IPC handler\n- date-fns for date manipulation\n\n## Files Affected\n\n- `renderer/src/templates/daily.ts`\n- `renderer/src/components/NoteHeader/*`\n- `renderer/src/App.tsx`\n- New test files\n\n## Success Criteria\n\n1. User can click chevrons to navigate prev/next daily notes\n2. User can click date to open calendar and jump to any date\n3. Title shows \"Today\", \"Yesterday\", \"Tomorrow\", or formatted date\n4. Keyboard navigation works fully\n5. Screen readers announce navigation correctly\n6. All tests pass","status":"closed","priority":1,"issue_type":"epic","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T22:07:29.960191-06:00","closed_at":"2025-12-21T22:07:29.960191-06:00"}
{"id":"scribe-10","title":"Update App.tsx for error handling and prop rename","description":"# Update App.tsx Integration\n\n## Context\n\nApp.tsx needs updates to:\n1. Rename prop from `onDateClick` to `onNavigateToDaily`\n2. Add try/catch with toast for error handling\n\n## Current Implementation (lines 172-178)\n\n```typescript\nconst handleDateClick = useCallback(\n  async (date: Date) =\u003e {\n    const note = await window.scribe.daily.getOrCreate(date);\n    navigateToNote(note.id);\n  },\n  [navigateToNote]\n);\n```\n\n## Updated Implementation\n\n```typescript\nconst handleNavigateToDaily = useCallback(\n  async (date: Date) =\u003e {\n    try {\n      // Note: The preload layer handles converting Date to ISO string internally\n      const dailyNote = await window.scribe.daily.getOrCreate(date);\n      navigateToNote(dailyNote.id);\n    } catch (error) {\n      showToast('Failed to open daily note', 'error');\n      console.error('Failed to navigate to daily note:', error);\n    }\n  },\n  [navigateToNote, showToast]\n);\n```\n\n## Changes Required\n\n### 1. Rename Handler\nChange `handleDateClick` to `handleNavigateToDaily` for consistency.\n\n### 2. Add Error Handling\nWrap the IPC call in try/catch with toast notification.\n\n### 3. Update NoteHeader Usage\n```typescript\n\u003cNoteHeader\n  note={noteState.currentNote}\n  onTitleChange={(title: string) =\u003e noteState.updateMetadata({ title })}\n  onTagsChange={(tags: string[]) =\u003e noteState.updateMetadata({ tags })}\n  onNavigateToDaily={handleNavigateToDaily}  // Changed from onDateClick\n  translateY={translateY}\n/\u003e\n```\n\n## IPC Type Contract (Verified)\n\nThe preload implementation (`apps/desktop/electron/preload/src/preload.ts:59-64`) accepts `Date` and converts internally:\n```typescript\ngetOrCreate: (date?: Date) =\u003e\n  ipcRenderer.invoke(\n    IPC_CHANNELS.DAILY_GET_OR_CREATE,\n    date ? { date: date.toISOString() } : undefined\n  ),\n```\n\nSo the call in App.tsx should use `Date` directly (not `{ date: string }`).\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/App.tsx`\n\n## Acceptance Criteria\n\n- [ ] Handler renamed to handleNavigateToDaily\n- [ ] Error handling with toast notification\n- [ ] Correct parameter format (Date object)\n- [ ] TypeScript compilation passes\n- [ ] showToast in dependency array\n- [ ] NoteHeader receives renamed prop\n\n## Dependencies\n\n- Depends on scribe-8 (NoteHeader must have the renamed prop)","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T22:05:53.922551-06:00","closed_at":"2025-12-21T22:05:53.922551-06:00","dependencies":[{"issue_id":"scribe-10","depends_on_id":"scribe-8","type":"blocks","created_at":"2025-12-21T21:28:17.819549-06:00","created_by":"daemon"},{"issue_id":"scribe-10","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.866624-06:00","created_by":"daemon"}]}
{"id":"scribe-11","title":"Create E2E integration tests for daily navigation","description":"# E2E Integration Tests\n\n## Context\n\nEnd-to-end tests validate the full daily note navigation flow in an actual Electron environment.\n\n## Test File\n\n`apps/desktop/daily-navigation.integration.test.ts`\n\n## Test Framework\n\n- Vitest for test runner\n- Electron testing utilities (check existing integration tests for patterns)\n\n## Test Flows\n\n### Flow 1: Navigate with Chevrons\n\n```typescript\nit('navigates between daily notes using chevrons', async () =\u003e {\n  // 1. Open today's daily note\n  await app.daily.getOrCreate();\n  \n  // 2. Verify title shows \"Today\"\n  await expect(page.locator('[data-testid=\"note-title\"]')).toHaveValue('Today');\n  \n  // 3. Hover over date area\n  await page.locator('[data-testid=\"date-navigator\"]').hover();\n  \n  // 4. Click left chevron\n  await page.locator('[aria-label=\"Navigate to previous day\"]').click();\n  \n  // 5. Verify title shows \"Yesterday\"\n  await expect(page.locator('[data-testid=\"note-title\"]')).toHaveValue('Yesterday');\n  \n  // 6. Click left again\n  await page.locator('[aria-label=\"Navigate to previous day\"]').click();\n  \n  // 7. Verify title shows formatted date\n  await expect(page.locator('[data-testid=\"note-title\"]')).toHaveValue(/Dec \\d+(?:st|nd|rd|th), 2024/);\n});\n```\n\n### Flow 2: Calendar Picker Navigation\n\n```typescript\nit('navigates using calendar picker', async () =\u003e {\n  // 1. Open today's daily note\n  await app.daily.getOrCreate();\n  \n  // 2. Click date to open calendar\n  await page.locator('[data-testid=\"date-button\"]').click();\n  \n  // 3. Verify calendar visible\n  await expect(page.locator('[data-testid=\"calendar\"]')).toBeVisible();\n  \n  // 4. Select date from 2 weeks ago\n  // ... navigate calendar and select\n  \n  // 5. Verify new note opens\n  // ... check title matches selected date\n});\n```\n\n### Flow 3: Note Creation via Navigation\n\n```typescript\nit('creates notes when navigating to dates without notes', async () =\u003e {\n  // 1. Open today's note\n  // 2. Navigate forward 3 days\n  // 3. Verify each note exists in storage\n  // 4. Navigate back - same notes, no duplicates\n});\n```\n\n### Flow 4: Keyboard Navigation\n\n```typescript\nit('supports keyboard navigation', async () =\u003e {\n  // 1. Focus date button\n  // 2. Press ArrowLeft - previous day\n  // 3. Press ArrowRight - next day\n  // 4. Press Enter - calendar opens\n  // 5. Navigate calendar with arrows\n  // 6. Press Enter - select date\n  // 7. Verify focus returns to date button\n});\n```\n\n### Flow 5: Error Handling\n\n```typescript\nit('shows error toast on navigation failure', async () =\u003e {\n  // 1. Mock storage failure\n  // 2. Click chevron\n  // 3. Verify toast appears\n  // 4. Verify current note unchanged\n});\n```\n\n## Test Data Setup\n\nEach test should:\n1. Use a temporary vault directory\n2. Clear any existing daily notes\n3. Create a known starting state\n\n## Files to Create\n\n- `apps/desktop/daily-navigation.integration.test.ts`\n\n## Dependencies\n\n- Check existing integration tests for patterns\n- May need test utilities for Electron interaction\n\n## Acceptance Criteria\n\n- [ ] All 5 test flows implemented\n- [ ] Tests run in CI\n- [ ] No flaky tests\n- [ ] Proper cleanup between tests\n- [ ] Error scenarios covered","status":"open","priority":3,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2024-12-21T12:00:00Z","dependencies":[{"issue_id":"scribe-11","depends_on_id":"scribe-10","type":"blocks","created_at":"2025-12-21T21:28:17.864563-06:00","created_by":"daemon"},{"issue_id":"scribe-11","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.911303-06:00","created_by":"daemon"},{"issue_id":"scribe-11","depends_on_id":"scribe-7","type":"blocks","created_at":"2025-12-21T21:36:21.373279-06:00","created_by":"daemon"}]}
{"id":"scribe-12","title":"Add aria-live region for navigation announcements","description":"# Accessibility: Live Region Announcements\n\n## Context\n\nWhen users navigate between daily notes using chevrons or keyboard, screen readers should announce the new note's title.\n\n## Current State\n\n- Toast notifications already use `role=\"alert\"` with `aria-live=\"assertive\"`\n- No specific announcement for navigation success\n\n## Requirements\n\n### Navigation Announcement\n\nWhen navigation completes successfully:\n- Announce the new note's display title\n- Use `aria-live=\"polite\"` (not assertive, to avoid interrupting)\n\n### Implementation Options\n\n#### Option A: Announce via existing Toast system\n\nUse a non-visual \"info\" toast:\n```typescript\nshowToast(`Navigated to ${displayTitle}`, 'info', { visualOnly: false });\n```\n\nThis may require extending the Toast component.\n\n#### Option B: Dedicated live region in DateNavigator\n\n```typescript\n\u003cdiv\n  role=\"status\"\n  aria-live=\"polite\"\n  aria-atomic=\"true\"\n  className={styles.srOnly}\n\u003e\n  {announcementText}\n\u003c/div\u003e\n```\n\n#### Option C: Page-level live region\n\nAdd a hidden live region to App.tsx that can be updated from anywhere.\n\n## Recommended Approach\n\nOption B is self-contained within DateNavigator:\n\n```typescript\nconst [announcement, setAnnouncement] = useState('');\n\n// After navigation completes:\nuseEffect(() =\u003e {\n  // When date prop changes, announce new date\n  const title = getDailyDisplayTitle(createDailyNote(date));\n  setAnnouncement(`Navigated to ${title}`);\n  \n  // Clear after announcement\n  const timer = setTimeout(() =\u003e setAnnouncement(''), 1000);\n  return () =\u003e clearTimeout(timer);\n}, [date]);\n```\n\n## srOnly Style\n\n```typescript\nexport const srOnly = style({\n  position: 'absolute',\n  width: '1px',\n  height: '1px',\n  padding: 0,\n  margin: '-1px',\n  overflow: 'hidden',\n  clip: 'rect(0, 0, 0, 0)',\n  whiteSpace: 'nowrap',\n  border: 0,\n});\n```\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.tsx`\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.css.ts`\n\n## Testing\n\n- Use screen reader (VoiceOver, NVDA) to verify announcements\n- Verify announcement doesn't interrupt other content\n\n## Acceptance Criteria\n\n- [ ] Navigation announces new note title\n- [ ] Uses aria-live=\"polite\"\n- [ ] Visually hidden but screen reader accessible\n- [ ] Announcement clears after being read","status":"closed","priority":3,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:34:54.958848-06:00","closed_at":"2025-12-21T21:34:54.958848-06:00","dependencies":[{"issue_id":"scribe-12","depends_on_id":"scribe-8","type":"blocks","created_at":"2025-12-21T21:28:17.91009-06:00","created_by":"daemon"},{"issue_id":"scribe-12","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.95697-06:00","created_by":"daemon"}]}
{"id":"scribe-13","title":"Verify and update IPC preload type definitions","description":"# Verify IPC Type Definitions\n\n## Context\n\nThe renderer accesses `window.scribe.daily.getOrCreate()`. Need to verify the preload types are correct for the date parameter.\n\n## Current Usage in App.tsx\n\n```typescript\nconst note = await window.scribe.daily.getOrCreate(date);\n```\n\nBut the handler expects:\n```typescript\nipcMain.handle('daily:getOrCreate', async (_, options?: { date?: string }) =\u003e {\n```\n\n## Issue\n\nThe current call passes a `Date` object directly, but the handler expects `{ date?: string }`.\n\n## Required Fix in App.tsx\n\n```typescript\nconst dailyNote = await window.scribe.daily.getOrCreate({ \n  date: date.toISOString() \n});\n```\n\n## Files to Check\n\n1. `apps/desktop/electron/preload/src/api.ts` - Verify preload API definition\n2. `apps/desktop/electron/preload/src/types.ts` - Verify type definitions\n3. `apps/desktop/renderer/src/App.tsx` - Update call site\n\n## Expected Preload Type\n\n```typescript\ninterface ScribeAPI {\n  daily: {\n    getOrCreate: (options?: { date?: string }) =\u003e Promise\u003cNote\u003e;\n    find: (options: { date: string }) =\u003e Promise\u003cNote | null\u003e;\n  };\n  // ...\n}\n```\n\n## Testing\n\n- Verify TypeScript compilation passes\n- Verify runtime behavior matches expected\n\n## Acceptance Criteria\n\n- [ ] Preload types match handler contract\n- [ ] App.tsx uses correct parameter format\n- [ ] TypeScript compilation passes\n- [ ] Runtime works correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:34:56.162149-06:00","closed_at":"2025-12-21T21:34:56.162149-06:00","dependencies":[{"issue_id":"scribe-13","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.001152-06:00","created_by":"daemon"}]}
{"id":"scribe-14","title":"Add data-testid attributes for E2E test selectors","description":"# Add Test Selectors\n\n## Context\n\nE2E tests need reliable selectors. Add `data-testid` attributes to key elements.\n\n## Required Selectors\n\n### DateNavigator\n\n| Element | data-testid |\n|---------|-------------|\n| Container | `date-navigator` |\n| Left chevron | `date-nav-prev` |\n| Date button | `date-nav-button` |\n| Right chevron | `date-nav-next` |\n| Calendar popover | `date-nav-calendar` |\n\n### NoteHeader\n\n| Element | data-testid |\n|---------|-------------|\n| Title input | `note-title` |\n| Metadata row | `note-metadata` |\n\n## Implementation\n\n```typescript\n// DateNavigator.tsx\n\u003cdiv\n  className={styles.dateNavigator}\n  data-testid=\"date-navigator\"\n  // ...\n\u003e\n  \u003cbutton\n    data-testid=\"date-nav-prev\"\n    // ...\n  \u003e\n  \u003cbutton\n    data-testid=\"date-nav-button\"\n    // ...\n  \u003e\n  \u003cbutton\n    data-testid=\"date-nav-next\"\n    // ...\n  \u003e\n  {isCalendarOpen \u0026\u0026 (\n    \u003cdiv data-testid=\"date-nav-calendar\"\u003e\n      \u003cCalendar ... /\u003e\n    \u003c/div\u003e\n  )}\n\u003c/div\u003e\n```\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.tsx`\n- `apps/desktop/renderer/src/components/NoteHeader/NoteHeader.tsx`\n\n## Acceptance Criteria\n\n- [ ] All key elements have data-testid\n- [ ] Test IDs are unique and descriptive\n- [ ] E2E tests can select elements reliably","status":"closed","priority":3,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:34:57.575348-06:00","closed_at":"2025-12-21T21:34:57.575348-06:00","dependencies":[{"issue_id":"scribe-14","depends_on_id":"scribe-4","type":"blocks","created_at":"2025-12-21T21:28:17.955712-06:00","created_by":"daemon"},{"issue_id":"scribe-14","depends_on_id":"scribe-8","type":"blocks","created_at":"2025-12-21T21:28:18.001942-06:00","created_by":"daemon"},{"issue_id":"scribe-14","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.046129-06:00","created_by":"daemon"}]}
{"id":"scribe-15","title":"Document DateNavigator component in storybook or README","description":"# Document DateNavigator Component\n\n## Context\n\nNew components should be documented for future developers.\n\n## Options\n\n### Option A: Storybook (if project uses it)\n\nCreate `DateNavigator.stories.tsx` with:\n- Default state\n- Hovered state\n- Calendar open state\n- Without navigation (non-daily)\n\n### Option B: README in component folder\n\nCreate `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.md`:\n\n```markdown\n# DateNavigator\n\nA date display component with optional navigation controls for daily notes.\n\n## Usage\n\n```tsx\nimport { DateNavigator } from './DateNavigator';\n\n// For daily notes (with navigation)\n\u003cDateNavigator\n  date={new Date()}\n  onNavigate={handleNavigate}\n  showNavigation={true}\n/\u003e\n\n// For other notes (no navigation)\n\u003cDateNavigator\n  date={note.createdAt}\n  onNavigate={handleNavigate}\n  showNavigation={false}\n/\u003e\n```\n\n## Props\n\n| Prop | Type | Default | Description |\n|------|------|---------|-------------|\n| date | Date | required | The date to display |\n| onNavigate | (date: Date) =\u003e void | required | Called when navigating |\n| showNavigation | boolean | true | Show chevrons and calendar |\n\n## Behavior\n\n- Chevrons visible on hover\n- Left/right chevrons navigate prev/next day\n- Date click opens calendar popover\n- Keyboard: arrows navigate, Enter/Space opens calendar\n```\n\n## Acceptance Criteria\n\n- [ ] Component documented\n- [ ] Usage examples provided\n- [ ] Props documented\n- [ ] Behavior explained","status":"closed","priority":3,"issue_type":"chore","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:34:58.792874-06:00","closed_at":"2025-12-21T21:34:58.792874-06:00","dependencies":[{"issue_id":"scribe-15","depends_on_id":"scribe-8","type":"blocks","created_at":"2025-12-21T21:28:18.04852-06:00","created_by":"daemon"},{"issue_id":"scribe-15","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.09057-06:00","created_by":"daemon"}]}
{"id":"scribe-16","title":"Performance: Memoize date formatting in DateNavigator","description":"# Performance Optimization\n\n## Context\n\nDate formatting with `date-fns` is relatively cheap, but memoization can prevent unnecessary recalculations during re-renders.\n\n## Current Code\n\n```typescript\nconst formattedDate = format(date, 'MMM do, yyyy');\n```\n\nThis runs on every render.\n\n## Optimized Code\n\n```typescript\nconst formattedDate = useMemo(\n  () =\u003e format(date, 'MMM do, yyyy'),\n  [date]\n);\n```\n\n## Other Memoization Opportunities\n\n### Callback Memoization\n\nAlready using `useCallback` for handlers - good.\n\n### Component Memoization\n\nIf parent re-renders frequently, consider:\n\n```typescript\nexport const DateNavigator = memo(function DateNavigator({ ... }) {\n  // ...\n});\n```\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.tsx`\n\n## Acceptance Criteria\n\n- [ ] Date formatting memoized\n- [ ] Consider component-level memo\n- [ ] No unnecessary re-renders\n- [ ] Profile to verify improvement","status":"closed","priority":3,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:35:00.206623-06:00","closed_at":"2025-12-21T21:35:00.206623-06:00","dependencies":[{"issue_id":"scribe-16","depends_on_id":"scribe-4","type":"blocks","created_at":"2025-12-21T21:28:18.094703-06:00","created_by":"daemon"},{"issue_id":"scribe-16","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.135137-06:00","created_by":"daemon"}]}
{"id":"scribe-17","title":"Handle timezone edge cases for Today/Yesterday/Tomorrow","description":"# Timezone Edge Cases\n\n## Context\n\nThe spec mentions: \"Today/Yesterday/Tomorrow use user's local timezone (date-fns default)\"\n\nThis is generally fine, but there are edge cases around midnight.\n\n## Edge Cases\n\n### 1. Midnight Transition\n\nIf user has today's note open at 11:59 PM and the clock ticks to 12:00 AM:\n- The note is now \"Yesterday\" but title still shows \"Today\"\n- Expected behavior: Title updates on next navigation or note switch\n\n### 2. Cross-Timezone Travel\n\nIf user creates note in NYC (EST) and opens it in LA (PST):\n- date-fns uses local timezone for comparison\n- Note created at 11 PM EST = 8 PM PST = same day\n- Note created at 1 AM EST = 10 PM PST previous day = different day!\n\n### 3. Daily Note Date Storage\n\nDaily notes store date as `MM-dd-yyyy` string in the title.\n- No timezone info preserved\n- Parsed as local midnight on that date\n\n## Current Behavior (Acceptable)\n\n- `isToday`, `isYesterday`, `isTomorrow` from date-fns compare against local midnight\n- This matches user expectation for a personal note-taking app\n\n## Potential Improvements (Future)\n\n1. Store timezone with daily note creation\n2. Compare in original timezone\n3. Show timezone indicator if different\n\n## For This Task\n\nDocument the behavior and add a test case:\n\n```typescript\nit('uses local timezone for Today/Yesterday/Tomorrow comparisons', () =\u003e {\n  // Create note at 11:59 PM local time\n  // Verify it's still \"Today\" even though midnight is 1 minute away\n  // Note: We don't auto-update title at midnight\n});\n```\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/templates/daily.test.ts` (add test case)\n- Consider adding a comment in `daily.ts` about timezone behavior\n\n## Acceptance Criteria\n\n- [ ] Timezone behavior documented in code comments\n- [ ] Test case for timezone edge case\n- [ ] No changes to actual logic (current behavior is acceptable)","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T22:06:37.450341-06:00","closed_at":"2025-12-21T22:06:37.450341-06:00","dependencies":[{"issue_id":"scribe-17","depends_on_id":"scribe-2","type":"blocks","created_at":"2025-12-21T21:28:18.141183-06:00","created_by":"daemon"},{"issue_id":"scribe-17","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.180111-06:00","created_by":"daemon"}]}
{"id":"scribe-18","title":"Cleanup: Remove deprecated dateButton style from NoteHeader.css.ts","description":"# Cleanup Deprecated Styles\n\n## Context\n\nAfter DateNavigator is integrated, the `dateButton` style in NoteHeader.css.ts is no longer used. It should be removed to keep the codebase clean.\n\n## Current Location\n\n`apps/desktop/renderer/src/components/NoteHeader/NoteHeader.css.ts` lines 80-102:\n\n```typescript\nexport const dateButton = style({\n  // ... styles\n});\n```\n\n## Action\n\n1. Verify dateButton is not used anywhere else (search codebase)\n2. Remove the style definition\n3. Verify build still passes\n\n## Verification Command\n\n```bash\ngrep -r \"dateButton\" --include=\"*.ts\" --include=\"*.tsx\" apps/desktop/renderer/src/\n```\n\nShould only find:\n- The definition in NoteHeader.css.ts\n- The import/usage that should be removed\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/components/NoteHeader/NoteHeader.css.ts`\n\n## Acceptance Criteria\n\n- [ ] Verify style not used elsewhere\n- [ ] Remove dateButton style\n- [ ] Build passes\n- [ ] No TypeScript errors","status":"closed","priority":3,"issue_type":"chore","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:35:01.275263-06:00","closed_at":"2025-12-21T21:35:01.275263-06:00","dependencies":[{"issue_id":"scribe-18","depends_on_id":"scribe-8","type":"blocks","created_at":"2025-12-21T21:28:18.185982-06:00","created_by":"daemon"},{"issue_id":"scribe-18","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.225638-06:00","created_by":"daemon"}]}
{"id":"scribe-19","title":"Manual QA: Test daily navigation on different screen sizes","description":"# Manual QA Testing\n\n## Context\n\nBefore release, manually test the feature on different screen sizes and devices.\n\n## Test Matrix\n\n### Screen Sizes\n\n| Size | Resolution | Priority |\n|------|------------|----------|\n| Desktop large | 1920x1080 | High |\n| Desktop medium | 1440x900 | High |\n| Laptop | 1280x800 | High |\n| Small laptop | 1024x768 | Medium |\n\n### Test Cases\n\n1. **Hover reveals chevrons**\n   - Chevrons fade in smoothly\n   - Chevrons fade out on mouse leave\n\n2. **Chevron navigation**\n   - Click left → previous day\n   - Click right → next day\n   - Title updates correctly\n\n3. **Calendar popover**\n   - Opens on date click\n   - Positioned correctly (not cut off)\n   - Closes on selection\n   - Closes on Escape\n   - Closes on outside click\n\n4. **Keyboard navigation**\n   - Tab reaches date button\n   - Arrow keys navigate days\n   - Enter opens calendar\n   - Escape closes calendar\n   - Focus returns correctly\n\n5. **Title display**\n   - \"Today\" for today\n   - \"Yesterday\" for yesterday\n   - \"Tomorrow\" for tomorrow\n   - Ordinal format for other dates\n\n6. **Error handling**\n   - Toast appears on error\n   - Toast dismisses automatically\n\n### Screen Reader Testing\n\n1. VoiceOver (macOS)\n   - Chevron labels announced\n   - Date button label announced\n   - Calendar dialog announced\n\n2. NVDA (Windows, if available)\n   - Same checks as VoiceOver\n\n## Bug Report Template\n\n```\n**Environment:**\n- OS: \n- Screen size: \n- Screen reader (if applicable):\n\n**Steps to reproduce:**\n1. \n2. \n3. \n\n**Expected behavior:**\n\n**Actual behavior:**\n\n**Screenshots/recordings:**\n```\n\n## Acceptance Criteria\n\n- [ ] All test cases pass on desktop large\n- [ ] All test cases pass on laptop\n- [ ] Screen reader testing complete\n- [ ] Any bugs filed as separate issues","status":"closed","priority":3,"issue_type":"chore","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:35:02.446923-06:00","closed_at":"2025-12-21T21:35:02.446923-06:00","dependencies":[{"issue_id":"scribe-19","depends_on_id":"scribe-11","type":"blocks","created_at":"2025-12-21T21:28:18.230802-06:00","created_by":"daemon"},{"issue_id":"scribe-19","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.270716-06:00","created_by":"daemon"}]}
{"id":"scribe-2","title":"Update getDailyDisplayTitle for Yesterday/Tomorrow/ordinal format","description":"# Update Daily Title Display Logic\n\n## Context\n\nThe current `getDailyDisplayTitle` function in `templates/daily.ts` only handles two cases:\n- \"Today\" for the current date\n- `MM/dd/yyyy` format for all other dates\n\nThis is inadequate for good UX. Users expect:\n- \"Yesterday\" when viewing yesterday's note\n- \"Tomorrow\" when viewing tomorrow's note  \n- Human-friendly ordinal dates like \"Dec 19th, 2024\" for other dates\n\n## Current Implementation (line 49-63)\n\n```typescript\nexport function getDailyDisplayTitle(note: Note): string {\n  const noteDate = parse(note.title, 'MM-dd-yyyy', new Date());\n  if (!isValid(noteDate)) {\n    return note.title;\n  }\n  const today = startOfDay(new Date());\n  if (isSameDay(noteDate, today)) {\n    return 'Today';\n  }\n  return format(noteDate, 'MM/dd/yyyy');\n}\n```\n\n## Required Changes\n\n1. Import `isYesterday` and `isTomorrow` from date-fns\n2. Add Yesterday check after Today\n3. Add Tomorrow check after Yesterday\n4. Change fallback format from `MM/dd/yyyy` to `MMM do, yyyy`\n\n## New Implementation\n\n```typescript\nimport { format, isToday, isYesterday, isTomorrow, parse, isValid } from 'date-fns';\n\nexport function getDailyDisplayTitle(note: Note): string {\n  const noteDate = parse(note.title, 'MM-dd-yyyy', new Date());\n\n  if (!isValid(noteDate)) {\n    return note.title;\n  }\n\n  if (isToday(noteDate)) {\n    return 'Today';\n  }\n  if (isYesterday(noteDate)) {\n    return 'Yesterday';\n  }\n  if (isTomorrow(noteDate)) {\n    return 'Tomorrow';\n  }\n  return format(noteDate, 'MMM do, yyyy');\n}\n```\n\n## Ordinal Format Notes\n\nThe `do` format token in date-fns automatically handles ordinal suffixes:\n- 1st, 2nd, 3rd, 4th...\n- 11th, 12th, 13th (exceptions)\n- 21st, 22nd, 23rd, 24th...\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/templates/daily.ts`\n\n## Acceptance Criteria\n\n- [ ] `isYesterday` and `isTomorrow` imported from date-fns\n- [ ] \"Yesterday\" returned for yesterday's date\n- [ ] \"Tomorrow\" returned for tomorrow's date\n- [ ] Ordinal format (MMM do, yyyy) used for other dates\n- [ ] No breaking changes to existing Today logic\n- [ ] Invalid dates still return original title","status":"closed","priority":1,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:53:58.161771-06:00","closed_at":"2025-12-21T21:53:58.161771-06:00","dependencies":[{"issue_id":"scribe-2","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.50739-06:00","created_by":"daemon"}]}
{"id":"scribe-20","title":"Update feature spec status to Complete after all tasks done","description":"# Update Feature Spec Status\n\n## Context\n\nOnce all tasks are complete and the feature is shipped, update the spec status from \"Draft\" to \"Complete\".\n\n## Changes\n\nIn `features/daily-note/spec.md`, change:\n\n```markdown\n**Status**: Draft\n```\n\nTo:\n\n```markdown\n**Status**: Complete\n**Completed**: YYYY-MM-DD\n```\n\n## Additional Updates\n\n1. Add a \"## Implementation Notes\" section with any deviations from spec\n2. Add a \"## Lessons Learned\" section if applicable\n3. Update any outdated information discovered during implementation\n\n## Files to Modify\n\n- `features/daily-note/spec.md`\n\n## Acceptance Criteria\n\n- [ ] Status updated to Complete\n- [ ] Completion date added\n- [ ] Any implementation deviations documented\n- [ ] Spec reflects final implementation","status":"closed","priority":3,"issue_type":"chore","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:35:03.19638-06:00","closed_at":"2025-12-21T21:35:03.19638-06:00","dependencies":[{"issue_id":"scribe-20","depends_on_id":"scribe-19","type":"blocks","created_at":"2025-12-21T21:28:18.274634-06:00","created_by":"daemon"},{"issue_id":"scribe-20","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:25.316312-06:00","created_by":"daemon"}]}
{"id":"scribe-3","title":"Add unit tests for getDailyDisplayTitle Yesterday/Tomorrow/ordinal","description":"# Add Template Unit Tests\n\n## Context\n\nAfter updating `getDailyDisplayTitle` in scribe-2, we need comprehensive unit tests to verify all title display scenarios.\n\n**IMPORTANT**: This task UPDATES existing tests in `daily.test.ts`. The current tests expect the OLD behavior (e.g., `MM/dd/yyyy` for yesterday). These tests must be modified to expect the NEW behavior (`'Yesterday'`, `'Tomorrow'`, ordinal format).\n\n## Test File\n\nUpdate: `apps/desktop/renderer/src/templates/daily.test.ts`\n\n## Current Tests That Need Updating (lines 30-41)\n\nThe existing tests explicitly expect old behavior:\n```typescript\n// CURRENT - expects old format\nit('returns MM/dd/yyyy for yesterday', () =\u003e {\n  expect(getDailyDisplayTitle(note)).toBe(format(yesterday, 'MM/dd/yyyy'));\n});\n\n// NEW - should expect 'Yesterday'\nit('returns \"Yesterday\" for yesterday', () =\u003e {\n  expect(getDailyDisplayTitle(note)).toBe('Yesterday');\n});\n```\n\n## Test Cases Required\n\n### Relative Date Tests\n\n| Test Case | Input Note Date | Expected Output |\n|-----------|----------------|------------------|\n| Today's note | today | \"Today\" |\n| Yesterday's note | yesterday | \"Yesterday\" |\n| Tomorrow's note | tomorrow | \"Tomorrow\" |\n\n### Ordinal Format Tests\n\n| Test Case | Input Note Date | Expected Output |\n|-----------|----------------|------------------|\n| Two days ago | 2 days prior | \"Dec 19th, 2024\" |\n| Week ago | 7 days prior | \"Dec 14th, 2024\" |\n| Historical date | Jul 28, 1990 | \"Jul 28th, 1990\" |\n| Future date (next week) | 7 days ahead | \"Dec 28th, 2024\" |\n\n### Ordinal Suffix Edge Cases\n\n| Test Case | Day | Expected Suffix |\n|-----------|-----|-----------------|\n| 1st | Jan 1 | \"1st\" |\n| 2nd | Jan 2 | \"2nd\" |\n| 3rd | Jan 3 | \"3rd\" |\n| 4th | Jan 4 | \"4th\" |\n| 11th exception | Jan 11 | \"11th\" (not 11st) |\n| 12th exception | Jan 12 | \"12th\" (not 12nd) |\n| 13th exception | Jan 13 | \"13th\" (not 13rd) |\n| 21st | Jan 21 | \"21st\" |\n| 22nd | Jan 22 | \"22nd\" |\n| 23rd | Jan 23 | \"23rd\" |\n\n### Error Handling Tests\n\n| Test Case | Input | Expected Output |\n|-----------|-------|------------------|\n| Invalid date string | \"invalid\" | \"invalid\" (returns original) |\n| Malformed date | \"13-45-2024\" | \"13-45-2024\" (returns original) |\n\n## Implementation Notes\n\n- Use `vitest` as the test runner\n- Mock `new Date()` for deterministic tests\n- Create helper to generate Note objects with specific dates\n\n## Sample Test Structure\n\n```typescript\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\nimport { getDailyDisplayTitle } from './daily';\nimport type { Note } from '@scribe/shared';\n\nfunction createDailyNote(dateStr: string): Note {\n  return {\n    id: 'test-id',\n    title: dateStr, // MM-dd-yyyy format\n    type: 'daily',\n    tags: ['daily'],\n    content: { root: { children: [] } },\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  } as Note;\n}\n\ndescribe('getDailyDisplayTitle', () =\u003e {\n  beforeEach(() =\u003e {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date('2024-12-21T12:00:00'));\n  });\n\n  afterEach(() =\u003e {\n    vi.useRealTimers();\n  });\n\n  it('returns \"Today\" for today\\'s date', () =\u003e {\n    const note = createDailyNote('12-21-2024');\n    expect(getDailyDisplayTitle(note)).toBe('Today');\n  });\n\n  // ... more tests\n});\n```\n\n## Acceptance Criteria\n\n- [ ] Existing tests updated to expect new behavior\n- [ ] All test cases from tables above are implemented\n- [ ] Tests use mocked system time for determinism\n- [ ] Tests pass in CI\n- [ ] No flaky tests due to timezone issues\n\n## Dependencies\n\n- scribe-2 must be completed first (updates the function being tested)","status":"closed","priority":1,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:55:27.154128-06:00","closed_at":"2025-12-21T21:55:27.154128-06:00","dependencies":[{"issue_id":"scribe-3","depends_on_id":"scribe-2","type":"blocks","created_at":"2025-12-21T21:25:35.672443-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-3","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.553683-06:00","created_by":"daemon"}]}
{"id":"scribe-4","title":"Create DateNavigator component skeleton","description":"# Create DateNavigator Component\n\n## Context\n\nThe DateNavigator is the core new UI component for this feature. It wraps the date display with optional navigation chevrons and a calendar popover.\n\n## Component Location\n\n`apps/desktop/renderer/src/components/NoteHeader/DateNavigator.tsx`\n\n## Props Interface\n\n**IMPORTANT**: Export the interface so it can be re-exported from index.ts:\n\n```typescript\nexport interface DateNavigatorProps {\n  /** The date to display and navigate from */\n  date: Date;\n  /** Called when navigating to a different date's daily note */\n  onNavigate: (date: Date) =\u003e void;\n  /** Whether to show chevron navigation (true for daily notes) */\n  showNavigation?: boolean;\n}\n```\n\n## Component Structure\n\n```\nDateNavigator\n├── ChevronButton (left) — only when showNavigation=true\n├── DateButton (trigger for Calendar popover)\n│   └── Calendar popover (only when showNavigation=true; uses @floating-ui/react)\n└── ChevronButton (right) — only when showNavigation=true\n└── aria-live region for announcements\n```\n\n## State Management\n\n```typescript\nconst [isHovered, setIsHovered] = useState(false);\nconst [isCalendarOpen, setIsCalendarOpen] = useState(false);\nconst [announcement, setAnnouncement] = useState('');\nconst dateButtonRef = useRef\u003cHTMLButtonElement\u003e(null);\nconst navigateTimeoutRef = useRef\u003cReturnType\u003ctypeof setTimeout\u003e\u003e();\nconst hoverTimeoutRef = useRef\u003cReturnType\u003ctypeof setTimeout\u003e\u003e();\n```\n\n## Key Behaviors\n\n### Hover State\n- When mouse enters container, clear any pending hide timeout, set `isHovered = true`\n- When mouse leaves, debounce 100ms then set `isHovered = false`\n- Chevrons visible when `isHovered || isCalendarOpen`\n\n### Navigation Debounce\n- Rapid chevron clicks should debounce (200ms)\n- Prevents excessive note creation from quick clicking\n\n### Calendar Popover\n- Only shown when `showNavigation=true`\n- Opens on date button click\n- Closes on: date selection, Escape, outside click\n- Uses existing Calendar component from design-system\n\n## Consolidated Requirements (from scribe-12, scribe-14, scribe-16)\n\n### Accessibility: aria-live region\nWhen navigation completes successfully, announce the new note's title:\n```typescript\n\u003cdiv\n  role=\"status\"\n  aria-live=\"polite\"\n  aria-atomic=\"true\"\n  className={styles.srOnly}\n\u003e\n  {announcement}\n\u003c/div\u003e\n```\n\n### Test Selectors (data-testid)\nAdd from the start:\n| Element | data-testid |\n|---------|-------------|\n| Container | `date-navigator` |\n| Left chevron | `date-nav-prev` |\n| Date button | `date-nav-button` |\n| Right chevron | `date-nav-next` |\n| Calendar popover | `date-nav-calendar` |\n\n### Accessibility: aria-expanded and aria-haspopup\n```typescript\n\u003cbutton\n  ref={dateButtonRef}\n  data-testid=\"date-nav-button\"\n  aria-label={showNavigation ? \"Open calendar to select date\" : \"Go to daily note for this date\"}\n  aria-expanded={isCalendarOpen}\n  aria-haspopup=\"dialog\"\n  onClick={handleDateClick}\n\u003e\n  {formattedDate}\n\u003c/button\u003e\n```\n\n### Performance: Memoization\n```typescript\nconst formattedDate = useMemo(\n  () =\u003e format(date, 'MMM do, yyyy'),\n  [date]\n);\n```\n\nConsider `memo()` wrapper if parent re-renders frequently.\n\n## Cleanup on Unmount\n\n```typescript\nuseEffect(() =\u003e {\n  return () =\u003e {\n    if (navigateTimeoutRef.current) clearTimeout(navigateTimeoutRef.current);\n    if (hoverTimeoutRef.current) clearTimeout(hoverTimeoutRef.current);\n  };\n}, []);\n```\n\n## Files to Create/Modify\n\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.tsx`\n\n## Acceptance Criteria\n\n- [ ] Interface is exported with `export interface DateNavigatorProps`\n- [ ] Component renders with proper structure\n- [ ] Hover reveals/hides chevrons with smooth transition\n- [ ] Navigation debounced at 200ms\n- [ ] Hover leave debounced at 100ms\n- [ ] Calendar opens on date click (only when showNavigation=true)\n- [ ] All data-testid attributes present\n- [ ] aria-live region for announcements\n- [ ] aria-expanded and aria-haspopup on date button\n- [ ] Date formatting memoized\n- [ ] Keyboard navigation works (arrows, Enter, Escape)\n- [ ] Cleanup on unmount for all timeouts\n\n## Parallel With\n\nCan be implemented in parallel with scribe-2 and scribe-5","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:57:35.63107-06:00","closed_at":"2025-12-21T21:57:35.63107-06:00","dependencies":[{"issue_id":"scribe-4","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.59871-06:00","created_by":"daemon"}]}
{"id":"scribe-5","title":"Create DateNavigator Vanilla Extract styles","description":"# Create DateNavigator Styles\n\n## Context\n\nThe DateNavigator component needs Vanilla Extract styles that match the existing NoteHeader styling and use design system tokens.\n\n## File Location\n\n`apps/desktop/renderer/src/components/NoteHeader/DateNavigator.css.ts`\n\n## Design Token Mapping\n\n| Spec Token | Design System Token |\n|------------|--------------------|\n| Text muted | `vars.color.foregroundMuted` |\n| Text primary | `vars.color.foreground` |\n| Background hover | `vars.color.surface` |\n| Border radius | `vars.radius.sm` / `vars.radius.lg` |\n| Transition | `vars.animation.duration.fast` + `vars.animation.easing.default` |\n| Popover z-index | `vars.zIndex.popover` |\n| Popover shadow | `vars.shadow.lg` |\n\n## Style Definitions\n\n### Container\n\n```typescript\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const dateNavigator = style({\n  display: 'inline-flex',\n  alignItems: 'center',\n  gap: vars.spacing['1'],\n  position: 'relative',\n});\n```\n\n### Chevron Button\n\nKey behaviors:\n- Hidden by default (opacity: 0)\n- Visible on container hover or when calendar open\n- 24x24px click target with 14x14px icon\n- Smooth opacity transition\n\n```typescript\nexport const chevronButton = style({\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  width: '24px',\n  height: '24px',\n  padding: 0,\n  border: 'none',\n  background: 'transparent',\n  borderRadius: vars.radius.sm,\n  cursor: 'pointer',\n  opacity: 0,\n  transition: `opacity ${vars.animation.duration.fast} ${vars.animation.easing.default}, background-color ${vars.animation.duration.fast} ${vars.animation.easing.default}`,\n  color: vars.color.foregroundMuted,\n  ':hover': {\n    color: vars.color.foreground,\n    backgroundColor: vars.color.surface,\n  },\n  ':focus': {\n    outline: 'none',\n  },\n  ':focus-visible': {\n    outline: `2px solid ${vars.color.accent}`,\n    outlineOffset: '2px',\n    opacity: 1,\n  },\n});\n\nexport const chevronVisible = style({\n  opacity: 1,\n});\n```\n\n### Date Button\n\nShould match existing `dateButton` style in NoteHeader.css.ts but may have slight modifications for the navigation context.\n\n```typescript\nexport const dateButton = style({\n  padding: `${vars.spacing['0']} ${vars.spacing['2']}`,\n  border: 'none',\n  background: 'transparent',\n  borderRadius: vars.radius.sm,\n  cursor: 'pointer',\n  fontSize: vars.typography.size.sm,\n  color: vars.color.foreground,\n  fontFamily: vars.typography.fontFamily.ui,\n  transition: `all ${vars.animation.duration.fast} ${vars.animation.easing.default}`,\n  ':hover': {\n    color: vars.color.accent,\n  },\n  ':focus': {\n    outline: 'none',\n  },\n  ':focus-visible': {\n    outline: `2px solid ${vars.color.accent}`,\n    outlineOffset: '2px',\n  },\n});\n```\n\n### Calendar Popover\n\nPositioned below the date button:\n\n```typescript\nexport const calendarPopover = style({\n  position: 'absolute',\n  top: '100%',\n  left: '50%',\n  transform: 'translateX(-50%)',\n  marginTop: vars.spacing['2'],\n  zIndex: vars.zIndex.popover,\n  backgroundColor: vars.color.background,\n  border: `1px solid ${vars.color.border}`,\n  borderRadius: vars.radius.lg,\n  boxShadow: vars.shadow.lg,\n  // Consider adding animation classes later\n});\n```\n\n## Animation Considerations\n\nThe spec calls for:\n- Chevrons: 150ms fade in/out\n- Calendar: Scale 0.95→1.0, opacity 0→1, 150ms\n\nFor MVP, simple opacity transitions are sufficient. Animation can be enhanced later.\n\n## Files to Create\n\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.css.ts`\n\n## Acceptance Criteria\n\n- [ ] All styles use design system tokens\n- [ ] Chevrons hidden by default, visible on hover\n- [ ] Focus-visible states for accessibility\n- [ ] Calendar popover positioned correctly\n- [ ] Smooth transitions on all interactive elements\n- [ ] Matches existing NoteHeader aesthetic","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T21:57:37.091963-06:00","closed_at":"2025-12-21T21:57:37.091963-06:00","dependencies":[{"issue_id":"scribe-5","depends_on_id":"scribe-4","type":"blocks","created_at":"2025-12-21T21:25:45.946096-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-5","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.642844-06:00","created_by":"daemon"}]}
{"id":"scribe-6","title":"Implement calendar popover positioning and outside click","description":"# Calendar Popover Positioning \u0026 Interactions\n\n## Context\n\nThe calendar popover needs proper positioning logic and outside-click-to-close behavior.\n\n## Prerequisites\n\n**IMPORTANT**: First install the dependency:\n```bash\ncd apps/desktop \u0026\u0026 bun add @floating-ui/react\n```\n\n## Requirements\n\n### Positioning\n\n1. Default: Below date button, centered\n2. If insufficient space below: Flip to above\n3. If insufficient space left/right: Adjust horizontal position\n\n### Close Triggers\n\n1. Date selection (handled in DateNavigator)\n2. Escape key (handled in DateNavigator)\n3. Click outside popover\n\n### Implementation: Floating UI\n\nUse `@floating-ui/react` for robust positioning:\n\n```typescript\nimport { \n  useFloating, \n  offset, \n  flip, \n  shift, \n  autoUpdate,\n  useClick,\n  useDismiss,\n  useInteractions,\n  FloatingFocusManager\n} from '@floating-ui/react';\n\nconst { refs, floatingStyles, context } = useFloating({\n  open: isCalendarOpen,\n  onOpenChange: setIsCalendarOpen,\n  placement: 'bottom',\n  middleware: [offset(8), flip(), shift({ padding: 8 })],\n  whileElementsMounted: autoUpdate,\n});\n\nconst click = useClick(context);\nconst dismiss = useDismiss(context, { escapeKey: true, outsidePress: true });\nconst { getReferenceProps, getFloatingProps } = useInteractions([click, dismiss]);\n```\n\n### Focus Management\n\nUse FloatingFocusManager for proper focus trapping:\n\n```typescript\n{isCalendarOpen \u0026\u0026 (\n  \u003cFloatingFocusManager context={context} modal={false}\u003e\n    \u003cdiv\n      ref={refs.setFloating}\n      style={floatingStyles}\n      className={styles.calendarPopover}\n      data-testid=\"date-nav-calendar\"\n      {...getFloatingProps()}\n    \u003e\n      \u003cCalendar\n        mode=\"single\"\n        selected={date}\n        onSelect={handleDateSelect}\n        defaultMonth={date}\n      /\u003e\n    \u003c/div\u003e\n  \u003c/FloatingFocusManager\u003e\n)}\n```\n\n### Outside Click Handling\n\nThe `useDismiss` hook from floating-ui handles this automatically when `outsidePress: true`.\n\n## Files to Modify\n\n- `apps/desktop/package.json` (add dependency)\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.tsx`\n\n## Acceptance Criteria\n\n- [ ] @floating-ui/react installed\n- [ ] Calendar positions correctly below button\n- [ ] Calendar flips above when near bottom edge\n- [ ] Calendar shifts horizontally when near edges\n- [ ] Clicking outside closes calendar\n- [ ] Escape key closes calendar\n- [ ] Focus trapped in calendar while open\n- [ ] Focus returns to date button on close\n\n## Dependencies\n\n- Depends on scribe-4 (DateNavigator skeleton must exist first)","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T22:05:24.139743-06:00","closed_at":"2025-12-21T22:05:24.139743-06:00","dependencies":[{"issue_id":"scribe-6","depends_on_id":"scribe-4","type":"blocks","created_at":"2025-12-21T21:25:56.233989-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-6","depends_on_id":"scribe-5","type":"blocks","created_at":"2025-12-21T21:26:06.520084-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-6","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.687314-06:00","created_by":"daemon"}]}
{"id":"scribe-7","title":"Add DateNavigator unit tests","description":"# DateNavigator Unit Tests\n\n## Context\n\nComprehensive unit tests for the DateNavigator component to verify all interaction behaviors.\n\n## Test File\n\n`apps/desktop/renderer/src/components/NoteHeader/DateNavigator.test.tsx`\n\n## Test Framework\n\n- Vitest for test runner\n- React Testing Library for component testing\n- @testing-library/user-event for interaction simulation\n\n## Test Categories\n\n### Rendering Tests\n\n| Test | Condition | Expected |\n|------|-----------|----------|\n| Renders date | Date = Dec 21, 2024 | Shows \"Dec 21st, 2024\" |\n| Renders chevrons when showNavigation=true | Default props | Left/right chevrons present |\n| Hides chevrons when showNavigation=false | showNavigation=false | No chevron buttons |\n\n### Hover Behavior Tests\n\n| Test | Action | Expected |\n|------|--------|----------|\n| Chevrons hidden initially | Mount component | Chevrons have opacity: 0 |\n| Chevrons visible on hover | Mouse enter container | Chevrons have opacity: 1 |\n| Chevrons hidden after hover | Mouse leave, wait 100ms | Chevrons have opacity: 0 |\n| Chevrons stay visible during calendar | Open calendar | Chevrons remain visible |\n\n### Navigation Tests\n\n| Test | Action | Expected |\n|------|--------|----------|\n| Previous day click | Click left chevron | onNavigate(Dec 20) |\n| Next day click | Click right chevron | onNavigate(Dec 22) |\n| Debounce rapid clicks | Click 3x in 100ms | Only 1 onNavigate call |\n\n### Calendar Tests\n\n| Test | Action | Expected |\n|------|--------|----------|\n| Opens on date click | Click date button | Calendar visible |\n| Closes on selection | Select date in calendar | Calendar hidden, onNavigate called |\n| Closes on Escape | Press Escape | Calendar hidden, no navigation |\n| Closes on outside click | Click outside | Calendar hidden, no navigation |\n| Focus returns on close | Close calendar | Date button focused |\n\n### Keyboard Navigation Tests\n\n| Test | Action | Expected |\n|------|--------|----------|\n| Left arrow navigates | Press ArrowLeft | onNavigate(prev day) |\n| Right arrow navigates | Press ArrowRight | onNavigate(next day) |\n| Enter opens calendar | Focus date, press Enter | Calendar opens |\n| Space opens calendar | Focus date, press Space | Calendar opens |\n\n### Props Tests\n\n| Test | Props | Expected |\n|------|-------|----------|\n| No navigation when disabled | showNavigation=false | No chevrons, no calendar |\n| Custom date displayed | date = Jan 1, 2025 | Shows \"Jan 1st, 2025\" |\n\n## Sample Test Implementation\n\n```typescript\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { DateNavigator } from './DateNavigator';\n\ndescribe('DateNavigator', () =\u003e {\n  const mockOnNavigate = vi.fn();\n  const defaultDate = new Date('2024-12-21T12:00:00');\n\n  beforeEach(() =\u003e {\n    vi.clearAllMocks();\n  });\n\n  it('renders the formatted date', () =\u003e {\n    render(\u003cDateNavigator date={defaultDate} onNavigate={mockOnNavigate} /\u003e);\n    expect(screen.getByText('Dec 21st, 2024')).toBeInTheDocument();\n  });\n\n  it('shows chevrons on hover', async () =\u003e {\n    const user = userEvent.setup();\n    render(\u003cDateNavigator date={defaultDate} onNavigate={mockOnNavigate} /\u003e);\n    \n    const container = screen.getByRole('button', { name: /previous/i }).parentElement!;\n    await user.hover(container);\n    \n    const leftChevron = screen.getByLabelText('Navigate to previous day');\n    expect(leftChevron).toHaveStyle({ opacity: '1' });\n  });\n\n  it('navigates to previous day on left chevron click', async () =\u003e {\n    const user = userEvent.setup();\n    render(\u003cDateNavigator date={defaultDate} onNavigate={mockOnNavigate} /\u003e);\n    \n    await user.click(screen.getByLabelText('Navigate to previous day'));\n    \n    await waitFor(() =\u003e {\n      expect(mockOnNavigate).toHaveBeenCalledWith(\n        expect.objectContaining({ getDate: expect.any(Function) })\n      );\n    });\n    // Verify it's Dec 20\n    const calledDate = mockOnNavigate.mock.calls[0][0];\n    expect(calledDate.getDate()).toBe(20);\n  });\n\n  // ... more tests\n});\n```\n\n## Files to Create\n\n- `apps/desktop/renderer/src/components/NoteHeader/DateNavigator.test.tsx`\n\n## Acceptance Criteria\n\n- [ ] All test cases from tables implemented\n- [ ] Tests use proper async/await patterns\n- [ ] No flaky tests\n- [ ] Good coverage of edge cases\n- [ ] Tests pass in CI","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T22:05:57.53239-06:00","closed_at":"2025-12-21T22:05:57.53239-06:00","dependencies":[{"issue_id":"scribe-7","depends_on_id":"scribe-4","type":"blocks","created_at":"2025-12-21T21:26:16.809073-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-7","depends_on_id":"scribe-5","type":"blocks","created_at":"2025-12-21T21:26:27.097027-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-7","depends_on_id":"scribe-6","type":"blocks","created_at":"2025-12-21T21:26:37.385474-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-7","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.732515-06:00","created_by":"daemon"}]}
{"id":"scribe-8","title":"Integrate DateNavigator into NoteHeader","description":"# Integrate DateNavigator into NoteHeader\n\n## Context\n\nReplace the existing date button in NoteHeader with the new DateNavigator component.\n\n## Current Implementation (NoteHeader.tsx)\n\nLines 227-240 contain the current date button that will be replaced.\n\n## Required Changes\n\n### 1. Update Props Interface\n\n```typescript\ninterface NoteHeaderProps {\n  note: Note;\n  onTitleChange: (title: string) =\u003e void;\n  onTagsChange: (tags: string[]) =\u003e void;\n  /** Called when navigating to a daily note for a date */\n  onNavigateToDaily: (date: Date) =\u003e void; // Renamed from onDateClick\n  translateY?: number;\n}\n```\n\n### 2. Import DateNavigator\n\n```typescript\nimport { DateNavigator } from './DateNavigator';\n```\n\n### 3. Replace Date Button\n\n```typescript\n\u003cdiv className={styles.metadataItem}\u003e\n  {(() =\u003e {\n    const displayDate = getDisplayDate(note);\n    const isDailyNote = note.type === 'daily';\n    return (\n      \u003cDateNavigator\n        date={displayDate.date}\n        onNavigate={onNavigateToDaily}\n        showNavigation={isDailyNote}\n      /\u003e\n    );\n  })()}\n\u003c/div\u003e\n```\n\n### 4. Update Index Export\n\n`apps/desktop/renderer/src/components/NoteHeader/index.ts`:\n\n```typescript\nexport { NoteHeader } from './NoteHeader';\nexport { DateNavigator } from './DateNavigator';\nexport type { DateNavigatorProps } from './DateNavigator';\n```\n\n### 5. Cleanup: Remove Deprecated Styles (from scribe-18)\n\nAfter integration, remove the unused `dateButton` style from NoteHeader.css.ts (lines 80-102):\n\n```bash\n# Verify not used elsewhere first\ngrep -r \"dateButton\" --include=\"*.ts\" --include=\"*.tsx\" apps/desktop/renderer/src/\n```\n\nThen remove the style definition.\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/components/NoteHeader/NoteHeader.tsx`\n- `apps/desktop/renderer/src/components/NoteHeader/NoteHeader.css.ts` (cleanup)\n- `apps/desktop/renderer/src/components/NoteHeader/index.ts`\n\n## Acceptance Criteria\n\n- [ ] DateNavigator renders in place of old date button\n- [ ] Daily notes show navigation controls\n- [ ] Non-daily notes hide navigation controls\n- [ ] Prop renamed from onDateClick to onNavigateToDaily\n- [ ] Old dateButton style removed from CSS\n- [ ] Build passes with no TypeScript errors\n- [ ] Index exports updated","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T22:03:34.453038-06:00","closed_at":"2025-12-21T22:03:34.453038-06:00","dependencies":[{"issue_id":"scribe-8","depends_on_id":"scribe-4","type":"blocks","created_at":"2025-12-21T21:26:47.569447-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-8","depends_on_id":"scribe-5","type":"blocks","created_at":"2025-12-21T21:26:57.848458-06:00","created_by":"erikjohansson"},{"issue_id":"scribe-8","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.777143-06:00","created_by":"daemon"}]}
{"id":"scribe-8ye","title":"Technical Debt: TypeScript Strictness \u0026 Type Safety","description":"# Technical Debt: TypeScript Strictness \u0026 Type Safety\n\n## Strategic Context\n\nTypeScript's value proposition is catching bugs at compile time rather than runtime. The codebase analysis revealed several patterns that undermine this:\n\n1. **`any` types** - Bypass type checking entirely\n2. **`as unknown as T` assertions** - Force type system to accept possibly-incorrect casts\n3. **ESLint disables** - Suppress type-related warnings\n4. **`@ts-expect-error`** - Acknowledge type issues without fixing them\n\n### Why This Matters\n\n1. **Runtime Errors**: `any` types can lead to \"undefined is not a function\" at runtime.\n2. **Refactoring Risk**: Type assertions mask breaking changes during refactors.\n3. **Editor Experience**: IDEs can't provide accurate autocomplete with `any`.\n4. **Documentation**: Types serve as documentation; `any` provides no information.\n\n### Philosophical Approach\n\nThe goal is not \"zero `any`\" but rather:\n- **Production code**: Should have proper types (P0)\n- **Test mocks**: May use `any` with justification (P2)\n- **External APIs**: May need `unknown` with runtime validation (P1)\n\n## Scope\n\nThis epic focuses on:\n- Replacing `any` with proper types in production code\n- Reducing `as unknown as T` chains where possible\n- Documenting legitimate cases where type assertions are necessary\n- Improving type definitions where they're incomplete\n\n## Out of Scope\n\n- Changing external library types\n- Rewriting code to avoid necessary type assertions for testing\n\n## Success Criteria\n\n- [ ] Zero `any` types in packages/ production code\n- [ ] `any` in apps/ production code documented with justification\n- [ ] All `as unknown as` in production code reviewed and minimized\n- [ ] ESLint type-related disables documented\n\n## Technical Notes\n\n### Found `any` Usages\n\nProduction code:\n- `apps/desktop/renderer/src/components/Tasks/TaskItem.tsx` - Event handler casts\n\nTest code (lower priority):\n- `packages/engine-core/src/task-extraction.test.ts`\n- `packages/engine-core/src/metadata.test.ts`\n- `apps/desktop/templates.integration.test.ts`\n- `apps/desktop/renderer/src/templates/meeting.test.ts`\n\n### Found `as unknown as` Patterns\n\n72 occurrences total. Many are in tests for mocking, which is acceptable. Production concerns:\n- `TaskItem.tsx:157,172` - Event handler type mismatch\n\n### ESLint Disables\n\n- `@typescript-eslint/no-explicit-any` - Should be minimized\n- `@typescript-eslint/no-unused-expressions` - Context.ts force-init pattern\n- `react-hooks/exhaustive-deps` - createLinkContext.tsx\n\n## Dependencies\n\nNone - can be worked in parallel with other cleanup","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:35:43.44632-06:00","updated_at":"2025-12-21T22:35:43.44632-06:00"}
{"id":"scribe-8ye.1","title":"Fix any types in TaskItem.tsx event handlers","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:35:43.507556-06:00","updated_at":"2025-12-22T12:38:42.292392-06:00","closed_at":"2025-12-22T12:38:42.292392-06:00","dependencies":[{"issue_id":"scribe-8ye.1","depends_on_id":"scribe-8ye","type":"parent-child","created_at":"2025-12-21T22:35:43.507889-06:00","created_by":"daemon"}]}
{"id":"scribe-8ye.2","title":"Review and fix as unknown as casts in production code","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:35:43.568858-06:00","updated_at":"2025-12-22T12:49:36.980369-06:00","closed_at":"2025-12-22T12:49:36.980369-06:00","dependencies":[{"issue_id":"scribe-8ye.2","depends_on_id":"scribe-8ye","type":"parent-child","created_at":"2025-12-21T22:35:43.569194-06:00","created_by":"daemon"}]}
{"id":"scribe-8ye.3","title":"Document legitimate ESLint disables with justification comments","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:35:43.629998-06:00","updated_at":"2025-12-21T22:35:43.629998-06:00","dependencies":[{"issue_id":"scribe-8ye.3","depends_on_id":"scribe-8ye","type":"parent-child","created_at":"2025-12-21T22:35:43.630352-06:00","created_by":"daemon"}]}
{"id":"scribe-8ye.4","title":"Add proper types to test mocks in engine-core","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:35:43.691441-06:00","updated_at":"2025-12-21T22:35:43.691441-06:00","dependencies":[{"issue_id":"scribe-8ye.4","depends_on_id":"scribe-8ye","type":"parent-child","created_at":"2025-12-21T22:35:43.691793-06:00","created_by":"daemon"}]}
{"id":"scribe-8ye.5","title":"Add proper types to integration test mocks","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:35:43.752859-06:00","updated_at":"2025-12-21T22:35:43.752859-06:00","dependencies":[{"issue_id":"scribe-8ye.5","depends_on_id":"scribe-8ye","type":"parent-child","created_at":"2025-12-21T22:35:43.753227-06:00","created_by":"daemon"}]}
{"id":"scribe-9","title":"Update NoteHeader tests for DateNavigator integration","description":"# Update NoteHeader Tests\n\n## Context\n\nAfter integrating DateNavigator, NoteHeader tests need updates to:\n1. Test the new prop name (`onNavigateToDaily`)\n2. Test that DateNavigator is rendered correctly\n3. Test title display logic (Today/Yesterday/Tomorrow)\n\n## Test File\n\n`apps/desktop/renderer/src/components/NoteHeader/NoteHeader.test.tsx`\n\n## New Test Cases\n\n### Component Integration Tests\n\n| Test | Condition | Expected |\n|------|-----------|----------|\n| Daily note shows navigation | note.type = 'daily' | DateNavigator with showNavigation=true |\n| Non-daily hides navigation | note.type = 'note' | DateNavigator with showNavigation=false |\n| Meeting note hides navigation | note.type = 'meeting' | DateNavigator with showNavigation=false |\n\n### Title Display Tests\n\n| Test | Note Date | Expected Title |\n|------|-----------|---------------|\n| Today's daily | Today | \"Today\" |\n| Yesterday's daily | Yesterday | \"Yesterday\" |\n| Tomorrow's daily | Tomorrow | \"Tomorrow\" |\n| Other date daily | 2 days ago | \"Dec 19th, 2024\" |\n| Historical daily | Jul 28, 1990 | \"Jul 28th, 1990\" |\n\n### Prop Rename Tests\n\n| Test | Action | Expected |\n|------|--------|----------|\n| onNavigateToDaily called | Navigate via DateNavigator | Prop function called with Date |\n\n## Sample Tests\n\n```typescript\nimport { render, screen } from '@testing-library/react';\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\nimport { NoteHeader } from './NoteHeader';\nimport type { Note } from '@scribe/shared';\n\nfunction createNote(overrides: Partial\u003cNote\u003e = {}): Note {\n  return {\n    id: 'test-id',\n    title: '12-21-2024',\n    type: 'daily',\n    tags: ['daily'],\n    content: { root: { children: [] } },\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    ...overrides,\n  } as Note;\n}\n\ndescribe('NoteHeader', () =\u003e {\n  beforeEach(() =\u003e {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date('2024-12-21T12:00:00'));\n  });\n\n  afterEach(() =\u003e {\n    vi.useRealTimers();\n  });\n\n  describe('title display for daily notes', () =\u003e {\n    it('shows \"Today\" for today\\'s daily note', () =\u003e {\n      const note = createNote({ title: '12-21-2024' });\n      render(\n        \u003cNoteHeader\n          note={note}\n          onTitleChange={() =\u003e {}}\n          onTagsChange={() =\u003e {}}\n          onNavigateToDaily={() =\u003e {}}\n        /\u003e\n      );\n      // The title input should show \"Today\"\n      expect(screen.getByDisplayValue('Today')).toBeInTheDocument();\n    });\n\n    it('shows \"Yesterday\" for yesterday\\'s daily note', () =\u003e {\n      const note = createNote({ title: '12-20-2024' });\n      render(\n        \u003cNoteHeader\n          note={note}\n          onTitleChange={() =\u003e {}}\n          onTagsChange={() =\u003e {}}\n          onNavigateToDaily={() =\u003e {}}\n        /\u003e\n      );\n      expect(screen.getByDisplayValue('Yesterday')).toBeInTheDocument();\n    });\n\n    it('shows \"Tomorrow\" for tomorrow\\'s daily note', () =\u003e {\n      const note = createNote({ title: '12-22-2024' });\n      render(\n        \u003cNoteHeader\n          note={note}\n          onTitleChange={() =\u003e {}}\n          onTagsChange={() =\u003e {}}\n          onNavigateToDaily={() =\u003e {}}\n        /\u003e\n      );\n      expect(screen.getByDisplayValue('Tomorrow')).toBeInTheDocument();\n    });\n  });\n\n  describe('DateNavigator integration', () =\u003e {\n    it('shows navigation for daily notes', () =\u003e {\n      const note = createNote({ type: 'daily' });\n      render(\n        \u003cNoteHeader\n          note={note}\n          onTitleChange={() =\u003e {}}\n          onTagsChange={() =\u003e {}}\n          onNavigateToDaily={() =\u003e {}}\n        /\u003e\n      );\n      expect(screen.getByLabelText('Navigate to previous day')).toBeInTheDocument();\n      expect(screen.getByLabelText('Navigate to next day')).toBeInTheDocument();\n    });\n\n    it('hides navigation for non-daily notes', () =\u003e {\n      const note = createNote({ type: 'note', title: 'Regular Note' });\n      render(\n        \u003cNoteHeader\n          note={note}\n          onTitleChange={() =\u003e {}}\n          onTagsChange={() =\u003e {}}\n          onNavigateToDaily={() =\u003e {}}\n        /\u003e\n      );\n      expect(screen.queryByLabelText('Navigate to previous day')).not.toBeInTheDocument();\n    });\n  });\n});\n```\n\n## Files to Modify\n\n- `apps/desktop/renderer/src/components/NoteHeader/NoteHeader.test.tsx`\n\n## Acceptance Criteria\n\n- [ ] Tests updated for `onNavigateToDaily` prop\n- [ ] Title display tests for Today/Yesterday/Tomorrow\n- [ ] DateNavigator integration tests\n- [ ] All existing tests still pass\n- [ ] No flaky tests","status":"closed","priority":2,"issue_type":"task","created_at":"2024-12-21T12:00:00Z","updated_at":"2025-12-21T22:08:50.885666-06:00","closed_at":"2025-12-21T22:08:50.885666-06:00","dependencies":[{"issue_id":"scribe-9","depends_on_id":"scribe-3","type":"blocks","created_at":"2025-12-21T21:28:17.723739-06:00","created_by":"daemon"},{"issue_id":"scribe-9","depends_on_id":"scribe-8","type":"blocks","created_at":"2025-12-21T21:28:17.77382-06:00","created_by":"daemon"},{"issue_id":"scribe-9","depends_on_id":"scribe-1","type":"parent-child","created_at":"2025-12-21T21:28:24.822356-06:00","created_by":"daemon"}]}
{"id":"scribe-cfc","title":"Technical Debt: Error Handling Consistency","description":"# Technical Debt: Error Handling Consistency\n\n## Strategic Context\n\nScribe's architecture (decision_8_data_flow.md) emphasizes **unidirectional data flow** and clear error boundaries. However, the codebase analysis revealed inconsistent error handling patterns:\n\n1. **Silent error swallowing**: Some catch blocks only log, with no user feedback\n2. **Inconsistent error extraction**: Different patterns for getting error messages\n3. **Mixed strategies**: Some handlers rethrow, others set state, others just log\n4. **No centralized error handling**: Each component invents its own approach\n\n### Why This Matters\n\n1. **User Experience**: Users can't know something failed if there's no feedback.\n2. **Debugging**: Swallowed errors are invisible in production.\n3. **Inconsistency**: Different components behave differently on failure.\n4. **Trust**: Users lose trust when operations fail silently.\n\n### Error Handling Principles\n\nPer the architecture, we should:\n1. **Report errors to users** via toast notifications for user-initiated actions\n2. **Log errors** with sufficient context for debugging\n3. **Preserve state** - don't leave app in broken state on error\n4. **Be consistent** - same pattern everywhere\n\n## Scope\n\nThis epic covers:\n- Auditing all try/catch blocks for consistent behavior\n- Ensuring user-initiated actions show error toasts\n- Standardizing error message extraction\n- Adding missing error handling where needed\n\n## Out of Scope\n\n- Changing error codes or error types\n- Adding error tracking/telemetry (future epic)\n- Retry logic (future epic)\n\n## Success Criteria\n\n- [ ] All user-initiated actions have error feedback\n- [ ] Consistent error extraction pattern documented and used\n- [ ] No silent catch blocks in user-facing code\n- [ ] Error handling guide added to CONTRIBUTING.md\n\n## Technical Notes\n\n### Current Patterns Found\n\nPattern A (incomplete):\n```typescript\ntry { ... } catch (error) {\n  console.error('Failed to load tasks:', error);\n  // No user feedback!\n}\n```\n\nPattern B (better):\n```typescript\ntry { ... } catch (err) {\n  const errorMessage = err instanceof Error ? err.message : 'Failed to load note';\n  showToast(errorMessage, 'error');\n  console.error('Failed to load note:', err);\n}\n```\n\n### Files with Silent Catch Blocks\n\n- `TasksWidget.tsx:76-80, 166-168`\n- `CommandModePanel.tsx:93-95`\n- Various hooks\n\n### Recommended Standard Pattern\n\n```typescript\ntry {\n  await riskyOperation();\n} catch (error) {\n  // 1. Extract message safely\n  const message = error instanceof Error ? error.message : 'Operation failed';\n  \n  // 2. Show user feedback (if user-initiated)\n  showToast(message, 'error');\n  \n  // 3. Log with context\n  console.error('[ComponentName] Operation failed:', { error, context });\n  \n  // 4. Update state if needed\n  setError(message);\n}\n```\n\n## Dependencies\n\nNone - can be worked independently","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:36:06.674884-06:00","updated_at":"2025-12-21T22:36:06.674884-06:00"}
{"id":"scribe-cfc.1","title":"Add user feedback to TasksWidget error handlers","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:36:06.734826-06:00","updated_at":"2025-12-22T12:42:05.342598-06:00","closed_at":"2025-12-22T12:42:05.342598-06:00","dependencies":[{"issue_id":"scribe-cfc.1","depends_on_id":"scribe-cfc","type":"parent-child","created_at":"2025-12-21T22:36:06.735149-06:00","created_by":"daemon"}]}
{"id":"scribe-cfc.2","title":"Add user feedback to CommandModePanel search errors","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:36:06.794067-06:00","updated_at":"2025-12-22T12:43:59.828327-06:00","closed_at":"2025-12-22T12:43:59.828327-06:00","dependencies":[{"issue_id":"scribe-cfc.2","depends_on_id":"scribe-cfc","type":"parent-child","created_at":"2025-12-21T22:36:06.794391-06:00","created_by":"daemon"}]}
{"id":"scribe-cfc.3","title":"Standardize error message extraction pattern","description":"# Standardize error message extraction pattern\n\n## Context\n\nThe codebase has inconsistent patterns for extracting error messages from caught exceptions:\n\n**Pattern A** (incomplete):\n```typescript\ncatch (error) {\n  console.error('Failed:', error);  // Just logs, no message extraction\n}\n```\n\n**Pattern B** (inline):\n```typescript\ncatch (err) {\n  const message = err instanceof Error ? err.message : 'Unknown error';\n}\n```\n\n**Pattern C** (varied fallbacks):\n```typescript\ncatch (e) {\n  const msg = e instanceof Error ? e.message : 'Failed to load note';\n  // vs\n  const msg = e instanceof Error ? e.message : String(e);\n  // vs\n  const msg = e instanceof Error ? e.message : 'Operation failed';\n}\n```\n\n## Proposed Solution\n\nAdd a utility function to `@scribe/shared/errors.ts`:\n\n```typescript\n/**\n * Safely extract an error message from an unknown caught value.\n * \n * @param error - The caught value (could be Error, string, or anything)\n * @param fallback - Default message if error is not an Error instance\n * @returns Human-readable error message\n * \n * @example\n * try {\n *   await riskyOperation();\n * } catch (error) {\n *   const message = getErrorMessage(error, 'Operation failed');\n *   showToast(message, 'error');\n * }\n */\nexport function getErrorMessage(error: unknown, fallback = 'An error occurred'): string {\n  if (error instanceof Error) {\n    return error.message;\n  }\n  if (typeof error === 'string') {\n    return error;\n  }\n  return fallback;\n}\n\n/**\n * Extract error message with context prefix.\n * \n * @example\n * getErrorMessageWithContext(error, 'Failed to save note');\n * // Returns: \"Failed to save note: \u003cerror message\u003e\" or \"Failed to save note\"\n */\nexport function getErrorMessageWithContext(\n  error: unknown, \n  context: string\n): string {\n  const message = getErrorMessage(error);\n  return message !== 'An error occurred' \n    ? `${context}: ${message}` \n    : context;\n}\n```\n\n## Migration Examples\n\n**Before:**\n```typescript\ncatch (err) {\n  const errorMessage = err instanceof Error ? err.message : 'Failed to load note';\n  showToast(errorMessage, 'error');\n}\n```\n\n**After:**\n```typescript\nimport { getErrorMessage } from '@scribe/shared';\n\ncatch (error) {\n  showToast(getErrorMessage(error, 'Failed to load note'), 'error');\n}\n```\n\n## Files to Modify\n\n- `packages/shared/src/errors.ts` - Add utility functions\n- `packages/shared/src/errors.test.ts` - Add tests\n- `packages/shared/src/index.ts` - Export new functions\n\n## Acceptance Criteria\n\n- [ ] `getErrorMessage` function added to @scribe/shared\n- [ ] `getErrorMessageWithContext` function added\n- [ ] Comprehensive tests for edge cases (null, undefined, objects, etc.)\n- [ ] JSDoc documentation with examples\n- [ ] Exported from package index","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:36:06.853627-06:00","updated_at":"2025-12-21T22:55:28.052925-06:00","closed_at":"2025-12-21T22:55:28.052925-06:00","dependencies":[{"issue_id":"scribe-cfc.3","depends_on_id":"scribe-cfc","type":"parent-child","created_at":"2025-12-21T22:36:06.853931-06:00","created_by":"daemon"}]}
{"id":"scribe-cfc.4","title":"Audit and fix error handling in useNoteState hook","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:36:06.912375-06:00","updated_at":"2025-12-21T22:36:06.912375-06:00","dependencies":[{"issue_id":"scribe-cfc.4","depends_on_id":"scribe-cfc","type":"parent-child","created_at":"2025-12-21T22:36:06.912676-06:00","created_by":"daemon"}]}
{"id":"scribe-cfc.5","title":"Document error handling patterns in CONTRIBUTING.md","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:36:06.970911-06:00","updated_at":"2025-12-21T22:36:06.970911-06:00","dependencies":[{"issue_id":"scribe-cfc.5","depends_on_id":"scribe-cfc","type":"parent-child","created_at":"2025-12-21T22:36:06.971225-06:00","created_by":"daemon"}]}
{"id":"scribe-dq8","title":"Technical Debt: Magic Numbers \u0026 Hardcoded Values","description":"# Technical Debt: Magic Numbers \u0026 Hardcoded Values\n\n## Strategic Context\n\nMagic numbers are literal values in code without explanation of what they represent. They make code:\n- Hard to understand (what does `2000` mean?)\n- Hard to change (search for all `2000`s?)\n- Error-prone (is this `2000` the same as that `2000`?)\n\nThe codebase has good examples of proper constants (e.g., `MAX_INDEXED_CONTENT_LENGTH`, `PERSIST_DEBOUNCE_MS`) but also has scattered magic numbers, particularly for timeouts and UI timings.\n\n### Why This Matters\n\n1. **Clarity**: `MOUSE_INACTIVITY_THRESHOLD_MS` is self-documenting; `2000` is not.\n2. **Consistency**: If toast duration should be 3s everywhere, one constant ensures that.\n3. **Tuning**: Want to experiment with longer timeouts? Change one place.\n4. **Review**: Reviewers can validate constant values without grepping.\n\n### Good Examples in Codebase (to emulate)\n\n```typescript\n// packages/engine-search/src/search-engine.ts\nconst MAX_INDEXED_CONTENT_LENGTH = 1000;\nconst SNIPPET_MAX_LENGTH = 160;\n\n// packages/engine-core/src/task-index.ts\nconst PERSIST_DEBOUNCE_MS = 5000;\n\n// apps/desktop/renderer/src/components/CommandPalette/config.ts\nconst SEARCH_DEBOUNCE_MS = 150;\n```\n\n## Scope\n\nThis epic covers extracting magic numbers to named constants for:\n- Timeout durations\n- UI animation timings\n- Buffer sizes\n- Retry counts\n- Any other unexplained literal values\n\n## Out of Scope\n\n- CSS values (handled by design tokens)\n- Array indices that are inherently contextual\n- Mathematical constants (π, etc.)\n\n## Success Criteria\n\n- [ ] All timeout values have named constants\n- [ ] Constants are co-located with usage or in a constants file\n- [ ] JSDoc comments explain why each value was chosen\n- [ ] No bare numeric literals for durations in production code\n\n## Technical Notes\n\n### Magic Numbers Found\n\n| File | Line | Value | Should Be |\n|------|------|-------|-----------|\n| DateNavigator.tsx | 102 | `1000` | `ANNOUNCEMENT_TIMEOUT_MS` |\n| SelectionToolbarPlugin.tsx | 280 | `0` | `IMMEDIATE_EXECUTION_DELAY` (or explain why 0) |\n| useMouseActivity.ts | 29 | `2000` | `DEFAULT_INACTIVITY_THRESHOLD_MS` |\n| useToast.ts | 15 | `3000` | `TOAST_AUTO_DISMISS_MS` |\n| ErrorNotification.tsx | 20 | `5000` | `ERROR_NOTIFICATION_DURATION_MS` |\n\n### Recommended Patterns\n\n```typescript\n// Option 1: In-file constant (for single-use values)\nconst HOVER_DEBOUNCE_MS = 100;\n\n// Option 2: Shared constants file (for cross-component values)\n// apps/desktop/renderer/src/constants/timing.ts\nexport const TOAST_DURATION_MS = 3000;\nexport const ERROR_DURATION_MS = 5000;\n\n// Option 3: Design system token (for design-related values)\n// Already handled by vars.animation.duration.*\n```\n\n## Dependencies\n\nNone - straightforward refactoring","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:36:32.341081-06:00","updated_at":"2025-12-21T22:36:32.341081-06:00"}
{"id":"scribe-dq8.1","title":"Extract timeout constants in DateNavigator","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:36:32.401102-06:00","updated_at":"2025-12-21T22:36:32.401102-06:00","dependencies":[{"issue_id":"scribe-dq8.1","depends_on_id":"scribe-dq8","type":"parent-child","created_at":"2025-12-21T22:36:32.401407-06:00","created_by":"daemon"}]}
{"id":"scribe-dq8.2","title":"Extract timeout constants in useMouseActivity","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:36:32.460279-06:00","updated_at":"2025-12-21T22:36:32.460279-06:00","dependencies":[{"issue_id":"scribe-dq8.2","depends_on_id":"scribe-dq8","type":"parent-child","created_at":"2025-12-21T22:36:32.460606-06:00","created_by":"daemon"}]}
{"id":"scribe-dq8.3","title":"Extract toast/notification duration constants","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:36:32.519519-06:00","updated_at":"2025-12-21T22:36:32.519519-06:00","dependencies":[{"issue_id":"scribe-dq8.3","depends_on_id":"scribe-dq8","type":"parent-child","created_at":"2025-12-21T22:36:32.519829-06:00","created_by":"daemon"}]}
{"id":"scribe-dq8.4","title":"Create shared timing constants file","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:36:32.578008-06:00","updated_at":"2025-12-21T22:36:32.578008-06:00","dependencies":[{"issue_id":"scribe-dq8.4","depends_on_id":"scribe-dq8","type":"parent-child","created_at":"2025-12-21T22:36:32.578328-06:00","created_by":"daemon"}]}
{"id":"scribe-dq8.5","title":"Document constant value rationale with JSDoc","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:36:32.636372-06:00","updated_at":"2025-12-21T22:36:32.636372-06:00","dependencies":[{"issue_id":"scribe-dq8.5","depends_on_id":"scribe-dq8","type":"parent-child","created_at":"2025-12-21T22:36:32.636671-06:00","created_by":"daemon"}]}
{"id":"scribe-mcc","title":"Technical Debt: Logging Infrastructure","description":"# Technical Debt: Logging Infrastructure\n\n## Strategic Context\n\nThe codebase currently uses `console.*` statements directly throughout the code. Analysis found 100+ console statements in non-test files. While console logging works for development, it has significant limitations:\n\n1. **No log levels**: Can't filter by severity in production\n2. **No structure**: Hard to parse logs programmatically\n3. **No context**: No automatic addition of timestamps, component names, etc.\n4. **No aggregation**: Logs are scattered, not centralized\n5. **Performance**: Console calls in production can impact performance\n\n### Why This Matters\n\n1. **Debugging Production Issues**: Without structured logs, debugging user-reported issues requires guessing.\n2. **Performance Monitoring**: Can't track timing or identify bottlenecks.\n3. **Security Auditing**: Can't track sensitive operations.\n4. **Error Tracking**: No integration with error tracking services.\n\n### Current State\n\n```typescript\n// Found patterns:\nconsole.log('Loading note:', noteId);\nconsole.error('Failed to save:', error);\nconsole.warn('File not found:', path);\nconsole.debug('Task state:', state);\n```\n\n### Desired State\n\n```typescript\nimport { logger } from '@scribe/shared/logger';\n\nlogger.info('Loading note', { noteId });\nlogger.error('Failed to save', { error, noteId });\nlogger.warn('File not found', { path });\nlogger.debug('Task state', { state });\n```\n\n## Scope\n\nThis epic covers:\n1. Creating a lightweight logger abstraction in `@scribe/shared`\n2. Migrating console statements to use the logger\n3. Adding log level filtering for production builds\n4. Optionally: Adding structured JSON output for log aggregation\n\n## Out of Scope (Future Epics)\n\n- Error tracking service integration (Sentry, etc.)\n- Remote log aggregation\n- Performance telemetry\n- User analytics\n\n## Success Criteria\n\n- [ ] Logger abstraction created in @scribe/shared\n- [ ] All production console statements migrated\n- [ ] Log levels respect environment (debug hidden in prod)\n- [ ] Logs include component context automatically\n\n## Technical Notes\n\n### Proposed Logger API\n\n```typescript\n// packages/shared/src/logger.ts\n\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\ninterface LogContext {\n  [key: string]: unknown;\n}\n\ninterface Logger {\n  debug(message: string, context?: LogContext): void;\n  info(message: string, context?: LogContext): void;\n  warn(message: string, context?: LogContext): void;\n  error(message: string, context?: LogContext): void;\n  child(component: string): Logger;\n}\n\n// Usage:\nconst log = logger.child('TasksWidget');\nlog.info('Loading tasks', { count: 10 });\n// Output: [TasksWidget] Loading tasks { count: 10 }\n```\n\n### Files with Most Console Statements\n\n- `packages/storage-fs/src/storage.ts` - file operations\n- `packages/storage-fs/src/quarantine-manager.ts` - quarantine ops\n- `packages/engine-core/src/task-index.ts` - persistence failures\n- `apps/desktop/renderer/src/hooks/useNoteState.ts` - state changes\n- `apps/desktop/renderer/src/components/ContextPanel/TasksWidget.tsx` - task loading\n\n### Migration Strategy\n\n1. Create logger in @scribe/shared\n2. Add to packages first (less UI churn)\n3. Add to renderer components\n4. Remove direct console usage via ESLint rule\n\n## Dependencies\n\nNone - can be worked independently, though test coverage epic helps validate","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:37:03.498386-06:00","updated_at":"2025-12-21T22:37:03.498386-06:00"}
{"id":"scribe-mcc.1","title":"Create logger abstraction in @scribe/shared","description":"# Create logger abstraction in @scribe/shared\n\n## Context\n\nThe codebase uses `console.*` directly throughout, with 100+ occurrences in non-test files. This makes it impossible to:\n- Filter logs by severity in production\n- Add structured context to logs\n- Disable debug logs in production builds\n- Integrate with log aggregation services later\n\n## Design Goals\n\n1. **Zero external dependencies**: Pure TypeScript, no winston/pino/etc.\n2. **Minimal API surface**: Just the methods needed\n3. **Type-safe context**: Structured logging with typed context objects\n4. **Environment-aware**: Respects log level from environment\n5. **Tree-shakeable**: Unused methods can be eliminated\n\n## Proposed Implementation\n\n```typescript\n// packages/shared/src/logger.ts\n\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error';\ntype LogContext = Record\u003cstring, unknown\u003e;\n\ninterface Logger {\n  debug(message: string, context?: LogContext): void;\n  info(message: string, context?: LogContext): void;\n  warn(message: string, context?: LogContext): void;\n  error(message: string, context?: LogContext): void;\n  child(name: string): Logger;\n}\n\nconst LOG_LEVELS: Record\u003cLogLevel, number\u003e = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\nfunction getMinLevel(): number {\n  const envLevel = process.env.LOG_LEVEL?.toLowerCase() as LogLevel | undefined;\n  return LOG_LEVELS[envLevel ?? 'info'];\n}\n\nfunction formatContext(context?: LogContext): string {\n  if (!context || Object.keys(context).length === 0) return '';\n  return ' ' + JSON.stringify(context);\n}\n\nfunction createLogger(prefix = ''): Logger {\n  const minLevel = getMinLevel();\n  const prefixStr = prefix ? `[${prefix}] ` : '';\n\n  const log = (level: LogLevel, message: string, context?: LogContext) =\u003e {\n    if (LOG_LEVELS[level] \u003c minLevel) return;\n    \n    const timestamp = new Date().toISOString();\n    const formattedContext = formatContext(context);\n    const output = `${timestamp} ${level.toUpperCase()} ${prefixStr}${message}${formattedContext}`;\n    \n    // Use appropriate console method\n    console[level === 'debug' ? 'log' : level](output);\n  };\n\n  return {\n    debug: (msg, ctx) =\u003e log('debug', msg, ctx),\n    info: (msg, ctx) =\u003e log('info', msg, ctx),\n    warn: (msg, ctx) =\u003e log('warn', msg, ctx),\n    error: (msg, ctx) =\u003e log('error', msg, ctx),\n    child: (name) =\u003e createLogger(prefix ? `${prefix}:${name}` : name),\n  };\n}\n\nexport const logger = createLogger();\nexport type { Logger, LogLevel, LogContext };\n```\n\n## Usage Examples\n\n```typescript\nimport { logger } from '@scribe/shared';\n\n// Root logger\nlogger.info('Application started');\n\n// Child logger with component context\nconst log = logger.child('TasksWidget');\nlog.debug('Loading tasks', { count: 10 });\nlog.error('Failed to save', { error, taskId });\n\n// Output:\n// 2024-12-21T12:00:00.000Z INFO Application started\n// 2024-12-21T12:00:00.000Z DEBUG [TasksWidget] Loading tasks {\"count\":10}\n// 2024-12-21T12:00:00.000Z ERROR [TasksWidget] Failed to save {\"error\":\"...\",\"taskId\":\"...\"}\n```\n\n## Files to Create/Modify\n\n**Create:**\n- `packages/shared/src/logger.ts`\n- `packages/shared/src/logger.test.ts`\n\n**Modify:**\n- `packages/shared/src/index.ts` - Export logger\n\n## Test Cases\n\n1. Respects LOG_LEVEL environment variable\n2. Child loggers inherit and extend prefix\n3. Context is JSON-serialized\n4. Errors go to console.error\n5. Debug suppressed when level \u003e debug\n\n## Acceptance Criteria\n\n- [ ] Logger implementation with all methods\n- [ ] Child logger support\n- [ ] Environment-based level filtering\n- [ ] Comprehensive tests\n- [ ] Exported from @scribe/shared\n- [ ] JSDoc documentation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:37:03.558459-06:00","updated_at":"2025-12-21T22:39:27.039949-06:00","dependencies":[{"issue_id":"scribe-mcc.1","depends_on_id":"scribe-mcc","type":"parent-child","created_at":"2025-12-21T22:37:03.558798-06:00","created_by":"daemon"}]}
{"id":"scribe-mcc.2","title":"Migrate storage-fs console statements to logger","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:37:03.625191-06:00","updated_at":"2025-12-21T22:37:03.625191-06:00","dependencies":[{"issue_id":"scribe-mcc.2","depends_on_id":"scribe-mcc","type":"parent-child","created_at":"2025-12-21T22:37:03.625533-06:00","created_by":"daemon"}]}
{"id":"scribe-mcc.3","title":"Migrate engine-core console statements to logger","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:37:03.689479-06:00","updated_at":"2025-12-21T22:37:03.689479-06:00","dependencies":[{"issue_id":"scribe-mcc.3","depends_on_id":"scribe-mcc","type":"parent-child","created_at":"2025-12-21T22:37:03.689778-06:00","created_by":"daemon"}]}
{"id":"scribe-mcc.4","title":"Migrate renderer hooks console statements to logger","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:37:03.74897-06:00","updated_at":"2025-12-21T22:37:03.74897-06:00","dependencies":[{"issue_id":"scribe-mcc.4","depends_on_id":"scribe-mcc","type":"parent-child","created_at":"2025-12-21T22:37:03.749272-06:00","created_by":"daemon"}]}
{"id":"scribe-mcc.5","title":"Migrate renderer components console statements to logger","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:37:03.806709-06:00","updated_at":"2025-12-21T22:37:03.806709-06:00","dependencies":[{"issue_id":"scribe-mcc.5","depends_on_id":"scribe-mcc","type":"parent-child","created_at":"2025-12-21T22:37:03.807014-06:00","created_by":"daemon"}]}
{"id":"scribe-mcc.6","title":"Add ESLint rule to prevent direct console usage","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:37:03.86587-06:00","updated_at":"2025-12-21T22:37:03.86587-06:00","dependencies":[{"issue_id":"scribe-mcc.6","depends_on_id":"scribe-mcc","type":"parent-child","created_at":"2025-12-21T22:37:03.866168-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr","title":"Technical Debt: Test Coverage Gaps","description":"# Technical Debt: Test Coverage Gaps\n\n## Strategic Context\n\nScribe's testing strategy (architecture/testing_strategy_and_design.md) explicitly prioritizes:\n1. **Engine-first confidence** - Core domain logic must be thoroughly tested\n2. **Preload \u0026 IPC Contract Tests** - The preload layer is a \"public API\" and must be tested\n3. **Fast feedback** - Unit and engine tests should run in seconds\n\nThe codebase audit revealed significant gaps where this strategy is not being followed, particularly in:\n- CLI notes subcommands (7 files with zero tests)\n- Editor save plugins (core autosave functionality)\n- Security boundary (preload.ts)\n- Command system infrastructure\n\n### Why This Matters\n\n1. **Regression Risk**: Untested code breaks silently during refactoring.\n2. **Confidence Gap**: Developers avoid touching untested code, leading to rot.\n3. **Security**: The preload script is a security boundary - bugs here can be exploited.\n4. **User Impact**: Save plugins directly affect data durability.\n\n### Alignment with Testing Principles\n\nPer testing_strategy_and_design.md:\n- \"The core domain logic (engine, storage, metadata, graph, search) must be thoroughly tested\"\n- \"The preload layer is a critical boundary. We treat it like a public API\"\n- \"Renderer tests cover the minimal UI Scribe relies on\"\n\n## Priority Framework\n\nTests are prioritized by:\n1. **P0 - Critical**: Security boundaries, data integrity (preload, save plugins)\n2. **P1 - High**: Core CLI functionality used by end users\n3. **P2 - Medium**: Editor features, UI components\n4. **P3 - Low**: Internal utilities, type definitions\n\n## Scope\n\nThis epic focuses on adding tests to existing untested code, not writing new features.\n\n## Success Criteria\n\n- [ ] All P0 items have test coverage\n- [ ] All P1 items have basic happy-path tests\n- [ ] Coverage thresholds enforced in CI\n- [ ] No new untested files introduced\n\n## Technical Notes\n\n- Use existing test patterns from well-tested files as templates\n- Leverage @scribe/test-utils for note/vault factories\n- Mock IPC for preload tests\n- Use vitest's fake timers for save plugin tests","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:34:46.461975-06:00","updated_at":"2025-12-21T22:34:46.461975-06:00"}
{"id":"scribe-ndr.1","title":"Add tests for preload.ts security boundary","description":"# Add tests for preload.ts security boundary\n\n## Context\n\nThe preload script (`apps/desktop/electron/preload/src/preload.ts`) is a **critical security boundary** in Electron applications. It's the bridge between the untrusted renderer process and the privileged main process.\n\nPer `architecture/testing_strategy_and_design.md`:\n\u003e \"The preload layer is a critical boundary. We treat it like a public API and test its contract.\"\n\nCurrently, this file has **zero tests**.\n\n## Why This Is Critical\n\n1. **Security**: Bugs in preload can expose Node.js APIs to malicious web content\n2. **API Stability**: The `window.scribe.*` API is the renderer's only interface to the engine\n3. **Contract Enforcement**: Tests ensure IPC channels match handler expectations\n\n## Test Strategy\n\n### What to Test\n\n1. **API Shape**: Verify `window.scribe` has expected structure\n2. **Channel Mapping**: Verify each API method calls the correct IPC channel\n3. **Argument Transformation**: Verify arguments are correctly serialized\n4. **Return Types**: Verify responses match expected types\n\n### Example Tests\n\n```typescript\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { ipcRenderer } from 'electron';\n\nvi.mock('electron', () =\u003e ({\n  ipcRenderer: {\n    invoke: vi.fn(),\n    on: vi.fn(),\n  },\n  contextBridge: {\n    exposeInMainWorld: vi.fn(),\n  },\n}));\n\ndescribe('preload API', () =\u003e {\n  beforeEach(() =\u003e {\n    vi.clearAllMocks();\n  });\n\n  describe('notes API', () =\u003e {\n    it('save invokes notes:save with correct channel', async () =\u003e {\n      const mockNote = { id: 'test', title: 'Test' };\n      await window.scribe.notes.save(mockNote);\n      expect(ipcRenderer.invoke).toHaveBeenCalledWith('notes:save', mockNote);\n    });\n  });\n\n  describe('daily API', () =\u003e {\n    it('getOrCreate transforms Date to ISO string', async () =\u003e {\n      const date = new Date('2024-12-21');\n      await window.scribe.daily.getOrCreate(date);\n      expect(ipcRenderer.invoke).toHaveBeenCalledWith(\n        'daily:getOrCreate',\n        { date: '2024-12-21T00:00:00.000Z' }\n      );\n    });\n  });\n});\n```\n\n## Files to Create\n\n- `apps/desktop/electron/preload/src/preload.test.ts`\n\n## Acceptance Criteria\n\n- [ ] Tests for each `window.scribe.*` namespace\n- [ ] Channel mapping verified for all IPC calls\n- [ ] Argument transformation tested (especially Date handling)\n- [ ] Tests run in CI\n- [ ] Coverage \u003e 80% for preload.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T22:34:46.528611-06:00","updated_at":"2025-12-21T22:51:19.809169-06:00","closed_at":"2025-12-21T22:51:19.809169-06:00","dependencies":[{"issue_id":"scribe-ndr.1","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:46.528934-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.10","title":"Add tests for CLI notes-helpers utilities","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:47.182018-06:00","updated_at":"2025-12-21T22:34:47.182018-06:00","dependencies":[{"issue_id":"scribe-ndr.10","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:47.182339-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.11","title":"Add tests for CommandRegistry","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:34:47.253758-06:00","updated_at":"2025-12-21T22:34:47.253758-06:00","dependencies":[{"issue_id":"scribe-ndr.11","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:47.25413-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.12","title":"Add tests for fuzzySearch command utility","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:34:47.323567-06:00","updated_at":"2025-12-21T22:34:47.323567-06:00","dependencies":[{"issue_id":"scribe-ndr.12","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:47.323889-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.13","title":"Add tests for table plugin hooks","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:34:47.391621-06:00","updated_at":"2025-12-21T22:34:47.391621-06:00","dependencies":[{"issue_id":"scribe-ndr.13","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:47.391947-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.2","title":"Add tests for AutosavePlugin and ManualSavePlugin","description":"# Add tests for AutosavePlugin and ManualSavePlugin\n\n## Context\n\nThe autosave functionality is **critical for data integrity**. Users expect their work to be saved automatically. If autosave fails silently, users lose work.\n\nCurrently, `AutosavePlugin.tsx` and `ManualSavePlugin.tsx` have **zero tests**.\n\n## Files\n\n- `apps/desktop/renderer/src/components/Editor/plugins/AutosavePlugin.tsx`\n- `apps/desktop/renderer/src/components/Editor/plugins/ManualSavePlugin.tsx`\n\n## Why This Is Critical\n\n1. **Data Loss**: Bugs in autosave = lost user work\n2. **User Trust**: Silent failures erode trust in the application\n3. **Race Conditions**: Save timing is prone to race conditions\n\n## Test Strategy\n\n### AutosavePlugin Tests\n\n| Test Case | Scenario | Expected |\n|-----------|----------|----------|\n| Triggers on change | User types | Save called after debounce |\n| Debounces rapid changes | User types quickly | Single save, not per-keystroke |\n| Respects debounce timing | Configure 1s debounce | Save after 1s of inactivity |\n| Handles save errors | Save throws | Error logged, no crash |\n| Cancels on unmount | Component unmounts during debounce | No save after unmount |\n\n### ManualSavePlugin Tests\n\n| Test Case | Scenario | Expected |\n|-----------|----------|----------|\n| Cmd+S triggers save | Keyboard shortcut | Save called |\n| Shows feedback | Save completes | Success indicator |\n| Handles errors | Save fails | Error toast shown |\n| Disables during save | Save in progress | Prevents duplicate saves |\n\n## Implementation Notes\n\nUse vitest's fake timers:\n```typescript\nimport { vi, beforeEach, afterEach } from 'vitest';\n\nbeforeEach(() =\u003e {\n  vi.useFakeTimers();\n});\n\nafterEach(() =\u003e {\n  vi.useRealTimers();\n});\n\nit('debounces rapid changes', async () =\u003e {\n  // Trigger 5 rapid changes\n  for (let i = 0; i \u003c 5; i++) {\n    triggerChange();\n  }\n  \n  // Advance past debounce\n  await vi.advanceTimersByTimeAsync(1000);\n  \n  // Should only save once\n  expect(mockSave).toHaveBeenCalledTimes(1);\n});\n```\n\n## Files to Create\n\n- `apps/desktop/renderer/src/components/Editor/plugins/AutosavePlugin.test.tsx`\n- `apps/desktop/renderer/src/components/Editor/plugins/ManualSavePlugin.test.tsx`\n\n## Acceptance Criteria\n\n- [ ] All test cases from tables implemented\n- [ ] Debounce behavior verified with fake timers\n- [ ] Error handling tested\n- [ ] Cleanup on unmount verified\n- [ ] Tests pass in CI","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T22:34:46.594907-06:00","updated_at":"2025-12-21T22:52:56.979704-06:00","closed_at":"2025-12-21T22:52:56.979704-06:00","dependencies":[{"issue_id":"scribe-ndr.2","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:46.59524-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.3","title":"Add tests for InitialStatePlugin","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T22:34:46.66742-06:00","updated_at":"2025-12-21T22:54:16.497611-06:00","closed_at":"2025-12-21T22:54:16.497611-06:00","dependencies":[{"issue_id":"scribe-ndr.3","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:46.667744-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.4","title":"Add tests for CLI notes-create command","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:46.738808-06:00","updated_at":"2025-12-22T12:58:00.665263-06:00","closed_at":"2025-12-22T12:58:00.665263-06:00","dependencies":[{"issue_id":"scribe-ndr.4","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:46.739134-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.5","title":"Add tests for CLI notes-delete command","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:46.80938-06:00","updated_at":"2025-12-22T12:59:36.573617-06:00","closed_at":"2025-12-22T12:59:36.573617-06:00","dependencies":[{"issue_id":"scribe-ndr.5","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:46.809721-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.6","title":"Add tests for CLI notes-find command","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:46.881817-06:00","updated_at":"2025-12-22T13:01:31.275018-06:00","closed_at":"2025-12-22T13:01:31.275018-06:00","dependencies":[{"issue_id":"scribe-ndr.6","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:46.882285-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.7","title":"Add tests for CLI notes-list command","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:46.955404-06:00","updated_at":"2025-12-22T13:03:56.967238-06:00","closed_at":"2025-12-22T13:03:56.967238-06:00","dependencies":[{"issue_id":"scribe-ndr.7","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:46.955753-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.8","title":"Add tests for CLI notes-show command","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:47.034623-06:00","updated_at":"2025-12-22T13:05:36.721407-06:00","closed_at":"2025-12-22T13:05:36.721407-06:00","dependencies":[{"issue_id":"scribe-ndr.8","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:47.034937-06:00","created_by":"daemon"}]}
{"id":"scribe-ndr.9","title":"Add tests for CLI notes-update command","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:47.109956-06:00","updated_at":"2025-12-22T13:07:25.336764-06:00","closed_at":"2025-12-22T13:07:25.336764-06:00","dependencies":[{"issue_id":"scribe-ndr.9","depends_on_id":"scribe-ndr","type":"parent-child","created_at":"2025-12-21T22:34:47.110318-06:00","created_by":"daemon"}]}
{"id":"scribe-pue","title":"Technical Debt: Large File Refactoring","description":"# Technical Debt: Large File Refactoring\n\n## Strategic Context\n\nLarge files are a code smell that often indicates:\n- Too many responsibilities in one module\n- Difficulty testing individual pieces\n- Merge conflicts when multiple developers touch the file\n- Cognitive overload when trying to understand the code\n\nThe codebase analysis identified several large files (500+ lines) that may benefit from splitting:\n\n| Lines | File | Concern |\n|------:|------|---------|\n| 1,031 | `packages/shared/src/content-extractor.ts` | Multiple extraction concerns |\n| 652 | `packages/storage-fs/src/storage.ts` | Storage + concurrency |\n| 538 | `packages/shared/src/ipc-contract.ts` | All IPC channels |\n| 530 | `packages/engine-core/src/task-index.ts` | Indexing + persistence |\n| 515 | `apps/desktop/renderer/.../TableKeyboardPlugin.tsx` | Complex but cohesive |\n\n### Why This Matters\n\n1. **Maintainability**: Smaller files are easier to understand and modify.\n2. **Testing**: Smaller modules can be tested in isolation.\n3. **Code Review**: Smaller, focused changes are easier to review.\n4. **Collaboration**: Less merge conflict when files are smaller.\n\n### Evaluation Criteria\n\nNot all large files need splitting. We evaluate:\n1. **Cohesion**: Does the file have a single, clear responsibility?\n2. **Coupling**: Are the pieces tightly coupled or loosely coupled?\n3. **Testability**: Is the file hard to test because of its size?\n4. **Churn**: Do multiple developers frequently modify this file?\n\n## Scope\n\nThis epic covers analyzing and potentially splitting:\n- `content-extractor.ts` - Candidate for splitting by extraction type\n- `storage.ts` - Candidate for extracting concurrency logic\n- `ipc-contract.ts` - May be fine as-is (single source of truth for IPC)\n- `task-index.ts` - Partially addressed by TaskPersistence extraction\n\n## Out of Scope\n\n- Files that are large but cohesive (e.g., TableKeyboardPlugin)\n- Type definition files (they're inherently large)\n- Test files (size is acceptable for tests)\n\n## Success Criteria\n\n- [ ] Each candidate file evaluated for split/no-split decision\n- [ ] Files split where beneficial\n- [ ] No regression in functionality\n- [ ] Tests updated to cover new modules\n- [ ] Import paths updated throughout codebase\n\n## Technical Notes\n\n### content-extractor.ts (1,031 lines)\n\nCurrent structure:\n- Link extraction (wiki links, inline links)\n- Mention extraction (people mentions)\n- Task extraction\n- Metadata extraction (title, tags)\n- AST traversal utilities\n\nPotential split:\n```\ncontent-extractor/\n├── index.ts (re-exports)\n├── link-extractor.ts\n├── mention-extractor.ts\n├── task-extractor.ts (note: also in engine-core)\n├── metadata-extractor.ts\n└── ast-traversal.ts\n```\n\n### storage.ts (652 lines)\n\nCurrent structure:\n- FileSystemVault class\n- CRUD operations\n- Concurrency/locking logic\n- Error handling\n\nPotential split:\n```\nstorage/\n├── index.ts\n├── vault.ts (main class)\n├── concurrency.ts (locking, atomic writes)\n└── operations.ts (CRUD)\n```\n\n### ipc-contract.ts (538 lines)\n\nThis file defines the IPC channel contract. It's large but serves as a single source of truth. Splitting might actually hurt discoverability. Recommendation: **Keep as-is**, but ensure it stays well-organized.\n\n## Dependencies\n\n- Should complete after test coverage epic to ensure refactors don't break anything\n- Can be parallelized across files","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:37:30.625301-06:00","updated_at":"2025-12-21T22:37:30.625301-06:00"}
{"id":"scribe-pue.1","title":"Evaluate and plan content-extractor.ts split","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:37:30.684726-06:00","updated_at":"2025-12-21T22:37:30.684726-06:00","dependencies":[{"issue_id":"scribe-pue.1","depends_on_id":"scribe-pue","type":"parent-child","created_at":"2025-12-21T22:37:30.685031-06:00","created_by":"daemon"}]}
{"id":"scribe-pue.2","title":"Evaluate and plan storage.ts split","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:37:30.745407-06:00","updated_at":"2025-12-21T22:37:30.745407-06:00","dependencies":[{"issue_id":"scribe-pue.2","depends_on_id":"scribe-pue","type":"parent-child","created_at":"2025-12-21T22:37:30.745721-06:00","created_by":"daemon"}]}
{"id":"scribe-pue.3","title":"Split content-extractor into focused modules","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:37:30.804813-06:00","updated_at":"2025-12-21T22:37:30.804813-06:00","dependencies":[{"issue_id":"scribe-pue.3","depends_on_id":"scribe-pue","type":"parent-child","created_at":"2025-12-21T22:37:30.805147-06:00","created_by":"daemon"}]}
{"id":"scribe-pue.4","title":"Extract concurrency logic from storage.ts","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:37:30.863119-06:00","updated_at":"2025-12-21T22:37:30.863119-06:00","dependencies":[{"issue_id":"scribe-pue.4","depends_on_id":"scribe-pue","type":"parent-child","created_at":"2025-12-21T22:37:30.863432-06:00","created_by":"daemon"}]}
{"id":"scribe-pue.5","title":"Update imports across codebase after splits","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T22:37:30.921795-06:00","updated_at":"2025-12-21T22:37:30.921795-06:00","dependencies":[{"issue_id":"scribe-pue.5","depends_on_id":"scribe-pue","type":"parent-child","created_at":"2025-12-21T22:37:30.922103-06:00","created_by":"daemon"}]}
{"id":"scribe-v3r","title":"Technical Debt: Code Deduplication \u0026 DRY Violations","description":"# Technical Debt: Code Deduplication \u0026 DRY Violations\n\n## Strategic Context\n\nScribe's architecture explicitly values **engine reusability** and **maintainability** (see architecture/decision_3_internal_architecture.md). The monorepo structure with `@scribe/shared`, `@scribe/test-utils`, and shared configs exists precisely to enable DRY (Don't Repeat Yourself) patterns. However, code analysis has revealed several violations where identical or near-identical code exists in multiple places.\n\n### Why This Matters\n\n1. **Bug Propagation Risk**: When duplicated code has a bug, it must be fixed in N places. History shows this leads to incomplete fixes.\n2. **Cognitive Load**: Developers must remember which copy to use, leading to confusion.\n3. **Maintenance Burden**: Updates require touching multiple files, increasing PR size and review time.\n4. **Test Coverage Gaps**: Duplicated code often has inconsistent test coverage.\n\n### Business Impact\n\n- **Developer velocity**: Every minute spent maintaining duplicate code is a minute not spent on features.\n- **Quality**: Centralized code gets more review and testing attention.\n- **Onboarding**: New contributors can learn patterns once, not per-package.\n\n## Scope\n\nThis epic covers:\n1. Exact code duplicates (copy-paste)\n2. Near-duplicates (same logic, different variable names)\n3. Configuration file duplication\n4. Test utility duplication\n\n## Out of Scope\n\n- Similar patterns that serve legitimately different purposes\n- Platform-specific implementations that must differ\n\n## Success Criteria\n\n- [ ] All exact duplicates eliminated\n- [ ] Shared utilities used consistently across packages\n- [ ] Config files extend shared base where possible\n- [ ] No new duplicates introduced (enforced via linting where feasible)\n\n## Dependencies\n\nNone - this is foundational cleanup work.\n\n## Files Affected (High-Level)\n\n- `apps/desktop/renderer/src/utils/formatRelativeDate.ts` (delete)\n- `apps/cli/tests/helpers.ts` (reduce)\n- `packages/test-utils/src/` (may expand)\n- `config/vitest/` (new shared config)\n- Various vitest.config.ts files (simplify)","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T22:34:19.937285-06:00","updated_at":"2025-12-21T22:34:19.937285-06:00"}
{"id":"scribe-v3r.1","title":"Delete exact duplicate formatRelativeDate.ts","description":"# Delete exact duplicate formatRelativeDate.ts\n\n## Context\n\nThe file `apps/desktop/renderer/src/utils/formatRelativeDate.ts` (61 lines) is a **character-for-character duplicate** of `getRelativeDateString()` in `packages/shared/src/date-utils.ts` (lines 174-221).\n\nThis duplication violates the monorepo's design principle: shared utilities belong in `@scribe/shared`.\n\n## Current State\n\n```typescript\n// apps/desktop/renderer/src/utils/formatRelativeDate.ts\nexport function formatRelativeDate(date: Date): string {\n  // ... 61 lines of duplicated logic\n}\n\n// packages/shared/src/date-utils.ts\nexport function getRelativeDateString(date: Date): string {\n  // ... identical logic\n}\n```\n\n## Action Required\n\n1. Find all usages of `formatRelativeDate` in the renderer\n2. Replace imports with `import { getRelativeDateString } from '@scribe/shared'`\n3. Delete `apps/desktop/renderer/src/utils/formatRelativeDate.ts`\n4. If the function name matters, consider adding an alias in shared\n\n## Verification\n\n```bash\n# Find usages before deletion\ngrep -r \"formatRelativeDate\" apps/desktop/renderer/src/\n\n# After migration, verify no references remain\ngrep -r \"formatRelativeDate\" apps/desktop/\n```\n\n## Acceptance Criteria\n\n- [ ] All usages migrated to @scribe/shared\n- [ ] Duplicate file deleted\n- [ ] Tests still pass\n- [ ] No TypeScript errors","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T22:34:19.997837-06:00","updated_at":"2025-12-21T22:46:20.729137-06:00","closed_at":"2025-12-21T22:46:20.729137-06:00","dependencies":[{"issue_id":"scribe-v3r.1","depends_on_id":"scribe-v3r","type":"parent-child","created_at":"2025-12-21T22:34:19.998149-06:00","created_by":"daemon"}]}
{"id":"scribe-v3r.2","title":"Consolidate CLI test helpers with @scribe/test-utils","description":"# Consolidate CLI test helpers with @scribe/test-utils\n\n## Context\n\nThe file `apps/cli/tests/helpers.ts` duplicates significant functionality from `@scribe/test-utils`:\n\n| Function | CLI helpers.ts | @scribe/test-utils |\n|----------|---------------|-------------------|\n| `createLexicalContent` | Lines 94-245 | `note-factory.ts` |\n| `createLexicalContentWithTask` | Duplicated | `note-factory.ts` |\n| `initializeTestVault` | Lines 288-312 | `vault-factory.ts` |\n| `cleanupTestVault` | Duplicated | `vault-factory.ts` |\n| `writeNoteToVault` | Duplicated | `vault-factory.ts` |\n\n## Why This Matters\n\n1. **Bug fixes**: If we fix a bug in `createLexicalContent`, we must remember to fix it in both places.\n2. **Feature additions**: Adding a new factory function requires adding it twice.\n3. **Inconsistency**: Small drift between implementations causes confusing test failures.\n\n## Action Required\n\n1. **Audit** both files to identify all duplicated functions\n2. **Extend** `@scribe/test-utils` if CLI needs any unique helpers\n3. **Replace** imports in `apps/cli/tests/helpers.ts`:\n   ```typescript\n   // Before\n   export function createLexicalContent(...) { ... }\n   \n   // After\n   export { createLexicalContent } from '@scribe/test-utils';\n   ```\n4. **Delete** duplicated implementations from helpers.ts\n5. **Verify** all CLI tests still pass\n\n## Files to Modify\n\n- `apps/cli/tests/helpers.ts` - Remove duplicates, add re-exports\n- `packages/test-utils/src/note-factory.ts` - Ensure all needed functions exported\n- `packages/test-utils/src/vault-factory.ts` - Ensure all needed functions exported\n- `packages/test-utils/src/index.ts` - Export new functions if added\n\n## Acceptance Criteria\n\n- [ ] No duplicated function implementations in CLI helpers\n- [ ] All CLI tests pass\n- [ ] @scribe/test-utils has all necessary exports\n- [ ] helpers.ts is significantly smaller","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-21T22:34:20.057724-06:00","updated_at":"2025-12-21T22:47:27.256732-06:00","closed_at":"2025-12-21T22:47:27.256732-06:00","dependencies":[{"issue_id":"scribe-v3r.2","depends_on_id":"scribe-v3r","type":"parent-child","created_at":"2025-12-21T22:34:20.058036-06:00","created_by":"daemon"}]}
{"id":"scribe-v3r.3","title":"Replace local createMockNote functions with shared utility","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:20.118198-06:00","updated_at":"2025-12-22T13:02:29.332005-06:00","closed_at":"2025-12-22T13:02:29.332005-06:00","dependencies":[{"issue_id":"scribe-v3r.3","depends_on_id":"scribe-v3r","type":"parent-child","created_at":"2025-12-21T22:34:20.118523-06:00","created_by":"daemon"}]}
{"id":"scribe-v3r.4","title":"Create shared vitest config preset","description":"# Create shared vitest config preset\n\n## Context\n\nThe codebase has **8 nearly-identical vitest.config.ts files**, each with ~90% duplicated content. This violates DRY and makes it hard to update test configuration consistently.\n\n## Current State\n\nEach package has:\n```typescript\n// packages/*/vitest.config.ts\nimport { defineConfig } from 'vitest/config';\n\nexport default defineConfig({\n  test: {\n    globals: true,\n    environment: 'node',\n    include: ['src/**/*.test.ts'],\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html'],\n      exclude: ['**/node_modules/**', '**/dist/**', '**/*.test.ts'],\n      thresholds: {\n        lines: 60,\n        branches: 60,\n        functions: 60,\n        statements: 60,\n      },\n    },\n  },\n});\n```\n\nThe only differences:\n- `environment`: 'node' vs 'jsdom' vs 'happy-dom'\n- `include` patterns\n- `setupFiles` for some packages\n\n## Proposed Solution\n\n### 1. Create shared config in `config/vitest/`\n\n```typescript\n// config/vitest/base.ts\nimport { defineConfig, mergeConfig } from 'vitest/config';\n\nexport const baseConfig = defineConfig({\n  test: {\n    globals: true,\n    include: ['src/**/*.test.ts'],\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html'],\n      exclude: ['**/node_modules/**', '**/dist/**', '**/*.test.ts'],\n      thresholds: {\n        lines: 60,\n        branches: 60,\n        functions: 60,\n        statements: 60,\n      },\n    },\n  },\n});\n\nexport const nodeConfig = mergeConfig(baseConfig, {\n  test: { environment: 'node' },\n});\n\nexport const jsdomConfig = mergeConfig(baseConfig, {\n  test: { environment: 'jsdom' },\n});\n```\n\n### 2. Simplify package configs\n\n```typescript\n// packages/shared/vitest.config.ts\nimport { nodeConfig } from '../../config/vitest/base';\nexport default nodeConfig;\n\n// apps/desktop/renderer/vitest.config.ts\nimport { mergeConfig } from 'vitest/config';\nimport { jsdomConfig } from '../../../config/vitest/base';\n\nexport default mergeConfig(jsdomConfig, {\n  test: {\n    setupFiles: ['./test/setup.ts'],\n  },\n});\n```\n\n## Files to Create/Modify\n\n**Create:**\n- `config/vitest/base.ts`\n- `config/vitest/package.json` (workspace package)\n\n**Modify:**\n- `packages/shared/vitest.config.ts`\n- `packages/engine-core/vitest.config.ts`\n- `packages/engine-graph/vitest.config.ts`\n- `packages/engine-search/vitest.config.ts`\n- `packages/storage-fs/vitest.config.ts`\n- `packages/design-system/vitest.config.ts`\n- `apps/cli/vitest.config.ts`\n- `apps/desktop/renderer/vitest.config.ts`\n\n## Benefits\n\n1. **Single source of truth** for test configuration\n2. **Easy to update** coverage thresholds globally\n3. **Consistent behavior** across packages\n4. **Less code** to maintain\n\n## Acceptance Criteria\n\n- [ ] Shared config created in config/vitest/\n- [ ] All package configs simplified to extend shared\n- [ ] All tests still pass\n- [ ] Coverage reporting unchanged\n- [ ] CI builds succeed","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-21T22:34:20.177956-06:00","updated_at":"2025-12-22T13:03:09.105156-06:00","dependencies":[{"issue_id":"scribe-v3r.4","depends_on_id":"scribe-v3r","type":"parent-child","created_at":"2025-12-21T22:34:20.178279-06:00","created_by":"daemon"}]}
{"id":"scribe-v3r.5","title":"Standardize on single fuzzy search implementation","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:34:20.236643-06:00","updated_at":"2025-12-21T22:34:20.236643-06:00","dependencies":[{"issue_id":"scribe-v3r.5","depends_on_id":"scribe-v3r","type":"parent-child","created_at":"2025-12-21T22:34:20.236957-06:00","created_by":"daemon"}]}
{"id":"scribe-v3r.6","title":"Consolidate date parsing to use @scribe/shared consistently","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T22:34:20.296562-06:00","updated_at":"2025-12-21T22:34:20.296562-06:00","dependencies":[{"issue_id":"scribe-v3r.6","depends_on_id":"scribe-v3r","type":"parent-child","created_at":"2025-12-21T22:34:20.296858-06:00","created_by":"daemon"}]}
