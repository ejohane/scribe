{"id":"linked-1","title":"Implement WikiLinkNode (Lexical custom node)","description":"Create the custom Lexical DecoratorNode for wiki-links.\n\n## Details\n- File: renderer/src/components/Editor/plugins/WikiLinkNode.ts\n- Extends DecoratorNode\u003cJSX.Element\u003e\n\n## Properties\n- __noteTitle: string - Target note title (e.g., 'Meeting Notes')\n- __displayText: string - What to show (alias or title)\n- __targetId: NoteId | null - Resolved note ID (null if unresolved)\n\n## Methods to implement\n- static getType(): 'wiki-link'\n- static clone(node): WikiLinkNode\n- constructor(noteTitle, displayText, targetId, key?)\n- createDOM(): span with class 'wiki-link'\n- updateDOM(): return false (decorator handles updates)\n- decorate(): return WikiLinkComponent JSX\n- exportJSON(): serialize all properties\n- static importJSON(json): deserialize node\n- isInline(): return true\n- getTextContent(): return displayText (for copy/paste)\n\n## Implementation Skeleton\n```typescript\nimport { DecoratorNode, NodeKey, SerializedLexicalNode, Spread } from 'lexical';\nimport type { NoteId } from '@scribe/shared';\n\nexport type SerializedWikiLinkNode = Spread\u003c\n  {\n    noteTitle: string;\n    displayText: string;\n    targetId: NoteId | null;\n  },\n  SerializedLexicalNode\n\u003e;\n\nexport class WikiLinkNode extends DecoratorNode\u003cJSX.Element\u003e {\n  __noteTitle: string;\n  __displayText: string;\n  __targetId: NoteId | null;\n\n  static getType(): string {\n    return 'wiki-link';\n  }\n\n  static clone(node: WikiLinkNode): WikiLinkNode {\n    return new WikiLinkNode(\n      node.__noteTitle,\n      node.__displayText,\n      node.__targetId,\n      node.__key\n    );\n  }\n\n  constructor(\n    noteTitle: string,\n    displayText: string,\n    targetId: NoteId | null,\n    key?: NodeKey\n  ) {\n    super(key);\n    this.__noteTitle = noteTitle;\n    this.__displayText = displayText;\n    this.__targetId = targetId;\n  }\n\n  createDOM(): HTMLElement {\n    const span = document.createElement('span');\n    span.className = 'wiki-link';\n    return span;\n  }\n\n  updateDOM(): boolean {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      \u003cWikiLinkComponent\n        noteTitle={this.__noteTitle}\n        displayText={this.__displayText}\n        targetId={this.__targetId}\n        nodeKey={this.__key}\n      /\u003e\n    );\n  }\n\n  exportJSON(): SerializedWikiLinkNode {\n    return {\n      ...super.exportJSON(),\n      type: 'wiki-link',\n      noteTitle: this.__noteTitle,\n      displayText: this.__displayText,\n      targetId: this.__targetId,\n      version: 1,\n    };\n  }\n\n  static importJSON(json: SerializedWikiLinkNode): WikiLinkNode {\n    return $createWikiLinkNode(\n      json.noteTitle,\n      json.displayText,\n      json.targetId\n    );\n  }\n\n  isInline(): boolean {\n    return true;\n  }\n\n  getTextContent(): string {\n    return this.__displayText;\n  }\n}\n\nexport function $createWikiLinkNode(\n  noteTitle: string,\n  displayText: string,\n  targetId: NoteId | null\n): WikiLinkNode {\n  return new WikiLinkNode(noteTitle, displayText, targetId);\n}\n\nexport function $isWikiLinkNode(node: unknown): node is WikiLinkNode {\n  return node instanceof WikiLinkNode;\n}\n```\n\n## WikiLinkComponent (inner React component)\n```typescript\ninterface WikiLinkComponentProps {\n  noteTitle: string;\n  displayText: string;\n  targetId: NoteId | null;\n  nodeKey: NodeKey;\n}\n\nfunction WikiLinkComponent({ displayText }: WikiLinkComponentProps) {\n  // Click handler will be added via context in linked-10\n  return \u003cspan\u003e{displayText}\u003c/span\u003e;\n}\n```\n\n## Important Notes\n- NoteId type from @scribe/shared\n- Node should be selectable but not editable (DecoratorNode behavior)\n- The click handler is NOT implemented here - see linked-10\n\n## Acceptance Criteria\n- [ ] Node can be created with noteTitle, displayText, targetId\n- [ ] Node serializes/deserializes correctly (JSON round-trip)\n- [ ] Node renders as inline span with wiki-link class\n- [ ] Node displays displayText (not noteTitle when different)\n- [ ] getTextContent() returns displayText for copy/paste\n- [ ] $createWikiLinkNode and $isWikiLinkNode helpers exported","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:39:40.682059-06:00","updated_at":"2025-11-26T15:03:31.359631-06:00","closed_at":"2025-11-26T15:03:31.359631-06:00","dependencies":[{"issue_id":"linked-1","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-10","title":"Implement wiki-link click navigation","description":"Handle click events on wiki-links to navigate to the target note.\n\n## Details\n- Files:\n  - renderer/src/components/Editor/plugins/WikiLinkNode.ts (update WikiLinkComponent)\n  - renderer/src/components/Editor/plugins/WikiLinkContext.tsx (new context)\n\n## Architecture Decision\nUse React Context to provide navigation callbacks to WikiLinkComponent. This keeps the DecoratorNode clean and allows the navigation logic to be managed at the App level.\n\n## New File: WikiLinkContext.tsx\n```typescript\nimport { createContext, useContext, ReactNode } from 'react';\nimport type { NoteId } from '@scribe/shared';\n\ninterface WikiLinkContextValue {\n  currentNoteId: NoteId | null;\n  onLinkClick: (noteTitle: string, targetId: NoteId | null) =\u003e Promise\u003cvoid\u003e;\n}\n\nconst WikiLinkContext = createContext\u003cWikiLinkContextValue | null\u003e(null);\n\nexport function useWikiLinkContext() {\n  const context = useContext(WikiLinkContext);\n  if (!context) {\n    throw new Error('useWikiLinkContext must be used within WikiLinkProvider');\n  }\n  return context;\n}\n\ninterface WikiLinkProviderProps {\n  children: ReactNode;\n  currentNoteId: NoteId | null;\n  onLinkClick: (noteTitle: string, targetId: NoteId | null) =\u003e Promise\u003cvoid\u003e;\n}\n\nexport function WikiLinkProvider({ \n  children, \n  currentNoteId, \n  onLinkClick \n}: WikiLinkProviderProps) {\n  return (\n    \u003cWikiLinkContext.Provider value={{ currentNoteId, onLinkClick }}\u003e\n      {children}\n    \u003c/WikiLinkContext.Provider\u003e\n  );\n}\n```\n\n## Update WikiLinkComponent in WikiLinkNode.ts\n```typescript\nimport { useWikiLinkContext } from './WikiLinkContext';\n\nfunction WikiLinkComponent({ \n  noteTitle, \n  displayText, \n  targetId \n}: WikiLinkComponentProps) {\n  const { currentNoteId, onLinkClick } = useWikiLinkContext();\n\n  const handleClick = async (e: React.MouseEvent) =\u003e {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    // Self-link check\n    if (targetId === currentNoteId) {\n      return;\n    }\n    \n    await onLinkClick(noteTitle, targetId);\n  };\n\n  return (\n    \u003cspan className=\"wiki-link\" onClick={handleClick}\u003e\n      {displayText}\n    \u003c/span\u003e\n  );\n}\n```\n\n## Link Resolution Logic (in App.tsx or parent)\nThe onLinkClick handler should implement:\n```typescript\nconst handleWikiLinkClick = async (noteTitle: string, targetId: NoteId | null) =\u003e {\n  let resolvedId = targetId;\n  \n  // If no targetId, try to find by title\n  if (!resolvedId) {\n    const note = await window.scribe.notes.findByTitle(noteTitle);\n    if (note) {\n      resolvedId = note.id;\n    }\n  }\n  \n  if (resolvedId) {\n    // Navigate to existing note\n    navigateToNote(resolvedId, true);\n  } else {\n    // Create new note with this title (future: set title on create)\n    const newNote = await window.scribe.notes.create();\n    navigateToNote(newNote.id, true);\n  }\n};\n```\n\n## Integration with EditorRoot\nWrap LexicalComposer children with WikiLinkProvider:\n```typescript\n\u003cLexicalComposer initialConfig={editorConfig}\u003e\n  \u003cWikiLinkProvider \n    currentNoteId={noteState.currentNoteId}\n    onLinkClick={handleWikiLinkClick}\n  \u003e\n    {/* existing content */}\n  \u003c/WikiLinkProvider\u003e\n\u003c/LexicalComposer\u003e\n```\n\n## Important Notes\n- Self-link check prevents infinite loops\n- Navigation function comes from useNavigationHistory (linked-11)\n- findByTitle API comes from linked-5\n- Note creation doesn't set title yet (acceptable for MVP)\n\n## Acceptance Criteria\n- [ ] WikiLinkContext created with currentNoteId and onLinkClick\n- [ ] WikiLinkComponent uses context for click handling\n- [ ] Click on wiki-link triggers navigation\n- [ ] Self-links (link to current note) are no-op\n- [ ] Resolved links navigate directly\n- [ ] Unresolved links attempt findByTitle lookup\n- [ ] Missing notes are created automatically\n- [ ] Navigation pushes to history stack","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:42:18.400947-06:00","updated_at":"2025-11-26T15:13:47.276808-06:00","closed_at":"2025-11-26T15:13:47.276808-06:00","dependencies":[{"issue_id":"linked-10","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-10","depends_on_id":"linked-5","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-10","depends_on_id":"linked-7","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-10","depends_on_id":"linked-11","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-100","title":"Add error path tests for PersonMentionPlugin","description":"The current test coverage doesn't include error scenarios for the PersonMentionPlugin.\n\nRecommended test cases:\n1. Test behavior when people.create() throws an error\n2. Test behavior when people.search() throws an error\n3. Verify autocomplete closes gracefully on API failures\n4. Verify user's typed text is preserved or cleared appropriately on errors\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.test.tsx (to create or add to existing tests)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T12:59:58.536457-06:00","updated_at":"2025-11-27T20:28:28.127093-06:00","closed_at":"2025-11-27T20:28:28.127093-06:00"}
{"id":"linked-101","title":"Add keyboard navigation boundary tests for autocomplete","description":"Add test coverage for keyboard navigation edge cases in the autocomplete component.\n\nRecommended test cases:\n1. ArrowDown at last item - should not go past last item\n2. ArrowUp at first item - should stay at first item (index 0)\n3. ArrowDown when create option is last - should select create option\n4. Tab/Enter on create option - should trigger onCreate\n5. Tab/Enter with empty results - should be a no-op\n\nThese tests ensure robust keyboard handling at list boundaries.\n\nFiles:\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx\n- Related test files","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T13:00:05.825749-06:00","updated_at":"2025-11-27T20:30:10.637379-06:00","closed_at":"2025-11-27T20:30:10.637379-06:00"}
{"id":"linked-102","title":"Verify PersonMentionProvider is properly wrapping EditorRoot","description":"The PersonMentionPlugin and PersonMentionNode rely on usePersonMentionContext(), but PersonMentionProvider is not visible in EditorRoot.tsx. This may cause runtime errors when clicking a mention if the provider is missing.\n\nInvestigation needed:\n1. Verify where PersonMentionProvider is instantiated (possibly in a parent component like App.tsx)\n2. If missing, add PersonMentionProvider wrapping the LexicalComposer in EditorRoot.tsx\n3. Ensure onMentionClick callback navigates to the person note\n4. Ensure onError callback shows appropriate UI feedback\n\nExpected structure:\n```typescript\n\u003cPersonMentionProvider\n  currentNoteId={currentNoteId}\n  onMentionClick={handleNavigateToNote}\n  onError={handleError}\n\u003e\n  \u003cLexicalComposer initialConfig={editorConfig}\u003e\n    {/* ... */}\n  \u003c/LexicalComposer\u003e\n\u003c/PersonMentionProvider\u003e\n```\n\nFiles:\n- apps/desktop/renderer/src/components/Editor/EditorRoot.tsx\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionContext.tsx\n- apps/desktop/renderer/src/App.tsx","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-27T13:00:14.069589-06:00","updated_at":"2025-11-28T12:36:17.30359-06:00","closed_at":"2025-11-28T12:36:17.30359-06:00"}
{"id":"linked-11","title":"Implement useNavigationHistory hook","description":"Create a React hook to manage navigation history state.\n\n## Details\n- File: renderer/src/hooks/useNavigationHistory.ts\n\n## Interface\n```typescript\nimport { useState, useCallback } from 'react';\nimport type { NoteId } from '@scribe/shared';\n\ninterface UseNavigationHistoryReturn {\n  /** Stack of previously visited note IDs */\n  history: NoteId[];\n  \n  /** Whether back navigation is available */\n  canGoBack: boolean;\n  \n  /** Navigate to a note, optionally adding current to history */\n  navigateToNote: (noteId: NoteId, addToHistory?: boolean) =\u003e void;\n  \n  /** Go back to previous note */\n  navigateBack: () =\u003e void;\n  \n  /** Clear all history (used on fresh navigation) */\n  clearHistory: () =\u003e void;\n}\n```\n\n## Implementation\n```typescript\nimport { useState, useCallback } from 'react';\nimport type { NoteId } from '@scribe/shared';\n\nexport function useNavigationHistory(\n  currentNoteId: NoteId | null,\n  loadNote: (id: NoteId) =\u003e Promise\u003cvoid\u003e\n): UseNavigationHistoryReturn {\n  const [history, setHistory] = useState\u003cNoteId[]\u003e([]);\n  \n  const canGoBack = history.length \u003e 0;\n  \n  const navigateToNote = useCallback((noteId: NoteId, addToHistory = true) =\u003e {\n    if (addToHistory \u0026\u0026 currentNoteId) {\n      setHistory(prev =\u003e [...prev, currentNoteId]);\n    }\n    loadNote(noteId);\n  }, [currentNoteId, loadNote]);\n  \n  const navigateBack = useCallback(() =\u003e {\n    if (history.length === 0) return;\n    \n    const newHistory = [...history];\n    const prevNoteId = newHistory.pop()!;\n    setHistory(newHistory);\n    loadNote(prevNoteId);\n  }, [history, loadNote]);\n  \n  const clearHistory = useCallback(() =\u003e {\n    setHistory([]);\n  }, []);\n  \n  return {\n    history,\n    canGoBack,\n    navigateToNote,\n    navigateBack,\n    clearHistory,\n  };\n}\n```\n\n## Usage in App.tsx\n```typescript\n// Import the hook\nimport { useNavigationHistory } from './hooks/useNavigationHistory';\n\nfunction App() {\n  const noteState = useNoteState();\n  \n  // Initialize navigation history\n  const { \n    canGoBack, \n    navigateToNote, \n    navigateBack, \n    clearHistory \n  } = useNavigationHistory(noteState.currentNoteId, noteState.loadNote);\n  \n  // Use navigateToNote for wiki-link clicks\n  // Use clearHistory when opening via command palette\n  // Use navigateBack for back button/Cmd+[\n}\n```\n\n## Important Notes\n- Session-only storage (no persistence across app restarts)\n- State resets on page reload\n- Uses array spread for immutable updates\n- loadNote is from useNoteState hook (returns Promise\u003cvoid\u003e)\n\n## Tests\nFile: renderer/src/hooks/useNavigationHistory.test.ts\n- navigateToNote pushes to history when addToHistory=true\n- navigateToNote does NOT push when addToHistory=false\n- navigateToNote does NOT push null currentNoteId\n- navigateBack pops and loads previous note\n- navigateBack does nothing when history empty\n- canGoBack is true only when history has items\n- clearHistory empties the stack and sets canGoBack false\n\n## Acceptance Criteria\n- [ ] Hook manages history stack correctly (LIFO)\n- [ ] navigateToNote pushes current note to history before loading new\n- [ ] navigateBack loads previous and removes from stack\n- [ ] canGoBack is true only when history exists\n- [ ] clearHistory empties the stack\n- [ ] Session-only (no persistence)\n- [ ] Type-safe with NoteId from @scribe/shared","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:42:43.597491-06:00","updated_at":"2025-11-26T15:03:34.138918-06:00","closed_at":"2025-11-26T15:03:34.138918-06:00","dependencies":[{"issue_id":"linked-11","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-12","title":"Implement back button UI","description":"Add the back navigation button to the editor UI.\n\n## Details\n- Files:\n  - renderer/src/components/BackButton/BackButton.tsx (new)\n  - renderer/src/components/BackButton/BackButton.css (new)\n  - renderer/src/components/BackButton/index.ts (new)\n\n## Component Implementation\n```typescript\n// BackButton.tsx\nimport './BackButton.css';\n\ninterface BackButtonProps {\n  visible: boolean;\n  onClick: () =\u003e void;\n}\n\nexport function BackButton({ visible, onClick }: BackButtonProps) {\n  if (!visible) return null;\n  \n  return (\n    \u003cbutton \n      className=\"back-button\"\n      onClick={onClick}\n      aria-label=\"Go back to previous note\"\n      title=\"Go back (⌘[)\"\n      type=\"button\"\n    \u003e\n      ←\n    \u003c/button\u003e\n  );\n}\n```\n\n```typescript\n// index.ts\nexport { BackButton } from './BackButton';\n```\n\n## CSS (BackButton.css)\n```css\n.back-button {\n  position: absolute;\n  top: 1rem;\n  left: 1rem;\n  z-index: 10;\n  background: none;\n  border: none;\n  font-size: 1.25rem;\n  cursor: pointer;\n  color: #666;\n  padding: 0.5rem;\n  border-radius: 4px;\n  transition: background-color 0.15s, color 0.15s;\n  line-height: 1;\n}\n\n.back-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n  color: #333;\n}\n\n.back-button:focus {\n  outline: 2px solid #007bff;\n  outline-offset: 2px;\n}\n\n.back-button:active {\n  background-color: rgba(0, 0, 0, 0.1);\n}\n\n/* Dark mode */\n[data-theme='dark'] .back-button {\n  color: #999;\n}\n\n[data-theme='dark'] .back-button:hover {\n  background-color: rgba(255, 255, 255, 0.1);\n  color: #fff;\n}\n\n[data-theme='dark'] .back-button:focus {\n  outline-color: #58a6ff;\n}\n```\n\n## Layout Position\nThe button sits in the upper left of the app, outside the editor content area:\n```\n┌──────────────────────────────────────────────────────┐\n│                                                      │\n│  ←                                                   │\n│                                                      │\n│        # Meeting Notes                               │\n│                                                      │\n│        Today we discussed [[Project Alpha]]...       │\n│                                                      │\n└──────────────────────────────────────────────────────┘\n```\n\n## Integration in App.tsx\nAdd to the return JSX (the .app div needs position: relative):\n```typescript\n\u003cdiv className=\"app\"\u003e\n  \u003cBackButton visible={canGoBack} onClick={navigateBack} /\u003e\n  \u003cEditorRoot noteState={noteState} /\u003e\n  {/* ... other components */}\n\u003c/div\u003e\n```\n\nEnsure App.css has:\n```css\n.app {\n  position: relative;\n  /* ... existing styles */\n}\n```\n\n## Accessibility\n- aria-label for screen readers\n- title shows keyboard shortcut hint\n- Focusable via Tab key\n- Clear focus ring for keyboard users\n- type=\"button\" prevents form submission issues\n\n## Acceptance Criteria\n- [ ] Button component created in BackButton directory\n- [ ] Button renders only when visible=true\n- [ ] Button hidden when visible=false (returns null)\n- [ ] Click triggers onClick callback\n- [ ] Accessible (aria-label, keyboard focusable)\n- [ ] Tooltip shows keyboard shortcut (⌘[)\n- [ ] Proper positioning in upper-left\n- [ ] Works in light and dark themes\n- [ ] Focus ring visible on keyboard focus","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:43:00.964936-06:00","updated_at":"2025-11-26T15:05:32.445713-06:00","closed_at":"2025-11-26T15:05:32.445713-06:00","dependencies":[{"issue_id":"linked-12","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-12","depends_on_id":"linked-11","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-13","title":"Implement Cmd+[ keyboard shortcut for back navigation","description":"Add keyboard shortcut for back navigation.\n\n## Details\n- File: renderer/src/App.tsx\n\n## Note\nThis task is now part of linked-14 (Integration task). The keyboard handler will be added as part of the full App.tsx integration. This task documents the specific requirements.\n\n## Shortcut\n- Mac: Cmd+[\n- Windows/Linux: Ctrl+[\n\n## Implementation\nAdd to existing keyboard handler in App.tsx useEffect (around line 147-183):\n\n```typescript\nuseEffect(() =\u003e {\n  const handleKeyDown = (e: KeyboardEvent) =\u003e {\n    // ... existing shortcuts (Cmd+K, Cmd+O, Cmd+N)\n    \n    // Cmd+[ / Ctrl+[: Navigate back\n    if ((e.metaKey || e.ctrlKey) \u0026\u0026 e.key === '[') {\n      e.preventDefault();\n      if (canGoBack) {\n        navigateBack();\n      }\n    }\n  };\n  \n  window.addEventListener('keydown', handleKeyDown);\n  return () =\u003e window.removeEventListener('keydown', handleKeyDown);\n}, [isPaletteOpen, noteState, canGoBack, navigateBack]);  // Add canGoBack, navigateBack to deps\n```\n\n## Behavior\n- Only triggers if canGoBack is true\n- Does nothing silently if history is empty\n- Prevents default browser behavior (some browsers use [ for other shortcuts)\n- Works alongside existing ⌘K, ⌘O, ⌘N shortcuts\n\n## Accessibility Notes\n- Back button tooltip should mention ⌘[ (handled in linked-12)\n- Consistent with browser back shortcut on Mac\n\n## Test Scenarios\n1. With history: Press Cmd+[ → navigates back\n2. Without history: Press Cmd+[ → nothing happens (no error)\n3. Works on both Mac (Cmd) and Windows (Ctrl)\n\n## Acceptance Criteria\n- [ ] Cmd+[ triggers navigateBack on Mac\n- [ ] Ctrl+[ triggers navigateBack on Windows/Linux\n- [ ] Does nothing when no history (canGoBack false)\n- [ ] Prevents default browser behavior\n- [ ] No errors logged when history empty\n- [ ] Integrated with existing keyboard handlers\n- [ ] useEffect deps array includes canGoBack and navigateBack","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:43:13.331004-06:00","updated_at":"2025-11-26T15:19:15.175657-06:00","closed_at":"2025-11-26T15:19:15.175657-06:00","dependencies":[{"issue_id":"linked-13","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-13","depends_on_id":"linked-11","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-14","title":"Integrate navigation history with App.tsx","description":"Wire up navigation history with existing note state and command palette. This is the final integration task that brings all wiki-link navigation pieces together.\n\n## Details\n- File: renderer/src/App.tsx\n\n## Prerequisites (blocked by)\n- linked-11: useNavigationHistory hook\n- linked-12: BackButton component\n- linked-13: Cmd+[ keyboard shortcut\n- linked-10: Wiki-link click navigation (WikiLinkContext)\n\n## Changes Needed\n\n### 1. Import new modules\n```typescript\nimport { useNavigationHistory } from './hooks/useNavigationHistory';\nimport { BackButton } from './components/BackButton';\nimport { WikiLinkProvider } from './components/Editor/plugins/WikiLinkContext';\n```\n\n### 2. Initialize useNavigationHistory hook\nAdd after useNoteState (around line 23):\n```typescript\nconst noteState = useNoteState();\n\n// Add navigation history\nconst { canGoBack, navigateToNote, navigateBack, clearHistory } = \n  useNavigationHistory(noteState.currentNoteId, noteState.loadNote);\n```\n\n### 3. Update command palette navigation\nModify onSearchResultSelect and onNoteSelect to clear history (around line 235-244):\n```typescript\nonSearchResultSelect={(result) =\u003e {\n  clearHistory();  // Fresh navigation - clear wiki-link history\n  noteState.loadNote(result.id);\n  setIsPaletteOpen(false);\n}}\n// ...\nonNoteSelect={(noteId) =\u003e {\n  clearHistory();  // Fresh navigation\n  noteState.loadNote(noteId);\n}}\n```\n\n### 4. Clear history on new note creation\nUpdate the ⌘N handler (around line 174-178):\n```typescript\nif ((e.metaKey || e.ctrlKey) \u0026\u0026 e.key === 'n') {\n  e.preventDefault();\n  setIsPaletteOpen(false);\n  clearHistory();  // Add this\n  noteState.createNote();\n}\n```\n\nAnd update the 'new-note' command (around line 46-48):\n```typescript\nrun: async (context) =\u003e {\n  clearHistory();  // Add this\n  await context.createNote();\n},\n```\n\n### 5. Add Cmd+[ handler\nAdd to existing keyboard handler (around line 179):\n```typescript\n// Cmd+[ / Ctrl+[: Navigate back\nif ((e.metaKey || e.ctrlKey) \u0026\u0026 e.key === '[') {\n  e.preventDefault();\n  if (canGoBack) {\n    navigateBack();\n  }\n}\n```\n\n### 6. Create wiki-link click handler\nAdd function in App component:\n```typescript\nconst handleWikiLinkClick = useCallback(async (\n  noteTitle: string, \n  targetId: NoteId | null\n) =\u003e {\n  let resolvedId = targetId;\n  \n  if (!resolvedId) {\n    const note = await window.scribe.notes.findByTitle(noteTitle);\n    if (note) {\n      resolvedId = note.id;\n    }\n  }\n  \n  if (resolvedId) {\n    navigateToNote(resolvedId, true);\n  } else {\n    const newNote = await window.scribe.notes.create();\n    navigateToNote(newNote.id, true);\n  }\n}, [navigateToNote]);\n```\n\n### 7. Pass wiki-link context to EditorRoot\nUpdate EditorRoot to accept and use WikiLinkProvider:\n```typescript\n\u003cEditorRoot \n  noteState={noteState}\n  onWikiLinkClick={handleWikiLinkClick}\n  currentNoteId={noteState.currentNoteId}\n/\u003e\n```\n\n### 8. Render back button\nAdd BackButton alongside EditorRoot in the return JSX:\n```typescript\n\u003cdiv className=\"app\"\u003e\n  \u003cBackButton visible={canGoBack} onClick={navigateBack} /\u003e\n  \u003cEditorRoot noteState={noteState} ... /\u003e\n  {/* rest of components */}\n\u003c/div\u003e\n```\n\n## Important Notes\n- clearHistory must be called before noteState.loadNote, not after\n- Keyboard handler deps must include canGoBack and navigateBack\n- The 'new-note' command needs clearHistory in its context or closure\n\n## Acceptance Criteria\n- [ ] useNavigationHistory integrated in App.tsx\n- [ ] Command palette navigation clears history before loading\n- [ ] New note creation clears history\n- [ ] Cmd+[/Ctrl+[ triggers navigateBack when history exists\n- [ ] Wiki-link clicks use navigateToNote with history\n- [ ] Back button receives canGoBack and navigateBack\n- [ ] Full navigation flow works end-to-end:\n  1. Click wiki-link -\u003e pushes to history -\u003e loads note\n  2. Click back/Cmd+[ -\u003e pops from history -\u003e loads previous\n  3. Open via palette -\u003e clears history -\u003e loads note","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:43:33.607749-06:00","updated_at":"2025-11-26T15:19:16.240362-06:00","closed_at":"2025-11-26T15:19:16.240362-06:00","dependencies":[{"issue_id":"linked-14","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-14","depends_on_id":"linked-11","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-14","depends_on_id":"linked-12","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-14","depends_on_id":"linked-13","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-14","depends_on_id":"linked-10","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-15","title":"Unit tests for WikiLinkNode","description":"Write comprehensive unit tests for the WikiLinkNode.\n\n## Details\n- File: renderer/src/components/Editor/plugins/WikiLinkNode.test.ts\n\n## Test cases\n\n### Node creation\n- Create node with all properties (noteTitle, displayText, targetId)\n- Create node with null targetId (unresolved link)\n- Create node where displayText equals noteTitle (no alias)\n\n### Serialization\n- exportJSON produces correct structure\n- importJSON recreates node correctly\n- Round-trip: export → import preserves all data\n\n### DOM creation\n- createDOM returns span element\n- Span has 'wiki-link' class\n- updateDOM returns false\n\n### Cloning\n- clone() preserves noteTitle\n- clone() preserves displayText\n- clone() preserves targetId\n\n### Text content\n- getTextContent() returns displayText\n- Works for aliased links\n- Works for non-aliased links\n\n### Type checking\n- getType() returns 'wiki-link'\n- isInline() returns true\n\n## Test setup\n```typescript\nimport { WikiLinkNode, $createWikiLinkNode } from './WikiLinkNode';\nimport { $getRoot, $createParagraphNode, createEditor } from 'lexical';\n\ndescribe('WikiLinkNode', () =\u003e {\n  let editor: LexicalEditor;\n  \n  beforeEach(() =\u003e {\n    editor = createEditor({\n      nodes: [WikiLinkNode],\n    });\n  });\n  \n  // ... tests\n});\n```\n\n## Acceptance Criteria\n- [ ] All node creation tests pass\n- [ ] Serialization round-trip works\n- [ ] DOM creation tests pass\n- [ ] Clone preserves all properties\n- [ ] getTextContent returns correct value","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T14:44:00.903119-06:00","updated_at":"2025-11-26T15:21:42.726831-06:00","closed_at":"2025-11-26T15:21:42.726831-06:00","dependencies":[{"issue_id":"linked-15","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-15","depends_on_id":"linked-1","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-16","title":"Unit tests for useNavigationHistory hook","description":"Write unit tests for the navigation history hook.\n\n## Details\n- File: renderer/src/hooks/useNavigationHistory.test.ts\n\n## Test cases\n\n### Initial state\n- history starts empty\n- canGoBack is false initially\n\n### navigateToNote\n- Adds current note to history when addToHistory=true\n- Does not add to history when addToHistory=false\n- Does not add null currentNoteId to history\n- Calls loadNote with correct ID\n\n### navigateBack\n- Pops last item from history\n- Calls loadNote with popped ID\n- Does nothing when history is empty\n- canGoBack updates after pop\n\n### clearHistory\n- Empties the history array\n- canGoBack becomes false\n\n### canGoBack\n- Returns true when history has items\n- Returns false when history is empty\n- Updates reactively\n\n## Test setup\n```typescript\nimport { renderHook, act } from '@testing-library/react';\nimport { useNavigationHistory } from './useNavigationHistory';\n\ndescribe('useNavigationHistory', () =\u003e {\n  const mockLoadNote = vi.fn();\n  \n  beforeEach(() =\u003e {\n    mockLoadNote.mockClear();\n  });\n  \n  it('starts with empty history', () =\u003e {\n    const { result } = renderHook(() =\u003e \n      useNavigationHistory('note-1', mockLoadNote)\n    );\n    \n    expect(result.current.history).toEqual([]);\n    expect(result.current.canGoBack).toBe(false);\n  });\n  \n  // ... more tests\n});\n```\n\n## Acceptance Criteria\n- [ ] All initial state tests pass\n- [ ] navigateToNote tests pass\n- [ ] navigateBack tests pass\n- [ ] clearHistory tests pass\n- [ ] canGoBack reactive updates work","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T14:44:13.988142-06:00","updated_at":"2025-11-26T15:21:30.448759-06:00","closed_at":"2025-11-26T15:21:30.448759-06:00","dependencies":[{"issue_id":"linked-16","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-16","depends_on_id":"linked-11","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-17","title":"Component tests for WikiLinkAutocomplete","description":"Write component tests for the autocomplete UI.\n\n## Details\n- File: renderer/src/components/Editor/plugins/WikiLinkAutocomplete.test.tsx\n\n## Test cases\n\n### Rendering\n- Renders nothing when isOpen=false\n- Renders popup when isOpen=true\n- Positions popup at specified coordinates\n- Shows loading state when isLoading=true\n\n### Results display\n- Renders all results\n- Truncates long titles\n- Shows 'No matching notes' when results empty\n\n### Selection state\n- Highlights item at selectedIndex\n- Scrolls selected item into view\n\n### Interactions\n- Calls onSelect when item clicked\n- Calls onClose when clicking outside (if applicable)\n\n### Keyboard (passed via props)\n- Selected index changes visible highlight\n\n## Test setup\n```typescript\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport { WikiLinkAutocomplete } from './WikiLinkAutocomplete';\n\nconst mockResults = [\n  { id: '1', title: 'Meeting Notes', snippet: '', score: 1, matches: [] },\n  { id: '2', title: 'Project Plan', snippet: '', score: 0.8, matches: [] },\n];\n\ndescribe('WikiLinkAutocomplete', () =\u003e {\n  it('renders results when open', () =\u003e {\n    render(\n      \u003cWikiLinkAutocomplete\n        isOpen={true}\n        query=\"meet\"\n        position={{ top: 100, left: 200 }}\n        results={mockResults}\n        selectedIndex={0}\n        onSelect={vi.fn()}\n        onClose={vi.fn()}\n        isLoading={false}\n      /\u003e\n    );\n    \n    expect(screen.getByText('Meeting Notes')).toBeInTheDocument();\n    expect(screen.getByText('Project Plan')).toBeInTheDocument();\n  });\n  \n  // ... more tests\n});\n```\n\n## Acceptance Criteria\n- [ ] Visibility tests pass\n- [ ] Position tests pass\n- [ ] Results rendering tests pass\n- [ ] Selection highlight tests pass\n- [ ] Click interaction tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T14:44:28.057866-06:00","updated_at":"2025-11-26T15:21:30.991777-06:00","closed_at":"2025-11-26T15:21:30.991777-06:00","dependencies":[{"issue_id":"linked-17","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-17","depends_on_id":"linked-8","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-18","title":"Integration tests for linked notes feature","description":"Write end-to-end integration tests for the linked notes feature.\n\n## Details\n- File: apps/desktop/linked-notes.integration.test.ts\n\n## Prerequisites\nThis test should run after all other tasks are complete. It validates the full feature works end-to-end.\n\n## Test Setup\nUse existing test helpers from apps/desktop/test-helpers.ts:\n```typescript\nimport { expect, test, _electron, ElectronApplication } from '@playwright/test';\nimport { launchApp, createNote, getEditorContent, typeInEditor } from './test-helpers';\n```\n\n## Test Flows\n\n### Flow 1: Create and follow link to new note\n```typescript\ntest('wiki-link creates and navigates to new note', async () =\u003e {\n  const app = await launchApp();\n  \n  // Create initial note\n  await createNote(app, 'Alpha');\n  \n  // Type wiki-link to non-existent note\n  await typeInEditor(app, '[[Beta]]');\n  \n  // Verify WikiLinkNode created (check serialized content)\n  const content = await getEditorContent(app);\n  expect(content).toContain('\"type\":\"wiki-link\"');\n  expect(content).toContain('\"noteTitle\":\"Beta\"');\n  \n  // Click the link\n  await app.click('.wiki-link');\n  \n  // Verify new note created and loaded\n  await expect(app.locator('.editor-input')).toContainText('Beta');\n  \n  // Click back button\n  await app.click('.back-button');\n  \n  // Verify returned to Alpha\n  await expect(app.locator('.editor-input')).toContainText('Alpha');\n});\n```\n\n### Flow 2: Autocomplete selection\n```typescript\ntest('autocomplete shows matching notes', async () =\u003e {\n  const app = await launchApp();\n  \n  // Create test notes\n  await createNote(app, 'Project Alpha');\n  await createNote(app, 'Project Beta');\n  await createNote(app, 'Other Note');\n  \n  // Start new note and trigger autocomplete\n  await createNote(app, 'Test');\n  await typeInEditor(app, '[[Proj');\n  \n  // Verify autocomplete shows\n  await expect(app.locator('.wiki-link-autocomplete')).toBeVisible();\n  await expect(app.locator('.wiki-link-autocomplete-item')).toHaveCount(2);\n  \n  // Select with keyboard\n  await app.keyboard.press('ArrowDown');\n  await app.keyboard.press('Enter');\n  \n  // Verify link inserted with targetId\n  const content = await getEditorContent(app);\n  expect(content).toContain('\"targetId\"');\n});\n```\n\n### Flow 3: Alias syntax\n```typescript\ntest('alias syntax displays custom text', async () =\u003e {\n  const app = await launchApp();\n  \n  await createNote(app, 'Meeting Notes');\n  await createNote(app, 'Test');\n  await typeInEditor(app, '[[Meeting Notes|yesterday]]');\n  \n  // Verify displays alias text\n  await expect(app.locator('.wiki-link')).toContainText('yesterday');\n  \n  // Click and verify correct note loads\n  await app.click('.wiki-link');\n  await expect(app.locator('.editor-input')).toContainText('Meeting Notes');\n});\n```\n\n### Flow 4: Back navigation with Cmd+[\n```typescript\ntest('Cmd+[ navigates back', async () =\u003e {\n  const app = await launchApp();\n  \n  await createNote(app, 'Alpha');\n  await typeInEditor(app, '[[Beta]]');\n  await app.click('.wiki-link');\n  \n  // Press Cmd+[\n  await app.keyboard.press('Meta+[');\n  \n  // Verify back at Alpha\n  await expect(app.locator('.editor-input')).toContainText('Alpha');\n  \n  // Press again - should do nothing\n  await app.keyboard.press('Meta+[');\n  await expect(app.locator('.editor-input')).toContainText('Alpha');\n});\n```\n\n### Flow 5: Graph backlinks integration\n```typescript\ntest('wiki-links appear in backlinks', async () =\u003e {\n  const app = await launchApp();\n  \n  // Create note B first\n  const noteB = await createNote(app, 'Note B');\n  \n  // Create note A with link to B\n  await createNote(app, 'Note A');\n  await typeInEditor(app, 'See [[Note B]] for info');\n  \n  // Navigate to B\n  await app.click('.wiki-link');\n  \n  // Open backlinks (Cmd+K, \"Show Backlinks\")\n  await app.keyboard.press('Meta+k');\n  await typeInEditor(app, 'backlinks');\n  await app.keyboard.press('Enter');\n  \n  // Verify A appears in backlinks\n  await expect(app.locator('.backlink-item')).toContainText('Note A');\n});\n```\n\n## Test Helpers to Add\n```typescript\n// In test-helpers.ts\nexport async function clickWikiLink(app: ElectronApplication, linkText: string) {\n  await app.locator('.wiki-link', { hasText: linkText }).click();\n}\n\nexport async function waitForNoteTitle(app: ElectronApplication, title: string) {\n  // Wait for note with given title to be visible in editor\n  await app.locator('.editor-input').waitFor();\n  // Check first paragraph contains title\n}\n```\n\n## Acceptance Criteria\n- [ ] Flow 1: Link creation and navigation works\n- [ ] Flow 2: Autocomplete selection works  \n- [ ] Flow 3: Alias syntax displays correctly\n- [ ] Flow 4: Back navigation (button and keyboard) works\n- [ ] Flow 5: Graph backlinks integration works\n- [ ] All tests pass in CI\n- [ ] Tests use existing test-helper patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T14:44:46.454759-06:00","updated_at":"2025-11-26T15:27:45.880184-06:00","closed_at":"2025-11-26T15:27:45.880184-06:00","dependencies":[{"issue_id":"linked-18","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-18","depends_on_id":"linked-14","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-18","depends_on_id":"linked-9","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-18","depends_on_id":"linked-4","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-19","title":"Unit tests for metadata extraction (wiki-links)","description":"Add tests for wiki-link extraction in metadata.ts.\n\n## Details\n- File: packages/engine-core/src/metadata.test.ts\n\n## Test cases\n\n### extractLinks with wiki-links\n- Extracts targetId from wiki-link nodes\n- Ignores wiki-links with null targetId\n- Extracts multiple wiki-links from same document\n- Works alongside existing link node types\n- Returns unique IDs (no duplicates)\n\n## Test data\n```typescript\nconst contentWithWikiLinks: LexicalState = {\n  root: {\n    type: 'root',\n    children: [\n      {\n        type: 'paragraph',\n        children: [\n          { type: 'text', text: 'See ' },\n          { \n            type: 'wiki-link', \n            noteTitle: 'Meeting Notes',\n            displayText: 'Meeting Notes',\n            targetId: 'note-123'\n          },\n          { type: 'text', text: ' for details.' }\n        ]\n      }\n    ]\n  }\n};\n\nconst contentWithUnresolvedLink: LexicalState = {\n  root: {\n    type: 'root',\n    children: [\n      {\n        type: 'paragraph',\n        children: [\n          { \n            type: 'wiki-link', \n            noteTitle: 'New Note',\n            displayText: 'New Note',\n            targetId: null  // Unresolved\n          }\n        ]\n      }\n    ]\n  }\n};\n```\n\n## Tests\n```typescript\ndescribe('extractLinks', () =\u003e {\n  it('extracts wiki-link targetId', () =\u003e {\n    const links = extractLinks(contentWithWikiLinks);\n    expect(links).toContain('note-123');\n  });\n  \n  it('ignores wiki-links with null targetId', () =\u003e {\n    const links = extractLinks(contentWithUnresolvedLink);\n    expect(links).toEqual([]);\n  });\n  \n  it('combines wiki-links with other link types', () =\u003e {\n    // Test with mixed link types\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] Wiki-link extraction tests pass\n- [ ] Null targetId handling tested\n- [ ] Multiple links extraction tested\n- [ ] Mixed link types tested","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T14:45:00.820759-06:00","updated_at":"2025-11-26T15:21:43.471919-06:00","closed_at":"2025-11-26T15:21:43.471919-06:00","dependencies":[{"issue_id":"linked-19","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-19","depends_on_id":"linked-4","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-2","title":"Register WikiLinkNode in EditorRoot","description":"Register the WikiLinkNode in the Lexical editor configuration.\n\n## Details\n- File: renderer/src/components/Editor/EditorRoot.tsx\n\n## Changes Required\n\n### 1. Import WikiLinkNode\nAdd import at top of file (after other plugin imports around line 22-26):\n```typescript\nimport { WikiLinkNode } from './plugins/WikiLinkNode';\n```\n\n### 2. Add to nodes array\nAdd WikiLinkNode to the editorConfig.nodes array (around line 75-84):\n```typescript\nnodes: [\n  HeadingNode,\n  QuoteNode,\n  ListNode,\n  ListItemNode,\n  CodeNode,\n  CodeHighlightNode,\n  LinkNode,\n  HorizontalRuleNode,\n  WikiLinkNode,  // Add this\n],\n```\n\n## Why this is needed\n- Lexical requires custom nodes to be registered before they can be used\n- Without registration, existing notes containing wiki-links won't load correctly\n- The node registration must happen before any content is loaded\n\n## Verification Steps\n1. Editor initializes without errors\n2. Console shows no \"unknown node type\" warnings\n3. Any existing test notes with wiki-link JSON load correctly\n\n## Acceptance Criteria\n- [ ] WikiLinkNode imported in EditorRoot.tsx\n- [ ] WikiLinkNode added to editorConfig.nodes array\n- [ ] Editor initializes without errors\n- [ ] No console warnings about unknown node types","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:39:52.060706-06:00","updated_at":"2025-11-26T15:05:29.972715-06:00","closed_at":"2025-11-26T15:05:29.972715-06:00","dependencies":[{"issue_id":"linked-2","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-2","depends_on_id":"linked-1","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-20","title":"Fix race condition in WikiLinkPlugin ]] closure handling","description":"## Problem\nIn WikiLinkPlugin.tsx:256-259, using `setTimeout(..., 0)` to defer insertion after a read operation is fragile. If the user types quickly or the editor state changes between the read and the scheduled callback, the `triggerState` captured in the closure may be stale.\n\n## Current Code\n```typescript\nif (query.endsWith(']]')) {\n  const linkText = query.slice(0, -2);\n  if (linkText) {\n    setTimeout(() =\u003e {\n      insertWikiLink(linkText);\n    }, 0);\n  }\n  return;\n}\n```\n\n## Suggested Fix\nUse `editor.update()` directly within the update listener callback or use Lexical's command system to queue the operation safely.\n\n## File\napps/desktop/renderer/src/components/Editor/plugins/WikiLinkPlugin.tsx:256-259\n\n## Acceptance Criteria\n- [ ] Remove setTimeout workaround\n- [ ] Use Lexical's update mechanism or command system\n- [ ] Verify rapid typing doesn't cause stale state issues\n- [ ] Add test for rapid typing scenario","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-26T19:17:08.993883-06:00","updated_at":"2025-11-26T19:22:12.26491-06:00","closed_at":"2025-11-26T19:22:12.26491-06:00"}
{"id":"linked-21","title":"Remove anti-pattern of attaching state to editor instance","description":"## Problem\nIn WikiLinkPlugin.tsx:365-377, custom properties are being attached directly to the Lexical editor instance:\n\n```typescript\n(editor as unknown as { __wikiLinkInsert?: typeof insertWikiLink }).__wikiLinkInsert =\n  insertWikiLink;\n(editor as unknown as { __wikiLinkTriggerState?: TriggerState | null }).__wikiLinkTriggerState =\n  triggerState;\n```\n\nThis is an anti-pattern because:\n- It bypasses TypeScript's type system\n- Creates hidden coupling between components\n- May conflict with Lexical internals or other plugins\n- Makes code harder to reason about and test\n\n## Current Justification\nThe comment says this is for 'WikiLinkAutocomplete to access', but WikiLinkAutocomplete already receives everything it needs via props.\n\n## Suggested Fix\n- Remove the editor instance mutations\n- If external access is truly needed, use React Context or a ref\n- Verify WikiLinkAutocomplete doesn't actually need this (it appears not to)\n\n## File\napps/desktop/renderer/src/components/Editor/plugins/WikiLinkPlugin.tsx:365-377\n\n## Acceptance Criteria\n- [ ] Remove __wikiLinkInsert and __wikiLinkTriggerState mutations\n- [ ] Verify WikiLinkAutocomplete still works correctly\n- [ ] If external access is needed, implement via React Context or ref\n- [ ] All existing tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T19:17:16.724286-06:00","updated_at":"2025-11-26T19:24:44.963116-06:00","closed_at":"2025-11-26T19:24:44.963116-06:00"}
{"id":"linked-22","title":"Add error handling for wiki-link click navigation","description":"## Problem\nIn WikiLinkNode.ts:46-56, the `handleClick` async function doesn't handle errors from `onLinkClick`:\n\n```typescript\nconst handleClick = async (e: MouseEvent) =\u003e {\n  e.preventDefault();\n  e.stopPropagation();\n\n  if (targetId === currentNoteId) {\n    return;\n  }\n\n  await onLinkClick(noteTitle, targetId);\n};\n```\n\nIf `onLinkClick` throws, the error is unhandled and will be swallowed silently (async click handlers in React don't surface errors to error boundaries). This could leave the UI in an inconsistent state with no feedback to the user.\n\n## Suggested Fix\nWrap in try/catch and surface errors to the user:\n\n```typescript\nconst handleClick = async (e: MouseEvent) =\u003e {\n  e.preventDefault();\n  e.stopPropagation();\n\n  if (targetId === currentNoteId) {\n    return;\n  }\n\n  try {\n    await onLinkClick(noteTitle, targetId);\n  } catch (error) {\n    console.error('Failed to navigate:', error);\n    // Consider showing a toast notification via context\n  }\n};\n```\n\n## Considerations\n- Need to decide how to surface errors (toast, error boundary, etc.)\n- May need to extend WikiLinkContext to include an error handler\n- Should log error details for debugging\n\n## File\napps/desktop/renderer/src/components/Editor/plugins/WikiLinkNode.ts:46-56\n\n## Acceptance Criteria\n- [ ] Add try/catch around onLinkClick call\n- [ ] Log errors to console for debugging\n- [ ] Surface errors to user (toast notification recommended)\n- [ ] Add test for error handling scenario","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-26T19:17:26.179327-06:00","updated_at":"2025-11-26T19:30:27.977937-06:00","closed_at":"2025-11-26T19:30:27.977937-06:00"}
{"id":"linked-23","title":"Replace type assertions with typed helper for wiki-link test nodes","description":"## Problem\nIn linked-notes.integration.test.ts, there are multiple `as any` assertions used to create wiki-link nodes in test content:\n\n```typescript\n{\n  type: 'wiki-link',\n  noteTitle: 'Target Note',\n  displayText: 'Target Note',\n  targetId: targetNote.id,\n  version: 1,\n} as any,\n```\n\nThis pattern appears throughout the test file (lines 118, 331, 485, 519, 549, 559, 599, 639, 699, 739, 785, 849).\n\n## Problems with current approach\n- Bypasses type checking, so invalid test data won't be caught\n- Repetitive boilerplate code\n- If wiki-link schema changes, all instances need manual updates\n- Makes tests harder to read and maintain\n\n## Suggested Fix\nCreate a typed helper function in test-helpers.ts:\n\n```typescript\nimport type { NoteId } from '@scribe/shared';\n\ninterface WikiLinkNodeData {\n  type: 'wiki-link';\n  noteTitle: string;\n  displayText: string;\n  targetId: NoteId | null;\n  version: number;\n}\n\nexport function createWikiLinkNodeData(\n  noteTitle: string,\n  displayText: string = noteTitle,\n  targetId: NoteId | null = null\n): WikiLinkNodeData {\n  return {\n    type: 'wiki-link',\n    noteTitle,\n    displayText,\n    targetId,\n    version: 1,\n  };\n}\n```\n\n## Files\n- apps/desktop/test-helpers.ts (add helper)\n- apps/desktop/linked-notes.integration.test.ts (use helper)\n\n## Acceptance Criteria\n- [ ] Create typed WikiLinkNodeData interface\n- [ ] Create createWikiLinkNodeData helper function\n- [ ] Replace all `as any` wiki-link assertions with helper\n- [ ] All tests still pass\n- [ ] Type errors would be caught if schema changes","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T19:17:37.077542-06:00","updated_at":"2025-11-26T19:30:29.401913-06:00","closed_at":"2025-11-26T19:30:29.401913-06:00"}
{"id":"linked-24","title":"Design System Implementation","description":"Implement the complete Scribe design system with vanilla-extract tokens, light/dark themes, and primitive components. Migrate all existing CSS (~1000 lines) to token-based styling.\n\n## Overview\nThe design system establishes a consistent visual language for Scribe with:\n- Warm neutral color palette with amber/gold accent (#D9A441)\n- Type-safe tokens via vanilla-extract\n- 7 primitive components: Surface, Text, Button, Input, List/ListItem, Icon, Overlay\n- Light and dark theme support\n- Full component migration from plain CSS to token-based styling\n\n## Implementation Phases\n\n### Phase 1: Foundation (linked-25 through linked-31)\n- Package setup and Vite integration\n- Token contract definition\n- Light and dark theme implementations\n- ThemeProvider and theme switching\n- Raw token values for future React Native support\n\n### Phase 2: Primitives (linked-32 through linked-38)\n- Surface, Text, Icon (foundation primitives)\n- Button, Input (interactive primitives)\n- List/ListItem (selection UIs)\n- Overlay/Portal (layering system)\n\n### Phase 3: Command Palette Migration (linked-39)\n- Highest-value component migration\n- Uses all primitives together\n- Delete legacy CommandPalette.css\n\n### Phase 4: Editor Migration (linked-40, linked-41)\n- EditorRoot typography and styles\n- WikiLinkAutocomplete component\n\n### Phase 5: Remaining Components (linked-42 through linked-45)\n- Toast notifications\n- BackButton navigation\n- ErrorNotification\n- Global styles (App.css, index.css)\n\n### Phase 6: Cleanup \u0026 Documentation (linked-46 through linked-49)\n- Delete all legacy CSS files\n- Add visual regression tests\n- Dark mode verification\n- Update documentation\n\n## Success Metrics\n| Metric | Current | Target |\n|--------|---------|--------|\n| Hardcoded hex colors | 100+ | 0 |\n| Hardcoded spacing values | 80+ | 0 |\n| Hardcoded font sizes | 30+ | 0 |\n| Plain CSS files | 8 | 0 (or 1 reset) |\n| Primitive components | 0 | 7 |\n| Theme consistency | Partial | Full |\n\n## Timeline Estimate\n~5 weeks total across all phases\n\n## Reference\nSee features/design-system/spec.md for complete specification","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-26T20:03:28.953957-06:00","updated_at":"2025-11-26T21:28:14.771504-06:00","closed_at":"2025-11-26T21:28:14.771504-06:00"}
{"id":"linked-25","title":"Phase 1: Create design-system package structure","description":"Set up the packages/design-system workspace with proper monorepo configuration.\n\n## Files to Create\n```\npackages/design-system/\n├── package.json\n├── tsconfig.json\n├── eslint.config.js\n└── src/\n    └── index.ts\n```\n\n## package.json\n```json\n{\n  \"name\": \"@scribe/design-system\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"main\": \"src/index.ts\",\n  \"types\": \"src/index.ts\",\n  \"scripts\": {\n    \"lint\": \"eslint .\",\n    \"typecheck\": \"tsc --noEmit\"\n  },\n  \"dependencies\": {\n    \"@vanilla-extract/css\": \"^1.15.0\",\n    \"clsx\": \"^2.1.0\"\n  },\n  \"peerDependencies\": {\n    \"react\": \"^18.0.0\",\n    \"react-dom\": \"^18.0.0\"\n  },\n  \"devDependencies\": {\n    \"@scribe/eslint-config\": \"workspace:*\",\n    \"@scribe/tsconfig\": \"workspace:*\",\n    \"@types/react\": \"^18.3.0\",\n    \"typescript\": \"^5.6.3\"\n  }\n}\n```\n\n## tsconfig.json\nExtend from @scribe/tsconfig/react.json with appropriate settings for vanilla-extract.\n\n## Integration Steps\n1. Create package directory structure\n2. Add workspace reference to root package.json (if not auto-detected)\n3. Add to turbo.json pipeline under `build` and `typecheck`\n4. Run `bun install` to link workspace\n5. Verify import works from renderer app\n\n## Acceptance Criteria\n- [ ] Package directory created at packages/design-system/\n- [ ] package.json with vanilla-extract and clsx dependencies\n- [ ] tsconfig.json extending @scribe/tsconfig/react.json\n- [ ] eslint.config.js following project conventions\n- [ ] src/index.ts with placeholder export\n- [ ] Workspace builds successfully (`bun run typecheck`)\n- [ ] Lint passes (`bun run lint`)\n- [ ] Can be imported as @scribe/design-system from renderer","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:03:39.289557-06:00","updated_at":"2025-11-26T20:26:49.887215-06:00","closed_at":"2025-11-26T20:26:49.887215-06:00","dependencies":[{"issue_id":"linked-25","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-26","title":"Phase 1: Configure vanilla-extract with Vite","description":"Set up vanilla-extract build integration with Vite for the desktop renderer.\n\n## Overview\nvanilla-extract requires build-time CSS extraction. We need to configure the Vite plugin in the renderer app to process .css.ts files from the design-system package.\n\n## Dependencies to Install\nAdd to apps/desktop/renderer/package.json:\n```json\n{\n  \"dependencies\": {\n    \"@scribe/design-system\": \"workspace:*\"\n  },\n  \"devDependencies\": {\n    \"@vanilla-extract/vite-plugin\": \"^4.0.0\"\n  }\n}\n```\n\n## Vite Configuration\nUpdate apps/desktop/renderer/vite.config.ts:\n```typescript\nimport { vanillaExtractPlugin } from '@vanilla-extract/vite-plugin';\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    vanillaExtractPlugin(),\n    // ... existing plugins\n  ],\n  // ...\n});\n```\n\n## Verification Steps\n1. Create a test .css.ts file in design-system package\n2. Import and use the style in renderer\n3. Verify CSS is generated and applied correctly\n4. Verify HMR works for style changes (modify token, see change)\n5. Run production build and verify CSS is extracted\n\n## Notes\n- vanilla-extract works at build time, not runtime\n- CSS is extracted to separate files in production\n- Development mode uses runtime injection for HMR\n- The plugin needs to process files from node_modules/@scribe/design-system\n\n## Acceptance Criteria\n- [ ] @vanilla-extract/vite-plugin installed in renderer\n- [ ] @scribe/design-system added as workspace dependency\n- [ ] Vite config updated with vanillaExtractPlugin()\n- [ ] Test style import works from design-system\n- [ ] HMR works for .css.ts file changes\n- [ ] Production build generates proper CSS bundle\n- [ ] No build errors or warnings","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:03:52.847836-06:00","updated_at":"2025-11-26T20:28:31.355651-06:00","closed_at":"2025-11-26T20:28:14.239685-06:00","dependencies":[{"issue_id":"linked-26","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-26","depends_on_id":"linked-25","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-27","title":"Phase 1: Define token contract","description":"Create the vanilla-extract theme contract that defines all design tokens.\n\n## File\npackages/design-system/src/tokens/contract.css.ts\n\n## Implementation\n```typescript\nimport { createThemeContract } from '@vanilla-extract/css';\n\nexport const vars = createThemeContract({\n  color: {\n    background: null,\n    backgroundAlt: null,\n    surface: null,\n    border: null,\n    foreground: null,\n    foregroundMuted: null,\n    accent: null,\n    accentForeground: null,\n    danger: null,\n    warning: null,\n    info: null,\n  },\n  typography: {\n    fontFamily: {\n      ui: null,\n      mono: null,\n    },\n    size: {\n      xs: null,\n      sm: null,\n      md: null,\n      lg: null,\n      xl: null,\n    },\n    weight: {\n      regular: null,\n      medium: null,\n      bold: null,\n    },\n    lineHeight: {\n      tight: null,\n      normal: null,\n      relaxed: null,\n    },\n  },\n  spacing: {\n    '0': null,\n    '1': null,\n    '2': null,\n    '3': null,\n    '4': null,\n    '6': null,\n    '8': null,\n    '12': null,\n    '16': null,\n    '24': null,\n  },\n  radius: {\n    none: null,\n    sm: null,\n    md: null,\n    lg: null,\n    full: null,\n  },\n  shadow: {\n    sm: null,\n    md: null,\n    lg: null,\n  },\n  zIndex: {\n    base: null,\n    overlay: null,\n    modal: null,\n    palette: null,\n    popover: null,\n    tooltip: null,\n  },\n});\n\nexport type ThemeVars = typeof vars;\n```\n\n## Export Structure\nCreate src/tokens/index.ts:\n```typescript\nexport { vars, type ThemeVars } from './contract.css';\n```\n\n## Benefits\n- Type-safe token access: `vars.color.accent`, `vars.spacing['4']`\n- Compile-time validation ensures themes provide all values\n- IDE auto-complete for all token paths\n- Contract acts as single source of truth\n\n## Token Categories Summary\n| Category | Count | Notes |\n|----------|-------|-------|\n| Colors | 11 | Semantic tokens only |\n| Font Families | 2 | ui, mono |\n| Font Sizes | 5 | xs through xl |\n| Font Weights | 3 | regular, medium, bold |\n| Line Heights | 3 | tight, normal, relaxed |\n| Spacing | 10 | 0 through 24 |\n| Radii | 5 | none through full |\n| Shadows | 3 | sm, md, lg |\n| Z-Index | 6 | base through tooltip |\n\n## Acceptance Criteria\n- [ ] contract.css.ts created at packages/design-system/src/tokens/\n- [ ] All 11 color tokens defined\n- [ ] Typography tokens (fontFamily, size, weight, lineHeight) defined\n- [ ] Spacing scale (0-24) defined\n- [ ] Radius values (none-full) defined\n- [ ] Shadow levels (sm, md, lg) defined\n- [ ] Z-index layers (6 total) defined\n- [ ] ThemeVars type exported\n- [ ] tokens/index.ts re-exports vars\n- [ ] Compiles without TypeScript errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:04:07.750689-06:00","updated_at":"2025-11-26T20:28:31.365424-06:00","closed_at":"2025-11-26T20:28:31.365424-06:00","dependencies":[{"issue_id":"linked-27","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-27","depends_on_id":"linked-25","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-28","title":"Phase 1: Implement light theme","description":"Create the light theme implementation with warm neutral values.\n\n## File\npackages/design-system/src/themes/light.css.ts\n\n## Implementation\n```typescript\nimport { createTheme } from '@vanilla-extract/css';\nimport { vars } from '../tokens/contract.css';\n\nexport const lightTheme = createTheme(vars, {\n  color: {\n    background: '#FAF9F7',      // Warm cream\n    backgroundAlt: '#F4F1EC',   // Subtle warm gray\n    surface: '#EAE6DF',         // Interactive containers\n    border: '#D8D3CB',          // Warm gray borders\n    foreground: '#1E1C19',      // Near-black, warm\n    foregroundMuted: '#7A756B', // Warm gray text\n    accent: '#D9A441',          // Warm amber/gold\n    accentForeground: '#1E1C19',// Dark text on accent\n    danger: '#B94A48',          // Warm red\n    warning: '#E2A65C',         // Warm orange\n    info: '#50698C',            // Muted blue\n  },\n  typography: {\n    fontFamily: {\n      ui: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n      mono: '\"SF Mono\", \"Fira Code\", \"Consolas\", monospace',\n    },\n    size: {\n      xs: '0.75rem',   // 12px\n      sm: '0.875rem',  // 14px\n      md: '1rem',      // 16px\n      lg: '1.125rem',  // 18px\n      xl: '1.25rem',   // 20px\n    },\n    weight: {\n      regular: '400',\n      medium: '500',\n      bold: '600',\n    },\n    lineHeight: {\n      tight: '1.25',\n      normal: '1.5',\n      relaxed: '1.75',\n    },\n  },\n  spacing: {\n    '0': '0',\n    '1': '0.25rem',   // 4px\n    '2': '0.5rem',    // 8px\n    '3': '0.75rem',   // 12px\n    '4': '1rem',      // 16px\n    '6': '1.5rem',    // 24px\n    '8': '2rem',      // 32px\n    '12': '3rem',     // 48px\n    '16': '4rem',     // 64px\n    '24': '6rem',     // 96px\n  },\n  radius: {\n    none: '0',\n    sm: '0.25rem',    // 4px\n    md: '0.5rem',     // 8px\n    lg: '0.75rem',    // 12px\n    full: '9999px',\n  },\n  shadow: {\n    sm: '0 1px 2px rgba(0, 0, 0, 0.05)',\n    md: '0 4px 12px rgba(0, 0, 0, 0.1)',\n    lg: '0 8px 32px rgba(0, 0, 0, 0.15)',\n  },\n  zIndex: {\n    base: '0',\n    overlay: '10',\n    modal: '100',\n    palette: '200',\n    popover: '300',\n    tooltip: '400',\n  },\n});\n```\n\n## Key Design Decisions\n- **Warm neutrals**: All grays lean warm (not cold/blue)\n- **Amber accent**: #D9A441 provides premium editorial feel\n- **Subtle contrast**: backgroundAlt barely differs from background\n- **Readable shadows**: Light, not harsh\n\n## Acceptance Criteria\n- [ ] Light theme created with all contract values\n- [ ] Color values match spec exactly\n- [ ] Typography uses system fonts\n- [ ] Spacing scale is correct\n- [ ] Shadow values are subtle\n- [ ] Theme compiles without errors\n- [ ] Exported from themes/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:04:26.271463-06:00","updated_at":"2025-11-26T20:30:34.464823-06:00","closed_at":"2025-11-26T20:30:34.464823-06:00","dependencies":[{"issue_id":"linked-28","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-28","depends_on_id":"linked-27","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-29","title":"Phase 1: Implement dark theme","description":"Create the dark theme implementation with warm neutral values.\n\n## File\npackages/design-system/src/themes/dark.css.ts\n\n## Implementation\n```typescript\nimport { createTheme } from '@vanilla-extract/css';\nimport { vars } from '../tokens/contract.css';\n\nexport const darkTheme = createTheme(vars, {\n  color: {\n    background: '#1A1A18',      // Dark warm gray\n    backgroundAlt: '#23231F',   // Slightly lighter\n    surface: '#2C2B27',         // Interactive containers\n    border: '#3A3935',          // Subtle border\n    foreground: '#F5F3EE',      // Warm off-white\n    foregroundMuted: '#A7A398', // Muted warm gray\n    accent: '#C2933A',          // Slightly muted amber for dark\n    accentForeground: '#1A1A18',// Dark text on accent\n    danger: '#D06968',          // Softer red for dark\n    warning: '#D19C5F',         // Muted warning\n    info: '#6C85A8',            // Softer blue\n  },\n  typography: {\n    fontFamily: {\n      ui: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n      mono: '\"SF Mono\", \"Fira Code\", \"Consolas\", monospace',\n    },\n    size: {\n      xs: '0.75rem',\n      sm: '0.875rem',\n      md: '1rem',\n      lg: '1.125rem',\n      xl: '1.25rem',\n    },\n    weight: {\n      regular: '400',\n      medium: '500',\n      bold: '600',\n    },\n    lineHeight: {\n      tight: '1.25',\n      normal: '1.5',\n      relaxed: '1.75',\n    },\n  },\n  spacing: {\n    '0': '0',\n    '1': '0.25rem',\n    '2': '0.5rem',\n    '3': '0.75rem',\n    '4': '1rem',\n    '6': '1.5rem',\n    '8': '2rem',\n    '12': '3rem',\n    '16': '4rem',\n    '24': '6rem',\n  },\n  radius: {\n    none: '0',\n    sm: '0.25rem',\n    md: '0.5rem',\n    lg: '0.75rem',\n    full: '9999px',\n  },\n  shadow: {\n    sm: '0 1px 2px rgba(0, 0, 0, 0.2)',\n    md: '0 4px 12px rgba(0, 0, 0, 0.3)',\n    lg: '0 8px 32px rgba(0, 0, 0, 0.4)',\n  },\n  zIndex: {\n    base: '0',\n    overlay: '10',\n    modal: '100',\n    palette: '200',\n    popover: '300',\n    tooltip: '400',\n  },\n});\n```\n\n## Key Design Decisions\n- **Dark with warmth**: Not pure black, warm undertones\n- **Adjusted accent**: Slightly muted amber for better contrast\n- **Stronger shadows**: More opacity needed on dark backgrounds\n- **Softer semantic colors**: Danger/warning/info less harsh\n\n## Parallelization Note\nThis task can be done in parallel with linked-28 (light theme) once linked-27 (contract) is complete.\n\n## Acceptance Criteria\n- [ ] Dark theme created with all contract values\n- [ ] Color values match spec exactly\n- [ ] Shadows have appropriate opacity for dark mode\n- [ ] Accent color works well on dark background\n- [ ] Theme compiles without errors\n- [ ] Exported from themes/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:04:43.273532-06:00","updated_at":"2025-11-26T20:30:34.475568-06:00","closed_at":"2025-11-26T20:30:34.475568-06:00","dependencies":[{"issue_id":"linked-29","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-29","depends_on_id":"linked-27","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-3","title":"Add wiki-link CSS styles","description":"Add CSS styles for wiki-links in the editor.\n\n## Details\n- File: renderer/src/components/Editor/EditorRoot.css\n\n## Styles to add\nAdd at the end of the file:\n\n```css\n/* Wiki Links */\n.wiki-link {\n  color: #007bff;\n  cursor: pointer;\n  border-radius: 2px;\n  padding: 0 2px;\n  margin: 0 1px;\n}\n\n.wiki-link:hover {\n  text-decoration: underline;\n  background-color: rgba(0, 123, 255, 0.1);\n}\n\n/* Dark mode support */\n[data-theme='dark'] .wiki-link {\n  color: #58a6ff;\n}\n\n[data-theme='dark'] .wiki-link:hover {\n  background-color: rgba(88, 166, 255, 0.15);\n}\n```\n\n## Design Notes\n- Blue color (#007bff) matches standard link styling\n- Subtle padding creates slight \"pill\" effect\n- Hover shows underline for clear link affordance  \n- Background tint on hover provides visual feedback\n- Dark mode uses GitHub's dark link color (#58a6ff)\n\n## Verification\n1. Create a note with wiki-link via `[[Note Name]]`\n2. Link displays as blue text\n3. Hovering shows underline and background tint\n4. Toggle to dark mode, verify colors adapt\n5. Link remains visible and clickable in both themes\n\n## Acceptance Criteria\n- [ ] .wiki-link class added to EditorRoot.css\n- [ ] Wiki-links display as blue text\n- [ ] Cursor changes to pointer on hover\n- [ ] Underline appears on hover\n- [ ] Subtle background highlight on hover\n- [ ] Works in both light and dark themes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T14:40:05.164624-06:00","updated_at":"2025-11-26T15:05:30.650629-06:00","closed_at":"2025-11-26T15:05:30.650629-06:00","dependencies":[{"issue_id":"linked-3","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-30","title":"Phase 1: Create raw token values for React Native","description":"Export raw JavaScript token values for future React Native consumption.\n\n## File\npackages/design-system/src/tokens/values.ts\n\n## Purpose\nReact Native cannot consume CSS variables. This file exports the same token values as plain JavaScript objects for cross-platform usage.\n\n## Implementation\n```typescript\nexport const lightThemeValues = {\n  color: {\n    background: '#FAF9F7',\n    backgroundAlt: '#F4F1EC',\n    surface: '#EAE6DF',\n    border: '#D8D3CB',\n    foreground: '#1E1C19',\n    foregroundMuted: '#7A756B',\n    accent: '#D9A441',\n    accentForeground: '#1E1C19',\n    danger: '#B94A48',\n    warning: '#E2A65C',\n    info: '#50698C',\n  },\n  // ... other categories\n} as const;\n\nexport const darkThemeValues = {\n  color: {\n    background: '#1A1A18',\n    // ... etc\n  },\n  // ... other categories\n} as const;\n\nexport type ThemeValues = typeof lightThemeValues;\n```\n\n## Note\nThis is lower priority as React Native support is future work. The structure should match the contract exactly to ensure consistency.\n\n## Acceptance Criteria\n- [ ] values.ts exports lightThemeValues and darkThemeValues\n- [ ] Structure matches contract exactly\n- [ ] Values match theme implementations\n- [ ] TypeScript types exported\n- [ ] File is pure JS (no CSS dependencies)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:04:54.78434-06:00","updated_at":"2025-11-26T21:31:59.819827-06:00","closed_at":"2025-11-26T21:31:59.819827-06:00","dependencies":[{"issue_id":"linked-30","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-30","depends_on_id":"linked-28","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-30","depends_on_id":"linked-29","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-31","title":"Phase 1: Add ThemeProvider and theme switching","description":"Create a React context for theme management and switching.\n\n## Files to Create\n- packages/design-system/src/ThemeProvider.tsx\n- packages/design-system/src/useTheme.ts\n\n## ThemeProvider Implementation\n```typescript\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { lightTheme } from './themes/light.css';\nimport { darkTheme } from './themes/dark.css';\n\ntype Theme = 'light' | 'dark' | 'system';\n\ninterface ThemeContextValue {\n  theme: Theme;\n  resolvedTheme: 'light' | 'dark';\n  setTheme: (theme: Theme) =\u003e void;\n}\n\nconst ThemeContext = createContext\u003cThemeContextValue | null\u003e(null);\n\ninterface ThemeProviderProps {\n  children: ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n}\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = 'system',\n  storageKey = 'scribe-theme',\n}: ThemeProviderProps) {\n  const [theme, setThemeState] = useState\u003cTheme\u003e(() =\u003e {\n    if (typeof window !== 'undefined') {\n      return (localStorage.getItem(storageKey) as Theme) || defaultTheme;\n    }\n    return defaultTheme;\n  });\n\n  const [resolvedTheme, setResolvedTheme] = useState\u003c'light' | 'dark'\u003e('light');\n\n  useEffect(() =\u003e {\n    const resolve = () =\u003e {\n      if (theme === 'system') {\n        return window.matchMedia('(prefers-color-scheme: dark)').matches\n          ? 'dark'\n          : 'light';\n      }\n      return theme;\n    };\n    setResolvedTheme(resolve());\n\n    // Listen for system preference changes\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = () =\u003e {\n      if (theme === 'system') {\n        setResolvedTheme(resolve());\n      }\n    };\n    mediaQuery.addEventListener('change', handleChange);\n    return () =\u003e mediaQuery.removeEventListener('change', handleChange);\n  }, [theme]);\n\n  useEffect(() =\u003e {\n    // Apply theme class to root\n    document.documentElement.classList.remove(lightTheme, darkTheme);\n    document.documentElement.classList.add(\n      resolvedTheme === 'dark' ? darkTheme : lightTheme\n    );\n  }, [resolvedTheme]);\n\n  const setTheme = (newTheme: Theme) =\u003e {\n    localStorage.setItem(storageKey, newTheme);\n    setThemeState(newTheme);\n  };\n\n  return (\n    \u003cThemeContext.Provider value={{ theme, resolvedTheme, setTheme }}\u003e\n      {children}\n    \u003c/ThemeContext.Provider\u003e\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error('useTheme must be used within ThemeProvider');\n  }\n  return context;\n}\n```\n\n## Integration in App.tsx\n```typescript\nimport { ThemeProvider } from '@scribe/design-system';\n\nfunction App() {\n  return (\n    \u003cThemeProvider defaultTheme=\"system\"\u003e\n      {/* app content */}\n    \u003c/ThemeProvider\u003e\n  );\n}\n```\n\n## Features\n- System preference detection via matchMedia\n- Listens for system preference changes\n- Persistent theme preference in localStorage\n- Easy theme toggle via useTheme hook\n- Applies vanilla-extract theme class to documentElement\n\n## Acceptance Criteria\n- [ ] ThemeProvider.tsx created with context and provider\n- [ ] useTheme.ts hook created (or exported from ThemeProvider)\n- [ ] System preference detection works (prefers-color-scheme)\n- [ ] Theme persists to localStorage under configurable key\n- [ ] useTheme hook returns { theme, resolvedTheme, setTheme }\n- [ ] Theme class applied to document.documentElement\n- [ ] Listens for system preference changes when theme='system'\n- [ ] Exported from main src/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:05:10.074412-06:00","updated_at":"2025-11-26T20:33:31.003299-06:00","closed_at":"2025-11-26T20:33:31.003299-06:00","dependencies":[{"issue_id":"linked-31","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-31","depends_on_id":"linked-28","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-31","depends_on_id":"linked-29","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-32","title":"Phase 2: Surface primitive component","description":"Create the Surface primitive - foundational container for all UI.\n\n## Files to Create\n- packages/design-system/src/primitives/Surface/Surface.tsx\n- packages/design-system/src/primitives/Surface/Surface.css.ts\n- packages/design-system/src/primitives/Surface/index.ts\n\n## Props Interface\n```typescript\ninterface SurfaceProps extends React.HTMLAttributes\u003cHTMLDivElement\u003e {\n  variant?: 'surface' | 'background' | 'backgroundAlt';\n  elevation?: 'none' | 'sm' | 'md' | 'lg';\n  padding?: keyof typeof vars.spacing; // '0' | '1' | '2' | ... | '24'\n  radius?: 'none' | 'sm' | 'md' | 'lg' | 'full';\n  bordered?: boolean;\n  as?: React.ElementType;\n  children?: React.ReactNode;\n}\n```\n\n## vanilla-extract Styles (Surface.css.ts)\n```typescript\nimport { style, styleVariants } from '@vanilla-extract/css';\nimport { vars } from '../../tokens/contract.css';\n\nexport const base = style({\n  boxSizing: 'border-box',\n});\n\nexport const variants = styleVariants({\n  surface: { backgroundColor: vars.color.surface },\n  background: { backgroundColor: vars.color.background },\n  backgroundAlt: { backgroundColor: vars.color.backgroundAlt },\n});\n\nexport const elevations = styleVariants({\n  none: { boxShadow: 'none' },\n  sm: { boxShadow: vars.shadow.sm },\n  md: { boxShadow: vars.shadow.md },\n  lg: { boxShadow: vars.shadow.lg },\n});\n\nexport const radii = styleVariants({\n  none: { borderRadius: vars.radius.none },\n  sm: { borderRadius: vars.radius.sm },\n  md: { borderRadius: vars.radius.md },\n  lg: { borderRadius: vars.radius.lg },\n  full: { borderRadius: vars.radius.full },\n});\n\nexport const bordered = style({\n  border: `1px solid ${vars.color.border}`,\n});\n```\n\n## Component Implementation\n- Use forwardRef for ref forwarding\n- Use clsx for className composition\n- Apply padding via inline style using vars.spacing[padding]\n- Support polymorphic `as` prop for element type\n\n## Usage Examples\n```tsx\n\u003cSurface elevation=\"md\" padding=\"4\" radius=\"md\"\u003e\n  Content\n\u003c/Surface\u003e\n\n\u003cSurface variant=\"backgroundAlt\" bordered\u003e\n  Sidebar content\n\u003c/Surface\u003e\n\n\u003cSurface as=\"section\" elevation=\"lg\" padding=\"6\" radius=\"lg\"\u003e\n  Modal content\n\u003c/Surface\u003e\n```\n\n## Why Surface is First\nSurface is the foundation - almost every other primitive and component will use it or derive patterns from it. The command palette, toast, autocomplete all need Surface.\n\n## Acceptance Criteria\n- [ ] Surface.tsx created with all props\n- [ ] Surface.css.ts uses tokens exclusively (no hardcoded values)\n- [ ] variant prop controls background color\n- [ ] elevation prop controls shadow\n- [ ] padding prop uses spacing tokens dynamically\n- [ ] radius prop controls border-radius\n- [ ] bordered prop adds token-based border\n- [ ] as prop allows element type change (div, section, etc.)\n- [ ] Forwards ref properly via forwardRef\n- [ ] Exported from primitives/index.ts\n- [ ] Re-exported from main src/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:05:38.921809-06:00","updated_at":"2025-11-26T20:33:31.014247-06:00","closed_at":"2025-11-26T20:33:31.014247-06:00","dependencies":[{"issue_id":"linked-32","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-32","depends_on_id":"linked-26","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-32","depends_on_id":"linked-27","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-32","depends_on_id":"linked-28","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-32","depends_on_id":"linked-29","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-33","title":"Phase 2: Text primitive component","description":"Create the Text primitive for consistent typography.\n\n## Files to Create\n- packages/design-system/src/primitives/Text/Text.tsx\n- packages/design-system/src/primitives/Text/Text.css.ts\n- packages/design-system/src/primitives/Text/index.ts\n\n## Props Interface\n```typescript\ninterface TextProps extends React.HTMLAttributes\u003cHTMLElement\u003e {\n  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';\n  weight?: 'regular' | 'medium' | 'bold';\n  mono?: boolean;\n  color?: 'foreground' | 'foregroundMuted' | 'accent' | 'danger' | 'warning' | 'info';\n  as?: 'span' | 'p' | 'label' | 'div' | 'h1' | 'h2' | 'h3';\n  truncate?: boolean;\n  children?: React.ReactNode;\n}\n```\n\n## vanilla-extract Styles (Text.css.ts)\n```typescript\nimport { style, styleVariants } from '@vanilla-extract/css';\nimport { vars } from '../../tokens/contract.css';\n\nexport const base = style({\n  margin: 0,\n  fontFamily: vars.typography.fontFamily.ui,\n});\n\nexport const mono = style({\n  fontFamily: vars.typography.fontFamily.mono,\n});\n\nexport const sizes = styleVariants({\n  xs: { fontSize: vars.typography.size.xs, lineHeight: vars.typography.lineHeight.normal },\n  sm: { fontSize: vars.typography.size.sm, lineHeight: vars.typography.lineHeight.normal },\n  md: { fontSize: vars.typography.size.md, lineHeight: vars.typography.lineHeight.normal },\n  lg: { fontSize: vars.typography.size.lg, lineHeight: vars.typography.lineHeight.normal },\n  xl: { fontSize: vars.typography.size.xl, lineHeight: vars.typography.lineHeight.tight },\n});\n\nexport const weights = styleVariants({\n  regular: { fontWeight: vars.typography.weight.regular },\n  medium: { fontWeight: vars.typography.weight.medium },\n  bold: { fontWeight: vars.typography.weight.bold },\n});\n\nexport const colors = styleVariants({\n  foreground: { color: vars.color.foreground },\n  foregroundMuted: { color: vars.color.foregroundMuted },\n  accent: { color: vars.color.accent },\n  danger: { color: vars.color.danger },\n  warning: { color: vars.color.warning },\n  info: { color: vars.color.info },\n});\n\nexport const truncate = style({\n  overflow: 'hidden',\n  textOverflow: 'ellipsis',\n  whiteSpace: 'nowrap',\n});\n```\n\n## Component Implementation\n- Use forwardRef for ref forwarding\n- Use clsx for className composition\n- Default to `span` element\n- Color prop is optional - inherits from parent if not specified\n- Support truncate prop for overflow handling\n\n## Usage Examples\n```tsx\n\u003cText size=\"sm\"\u003eSearch Results\u003c/Text\u003e\n\u003cText mono size=\"xs\" color=\"foregroundMuted\"\u003eCmd+K\u003c/Text\u003e\n\u003cText size=\"lg\" weight=\"bold\"\u003eHeading\u003c/Text\u003e\n\u003cText color=\"danger\"\u003eError message\u003c/Text\u003e\n\u003cText as=\"p\" size=\"md\"\u003eParagraph content\u003c/Text\u003e\n\u003cText truncate\u003eVery long text that should be truncated...\u003c/Text\u003e\n```\n\n## Parallelization Note\nCan be developed in parallel with Surface once token contract is complete.\n\n## Acceptance Criteria\n- [ ] Text.tsx created with all props\n- [ ] Text.css.ts uses tokens exclusively\n- [ ] size prop maps to typography.size tokens\n- [ ] weight prop maps to typography.weight tokens\n- [ ] mono prop switches to monospace fontFamily\n- [ ] color prop controls text color (optional)\n- [ ] as prop allows element type change\n- [ ] truncate prop adds overflow handling\n- [ ] Forwards ref properly via forwardRef\n- [ ] Default color inherits from parent (not hardcoded)\n- [ ] Exported from primitives/index.ts\n- [ ] Re-exported from main src/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:05:55.659087-06:00","updated_at":"2025-11-26T20:33:31.023882-06:00","closed_at":"2025-11-26T20:33:31.023882-06:00","dependencies":[{"issue_id":"linked-33","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-33","depends_on_id":"linked-26","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-33","depends_on_id":"linked-27","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-33","depends_on_id":"linked-28","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-33","depends_on_id":"linked-29","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-34","title":"Phase 2: Icon primitive component","description":"Create the Icon primitive for consistent icon sizing and alignment.\n\n## Files\n- packages/design-system/src/primitives/Icon/Icon.tsx\n- packages/design-system/src/primitives/Icon/Icon.css.ts\n- packages/design-system/src/primitives/Icon/index.ts\n\n## Props Interface\n```typescript\ninterface IconProps extends React.HTMLAttributes\u003cHTMLSpanElement\u003e {\n  size?: 'xs' | 'sm' | 'md' | 'lg';\n  color?: 'foreground' | 'foregroundMuted' | 'accent' | 'danger' | 'warning' | 'info';\n  children: React.ReactNode;\n}\n```\n\n## vanilla-extract Styles (Icon.css.ts)\n```typescript\nimport { style, styleVariants } from '@vanilla-extract/css';\nimport { vars } from '../../tokens/contract.css';\n\nexport const base = style({\n  display: 'inline-flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  flexShrink: 0,\n  // Ensure SVG inherits color\n  selectors: {\n    '\u0026 svg': {\n      width: '100%',\n      height: '100%',\n    },\n  },\n});\n\nexport const sizes = styleVariants({\n  xs: { width: '0.75rem', height: '0.75rem' },  // 12px\n  sm: { width: '1rem', height: '1rem' },        // 16px\n  md: { width: '1.25rem', height: '1.25rem' },  // 20px\n  lg: { width: '1.5rem', height: '1.5rem' },    // 24px\n});\n\nexport const colors = styleVariants({\n  foreground: { color: vars.color.foreground },\n  foregroundMuted: { color: vars.color.foregroundMuted },\n  accent: { color: vars.color.accent },\n  danger: { color: vars.color.danger },\n  warning: { color: vars.color.warning },\n  info: { color: vars.color.info },\n});\n```\n\n## Component Implementation\n```typescript\nimport { forwardRef } from 'react';\nimport * as styles from './Icon.css';\nimport clsx from 'clsx';\n\nexport const Icon = forwardRef\u003cHTMLSpanElement, IconProps\u003e(\n  function Icon(\n    {\n      size = 'md',\n      color,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) {\n    return (\n      \u003cspan\n        ref={ref}\n        className={clsx(\n          styles.base,\n          styles.sizes[size],\n          color \u0026\u0026 styles.colors[color],\n          className\n        )}\n        aria-hidden=\"true\"\n        {...props}\n      \u003e\n        {children}\n      \u003c/span\u003e\n    );\n  }\n);\n```\n\n## Usage Examples\n```tsx\n\u003cIcon size=\"sm\"\u003e\n  \u003cSearchIcon /\u003e\n\u003c/Icon\u003e\n\n\u003cIcon size=\"md\" color=\"accent\"\u003e\n  \u003cStarIcon /\u003e\n\u003c/Icon\u003e\n```\n\n## Notes\n- aria-hidden by default (icons are decorative)\n- SVG children automatically sized to container\n- Color inherits if not specified\n\n## Parallelization Note\nCan be developed in parallel with Surface and Text.\n\n## Acceptance Criteria\n- [ ] Icon component created with all props\n- [ ] size prop controls wrapper dimensions\n- [ ] SVG children scale to fill container\n- [ ] color prop controls icon color\n- [ ] aria-hidden=\"true\" by default\n- [ ] Exported from primitives/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:06:11.084986-06:00","updated_at":"2025-11-26T20:33:31.033055-06:00","closed_at":"2025-11-26T20:33:31.033055-06:00","dependencies":[{"issue_id":"linked-34","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-34","depends_on_id":"linked-26","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-34","depends_on_id":"linked-27","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-35","title":"Phase 2: Button primitive component","description":"Create the Button primitive with multiple variants.\n\n## Files\n- packages/design-system/src/primitives/Button/Button.tsx\n- packages/design-system/src/primitives/Button/Button.css.ts\n- packages/design-system/src/primitives/Button/index.ts\n\n## Props Interface\n```typescript\ninterface ButtonProps extends React.ButtonHTMLAttributes\u003cHTMLButtonElement\u003e {\n  variant?: 'solid' | 'ghost' | 'subtle';\n  tone?: 'accent' | 'neutral' | 'danger';\n  size?: 'sm' | 'md';\n  iconLeft?: React.ReactNode;\n  iconRight?: React.ReactNode;\n  children?: React.ReactNode;\n}\n```\n\n## vanilla-extract Styles (Button.css.ts)\n```typescript\nimport { style, styleVariants, composeStyles } from '@vanilla-extract/css';\nimport { vars } from '../../tokens/contract.css';\n\nexport const base = style({\n  display: 'inline-flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  gap: vars.spacing['2'],\n  border: 'none',\n  cursor: 'pointer',\n  fontFamily: vars.typography.fontFamily.ui,\n  fontWeight: vars.typography.weight.medium,\n  borderRadius: vars.radius.md,\n  transition: 'background-color 0.15s, color 0.15s, box-shadow 0.15s',\n  ':focus-visible': {\n    outline: 'none',\n    boxShadow: `0 0 0 2px ${vars.color.background}, 0 0 0 4px ${vars.color.accent}`,\n  },\n  ':disabled': {\n    opacity: 0.5,\n    cursor: 'not-allowed',\n  },\n});\n\nexport const sizes = styleVariants({\n  sm: {\n    fontSize: vars.typography.size.sm,\n    padding: `${vars.spacing['1']} ${vars.spacing['3']}`,\n    height: '1.75rem',\n  },\n  md: {\n    fontSize: vars.typography.size.md,\n    padding: `${vars.spacing['2']} ${vars.spacing['4']}`,\n    height: '2.25rem',\n  },\n});\n\n// Solid variants\nexport const solidAccent = style({\n  backgroundColor: vars.color.accent,\n  color: vars.color.accentForeground,\n  ':hover:not(:disabled)': {\n    filter: 'brightness(0.95)',\n  },\n});\n\nexport const solidNeutral = style({\n  backgroundColor: vars.color.surface,\n  color: vars.color.foreground,\n  ':hover:not(:disabled)': {\n    backgroundColor: vars.color.border,\n  },\n});\n\nexport const solidDanger = style({\n  backgroundColor: vars.color.danger,\n  color: '#ffffff',\n  ':hover:not(:disabled)': {\n    filter: 'brightness(0.95)',\n  },\n});\n\n// Ghost variants\nexport const ghostAccent = style({\n  backgroundColor: 'transparent',\n  color: vars.color.accent,\n  ':hover:not(:disabled)': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\nexport const ghostNeutral = style({\n  backgroundColor: 'transparent',\n  color: vars.color.foreground,\n  ':hover:not(:disabled)': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\nexport const ghostDanger = style({\n  backgroundColor: 'transparent',\n  color: vars.color.danger,\n  ':hover:not(:disabled)': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\n// Subtle variants\nexport const subtleAccent = style({\n  backgroundColor: vars.color.backgroundAlt,\n  color: vars.color.accent,\n  ':hover:not(:disabled)': {\n    backgroundColor: vars.color.surface,\n  },\n});\n\nexport const subtleNeutral = style({\n  backgroundColor: vars.color.backgroundAlt,\n  color: vars.color.foreground,\n  ':hover:not(:disabled)': {\n    backgroundColor: vars.color.surface,\n  },\n});\n\nexport const subtleDanger = style({\n  backgroundColor: vars.color.backgroundAlt,\n  color: vars.color.danger,\n  ':hover:not(:disabled)': {\n    backgroundColor: vars.color.surface,\n  },\n});\n```\n\n## Usage Examples\n```tsx\n\u003cButton variant=\"solid\" tone=\"accent\"\u003eRun\u003c/Button\u003e\n\u003cButton variant=\"ghost\" iconLeft={\u003cIcon\u003e\u003cSearchIcon /\u003e\u003c/Icon\u003e}\u003eSearch\u003c/Button\u003e\n\u003cButton variant=\"subtle\" tone=\"danger\" size=\"sm\"\u003eDelete\u003c/Button\u003e\n```\n\n## Accessibility\n- Visible focus ring using accent color\n- Disabled state visually distinct\n- Focus-visible for keyboard-only focus\n\n## Acceptance Criteria\n- [ ] Button component created with all props\n- [ ] 3 variants: solid, ghost, subtle\n- [ ] 3 tones: accent, neutral, danger\n- [ ] 2 sizes: sm, md\n- [ ] iconLeft/iconRight support\n- [ ] Focus ring using accent token\n- [ ] Disabled styling\n- [ ] Exported from primitives/index.ts","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-11-26T20:06:30.576422-06:00","updated_at":"2025-11-26T20:33:37.486178-06:00","dependencies":[{"issue_id":"linked-35","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-35","depends_on_id":"linked-32","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-35","depends_on_id":"linked-34","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-36","title":"Phase 2: Input primitive component","description":"Create the Input primitive for search and text entry.\n\n## Files\n- packages/design-system/src/primitives/Input/Input.tsx\n- packages/design-system/src/primitives/Input/Input.css.ts\n- packages/design-system/src/primitives/Input/index.ts\n\n## Props Interface\n```typescript\ninterface InputProps extends Omit\u003cReact.InputHTMLAttributes\u003cHTMLInputElement\u003e, 'size' | 'onChange'\u003e {\n  size?: 'sm' | 'md';\n  iconLeft?: React.ReactNode;\n  iconRight?: React.ReactNode;\n  value?: string;\n  onChange?: (value: string) =\u003e void;\n  error?: boolean;\n}\n```\n\n## vanilla-extract Styles (Input.css.ts)\n```typescript\nimport { style, styleVariants } from '@vanilla-extract/css';\nimport { vars } from '../../tokens/contract.css';\n\nexport const wrapper = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['2'],\n  backgroundColor: vars.color.background,\n  border: `1px solid ${vars.color.border}`,\n  borderRadius: vars.radius.md,\n  transition: 'border-color 0.15s, box-shadow 0.15s',\n  ':focus-within': {\n    borderColor: vars.color.accent,\n    boxShadow: `0 0 0 2px ${vars.color.background}, 0 0 0 4px ${vars.color.accent}`,\n  },\n});\n\nexport const wrapperError = style({\n  borderColor: vars.color.danger,\n  ':focus-within': {\n    borderColor: vars.color.danger,\n    boxShadow: `0 0 0 2px ${vars.color.background}, 0 0 0 4px ${vars.color.danger}`,\n  },\n});\n\nexport const sizes = styleVariants({\n  sm: {\n    padding: `${vars.spacing['1']} ${vars.spacing['2']}`,\n    minHeight: '1.75rem',\n  },\n  md: {\n    padding: `${vars.spacing['2']} ${vars.spacing['3']}`,\n    minHeight: '2.25rem',\n  },\n});\n\nexport const input = style({\n  flex: 1,\n  border: 'none',\n  background: 'transparent',\n  color: vars.color.foreground,\n  fontFamily: vars.typography.fontFamily.ui,\n  fontSize: vars.typography.size.md,\n  outline: 'none',\n  '::placeholder': {\n    color: vars.color.foregroundMuted,\n  },\n});\n\nexport const inputSm = style({\n  fontSize: vars.typography.size.sm,\n});\n\nexport const iconWrapper = style({\n  display: 'flex',\n  alignItems: 'center',\n  color: vars.color.foregroundMuted,\n  flexShrink: 0,\n});\n```\n\n## Component Implementation\n```typescript\nimport { forwardRef } from 'react';\nimport * as styles from './Input.css';\nimport clsx from 'clsx';\n\nexport const Input = forwardRef\u003cHTMLInputElement, InputProps\u003e(\n  function Input(\n    {\n      size = 'md',\n      iconLeft,\n      iconRight,\n      value,\n      onChange,\n      error = false,\n      className,\n      ...props\n    },\n    ref\n  ) {\n    return (\n      \u003cdiv\n        className={clsx(\n          styles.wrapper,\n          styles.sizes[size],\n          error \u0026\u0026 styles.wrapperError,\n          className\n        )}\n      \u003e\n        {iconLeft \u0026\u0026 \u003cspan className={styles.iconWrapper}\u003e{iconLeft}\u003c/span\u003e}\n        \u003cinput\n          ref={ref}\n          className={clsx(styles.input, size === 'sm' \u0026\u0026 styles.inputSm)}\n          value={value}\n          onChange={(e) =\u003e onChange?.(e.target.value)}\n          {...props}\n        /\u003e\n        {iconRight \u0026\u0026 \u003cspan className={styles.iconWrapper}\u003e{iconRight}\u003c/span\u003e}\n      \u003c/div\u003e\n    );\n  }\n);\n```\n\n## Usage Examples\n```tsx\n\u003cInput \n  placeholder=\"Search...\" \n  iconLeft={\u003cIcon size=\"sm\"\u003e\u003cSearchIcon /\u003e\u003c/Icon\u003e}\n  value={query}\n  onChange={setQuery}\n/\u003e\n```\n\n## Accessibility\n- Focus ring on wrapper when input focused\n- Visible placeholder color meets contrast\n- Error state visually distinct\n\n## Acceptance Criteria\n- [ ] Input component created with all props\n- [ ] Wrapper-based design with icon slots\n- [ ] 2 sizes: sm, md\n- [ ] Focus ring on focus-within\n- [ ] Error state with danger color\n- [ ] onChange receives string value directly\n- [ ] Exported from primitives/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:06:49.532408-06:00","updated_at":"2025-11-26T20:54:34.509969-06:00","closed_at":"2025-11-26T20:54:34.509969-06:00","dependencies":[{"issue_id":"linked-36","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-36","depends_on_id":"linked-32","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-36","depends_on_id":"linked-34","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-37","title":"Phase 2: List and ListItem primitive components","description":"Create the List and ListItem primitives for selection UIs.\n\n## Files\n- packages/design-system/src/primitives/List/List.tsx\n- packages/design-system/src/primitives/List/ListItem.tsx\n- packages/design-system/src/primitives/List/List.css.ts\n- packages/design-system/src/primitives/List/index.ts\n\n## List Props Interface\n```typescript\ninterface ListProps extends React.HTMLAttributes\u003cHTMLUListElement\u003e {\n  children: React.ReactNode;\n}\n```\n\n## ListItem Props Interface\n```typescript\ninterface ListItemProps extends React.LiHTMLAttributes\u003cHTMLLIElement\u003e {\n  selected?: boolean;\n  active?: boolean;  // For keyboard navigation highlight\n  iconLeft?: React.ReactNode;\n  iconRight?: React.ReactNode;\n  disabled?: boolean;\n  onClick?: () =\u003e void;\n  children: React.ReactNode;\n}\n```\n\n## vanilla-extract Styles (List.css.ts)\n```typescript\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '../../tokens/contract.css';\n\nexport const list = style({\n  listStyle: 'none',\n  margin: 0,\n  padding: 0,\n});\n\nexport const listItem = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['3'],\n  padding: `${vars.spacing['2']} ${vars.spacing['3']}`,\n  cursor: 'pointer',\n  color: vars.color.foreground,\n  transition: 'background-color 0.1s',\n  borderRadius: vars.radius.sm,\n  ':hover:not([aria-disabled=\"true\"])': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\nexport const listItemActive = style({\n  backgroundColor: vars.color.backgroundAlt,\n});\n\nexport const listItemSelected = style({\n  backgroundColor: vars.color.surface,\n  borderLeft: `3px solid ${vars.color.accent}`,\n  paddingLeft: `calc(${vars.spacing['3']} - 3px)`,\n});\n\nexport const listItemDisabled = style({\n  opacity: 0.5,\n  cursor: 'not-allowed',\n});\n\nexport const iconWrapper = style({\n  display: 'flex',\n  alignItems: 'center',\n  flexShrink: 0,\n  color: vars.color.foregroundMuted,\n});\n\nexport const content = style({\n  flex: 1,\n  minWidth: 0,  // Allow text truncation\n});\n\nexport const iconRight = style({\n  marginLeft: 'auto',\n});\n```\n\n## Component Implementation\n```typescript\n// List.tsx\nexport function List({ children, className, ...props }: ListProps) {\n  return (\n    \u003cul role=\"listbox\" className={clsx(styles.list, className)} {...props}\u003e\n      {children}\n    \u003c/ul\u003e\n  );\n}\n\n// ListItem.tsx\nexport const ListItem = forwardRef\u003cHTMLLIElement, ListItemProps\u003e(\n  function ListItem(\n    {\n      selected = false,\n      active = false,\n      iconLeft,\n      iconRight,\n      disabled = false,\n      onClick,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) {\n    return (\n      \u003cli\n        ref={ref}\n        role=\"option\"\n        aria-selected={selected}\n        aria-disabled={disabled}\n        className={clsx(\n          styles.listItem,\n          active \u0026\u0026 styles.listItemActive,\n          selected \u0026\u0026 styles.listItemSelected,\n          disabled \u0026\u0026 styles.listItemDisabled,\n          className\n        )}\n        onClick={disabled ? undefined : onClick}\n        {...props}\n      \u003e\n        {iconLeft \u0026\u0026 \u003cspan className={styles.iconWrapper}\u003e{iconLeft}\u003c/span\u003e}\n        \u003cspan className={styles.content}\u003e{children}\u003c/span\u003e\n        {iconRight \u0026\u0026 \u003cspan className={clsx(styles.iconWrapper, styles.iconRight)}\u003e{iconRight}\u003c/span\u003e}\n      \u003c/li\u003e\n    );\n  }\n);\n```\n\n## Usage Examples\n```tsx\n\u003cList\u003e\n  \u003cListItem \n    selected \n    iconLeft={\u003cIcon\u003e\u003cFileIcon /\u003e\u003c/Icon\u003e}\n    iconRight={\u003cText mono size=\"xs\"\u003eCmd+O\u003c/Text\u003e}\n  \u003e\n    Open File\n  \u003c/ListItem\u003e\n  \u003cListItem iconLeft={\u003cIcon\u003e\u003cSearchIcon /\u003e\u003c/Icon\u003e}\u003e\n    Search Notes\n  \u003c/ListItem\u003e\n  \u003cListItem disabled\u003e\n    Disabled Item\n  \u003c/ListItem\u003e\n\u003c/List\u003e\n```\n\n## Accessibility\n- role=\"listbox\" on List\n- role=\"option\" on ListItem\n- aria-selected for selection state\n- aria-disabled for disabled state\n- Keyboard navigation handled by parent component\n\n## Acceptance Criteria\n- [ ] List component with listbox role\n- [ ] ListItem with all props and states\n- [ ] selected state with accent indicator\n- [ ] active state for keyboard highlight\n- [ ] disabled state\n- [ ] iconLeft/iconRight slots\n- [ ] Proper ARIA attributes\n- [ ] Exported from primitives/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:07:08.621561-06:00","updated_at":"2025-11-26T20:54:34.915561-06:00","closed_at":"2025-11-26T20:54:34.915561-06:00","dependencies":[{"issue_id":"linked-37","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-37","depends_on_id":"linked-32","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-37","depends_on_id":"linked-33","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-37","depends_on_id":"linked-34","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-38","title":"Phase 2: Overlay and Portal primitive components","description":"Create the Overlay and Portal primitives for layered UI.\n\n## Files\n- packages/design-system/src/primitives/Overlay/Portal.tsx\n- packages/design-system/src/primitives/Overlay/Overlay.tsx\n- packages/design-system/src/primitives/Overlay/Overlay.css.ts\n- packages/design-system/src/primitives/Overlay/index.ts\n\n## Portal Props Interface\n```typescript\ninterface PortalProps {\n  children: React.ReactNode;\n  container?: Element | null;\n}\n```\n\n## Overlay Props Interface\n```typescript\ninterface OverlayProps extends React.HTMLAttributes\u003cHTMLDivElement\u003e {\n  backdrop?: 'none' | 'transparent' | 'blur';\n  open?: boolean;\n  onClose?: () =\u003e void;\n  children: React.ReactNode;\n}\n```\n\n## vanilla-extract Styles (Overlay.css.ts)\n```typescript\nimport { style, styleVariants, keyframes } from '@vanilla-extract/css';\nimport { vars } from '../../tokens/contract.css';\n\nconst fadeIn = keyframes({\n  from: { opacity: 0 },\n  to: { opacity: 1 },\n});\n\nexport const overlay = style({\n  position: 'fixed',\n  inset: 0,\n  zIndex: vars.zIndex.overlay,\n  display: 'flex',\n  alignItems: 'flex-start',\n  justifyContent: 'center',\n  paddingTop: '15vh',  // Command palette position\n  animation: `${fadeIn} 0.15s ease-out`,\n});\n\nexport const backdrops = styleVariants({\n  none: {},\n  transparent: {\n    backgroundColor: 'rgba(0, 0, 0, 0.3)',\n  },\n  blur: {\n    backgroundColor: 'rgba(0, 0, 0, 0.3)',\n    backdropFilter: 'blur(4px)',\n  },\n});\n\nexport const content = style({\n  position: 'relative',\n  zIndex: 1,\n  maxHeight: '70vh',\n  overflow: 'auto',\n});\n```\n\n## Portal Implementation\n```typescript\nimport { useEffect, useState } from 'react';\nimport { createPortal } from 'react-dom';\n\nexport function Portal({ children, container }: PortalProps) {\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() =\u003e {\n    setMounted(true);\n    return () =\u003e setMounted(false);\n  }, []);\n\n  if (!mounted) return null;\n\n  return createPortal(\n    children,\n    container || document.body\n  );\n}\n```\n\n## Overlay Implementation\n```typescript\nimport { useEffect, useCallback } from 'react';\nimport { Portal } from './Portal';\nimport * as styles from './Overlay.css';\nimport clsx from 'clsx';\n\nexport function Overlay({\n  backdrop = 'none',\n  open = true,\n  onClose,\n  className,\n  children,\n  ...props\n}: OverlayProps) {\n  // Handle escape key\n  const handleKeyDown = useCallback((e: KeyboardEvent) =\u003e {\n    if (e.key === 'Escape' \u0026\u0026 onClose) {\n      onClose();\n    }\n  }, [onClose]);\n\n  useEffect(() =\u003e {\n    if (open) {\n      document.addEventListener('keydown', handleKeyDown);\n      // Prevent body scroll\n      document.body.style.overflow = 'hidden';\n    }\n    return () =\u003e {\n      document.removeEventListener('keydown', handleKeyDown);\n      document.body.style.overflow = '';\n    };\n  }, [open, handleKeyDown]);\n\n  // Handle backdrop click\n  const handleBackdropClick = (e: React.MouseEvent) =\u003e {\n    if (e.target === e.currentTarget \u0026\u0026 onClose) {\n      onClose();\n    }\n  };\n\n  if (!open) return null;\n\n  return (\n    \u003cPortal\u003e\n      \u003cdiv\n        className={clsx(\n          styles.overlay,\n          styles.backdrops[backdrop],\n          className\n        )}\n        onClick={handleBackdropClick}\n        {...props}\n      \u003e\n        \u003cdiv className={styles.content}\u003e\n          {children}\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/Portal\u003e\n  );\n}\n```\n\n## Usage Examples\n```tsx\n\u003cOverlay backdrop=\"transparent\" open={isPaletteOpen} onClose={closePalette}\u003e\n  \u003cSurface elevation=\"lg\" radius=\"lg\"\u003e\n    {/* Palette content */}\n  \u003c/Surface\u003e\n\u003c/Overlay\u003e\n```\n\n## Features\n- Portal renders to document.body\n- 3 backdrop options: none, transparent, blur\n- Escape key dismissal\n- Backdrop click dismissal\n- Body scroll lock when open\n- Fade-in animation\n\n## Acceptance Criteria\n- [ ] Portal renders children to document.body\n- [ ] Overlay manages open/close state\n- [ ] 3 backdrop variants\n- [ ] Escape key triggers onClose\n- [ ] Backdrop click triggers onClose\n- [ ] Body scroll locked when open\n- [ ] Uses zIndex tokens\n- [ ] Exported from primitives/index.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:07:29.259086-06:00","updated_at":"2025-11-26T20:56:06.248107-06:00","closed_at":"2025-11-26T20:56:06.248107-06:00","dependencies":[{"issue_id":"linked-38","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-38","depends_on_id":"linked-32","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-38","depends_on_id":"linked-26","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-39","title":"Phase 3: Migrate CommandPalette to design system","description":"Migrate the CommandPalette component to use design system primitives and tokens.\n\n## Current State Analysis\n- CommandPalette.css: ~327 lines of hardcoded styles\n- Uses Tailwind-like colors (#3b82f6) and Bootstrap colors (#dc3545)\n- Inconsistent dark mode handling with [data-theme='dark'] selectors\n- Heavy use of hardcoded spacing (16px, 12px, 8px), colors, and radii\n\n## Target Architecture\nReplace CSS with vanilla-extract styles using primitives:\n- `\u003cOverlay\u003e` for backdrop\n- `\u003cSurface\u003e` for palette container\n- `\u003cInput\u003e` for search field\n- `\u003cList\u003e` + `\u003cListItem\u003e` for results\n- `\u003cText\u003e` for labels and descriptions\n- `\u003cIcon\u003e` for command icons\n\n## Files to Modify\n- apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx\n- apps/desktop/renderer/src/components/CommandPalette/CommandPalette.css (DELETE)\n- CREATE: apps/desktop/renderer/src/components/CommandPalette/CommandPalette.css.ts\n\n## Migration Steps\n\n### Step 1: Update imports\n```typescript\nimport {\n  Overlay,\n  Surface,\n  Input,\n  List,\n  ListItem,\n  Text,\n  Icon,\n  vars,\n} from '@scribe/design-system';\nimport * as styles from './CommandPalette.css';\n```\n\n### Step 2: Replace root structure\n```tsx\n// Before\n\u003cdiv className=\"command-palette-overlay\"\u003e\n  \u003cdiv className=\"command-palette\"\u003e\n\n// After\n\u003cOverlay backdrop=\"transparent\" open={isOpen} onClose={onClose}\u003e\n  \u003cSurface elevation=\"lg\" radius=\"lg\" padding=\"0\" className={styles.paletteContainer}\u003e\n```\n\n### Step 3: Replace search input\n```tsx\n// Before\n\u003cinput className=\"command-palette-input\" ... /\u003e\n\n// After\n\u003cInput\n  iconLeft={\u003cIcon size=\"sm\"\u003e\u003cSearchIcon /\u003e\u003c/Icon\u003e}\n  placeholder=\"Type a command or search...\"\n  value={query}\n  onChange={setQuery}\n/\u003e\n```\n\n### Step 4: Replace results list\n```tsx\n// Before\n\u003cdiv className=\"command-palette-results\"\u003e\n  {items.map(item =\u003e (\n    \u003cdiv className=\"command-palette-item\"\u003e\n\n// After\n\u003cList\u003e\n  {items.map(item =\u003e (\n    \u003cListItem\n      key={item.id}\n      selected={item.id === selectedId}\n      iconLeft={item.icon \u0026\u0026 \u003cIcon\u003e{item.icon}\u003c/Icon\u003e}\n      iconRight={item.shortcut \u0026\u0026 \u003cText mono size=\"xs\"\u003e{item.shortcut}\u003c/Text\u003e}\n      onClick={() =\u003e onSelect(item)}\n    \u003e\n```\n\n### Step 5: Create component-specific styles\nSome styles are unique to CommandPalette and don't belong in primitives:\n```typescript\n// CommandPalette.css.ts\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const paletteContainer = style({\n  width: '600px',\n  maxWidth: '90vw',\n  maxHeight: '70vh',\n  overflow: 'hidden',\n  display: 'flex',\n  flexDirection: 'column',\n});\n\nexport const resultsContainer = style({\n  flex: 1,\n  overflow: 'auto',\n  padding: vars.spacing['2'],\n});\n\nexport const divider = style({\n  height: '1px',\n  backgroundColor: vars.color.border,\n  margin: `${vars.spacing['2']} 0`,\n});\n\nexport const sectionHeader = style({\n  padding: `${vars.spacing['2']} ${vars.spacing['3']}`,\n  color: vars.color.foregroundMuted,\n  fontSize: vars.typography.size.xs,\n  fontWeight: vars.typography.weight.medium,\n  textTransform: 'uppercase',\n  letterSpacing: '0.05em',\n});\n\nexport const inputWrapper = style({\n  padding: vars.spacing['3'],\n  borderBottom: `1px solid ${vars.color.border}`,\n});\n```\n\n## Specific Patterns to Apply\n\n### Category headers\n```tsx\n\u003cdiv className={styles.sectionHeader}\u003eNotes\u003c/div\u003e\n```\n\n### Delete action styling\n```tsx\n\u003cListItem \n  iconLeft={\u003cIcon color=\"danger\"\u003e\u003cTrashIcon /\u003e\u003c/Icon\u003e}\n\u003e\n  \u003cText color=\"danger\"\u003eDelete Note\u003c/Text\u003e\n\u003c/ListItem\u003e\n```\n\n### Keyboard shortcuts display\n```tsx\n\u003cText mono size=\"xs\" color=\"foregroundMuted\"\u003e⌘K\u003c/Text\u003e\n```\n\n## Theme Verification Checklist\n- [ ] Test light theme appearance\n- [ ] Test dark theme appearance  \n- [ ] Verify accent color (#D9A441) on selected items\n- [ ] Verify warm neutral backgrounds\n- [ ] Check keyboard shortcuts are visible in both themes\n\n## Acceptance Criteria\n- [ ] CommandPalette uses Overlay, Surface, Input, List, ListItem, Text, Icon\n- [ ] All hardcoded hex colors removed (search for # in file)\n- [ ] All hardcoded spacing removed (search for px values)\n- [ ] Dark theme works correctly via ThemeProvider\n- [ ] Keyboard navigation still functional (arrow keys, enter, escape)\n- [ ] Selected state uses accent color from tokens\n- [ ] Delete actions use danger color from tokens\n- [ ] CommandPalette.css DELETED\n- [ ] CommandPalette.css.ts created for component-specific styles\n- [ ] Visual appearance matches or improves upon current design","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:08:02.273953-06:00","updated_at":"2025-11-26T21:06:17.882476-06:00","closed_at":"2025-11-26T21:06:17.882476-06:00","dependencies":[{"issue_id":"linked-39","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-39","depends_on_id":"linked-31","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-39","depends_on_id":"linked-36","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-39","depends_on_id":"linked-37","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-39","depends_on_id":"linked-38","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-4","title":"Update metadata extraction for wiki-link nodes","description":"Update the metadata extraction in engine-core to recognize and extract wiki-link nodes.\n\n## Details\n- File: packages/engine-core/src/metadata.ts\n\n## Changes to extractLinks()\nAdd handling for wiki-link nodes in the traverseNodes callback (around line 93-116):\n\n```typescript\n// Recursively traverse nodes to find links\ntraverseNodes(content.root.children, (node) =\u003e {\n  // Standard link nodes with note references\n  if (node.type === 'link' \u0026\u0026 typeof node.url === 'string') {\n    const noteId = extractNoteIdFromUrl(node.url);\n    if (noteId) {\n      links.add(noteId);\n    }\n  }\n\n  // Custom entity reference nodes\n  if (\n    node.type === 'entity-reference' \u0026\u0026\n    node.entityType === 'note' \u0026\u0026\n    typeof node.id === 'string'\n  ) {\n    links.add(node.id);\n  }\n\n  // Custom note reference nodes\n  if (node.type === 'note-reference' \u0026\u0026 typeof node.noteId === 'string') {\n    links.add(node.noteId);\n  }\n\n  // Wiki-link nodes (NEW)\n  if (node.type === 'wiki-link' \u0026\u0026 typeof node.targetId === 'string') {\n    links.add(node.targetId);\n  }\n});\n```\n\n## Why this matters\n- Ensures wiki-links are indexed in the graph engine\n- Enables backlinks queries to find wiki-links  \n- Makes wiki-links part of the knowledge graph\n- Existing \"Show Backlinks\" command will find wiki-links\n\n## Important Notes\n- Only extract targetId if it's a non-null string\n- Unresolved links (targetId === null) should NOT be added to links\n- The node.type will be 'wiki-link' exactly as defined in WikiLinkNode.getType()\n\n## Tests to add in metadata.test.ts\n```typescript\ndescribe('extractLinks', () =\u003e {\n  it('extracts wiki-link nodes with resolved targetId', () =\u003e {\n    const content = {\n      root: {\n        children: [{\n          type: 'paragraph',\n          children: [{\n            type: 'wiki-link',\n            noteTitle: 'Meeting Notes',\n            displayText: 'Meeting Notes',\n            targetId: 'note-123'\n          }]\n        }]\n      }\n    };\n    expect(extractLinks(content)).toEqual(['note-123']);\n  });\n\n  it('ignores wiki-link nodes with null targetId', () =\u003e {\n    const content = {\n      root: {\n        children: [{\n          type: 'paragraph', \n          children: [{\n            type: 'wiki-link',\n            noteTitle: 'New Note',\n            displayText: 'New Note',\n            targetId: null\n          }]\n        }]\n      }\n    };\n    expect(extractLinks(content)).toEqual([]);\n  });\n\n  it('extracts mix of wiki-links and regular links', () =\u003e {\n    const content = {\n      root: {\n        children: [{\n          type: 'paragraph',\n          children: [\n            { type: 'wiki-link', noteTitle: 'A', displayText: 'A', targetId: 'id-1' },\n            { type: 'link', url: 'note://id-2' }\n          ]\n        }]\n      }\n    };\n    expect(extractLinks(content)).toContain('id-1');\n    expect(extractLinks(content)).toContain('id-2');\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] extractLinks() recognizes 'wiki-link' node type\n- [ ] Only extracts links with non-null string targetId\n- [ ] Unit tests pass for all scenarios\n- [ ] Graph engine shows backlinks for wiki-linked notes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:40:22.097864-06:00","updated_at":"2025-11-26T15:05:31.540421-06:00","closed_at":"2025-11-26T15:05:31.540421-06:00","dependencies":[{"issue_id":"linked-4","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-40","title":"Phase 4: Migrate EditorRoot typography to design system","description":"Migrate EditorRoot.css to use design system tokens for typography.\n\n## Current State Analysis\n- EditorRoot.css: ~228 lines\n- Hardcoded colors: #ffffff, #1a1a1a, #007bff, #f5f5f5\n- Hardcoded font sizes: 14px, 16px, 18px, etc.\n- Hardcoded spacing throughout\n- Dark mode handled via [data-theme='dark'] selectors\n\n## Files to Modify\n- apps/desktop/renderer/src/components/Editor/EditorRoot.tsx (update className imports)\n- apps/desktop/renderer/src/components/Editor/EditorRoot.css (DELETE)\n- CREATE: apps/desktop/renderer/src/components/Editor/EditorRoot.css.ts\n\n## Migration Approach\nThe editor has special requirements - it's a writing environment with typography that may differ from UI components. We'll create editor-specific styles but still use tokens for consistency and theming.\n\n## EditorRoot.css.ts Structure\n```typescript\nimport { style, globalStyle } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const editorContainer = style({\n  backgroundColor: vars.color.background,\n  color: vars.color.foreground,\n  fontFamily: vars.typography.fontFamily.ui,\n  fontSize: vars.typography.size.md,\n  lineHeight: vars.typography.lineHeight.relaxed,\n  padding: vars.spacing['6'],\n  maxWidth: '800px',\n  margin: '0 auto',\n  minHeight: '100%',\n});\n\n// Heading styles - use globalStyle for Lexical-generated elements\nglobalStyle(`${editorContainer} h1`, {\n  fontSize: vars.typography.size.xl,\n  fontWeight: vars.typography.weight.bold,\n  marginBottom: vars.spacing['4'],\n  marginTop: vars.spacing['6'],\n  color: vars.color.foreground,\n  lineHeight: vars.typography.lineHeight.tight,\n});\n\nglobalStyle(`${editorContainer} h2`, {\n  fontSize: vars.typography.size.lg,\n  fontWeight: vars.typography.weight.bold,\n  marginBottom: vars.spacing['3'],\n  marginTop: vars.spacing['4'],\n  color: vars.color.foreground,\n});\n\nglobalStyle(`${editorContainer} h3`, {\n  fontSize: vars.typography.size.md,\n  fontWeight: vars.typography.weight.medium,\n  marginBottom: vars.spacing['2'],\n  marginTop: vars.spacing['3'],\n  color: vars.color.foreground,\n});\n\n// Paragraph styles\nglobalStyle(`${editorContainer} p`, {\n  marginBottom: vars.spacing['4'],\n});\n\n// List styles\nglobalStyle(`${editorContainer} ul, ${editorContainer} ol`, {\n  marginBottom: vars.spacing['4'],\n  paddingLeft: vars.spacing['6'],\n});\n\nglobalStyle(`${editorContainer} li`, {\n  marginBottom: vars.spacing['2'],\n});\n\n// Blockquote styles\nglobalStyle(`${editorContainer} blockquote`, {\n  borderLeft: `3px solid ${vars.color.border}`,\n  paddingLeft: vars.spacing['4'],\n  color: vars.color.foregroundMuted,\n  fontStyle: 'italic',\n  marginBottom: vars.spacing['4'],\n  marginLeft: 0,\n});\n\n// Code styles (inline)\nglobalStyle(`${editorContainer} code`, {\n  fontFamily: vars.typography.fontFamily.mono,\n  fontSize: '0.9em',\n  backgroundColor: vars.color.surface,\n  padding: `${vars.spacing['1']} ${vars.spacing['2']}`,\n  borderRadius: vars.radius.sm,\n});\n\n// Code blocks\nglobalStyle(`${editorContainer} pre`, {\n  fontFamily: vars.typography.fontFamily.mono,\n  fontSize: vars.typography.size.sm,\n  backgroundColor: vars.color.surface,\n  padding: vars.spacing['4'],\n  borderRadius: vars.radius.md,\n  overflow: 'auto',\n  marginBottom: vars.spacing['4'],\n});\n\nglobalStyle(`${editorContainer} pre code`, {\n  backgroundColor: 'transparent',\n  padding: 0,\n});\n\n// Wiki-link styles\nexport const wikiLink = style({\n  color: vars.color.accent,\n  textDecoration: 'none',\n  cursor: 'pointer',\n  borderBottom: '1px solid transparent',\n  transition: 'border-color 0.15s',\n  ':hover': {\n    borderBottomColor: vars.color.accent,\n  },\n});\n\nexport const wikiLinkUnresolved = style({\n  color: vars.color.foregroundMuted,\n  fontStyle: 'italic',\n});\n```\n\n## Typography Token Mapping\n| Element | Current Value | Token |\n|---------|---------------|-------|\n| Body | 16px | vars.typography.size.md |\n| H1 | 24px | vars.typography.size.xl |\n| H2 | 20px | vars.typography.size.lg |\n| H3 | 18px | vars.typography.size.md + weight.medium |\n| Code | 14px | vars.typography.size.sm |\n\n## Color Mapping\n| Current | Token |\n|---------|-------|\n| #ffffff | vars.color.background |\n| #1a1a1a | vars.color.foreground |\n| #666666 | vars.color.foregroundMuted |\n| #007bff | vars.color.accent |\n| #f5f5f5 | vars.color.surface |\n\n## Wiki-Link Styling Notes\nWiki-links should use accent color consistently:\n- Resolved links: accent color, subtle underline on hover\n- Unresolved links: muted color, italic style\n\n## Acceptance Criteria\n- [ ] EditorRoot.css.ts created with all styles migrated\n- [ ] All colors use design system tokens\n- [ ] Typography uses token scale\n- [ ] Wiki-links use accent color (not Bootstrap blue)\n- [ ] Code blocks use monospace font from tokens\n- [ ] Dark theme works correctly (test via ThemeProvider)\n- [ ] Line heights maintain readability\n- [ ] EditorRoot.css DELETED\n- [ ] EditorRoot.tsx updated to import .css.ts styles","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T20:08:31.62287-06:00","updated_at":"2025-11-26T21:13:09.857157-06:00","closed_at":"2025-11-26T21:13:09.857157-06:00","dependencies":[{"issue_id":"linked-40","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-40","depends_on_id":"linked-31","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-40","depends_on_id":"linked-27","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-40","depends_on_id":"linked-26","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-41","title":"Phase 4: Migrate WikiLinkAutocomplete to design system","description":"Migrate the WikiLinkAutocomplete component to use design system.\n\n## Current State\n- WikiLinkAutocomplete.css: ~108 lines\n- Positioned dropdown with hardcoded colors\n- Similar structure to command palette results\n\n## Files to Modify\n- renderer/src/components/Editor/plugins/WikiLinkAutocomplete.tsx\n- renderer/src/components/Editor/plugins/WikiLinkAutocomplete.css (delete)\n- Create: WikiLinkAutocomplete.css.ts\n\n## Migration Approach\nReuse List/ListItem primitives where possible. Create component-specific styles for positioning.\n\n## WikiLinkAutocomplete.css.ts\n```typescript\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const dropdown = style({\n  position: 'absolute',\n  zIndex: vars.zIndex.popover,\n  minWidth: '200px',\n  maxWidth: '400px',\n  maxHeight: '300px',\n  overflow: 'auto',\n});\n\nexport const loading = style({\n  padding: vars.spacing['3'],\n  color: vars.color.foregroundMuted,\n  fontSize: vars.typography.size.sm,\n});\n\nexport const empty = style({\n  padding: vars.spacing['3'],\n  color: vars.color.foregroundMuted,\n  fontSize: vars.typography.size.sm,\n  fontStyle: 'italic',\n});\n\nexport const createNew = style({\n  borderTop: `1px solid ${vars.color.border}`,\n  marginTop: vars.spacing['2'],\n  paddingTop: vars.spacing['2'],\n});\n```\n\n## Component Update\n```tsx\nimport { Surface, List, ListItem, Text, Icon } from '@scribe/design-system';\nimport * as styles from './WikiLinkAutocomplete.css';\n\nreturn (\n  \u003cdiv className={styles.dropdown} style={{ top, left }}\u003e\n    \u003cSurface elevation=\"md\" radius=\"md\" padding=\"2\"\u003e\n      {isLoading ? (\n        \u003cdiv className={styles.loading}\u003eSearching...\u003c/div\u003e\n      ) : results.length === 0 ? (\n        \u003cdiv className={styles.empty}\u003eNo matching notes\u003c/div\u003e\n      ) : (\n        \u003cList\u003e\n          {results.map((result, index) =\u003e (\n            \u003cListItem\n              key={result.id}\n              active={index === selectedIndex}\n              onClick={() =\u003e onSelect(result)}\n            \u003e\n              \u003cText size=\"sm\"\u003e{result.title}\u003c/Text\u003e\n            \u003c/ListItem\u003e\n          ))}\n        \u003c/List\u003e\n      )}\n      {query \u0026\u0026 (\n        \u003cdiv className={styles.createNew}\u003e\n          \u003cListItem onClick={onCreateNew}\u003e\n            \u003cText size=\"sm\" color=\"accent\"\u003e\n              Create \"{query}\"\n            \u003c/Text\u003e\n          \u003c/ListItem\u003e\n        \u003c/div\u003e\n      )}\n    \u003c/Surface\u003e\n  \u003c/div\u003e\n);\n```\n\n## Acceptance Criteria\n- [ ] Uses Surface for container\n- [ ] Uses List/ListItem for results\n- [ ] Positioned correctly relative to cursor\n- [ ] Loading and empty states styled\n- [ ] \"Create new\" option styled\n- [ ] Dark theme works\n- [ ] WikiLinkAutocomplete.css deleted","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:08:48.567714-06:00","updated_at":"2025-11-26T21:15:13.725761-06:00","closed_at":"2025-11-26T21:15:13.725761-06:00","dependencies":[{"issue_id":"linked-41","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-41","depends_on_id":"linked-40","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-41","depends_on_id":"linked-37","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-42","title":"Phase 5: Migrate Toast component to design system","description":"Migrate the Toast notification component to use design system tokens.\n\n## Current State\n- Toast.css: ~55 lines\n- Fixed positioning with hardcoded colors\n- Animation styles\n\n## Files to Modify\n- renderer/src/components/Toast/Toast.tsx (or similar path)\n- Toast.css (delete)\n- Create: Toast.css.ts\n\n## Migration Approach\nToast is a notification component that benefits from Surface and Text primitives.\n\n## Toast.css.ts\n```typescript\nimport { style, keyframes } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nconst slideIn = keyframes({\n  from: {\n    transform: 'translateX(100%)',\n    opacity: 0,\n  },\n  to: {\n    transform: 'translateX(0)',\n    opacity: 1,\n  },\n});\n\nconst slideOut = keyframes({\n  from: {\n    transform: 'translateX(0)',\n    opacity: 1,\n  },\n  to: {\n    transform: 'translateX(100%)',\n    opacity: 0,\n  },\n});\n\nexport const toastContainer = style({\n  position: 'fixed',\n  bottom: vars.spacing['4'],\n  right: vars.spacing['4'],\n  zIndex: vars.zIndex.tooltip,\n  display: 'flex',\n  flexDirection: 'column',\n  gap: vars.spacing['2'],\n});\n\nexport const toast = style({\n  animation: `${slideIn} 0.2s ease-out`,\n  minWidth: '280px',\n  maxWidth: '400px',\n});\n\nexport const toastExiting = style({\n  animation: `${slideOut} 0.2s ease-in forwards`,\n});\n```\n\n## Component Update\n```tsx\nimport { Surface, Text, Icon, Button } from '@scribe/design-system';\n\n\u003cSurface elevation=\"lg\" radius=\"md\" padding=\"3\" className={styles.toast}\u003e\n  \u003cdiv style={{ display: 'flex', alignItems: 'start', gap: vars.spacing['3'] }}\u003e\n    {icon \u0026\u0026 \u003cIcon color={tone}\u003e{icon}\u003c/Icon\u003e}\n    \u003cdiv style={{ flex: 1 }}\u003e\n      \u003cText weight=\"medium\"\u003e{title}\u003c/Text\u003e\n      {description \u0026\u0026 \u003cText size=\"sm\" color=\"foregroundMuted\"\u003e{description}\u003c/Text\u003e}\n    \u003c/div\u003e\n    \u003cButton variant=\"ghost\" size=\"sm\" onClick={onClose}\u003e\n      \u003cIcon size=\"sm\"\u003e\u003cCloseIcon /\u003e\u003c/Icon\u003e\n    \u003c/Button\u003e\n  \u003c/div\u003e\n\u003c/Surface\u003e\n```\n\n## Tone Variants\n- Default: neutral colors\n- Success: could add green (or use info)\n- Error: danger color\n- Warning: warning color\n\n## Acceptance Criteria\n- [ ] Uses Surface for container\n- [ ] Uses Text for content\n- [ ] Slide animations preserved\n- [ ] Positioned in bottom-right\n- [ ] Uses zIndex.tooltip\n- [ ] Close button uses Button primitive\n- [ ] Dark theme works\n- [ ] Toast.css deleted","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:09:12.098337-06:00","updated_at":"2025-11-26T21:18:07.51311-06:00","closed_at":"2025-11-26T21:18:07.51311-06:00","dependencies":[{"issue_id":"linked-42","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-42","depends_on_id":"linked-32","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-42","depends_on_id":"linked-33","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-42","depends_on_id":"linked-35","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-43","title":"Phase 5: Migrate BackButton to design system","description":"Migrate the BackButton component to use design system tokens.\n\n## Current State\n- BackButton.css: ~46 lines\n- Simple icon button with hover states\n\n## Files to Modify\n- renderer/src/components/BackButton/BackButton.tsx\n- renderer/src/components/BackButton/BackButton.css (delete)\n- Create: BackButton.css.ts\n\n## Migration Approach\nBackButton is essentially a ghost button - it can use the Button primitive directly.\n\n## Option 1: Use Button Primitive\n```tsx\nimport { Button, Icon } from '@scribe/design-system';\n\nexport function BackButton({ visible, onClick }: BackButtonProps) {\n  if (!visible) return null;\n  \n  return (\n    \u003cButton\n      variant=\"ghost\"\n      size=\"sm\"\n      onClick={onClick}\n      aria-label=\"Go back to previous note\"\n      title=\"Go back (⌘[)\"\n      className={styles.backButton}\n    \u003e\n      \u003cIcon size=\"md\"\u003e←\u003c/Icon\u003e\n    \u003c/Button\u003e\n  );\n}\n```\n\n## Option 2: Custom Styles (if Button doesn't fit)\n```typescript\n// BackButton.css.ts\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const backButton = style({\n  position: 'absolute',\n  top: vars.spacing['4'],\n  left: vars.spacing['4'],\n  zIndex: vars.zIndex.overlay,\n});\n```\n\n## Position Style\nThe button needs absolute positioning - this should be in component-specific styles:\n```typescript\nexport const backButton = style({\n  position: 'absolute',\n  top: vars.spacing['4'],\n  left: vars.spacing['4'],\n  zIndex: vars.zIndex.overlay,\n});\n```\n\n## Acceptance Criteria\n- [ ] Uses Button primitive (ghost variant)\n- [ ] Position styles use spacing tokens\n- [ ] Uses zIndex.overlay token\n- [ ] Dark theme hover states work\n- [ ] Focus ring visible\n- [ ] BackButton.css deleted","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:09:25.23431-06:00","updated_at":"2025-11-26T21:19:56.675259-06:00","closed_at":"2025-11-26T21:19:56.675259-06:00","dependencies":[{"issue_id":"linked-43","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-43","depends_on_id":"linked-35","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-43","depends_on_id":"linked-34","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-44","title":"Phase 5: Migrate ErrorNotification to design system","description":"Migrate the ErrorNotification component to use design system tokens.\n\n## Current State\n- ErrorNotification.css: ~64 lines\n- Error display with hardcoded red colors\n\n## Files to Modify\n- renderer/src/components/ErrorNotification/ErrorNotification.tsx\n- ErrorNotification.css (delete)\n- Create: ErrorNotification.css.ts\n\n## Migration Approach\nErrorNotification is a specialized Surface with danger color styling.\n\n## ErrorNotification.css.ts\n```typescript\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const errorContainer = style({\n  display: 'flex',\n  alignItems: 'flex-start',\n  gap: vars.spacing['3'],\n  padding: vars.spacing['4'],\n  backgroundColor: vars.color.surface,\n  borderLeft: `4px solid ${vars.color.danger}`,\n  borderRadius: vars.radius.md,\n});\n\nexport const errorIcon = style({\n  color: vars.color.danger,\n  flexShrink: 0,\n});\n\nexport const errorContent = style({\n  flex: 1,\n  minWidth: 0,\n});\n\nexport const errorTitle = style({\n  color: vars.color.danger,\n  fontWeight: vars.typography.weight.medium,\n  marginBottom: vars.spacing['1'],\n});\n\nexport const errorMessage = style({\n  color: vars.color.foregroundMuted,\n  fontSize: vars.typography.size.sm,\n});\n\nexport const dismissButton = style({\n  flexShrink: 0,\n});\n```\n\n## Component Update\n```tsx\nimport { Surface, Text, Icon, Button } from '@scribe/design-system';\nimport * as styles from './ErrorNotification.css';\n\nreturn (\n  \u003cSurface elevation=\"sm\" className={styles.errorContainer}\u003e\n    \u003cIcon className={styles.errorIcon} size=\"md\"\u003e\n      \u003cAlertIcon /\u003e\n    \u003c/Icon\u003e\n    \u003cdiv className={styles.errorContent}\u003e\n      \u003cText weight=\"medium\" color=\"danger\"\u003e{title}\u003c/Text\u003e\n      \u003cText size=\"sm\" color=\"foregroundMuted\"\u003e{message}\u003c/Text\u003e\n    \u003c/div\u003e\n    \u003cButton variant=\"ghost\" size=\"sm\" onClick={onDismiss}\u003e\n      \u003cIcon size=\"sm\"\u003e\u003cCloseIcon /\u003e\u003c/Icon\u003e\n    \u003c/Button\u003e\n  \u003c/Surface\u003e\n);\n```\n\n## Acceptance Criteria\n- [ ] Uses Surface for container\n- [ ] Danger color for error indication\n- [ ] Uses Text with appropriate colors\n- [ ] Dismiss button uses Button primitive\n- [ ] Dark theme works\n- [ ] ErrorNotification.css deleted","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:09:38.428681-06:00","updated_at":"2025-11-26T21:21:56.749204-06:00","closed_at":"2025-11-26T21:21:56.749204-06:00","dependencies":[{"issue_id":"linked-44","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-44","depends_on_id":"linked-32","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-44","depends_on_id":"linked-33","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-44","depends_on_id":"linked-35","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-45","title":"Phase 5: Migrate App.css and global styles","description":"Migrate App.css and index.css global styles to use design system tokens.\n\n## Current State Analysis\n- App.css: ~104 lines (layout, backlinks overlay)\n- index.css: ~64 lines (root CSS variables, resets)\n- These files define the app's global styling foundation\n\n## Files to Modify\n- apps/desktop/renderer/src/App.css (DELETE most, some patterns move to new file)\n- apps/desktop/renderer/src/index.css (DELETE - replaced by ThemeProvider)\n- CREATE: apps/desktop/renderer/src/global.css.ts\n\n## Migration Approach\n\n### index.css Replacement\nThe root CSS variables in index.css are completely replaced by:\n1. ThemeProvider applying theme classes to documentElement\n2. Design system tokens providing all values\n3. A minimal global.css.ts for resets\n\n### global.css.ts Implementation\n```typescript\nimport { globalStyle } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\n// Box-sizing reset\nglobalStyle('*, *::before, *::after', {\n  boxSizing: 'border-box',\n  margin: 0,\n  padding: 0,\n});\n\n// Root sizing\nglobalStyle('html, body, #root', {\n  height: '100%',\n  width: '100%',\n});\n\n// Body defaults\nglobalStyle('body', {\n  fontFamily: vars.typography.fontFamily.ui,\n  fontSize: vars.typography.size.md,\n  lineHeight: vars.typography.lineHeight.normal,\n  color: vars.color.foreground,\n  backgroundColor: vars.color.background,\n  WebkitFontSmoothing: 'antialiased',\n  MozOsxFontSmoothing: 'grayscale',\n});\n\n// Text selection\nglobalStyle('::selection', {\n  backgroundColor: vars.color.accent,\n  color: vars.color.accentForeground,\n});\n\n// Focus visible for accessibility\nglobalStyle(':focus-visible', {\n  outline: `2px solid ${vars.color.accent}`,\n  outlineOffset: '2px',\n});\n\n// Link defaults (if any outside of components)\nglobalStyle('a', {\n  color: vars.color.accent,\n  textDecoration: 'none',\n});\n\nglobalStyle('a:hover', {\n  textDecoration: 'underline',\n});\n```\n\n### App-specific styles\n```typescript\n// App.css.ts\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const app = style({\n  position: 'relative',\n  height: '100%',\n  width: '100%',\n  display: 'flex',\n  flexDirection: 'column',\n});\n\nexport const mainContent = style({\n  flex: 1,\n  overflow: 'auto',\n});\n\nexport const backlinksOverlay = style({\n  position: 'fixed',\n  bottom: vars.spacing['4'],\n  right: vars.spacing['4'],\n  maxWidth: '300px',\n  zIndex: vars.zIndex.overlay,\n});\n```\n\n## Current index.css Variables to Remove\nThese are replaced by design system tokens:\n```css\n/* All of these go away */\n--color-bg-primary: #ffffff;\n--color-bg-secondary: #f5f5f5;\n--color-text-primary: #1a1a1a;\n--color-text-secondary: #666666;\n--color-accent: #007aff;\n--color-border: #e5e5e5;\n```\n\n## Import Changes in main.tsx or App.tsx\n```typescript\n// Before\nimport './index.css';\nimport './App.css';\n\n// After\nimport './global.css'; // Import the .css.ts file (extension omitted)\nimport * as styles from './App.css';\n```\n\n## Acceptance Criteria\n- [ ] global.css.ts created with reset and body styles\n- [ ] App.css.ts created with app layout styles\n- [ ] All styles use design system tokens\n- [ ] index.css DELETED\n- [ ] App.css DELETED\n- [ ] main.tsx/index.tsx updated to import global.css\n- [ ] App.tsx updated to use App.css.ts styles\n- [ ] Backlinks overlay uses token-based positioning\n- [ ] Both themes work correctly\n- [ ] Selection highlight uses accent color","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:09:58.751166-06:00","updated_at":"2025-11-26T21:24:56.318291-06:00","closed_at":"2025-11-26T21:24:56.318291-06:00","dependencies":[{"issue_id":"linked-45","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-45","depends_on_id":"linked-31","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-46","title":"Phase 6: Delete legacy CSS files","description":"Remove all legacy plain CSS files after migration is complete.\n\n## Files to Delete\nAfter verifying all components work with the design system:\n\n### Renderer CSS Files (in order of migration)\n1. [ ] apps/desktop/renderer/src/components/CommandPalette/CommandPalette.css\n2. [ ] apps/desktop/renderer/src/components/Editor/EditorRoot.css\n3. [ ] apps/desktop/renderer/src/components/Editor/plugins/WikiLinkAutocomplete.css\n4. [ ] apps/desktop/renderer/src/components/Toast/Toast.css (verify path)\n5. [ ] apps/desktop/renderer/src/components/BackButton/BackButton.css\n6. [ ] apps/desktop/renderer/src/components/ErrorNotification/ErrorNotification.css\n7. [ ] apps/desktop/renderer/src/App.css\n8. [ ] apps/desktop/renderer/src/index.css\n\n## Pre-Deletion Checklist\nBefore deleting each file, verify:\n1. [ ] Component renders correctly in browser\n2. [ ] Light theme appearance matches or improves design\n3. [ ] Dark theme appearance matches or improves design\n4. [ ] No console errors related to styles\n5. [ ] No visual regressions (compare screenshots)\n6. [ ] All interactive states work (hover, focus, active)\n\n## Verification Commands\n```bash\n# Find any remaining hardcoded colors in TSX files\nrg '#[0-9a-fA-F]{3,6}' --type tsx apps/desktop/renderer/src/\n\n# Find any remaining plain CSS imports\nrg \"import.*\\.css'\" apps/desktop/renderer/src/ --type tsx\nrg 'import.*\\.css\"' apps/desktop/renderer/src/ --type tsx\n\n# Find any remaining CSS files\nfd '\\.css$' apps/desktop/renderer/src/\n```\n\n## Expected Final State\n- 0 plain .css files in renderer/src (or 1 minimal reset if needed)\n- All styles in .css.ts files using vanilla-extract\n- All component imports from @scribe/design-system\n- No hardcoded color values in component files\n\n## Post-Deletion\n- Run full test suite to catch any issues\n- Manual QA of all major flows\n- Update any documentation referencing old CSS files\n\n## Acceptance Criteria\n- [ ] All 8 legacy CSS files deleted\n- [ ] No broken imports (app compiles)\n- [ ] App builds successfully (bun run build)\n- [ ] All existing tests pass\n- [ ] Visual appearance unchanged (or intentionally improved)\n- [ ] Both themes work correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:10:20.680253-06:00","updated_at":"2025-11-26T21:25:17.65471-06:00","closed_at":"2025-11-26T21:25:17.65471-06:00","dependencies":[{"issue_id":"linked-46","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-46","depends_on_id":"linked-39","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-46","depends_on_id":"linked-40","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-46","depends_on_id":"linked-41","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-46","depends_on_id":"linked-42","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-46","depends_on_id":"linked-43","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-46","depends_on_id":"linked-44","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-46","depends_on_id":"linked-45","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-47","title":"Phase 6: Add visual regression tests","description":"Add screenshot-based visual regression tests to catch unintended style changes.\n\n## Purpose\nVisual regression tests capture screenshots of components and compare them against baselines. This catches unintended changes during future development.\n\n## Recommended Tool\n- Playwright with built-in screenshot comparison\n- Or: Storybook + Chromatic (if Storybook is added)\n\n## Test Cases\n\n### Component Screenshots\n1. **CommandPalette**\n   - Open state (light theme)\n   - Open state (dark theme)\n   - With search results\n   - With selected item\n   - Delete action highlighted\n\n2. **Editor**\n   - Empty state\n   - With content (headings, paragraphs, lists)\n   - With wiki-links\n   - Code block rendering\n\n3. **Toast**\n   - Default notification\n   - Error notification\n   - Multiple toasts\n\n4. **Primitives**\n   - Button variants (solid, ghost, subtle)\n   - Input states (default, focus, error)\n   - List with selection\n\n### Theme Comparison\n- Each component in light and dark theme\n- Ensure contrast ratios meet accessibility standards\n\n## Implementation Example\n```typescript\n// tests/visual/command-palette.spec.ts\nimport { test, expect } from '@playwright/test';\n\ntest('command palette matches baseline - light theme', async ({ page }) =\u003e {\n  await page.goto('/');\n  await page.keyboard.press('Meta+k');\n  await page.waitForSelector('[role=\"dialog\"]');\n  \n  await expect(page).toHaveScreenshot('command-palette-light.png');\n});\n\ntest('command palette matches baseline - dark theme', async ({ page }) =\u003e {\n  // Set dark theme\n  await page.evaluate(() =\u003e {\n    localStorage.setItem('scribe-theme', 'dark');\n  });\n  await page.goto('/');\n  await page.keyboard.press('Meta+k');\n  await page.waitForSelector('[role=\"dialog\"]');\n  \n  await expect(page).toHaveScreenshot('command-palette-dark.png');\n});\n```\n\n## Update Strategy\n- Baseline images stored in git\n- CI runs comparison on PRs\n- Manual review of intentional changes\n\n## Acceptance Criteria\n- [ ] Visual test setup configured\n- [ ] CommandPalette snapshots (light/dark)\n- [ ] Editor snapshots (light/dark)\n- [ ] Primitive component snapshots\n- [ ] CI integration\n- [ ] Documentation on updating baselines","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T20:10:37.844162-06:00","updated_at":"2025-11-26T21:32:00.013464-06:00","closed_at":"2025-11-26T21:32:00.013464-06:00","dependencies":[{"issue_id":"linked-47","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-47","depends_on_id":"linked-46","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-48","title":"Phase 6: Verify dark mode consistency","description":"Comprehensive dark mode verification across all components.\n\n## Purpose\nEnsure consistent dark mode experience after migration. The current codebase has inconsistent dark mode handling with different selector patterns.\n\n## Verification Checklist\n\n### Global Styles\n- [ ] Body background uses vars.color.background\n- [ ] Text color uses vars.color.foreground\n- [ ] Selection highlight uses accent color\n- [ ] Focus rings visible in both themes\n\n### Command Palette\n- [ ] Overlay backdrop appropriate darkness\n- [ ] Surface background uses vars.color.surface\n- [ ] Input field border and background correct\n- [ ] Selected item highlight visible (accent color)\n- [ ] Keyboard shortcuts readable (foregroundMuted)\n- [ ] Delete action danger color visible\n\n### Editor\n- [ ] Editor background correct\n- [ ] Heading colors correct\n- [ ] Body text readable (sufficient contrast)\n- [ ] Wiki-links visible (accent color)\n- [ ] Code blocks have appropriate contrast\n- [ ] Blockquote styling visible\n\n### Other Components\n- [ ] BackButton visible on dark background\n- [ ] Toast notifications readable\n- [ ] Error notifications visible (danger color)\n- [ ] Autocomplete dropdown readable\n\n### Interactive States\n- [ ] Focus rings visible (accent color, 4px outline)\n- [ ] Hover states distinguishable from default\n- [ ] Active/pressed states visible\n- [ ] Disabled states clearly apparent (opacity)\n\n## Common Dark Mode Issues to Check\n1. **Insufficient contrast**: Text too faint against background\n2. **Wrong background layers**: Surface same color as background\n3. **Missing dark overrides**: Some elements remain light themed\n4. **Focus rings invisible**: Ring color too similar to background\n5. **Shadows too harsh**: Opacity not adjusted for dark backgrounds\n\n## Testing Process\n1. Enable dark mode via ThemeProvider (setTheme('dark'))\n2. Navigate through entire app systematically\n3. Screenshot each major view\n4. Compare against light mode for consistency\n5. Use browser devtools to verify CSS variable values\n\n## Tools \u0026 Commands\n```bash\n# Verify theme class is applied\n# In browser console:\ndocument.documentElement.classList\n\n# Check computed styles for an element\ngetComputedStyle(element).backgroundColor\n```\n\n## Color Contrast Requirements\n- Normal text: minimum 4.5:1 contrast ratio\n- Large text (18px+): minimum 3:1 contrast ratio\n- Use browser devtools or axe extension to verify\n\n## Acceptance Criteria\n- [ ] All components tested in dark mode manually\n- [ ] No contrast issues (meets WCAG AA)\n- [ ] All interactive states visible\n- [ ] Focus management works (tab through app)\n- [ ] Screenshots captured for documentation\n- [ ] No console errors related to theming","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T20:10:54.278233-06:00","updated_at":"2025-11-26T21:27:47.594275-06:00","closed_at":"2025-11-26T21:27:47.594275-06:00","dependencies":[{"issue_id":"linked-48","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-48","depends_on_id":"linked-46","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-49","title":"Phase 6: Update component documentation","description":"Update existing design system documentation with implementation details.\n\n## Files to Update\n- docs/design-system/scribe_design_system_architecture.md\n- docs/design-system/scribe_design_tokens.md  \n- docs/design-system/scribe_ds_usage_guidelines.md\n- docs/design-system/scribe_primitives_spec.md\n- features/design-system/spec.md\n\n## Documentation Updates Needed\n\n### Architecture Doc\n- Add actual file paths matching implementation\n- Document vanilla-extract setup and Vite plugin configuration\n- Add package structure diagram\n\n### Token Doc\n- Add actual import statements: `import { vars } from '@scribe/design-system'`\n- Show how to access tokens in vanilla-extract styles\n- Document any token additions/changes from spec\n\n### Usage Guidelines\n- Add real code examples from migrated components\n- Document common patterns discovered during migration\n- Add troubleshooting section for common issues\n\n### Primitives Spec\n- Add actual TypeScript prop interfaces from code\n- Document any deviations from original spec\n- Add usage examples from actual migration\n\n### Spec Doc (features/design-system/spec.md)\n- Update \"Implementation Work Required\" section to reflect completion\n- Add \"Lessons Learned\" section\n- Document any scope changes or additions\n\n## New Documentation to Add\n\n### Developer Quick Start (add to README or separate file)\n```markdown\n## Using the Design System\n\n### Import tokens\n\\`\\`\\`typescript\nimport { vars } from '@scribe/design-system';\n\n// Use in vanilla-extract styles\nexport const myStyle = style({\n  color: vars.color.foreground,\n  padding: vars.spacing['4'],\n});\n\\`\\`\\`\n\n### Import primitives\n\\`\\`\\`typescript\nimport { Surface, Text, Button } from '@scribe/design-system';\n\n\u003cSurface elevation=\"md\" padding=\"4\"\u003e\n  \u003cText size=\"lg\"\u003eHello\u003c/Text\u003e\n  \u003cButton variant=\"solid\" tone=\"accent\"\u003eClick me\u003c/Button\u003e\n\u003c/Surface\u003e\n\\`\\`\\`\n\n### Use ThemeProvider\n\\`\\`\\`typescript\nimport { ThemeProvider } from '@scribe/design-system';\n\n\u003cThemeProvider defaultTheme=\"system\"\u003e\n  \u003cApp /\u003e\n\u003c/ThemeProvider\u003e\n\\`\\`\\`\n\n### Toggle theme\n\\`\\`\\`typescript\nimport { useTheme } from '@scribe/design-system';\n\nfunction ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n  return (\n    \u003cButton onClick={() =\u003e setTheme(theme === 'dark' ? 'light' : 'dark')}\u003e\n      Toggle theme\n    \u003c/Button\u003e\n  );\n}\n\\`\\`\\`\n```\n\n## Acceptance Criteria\n- [ ] All 5 documentation files updated with accurate information\n- [ ] Import statements match actual package exports\n- [ ] Code examples are tested and working\n- [ ] Any spec deviations documented\n- [ ] Quick start guide added for new developers\n- [ ] Troubleshooting section added\n- [ ] All links between docs are valid","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T20:11:10.046833-06:00","updated_at":"2025-11-26T21:28:13.737394-06:00","closed_at":"2025-11-26T21:28:13.737394-06:00","dependencies":[{"issue_id":"linked-49","depends_on_id":"linked-24","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-49","depends_on_id":"linked-46","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-5","title":"Implement notes:findByTitle IPC handler","description":"Add IPC handler to find a note by its title for link resolution.\n\n## Details\n- Files: \n  - apps/desktop/electron/main/src/main.ts (handler)\n  - apps/desktop/electron/preload/src/preload.ts (API)\n\n## IPC Channel: notes:findByTitle\n\n### Input\n```typescript\ntitle: string\n```\n\n### Output  \n```typescript\nNote | null\n```\n\n### Resolution Logic\n1. Exact match: Find note where metadata.title === title\n2. Case-insensitive match: Find note where metadata.title.toLowerCase() === title.toLowerCase()\n3. Multiple matches: Return most recently updated (highest updatedAt)\n4. No match: Return null\n\n## Main process handler\n```typescript\n// Add to main.ts after existing notes handlers\nipcMain.handle('notes:findByTitle', async (_event, title: string) =\u003e {\n  if (!vault) {\n    throw new Error('Vault not initialized');\n  }\n  const notes = vault.list();\n  \n  // Exact match first\n  let match = notes.find(n =\u003e n.metadata.title === title);\n  \n  // Case-insensitive fallback\n  if (!match) {\n    const lowerTitle = title.toLowerCase();\n    const matches = notes.filter(n =\u003e \n      n.metadata.title?.toLowerCase() === lowerTitle\n    );\n    // Most recently updated wins\n    match = matches.sort((a, b) =\u003e b.updatedAt - a.updatedAt)[0];\n  }\n  \n  return match ?? null;\n});\n```\n\n## Preload API\n```typescript\nnotes: {\n  // ... existing methods (list, read, create, save, delete)\n  findByTitle: (title: string): Promise\u003cNote | null\u003e =\u003e\n    ipcRenderer.invoke('notes:findByTitle', title),\n}\n```\n\n## Important Notes\n- Uses `vault.list()` (synchronous) not `storage.list()` - see main.ts:109\n- vault is of type FileSystemVault\n- Note type from @scribe/shared\n\n## Tests\n- Find note by exact title match\n- Find note by case-insensitive match\n- Return most recent when multiple matches\n- Return null when no match\n\n## Acceptance Criteria\n- [ ] IPC handler implemented in main.ts\n- [ ] Preload API exposed with correct types\n- [ ] Exact match takes priority\n- [ ] Case-insensitive fallback works\n- [ ] Most recent note returned for duplicates\n- [ ] Returns null (not undefined) when no match","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:40:37.726372-06:00","updated_at":"2025-11-26T15:03:32.670799-06:00","closed_at":"2025-11-26T15:03:32.670799-06:00","dependencies":[{"issue_id":"linked-5","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-50","title":"Fix dual Escape key handler conflict between Overlay and CommandPalette","description":"The Overlay component adds a global Escape key handler that calls onClose, but CommandPalette also has its own Escape key handling with different behavior depending on mode (e.g., returning to command mode from file-browse, not closing). Since both handlers are registered, this could cause unexpected behavior. Solution: Add a closeOnEscape prop to Overlay (default true) and set it to false in CommandPalette.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-26T21:46:34.246664-06:00","updated_at":"2025-11-26T21:48:58.047473-06:00","closed_at":"2025-11-26T21:48:58.047473-06:00"}
{"id":"linked-51","title":"Input component onChange signature breaks React conventions","description":"The Input component has a non-standard onChange signature (value: string) =\u003e void instead of native (e: ChangeEvent) =\u003e void. This breaks compatibility with form libraries like react-hook-form and formik. Solution: Keep the native signature and add an onValueChange prop for convenience.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-26T21:46:35.693345-06:00","updated_at":"2025-11-26T21:53:30.276071-06:00","closed_at":"2025-11-26T21:53:30.276071-06:00"}
{"id":"linked-52","title":"Surface component polymorphic as prop has incorrect ref typing","description":"The polymorphic as prop typing doesn't properly constrain ref types. If you render \u003cSurface as='section' ref={sectionRef} /\u003e, the ref type is still HTMLDivElement which is incorrect. Solution: Use a proper polymorphic component pattern with generic ref types.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-26T21:46:37.155804-06:00","updated_at":"2025-11-26T22:00:14.955969-06:00","closed_at":"2025-11-26T22:00:14.955969-06:00"}
{"id":"linked-53","title":"Use design system ThemeProvider instead of duplicate useTheme hook","description":"There are two implementations of theme management: ThemeProvider in the design-system package and useTheme hook in the renderer app. The app version has app-specific logic (loading from config) but duplicates theme class management. Solution: Extend the design system's ThemeProvider to be configurable and remove the duplicate hook from the app.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T21:46:39.326055-06:00","updated_at":"2025-11-26T22:13:50.966524-06:00","closed_at":"2025-11-26T22:13:50.966524-06:00"}
{"id":"linked-54","title":"Export ButtonProps type from design system","description":"The Button component has a well-defined ButtonProps interface but it's not exported from the index, making it difficult for consumers to type callbacks or extend the component. Solution: Export all component prop types (ButtonProps, TextProps, SurfaceProps, etc.) for better DX.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T21:46:40.619238-06:00","updated_at":"2025-11-26T22:17:59.77624-06:00","closed_at":"2025-11-26T22:17:59.77624-06:00"}
{"id":"linked-55","title":"Text component uses any cast for ref - fix polymorphic typing","description":"The Text component has 'ref={ref as any}' with an eslint-disable comment, indicating the polymorphic pattern isn't properly typed. This should be fixed using the same solution as the Surface component polymorphic ref typing issue.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T21:46:45.30672-06:00","updated_at":"2025-11-26T22:16:01.015803-06:00","closed_at":"2025-11-26T22:16:01.015803-06:00"}
{"id":"linked-56","title":"Document missing spacing token 5 in design system","description":"The spacing scale jumps from 4 (1rem) to 6 (1.5rem), missing 5. This appears intentional (Tailwind uses this scale) but should be documented in the design tokens documentation to avoid confusion.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-11-26T21:46:46.927349-06:00","updated_at":"2025-11-26T22:23:50.216336-06:00","closed_at":"2025-11-26T22:23:50.216336-06:00"}
{"id":"linked-57","title":"Clarify zIndex token naming - overlay vs palette confusion","description":"The zIndex scale has potential for confusion: overlay (10), modal (100), palette (200). The BackButton uses overlay (10), but the command palette uses palette (200). The naming could be clearer - 'overlay' sounds like it should be the highest. Consider renaming or documenting the intended use cases.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-11-26T21:46:48.838514-06:00","updated_at":"2025-11-26T22:23:49.879328-06:00","closed_at":"2025-11-26T22:23:49.879328-06:00"}
{"id":"linked-58","title":"Replace hardcoded #ffffff in Button solidDanger style with token","description":"In Button.css.ts, solidDanger uses 'color: #ffffff' instead of a design token. Should use a semantic token like vars.color.dangerForeground or vars.color.onDanger for consistency and theming support.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T21:46:50.788021-06:00","updated_at":"2025-11-26T22:15:12.161567-06:00","closed_at":"2025-11-26T22:15:12.161567-06:00"}
{"id":"linked-59","title":"Add SSR safety check to Portal component","description":"Portal.tsx checks for document existence but createPortal should also have full SSR protection. Add 'if (typeof window === undefined) return null;' at the start of the component for complete SSR safety.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T21:46:52.454119-06:00","updated_at":"2025-11-26T22:14:10.333867-06:00","closed_at":"2025-11-26T22:14:10.333867-06:00"}
{"id":"linked-6","title":"Implement notes:searchTitles IPC handler","description":"Add IPC handler to search note titles for autocomplete suggestions.\n\n## Details\n- Files: \n  - apps/desktop/electron/main/src/main.ts (handler)\n  - apps/desktop/electron/preload/src/preload.ts (API)\n\n## IPC Channel: notes:searchTitles\n\n### Input\n```typescript\nquery: string, limit?: number\n```\n\n### Output  \n```typescript\nSearchResult[]\n```\n\n### Behavior\n- Search metadata.title field only (not content)\n- Fuzzy matching using existing search infrastructure\n- Return max 10 results by default\n- Results sorted by relevance score\n- Exclude notes with null/empty titles\n\n## Implementation (using simple substring match for MVP)\n```typescript\n// Add to main.ts after notes:findByTitle handler\nipcMain.handle('notes:searchTitles', async (_event, query: string, limit = 10) =\u003e {\n  if (!vault) {\n    throw new Error('Vault not initialized');\n  }\n  \n  // Empty query returns empty results\n  if (!query.trim()) {\n    return [];\n  }\n  \n  const notes = vault.list();\n  const lowerQuery = query.toLowerCase();\n  \n  const matches = notes\n    .filter(n =\u003e n.metadata.title) // Has title\n    .filter(n =\u003e n.metadata.title!.toLowerCase().includes(lowerQuery))\n    .slice(0, limit)\n    .map(n =\u003e ({\n      id: n.id,\n      title: n.metadata.title!,\n      snippet: '',\n      score: 1,\n      matches: []\n    }));\n  \n  return matches;\n});\n```\n\n## Preload API\n```typescript\nnotes: {\n  // ... existing methods\n  searchTitles: (query: string, limit?: number): Promise\u003cSearchResult[]\u003e =\u003e\n    ipcRenderer.invoke('notes:searchTitles', query, limit ?? 10),\n}\n```\n\n## Important Notes\n- Uses `vault.list()` (synchronous) - see existing handlers in main.ts\n- SearchResult type from @scribe/shared\n- Empty query should return empty array (not all notes)\n- Consider adding score calculation based on match position later\n\n## Future Enhancement\nFor better fuzzy matching, could integrate with SearchEngine:\n```typescript\n// Optional: Use existing search engine with title-only filter\nconst results = searchEngine.search(query, { field: 'title', limit });\n```\n\n## Tests\n- Search returns matching titles\n- Empty query returns empty array\n- Limit parameter respected\n- Results include note ID and title\n- Partial matches work (substring)\n\n## Acceptance Criteria\n- [ ] IPC handler implemented in main.ts\n- [ ] Preload API exposed with correct types\n- [ ] Substring matching works\n- [ ] Results limited to specified count\n- [ ] Empty titles excluded from results\n- [ ] Empty query returns empty array","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:40:52.953425-06:00","updated_at":"2025-11-26T15:03:33.952279-06:00","closed_at":"2025-11-26T15:03:33.952279-06:00","dependencies":[{"issue_id":"linked-6","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-60","title":"People Feature - @mentions and Person entities","description":"Implement People feature allowing users to create Person entities and tag them in notes using @name syntax.\n\n## Overview\nPeople function like normal notes, but their title is the person's name and they can be referenced via @ mentions. This includes:\n- Creating Person entities (explicit via command palette or inline via autocomplete)\n- @ mentions to tag people within notes\n- Navigation from mentions to Person pages\n- Graph engine integration for relationship tracking\n\n## GitHub Issue\n#17\n\n## Phases\n1. Core Types \u0026 Storage - Extend shared types, storage layer, metadata extraction\n2. Graph Engine - Add mention tracking indexes\n3. Editor Components - PersonMentionNode, plugin, autocomplete UI\n4. IPC \u0026 Commands - People API, command palette integration\n5. Integration \u0026 Polish - Wire everything together, styling, type declarations\n\n## Files to Create\n- renderer/src/components/Editor/plugins/PersonMentionNode.ts\n- renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx\n- renderer/src/components/Editor/plugins/PersonMentionAutocomplete.tsx\n- renderer/src/components/Editor/plugins/PersonMentionAutocomplete.css.ts\n- renderer/src/components/Editor/plugins/PersonMentionContext.tsx\n- renderer/src/commands/people.ts\n\n## Files to Modify\n- packages/shared/src/types.ts\n- packages/engine-core/src/metadata.ts\n- packages/engine-graph/src/graph-engine.ts\n- packages/storage-fs/src/vault.ts\n- apps/desktop/electron/preload/src/preload.ts\n- apps/desktop/electron/main/src/main.ts\n- apps/desktop/renderer/src/components/Editor/EditorRoot.tsx\n- apps/desktop/renderer/src/types/scribe.d.ts\n- apps/desktop/renderer/src/commands/types.ts\n- apps/desktop/renderer/src/commands/paletteState.ts\n- apps/desktop/renderer/src/commands/registry.ts","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-27T09:52:24.954352-06:00","updated_at":"2025-11-27T10:52:19.477025-06:00","closed_at":"2025-11-27T10:52:19.477025-06:00"}
{"id":"linked-61","title":"Phase 1.1: Extend shared types with NoteType, mentions field","description":"Add type discriminator and mentions field to shared types.\n\n## File\npackages/shared/src/types.ts\n\n## Changes Required\n\n### Add NoteType\n```typescript\n/** Note type discriminator */\nexport type NoteType = 'person';  // Extensible for future types\n```\n\n### Update LexicalState (IMPORTANT)\nThe LexicalState interface must be extended to support the type field:\n```typescript\nexport interface LexicalState {\n  root: {\n    type: 'root';\n    children: Array\u003cLexicalNode\u003e;\n    format?: string | number;\n    indent?: number;\n    version?: number;\n  };\n  type?: NoteType;  // NEW: Note type discriminator stored with content\n}\n```\n\n### Update NoteMetadata\n```typescript\nexport interface NoteMetadata {\n  title: string | null;\n  tags: string[];\n  links: NoteId[];\n  mentions: NoteId[];      // NEW: People mentioned in this note\n  type?: NoteType;         // NEW: undefined = regular note, 'person' = person note\n}\n```\n\n### Update GraphNode\n```typescript\nexport interface GraphNode {\n  id: NoteId;\n  title: string | null;\n  tags: string[];\n  type?: NoteType;         // NEW: For filtering people in graph\n}\n```\n\n## Migration Note\nExisting notes have no `type` field. The system treats `undefined` as a regular note. No migration required.\n\n## Acceptance Criteria\n- [ ] NoteType type exported\n- [ ] LexicalState has type?: NoteType field\n- [ ] NoteMetadata has mentions: NoteId[] field\n- [ ] NoteMetadata has type?: NoteType field\n- [ ] GraphNode has type?: NoteType field\n- [ ] TypeScript compiles without errors\n- [ ] Existing tests still pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:52:35.661219-06:00","updated_at":"2025-11-27T10:29:50.99178-06:00","closed_at":"2025-11-27T10:29:50.99178-06:00","dependencies":[{"issue_id":"linked-61","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-62","title":"Phase 1.2: Update storage layer to support type option in create()","description":"Extend vault.create() to accept options for creating person notes.\n\n## File\npackages/storage-fs/src/storage.ts\n\n## Current Signature\n```typescript\nasync create(content?: LexicalState): Promise\u003cNote\u003e\n```\n\n## Updated Signature\n```typescript\ninterface CreateNoteOptions {\n  content?: LexicalState;  // Initial content (optional)\n  type?: NoteType;         // Note type discriminator (optional)\n}\n\nasync create(options?: CreateNoteOptions): Promise\u003cNote\u003e\n```\n\n## Implementation\n```typescript\nasync create(options?: CreateNoteOptions): Promise\u003cNote\u003e {\n  const now = Date.now();\n  \n  // Build content with optional type\n  const noteContent: LexicalState = options?.content ?? this.createEmptyContent();\n  \n  // Set type on the content if provided\n  if (options?.type) {\n    (noteContent as LexicalState \u0026 { type?: NoteType }).type = options.type;\n  }\n  \n  const note: Note = {\n    id: randomUUID(),\n    createdAt: now,\n    updatedAt: now,\n    content: noteContent,\n    metadata: extractMetadata(noteContent),\n  };\n  \n  await this.save(note);\n  return this.notes.get(note.id)!;\n}\n```\n\n## Backward Compatibility\nThe method signature change from `create(content?: LexicalState)` to `create(options?: CreateNoteOptions)` requires updating existing callers:\n- Old: `vault.create()` -\u003e Still works (undefined options)\n- Old: `vault.create(content)` -\u003e Must change to `vault.create({ content })`\n\n**Check existing usages in:**\n- apps/desktop/electron/main/src/main.ts (notes:create handler)\n- Any tests that call create()\n\n## Note\nThe type field is stored as part of the Lexical JSON content, ensuring it persists with the note and is available during metadata extraction.\n\n## Acceptance Criteria\n- [ ] CreateNoteOptions interface defined\n- [ ] create() accepts optional CreateNoteOptions parameter\n- [ ] type field is set on content when provided\n- [ ] Update all existing callers to new signature\n- [ ] Backward compatible for create() with no args\n- [ ] Unit tests for creating notes with type='person'\n- [ ] Unit tests for creating notes without type","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:52:43.418458-06:00","updated_at":"2025-11-27T10:39:18.354013-06:00","closed_at":"2025-11-27T10:39:18.354013-06:00","dependencies":[{"issue_id":"linked-62","depends_on_id":"linked-61","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-62","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-63","title":"Phase 1.3: Update metadata extraction for mentions and type","description":"Add extractMentions() function and extract type field from Lexical content.\n\n## File\npackages/engine-core/src/metadata.ts\n\n## Changes Required\n\n### Add extractMentions function\n```typescript\nfunction extractMentions(content: LexicalState): NoteId[] {\n  const mentions = new Set\u003cNoteId\u003e();\n  \n  traverseNodes(content, (node) =\u003e {\n    if (node.type === 'person-mention' \u0026\u0026 typeof node.personId === 'string') {\n      mentions.add(node.personId);\n    }\n  });\n  \n  return Array.from(mentions);\n}\n```\n\n### Update extractMetadata\n```typescript\nexport function extractMetadata(content: LexicalState): NoteMetadata {\n  const title = extractTitle(content);\n  const tags = extractTags(content);\n  const links = extractLinks(content);\n  const mentions = extractMentions(content);  // NEW\n  const type = content.type;                   // NEW: Read from content root\n\n  return { title, tags, links, mentions, type };\n}\n```\n\n## Test Cases (metadata.test.ts)\n| Test Case | Description |\n|-----------|-------------|\n| Extract mentions | Finds all person-mention nodes |\n| No duplicates | Same person mentioned twice → one entry |\n| Person type | Notes with type='person' correctly identified |\n| Empty mentions | Note with no mentions returns empty array |\n| Type undefined | Regular notes have undefined type |\n\n## Acceptance Criteria\n- [ ] extractMentions() function implemented\n- [ ] extractMetadata returns mentions array\n- [ ] extractMetadata returns type field (or undefined)\n- [ ] Deduplication of person IDs\n- [ ] All unit tests pass\n- [ ] Handles edge case: malformed person-mention nodes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:52:50.849902-06:00","updated_at":"2025-11-27T10:39:18.366538-06:00","closed_at":"2025-11-27T10:39:18.366538-06:00","dependencies":[{"issue_id":"linked-63","depends_on_id":"linked-61","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-63","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-64","title":"Phase 2: Graph engine mention tracking indexes","description":"Add person mention tracking indexes to graph engine.\n\n## File\npackages/engine-graph/src/graph-engine.ts\n\n## New Private Fields\n```typescript\nprivate mentioning: Map\u003cNoteId, Set\u003cNoteId\u003e\u003e = new Map();   // note → people mentioned in it\nprivate mentionedBy: Map\u003cNoteId, Set\u003cNoteId\u003e\u003e = new Map();  // person → notes mentioning them\n```\n\n## Methods to Add/Update\n\n### addNote() - Track person mentions\n```typescript\naddNote(note: Note): void {\n  // Existing logic for links, tags...\n  \n  // Track person mentions\n  for (const personId of note.metadata.mentions ?? []) {\n    this.addPersonMention(note.id, personId);\n  }\n}\n```\n\n### removeNote() - Clean up mentions\n```typescript\nremoveNote(noteId: NoteId): void {\n  // Existing cleanup for links, tags...\n  \n  // Clean up person mention indexes\n  const mentionedPeople = this.mentioning.get(noteId);\n  if (mentionedPeople) {\n    for (const personId of mentionedPeople) {\n      this.mentionedBy.get(personId)?.delete(noteId);\n    }\n    this.mentioning.delete(noteId);\n  }\n  \n  // If this note IS a person, clean up all mentions of them\n  this.mentionedBy.delete(noteId);\n  for (const [_, people] of this.mentioning) {\n    people.delete(noteId);\n  }\n}\n```\n\n### New private method\n```typescript\nprivate addPersonMention(noteId: NoteId, personId: NoteId): void {\n  if (!this.mentioning.has(noteId)) {\n    this.mentioning.set(noteId, new Set());\n  }\n  this.mentioning.get(noteId)!.add(personId);\n  \n  if (!this.mentionedBy.has(personId)) {\n    this.mentionedBy.set(personId, new Set());\n  }\n  this.mentionedBy.get(personId)!.add(noteId);\n}\n```\n\n### New public query methods\n```typescript\nnotesMentioning(personId: NoteId): NoteId[] {\n  return Array.from(this.mentionedBy.get(personId) ?? []);\n}\n\npeopleMentionedIn(noteId: NoteId): NoteId[] {\n  return Array.from(this.mentioning.get(noteId) ?? []);\n}\n\ngetAllPeople(): NoteId[] {\n  return Array.from(this.nodes.values())\n    .filter(node =\u003e node.type === 'person')\n    .map(node =\u003e node.id);\n}\n```\n\n## Test Cases (graph-engine.test.ts)\n| Test Case | Description |\n|-----------|-------------|\n| Track mentions | Adding note updates mentioning/mentionedBy indexes |\n| Remove note cleans mentions | Removing note clears mention relationships |\n| Remove person cleans references | Removing a person clears all mention-of references |\n| getAllPeople | Returns only notes with type='person' |\n| notesMentioning | Returns correct notes for a person |\n| peopleMentionedIn | Returns correct people for a note |\n\n## Acceptance Criteria\n- [ ] mentioning index properly maintained\n- [ ] mentionedBy index properly maintained\n- [ ] removeNote cleans up both indexes\n- [ ] notesMentioning() works correctly\n- [ ] peopleMentionedIn() works correctly\n- [ ] getAllPeople() filters by type='person'\n- [ ] All existing tests still pass\n- [ ] New tests for mention tracking","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:53:13.986544-06:00","updated_at":"2025-11-27T10:44:16.066833-06:00","closed_at":"2025-11-27T10:44:16.066833-06:00","dependencies":[{"issue_id":"linked-64","depends_on_id":"linked-63","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-64","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-65","title":"Phase 3.1: PersonMentionNode - Lexical custom node","description":"Create custom Lexical DecoratorNode for person mentions.\n\n## Files\n- renderer/src/components/Editor/plugins/PersonMentionNode.ts\n- renderer/src/components/Editor/plugins/PersonMentionNode.test.ts\n\n## PersonMentionNode Implementation\n```typescript\nimport { DecoratorNode, type LexicalNode, type NodeKey } from 'lexical';\nimport type { NoteId } from '@scribe/shared';\n\nexport interface SerializedPersonMentionNode {\n  type: 'person-mention';\n  personName: string;\n  personId: string;\n  version: 1;\n}\n\nexport class PersonMentionNode extends DecoratorNode\u003cJSX.Element\u003e {\n  __personName: string;\n  __personId: NoteId;\n\n  static getType(): string {\n    return 'person-mention';\n  }\n\n  static clone(node: PersonMentionNode): PersonMentionNode {\n    return new PersonMentionNode(node.__personName, node.__personId, node.__key);\n  }\n\n  constructor(personName: string, personId: NoteId, key?: NodeKey) {\n    super(key);\n    this.__personName = personName;\n    this.__personId = personId;\n  }\n\n  createDOM(): HTMLElement {\n    const span = document.createElement('span');\n    span.className = 'person-mention';\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      \u003cPersonMentionComponent\n        personName={this.__personName}\n        personId={this.__personId}\n      /\u003e\n    );\n  }\n\n  exportJSON(): SerializedPersonMentionNode {\n    return {\n      type: 'person-mention',\n      personName: this.__personName,\n      personId: this.__personId,\n      version: 1,\n    };\n  }\n\n  static importJSON(json: SerializedPersonMentionNode): PersonMentionNode {\n    return $createPersonMentionNode(json.personName, json.personId);\n  }\n\n  getTextContent(): string {\n    return `@${this.__personName}`;\n  }\n\n  isInline(): boolean {\n    return true;\n  }\n}\n\n// Factory function\nexport function $createPersonMentionNode(\n  personName: string,\n  personId: NoteId\n): PersonMentionNode {\n  return new PersonMentionNode(personName, personId);\n}\n\n// Type guard\nexport function $isPersonMentionNode(\n  node: LexicalNode | null | undefined\n): node is PersonMentionNode {\n  return node instanceof PersonMentionNode;\n}\n```\n\n## PersonMentionComponent (inline in same file or separate)\n```typescript\ninterface PersonMentionComponentProps {\n  personName: string;\n  personId: NoteId;\n}\n\nfunction PersonMentionComponent({ personName, personId }: PersonMentionComponentProps) {\n  const { onNavigate, onError } = usePersonMention();\n  \n  const handleClick = useCallback((e: React.MouseEvent) =\u003e {\n    e.preventDefault();\n    e.stopPropagation();\n    onNavigate(personId);\n  }, [personId, onNavigate]);\n  \n  return (\n    \u003cspan onClick={handleClick} role=\"link\" tabIndex={0}\u003e\n      @{personName}\n    \u003c/span\u003e\n  );\n}\n```\n\n## Serialization Format\n```json\n{\n  \"type\": \"person-mention\",\n  \"personName\": \"John Smith\",\n  \"personId\": \"abc123-uuid\",\n  \"version\": 1\n}\n```\n\n## Required Exports\n- PersonMentionNode class\n- $createPersonMentionNode factory\n- $isPersonMentionNode type guard\n- SerializedPersonMentionNode interface\n\n## Test Cases (PersonMentionNode.test.ts)\n| Test Case | Description |\n|-----------|-------------|\n| Node creation | Create node with personName, personId |\n| Static clone | Clone preserves all properties |\n| Serialization | Export/import JSON round-trip |\n| DOM creation | Creates span with person-mention class |\n| Text content | Returns `@{personName}` |\n| isInline | Returns true (inline node) |\n| Type guard | $isPersonMentionNode works correctly |\n\n## Acceptance Criteria\n- [ ] PersonMentionNode extends DecoratorNode\n- [ ] Node stores personName and personId\n- [ ] static clone() method implemented\n- [ ] JSON serialization/deserialization works (exportJSON/importJSON)\n- [ ] getTextContent returns @-prefixed name\n- [ ] isInline returns true\n- [ ] Factory function $createPersonMentionNode\n- [ ] Type guard $isPersonMentionNode\n- [ ] PersonMentionComponent handles click navigation\n- [ ] All unit tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:53:26.999813-06:00","updated_at":"2025-11-27T10:39:18.377294-06:00","closed_at":"2025-11-27T10:39:18.377294-06:00","dependencies":[{"issue_id":"linked-65","depends_on_id":"linked-61","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-65","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-66","title":"Phase 3.2: PersonMentionContext - Navigation context provider","description":"Create React context for person mention click handling and navigation.\n\n## Files\n- renderer/src/components/Editor/plugins/PersonMentionContext.tsx\n\n## Context Interface\n```typescript\ninterface PersonMentionContextValue {\n  onNavigate: (personId: NoteId) =\u003e void;\n  onError: (message: string) =\u003e void;\n}\n```\n\n## Provider Component\n```typescript\ninterface PersonMentionProviderProps {\n  onNavigate: (noteId: NoteId) =\u003e void;\n  onError: (message: string) =\u003e void;\n  children: React.ReactNode;\n}\n\nexport function PersonMentionProvider({\n  onNavigate,\n  onError,\n  children,\n}: PersonMentionProviderProps) {\n  const value = useMemo(\n    () =\u003e ({ onNavigate, onError }),\n    [onNavigate, onError]\n  );\n  \n  return (\n    \u003cPersonMentionContext.Provider value={value}\u003e\n      {children}\n    \u003c/PersonMentionContext.Provider\u003e\n  );\n}\n```\n\n## Hook\n```typescript\nexport function usePersonMention() {\n  const context = useContext(PersonMentionContext);\n  if (!context) {\n    throw new Error('usePersonMention must be used within PersonMentionProvider');\n  }\n  return context;\n}\n```\n\n## Usage in EditorRoot.tsx\n```typescript\n\u003cPersonMentionProvider onNavigate={handleNavigateToNote} onError={handleError}\u003e\n  \u003cLexicalComposer\u003e\n    {/* ... */}\n  \u003c/LexicalComposer\u003e\n\u003c/PersonMentionProvider\u003e\n```\n\n## Acceptance Criteria\n- [ ] PersonMentionContext created\n- [ ] PersonMentionProvider component\n- [ ] usePersonMention hook with proper error\n- [ ] Context provides onNavigate and onError callbacks\n- [ ] Memoized context value to prevent re-renders","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:53:33.405521-06:00","updated_at":"2025-11-27T10:39:18.38846-06:00","closed_at":"2025-11-27T10:39:18.38846-06:00","dependencies":[{"issue_id":"linked-66","depends_on_id":"linked-61","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-66","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-67","title":"Phase 3.3: PersonMentionAutocomplete - UI component","description":"Create autocomplete popup UI for person selection.\n\n## Files\n- renderer/src/components/Editor/plugins/PersonMentionAutocomplete.tsx\n- renderer/src/components/Editor/plugins/PersonMentionAutocomplete.css.ts\n\n## Component Props\n```typescript\ninterface PersonMentionAutocompleteProps {\n  query: string;\n  position: { top: number; left: number };\n  selectedIndex: number;\n  onSelect: (person: PersonResult) =\u003e void;\n  onCreate: (name: string) =\u003e void;\n  onClose: () =\u003e void;\n  onNavigate: (direction: 'up' | 'down') =\u003e void;\n  currentNoteId: NoteId | null;\n}\n\ninterface PersonResult {\n  id: NoteId;\n  name: string;\n}\n```\n\n## UI Layout\n```\nMeeting with @joh\n               +------------------------------+\n               | John Smith                   |\n               | John Doe                     |\n               | Johnny Appleseed             |\n               |------------------------------|\n               | + Create \"joh\"               |\n               +------------------------------+\n```\n\n## Specifications\n| Element | Value |\n|---------|-------|\n| Position | Below cursor, aligned with @ |\n| Width | 280px (fixed) |\n| Max height | 300px (scrollable) |\n| Item height | ~40px |\n| Selected state | Highlighted background |\n| Empty state | \"No matching people\" |\n| Create option | Shown at bottom when query exists |\n\n## Autocomplete Behavior\n| Event | Behavior |\n|-------|----------|\n| Type @ | Opens autocomplete popup |\n| Type characters | Filters results by fuzzy match |\n| Press Escape | Cancels autocomplete |\n| Press Tab | Selects highlighted item |\n| Press Enter | Selects highlighted item |\n| Click item | Selects that item |\n| ArrowUp/Down | Navigate list |\n| Click outside | Cancels autocomplete |\n\n## Search Rules\n- Search field: metadata.title on notes where metadata.type === 'person'\n- Matching: Fuzzy via search engine\n- Current person: Excluded from suggestions (if editing a person note)\n- Max results: 10\n- Create option: Shown when query has text and no exact match\n\n## vanilla-extract Styles\n```typescript\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const autocompleteContainer = style({\n  position: 'absolute',\n  width: '280px',\n  maxHeight: '300px',\n  overflow: 'auto',\n  backgroundColor: vars.color.surface,\n  border: `1px solid ${vars.color.border}`,\n  borderRadius: vars.radius.md,\n  boxShadow: vars.shadow.lg,\n  zIndex: vars.zIndex.popover,  // Use popover, not dropdown\n});\n\nexport const autocompleteItem = style({\n  padding: `${vars.spacing['2']} ${vars.spacing['3']}`,\n  cursor: 'pointer',\n  ':hover': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\nexport const autocompleteItemSelected = style({\n  backgroundColor: vars.color.backgroundAlt,\n});\n\nexport const createOption = style({\n  borderTop: `1px solid ${vars.color.border}`,\n  color: vars.color.accent,\n});\n\nexport const emptyState = style({\n  padding: vars.spacing['3'],\n  color: vars.color.foregroundMuted,\n  textAlign: 'center',\n});\n```\n\n## Data Fetching\nThe component should call `window.scribe.people.search(query)` to get filtered results. Consider debouncing the search if needed.\n\n## Acceptance Criteria\n- [ ] Component renders at correct position\n- [ ] Shows filtered list of people from people.search()\n- [ ] Excludes current person if editing person note\n- [ ] Keyboard navigation (up/down) via onNavigate callback\n- [ ] Selection via Tab/Enter triggers onSelect\n- [ ] Click selection works\n- [ ] Create option shown when no exact match, triggers onCreate\n- [ ] Empty state shown when no results\n- [ ] Uses design system tokens for styling\n- [ ] Proper accessibility attributes (role=\"listbox\", aria-selected)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:53:48.831821-06:00","updated_at":"2025-11-27T10:39:18.399398-06:00","closed_at":"2025-11-27T10:39:18.399398-06:00","dependencies":[{"issue_id":"linked-67","depends_on_id":"linked-61","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-67","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-68","title":"Phase 3.4: PersonMentionPlugin - Core @ trigger plugin","description":"Create main Lexical plugin for @ trigger detection and autocomplete state management.\n\n## Files\n- renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx\n- renderer/src/components/Editor/plugins/PersonMentionPlugin.test.tsx\n\n## Plugin Props\n```typescript\ninterface PersonMentionPluginProps {\n  currentNoteId: NoteId | null;  // For excluding self from autocomplete\n}\n```\n\n## Plugin Responsibilities\n1. Detect @ character typed\n2. Track query text after @\n3. Manage autocomplete popup visibility\n4. Handle selection → insert PersonMentionNode\n5. Handle Escape → cancel and remove @\n6. Handle create → call people API, then insert node\n\n## State Management\n```typescript\nconst [isOpen, setIsOpen] = useState(false);\nconst [query, setQuery] = useState('');\nconst [position, setPosition] = useState({ top: 0, left: 0 });\nconst [selectedIndex, setSelectedIndex] = useState(0);\n```\n\n## Key Event Handlers\n```typescript\n// On @ typed\n- setIsOpen(true)\n- Calculate cursor position\n- Start tracking query\n\n// On text after @\n- Update query state\n- Reset selectedIndex to 0\n\n// On selection (Tab/Enter/Click)\n- Insert PersonMentionNode with selected person\n- Close autocomplete\n- Remove @ and query text from editor\n\n// On Escape\n- Close autocomplete\n- Remove @ and query text from editor\n\n// On click outside\n- Close autocomplete\n// (leave @ and query in document as plain text)\n```\n\n## Node Insertion Logic\n```typescript\nconst handleSelect = (person: PersonResult) =\u003e {\n  editor.update(() =\u003e {\n    // Remove @ and query text\n    // Insert PersonMentionNode at position\n    const node = $createPersonMentionNode(person.name, person.id);\n    // Insert node\n    // Move cursor after node\n  });\n  setIsOpen(false);\n};\n```\n\n## Test Cases (PersonMentionPlugin.test.tsx)\n| Test Case | Action | Expected |\n|-----------|--------|----------|\n| Opens on @ | Type @ | Popup appears |\n| Filters results | Type @john | Shows matching people |\n| Keyboard navigation | Press ArrowDown | Next item highlighted |\n| Tab selection | Press Tab | Inserts selected mention |\n| Escape closes | Press Escape | Popup closes, @ removed |\n| Click selection | Click item | Inserts mention |\n| Empty results | Type nonsense | \"No matching people\" |\n| Create option | Type new name | \"Create person\" appears |\n| Self exclusion | Edit person note | Current person not in autocomplete |\n| Click navigates | Click inserted mention | Navigates to person's page |\n| Deleted person | Click mention to deleted | Shows error toast |\n\n## Acceptance Criteria\n- [ ] @ triggers autocomplete popup\n- [ ] Query updates as user types\n- [ ] PersonMentionNode inserted on selection\n- [ ] Escape cancels and removes @ from document\n- [ ] Create option calls people API then inserts node\n- [ ] currentNoteId used to exclude self\n- [ ] Proper cleanup on unmount\n- [ ] All test cases pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:54:04.672519-06:00","updated_at":"2025-11-27T10:44:16.083005-06:00","closed_at":"2025-11-27T10:44:16.083005-06:00","dependencies":[{"issue_id":"linked-68","depends_on_id":"linked-65","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-68","depends_on_id":"linked-66","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-68","depends_on_id":"linked-67","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-68","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-69","title":"Phase 4.1: People IPC handlers in main process","description":"Add IPC handlers for people:list, people:create, and people:search in the main process.\n\n## File\napps/desktop/electron/main/src/main.ts\n\n## IPC Channels\n| Channel | Purpose | Input | Output |\n|---------|---------|-------|--------|\n| people:list | List all people | - | Note[] |\n| people:create | Create a new person | name: string | Note |\n| people:search | Search people by name | query: string, limit: number | SearchResult[] |\n\n## Implementation\n\n### people:list handler\n```typescript\nipcMain.handle('people:list', async () =\u003e {\n  if (!vault) {\n    throw new ScribeError('No vault open', 'NO_VAULT_OPEN');\n  }\n  try {\n    const notes = vault.list();\n    return notes.filter(n =\u003e n.metadata.type === 'person');\n  } catch (error) {\n    throw new ScribeError('Failed to list people', 'PEOPLE_LIST_FAILED', error);\n  }\n});\n```\n\n### people:create handler\n```typescript\nipcMain.handle('people:create', async (_, name: string) =\u003e {\n  if (!vault) {\n    throw new ScribeError('No vault open', 'NO_VAULT_OPEN');\n  }\n  if (!name || name.trim().length === 0) {\n    throw new ScribeError('Person name is required', 'INVALID_PERSON_NAME');\n  }\n  try {\n    const content = createPersonContent(name.trim());\n    // Note: vault.create() signature updated in linked-62\n    return await vault.create({ content, type: 'person' });\n  } catch (error) {\n    throw new ScribeError('Failed to create person', 'PEOPLE_CREATE_FAILED', error);\n  }\n});\n```\n\n### people:search handler\n```typescript\nipcMain.handle('people:search', async (_, query: string, limit: number = 10) =\u003e {\n  if (!vault) {\n    throw new ScribeError('No vault open', 'NO_VAULT_OPEN');\n  }\n  try {\n    const notes = vault.list();\n    const people = notes.filter(n =\u003e n.metadata.type === 'person');\n    \n    // Simple case-insensitive fuzzy match\n    const queryLower = query.toLowerCase();\n    const filtered = people.filter(n =\u003e {\n      const title = n.metadata.title?.toLowerCase() ?? '';\n      return title.includes(queryLower);\n    });\n    \n    return filtered.slice(0, limit).map(n =\u003e ({\n      id: n.id,\n      title: n.metadata.title,\n      snippet: '',\n      score: 1,\n      matches: [],\n    }));\n  } catch (error) {\n    throw new ScribeError('Failed to search people', 'PEOPLE_SEARCH_FAILED', error);\n  }\n});\n```\n\n### createPersonContent helper\n```typescript\nfunction createPersonContent(name: string): LexicalState {\n  return {\n    root: {\n      children: [\n        {\n          type: 'heading',\n          tag: 'h1',\n          children: [{ type: 'text', text: name }],\n          direction: null,\n          format: '',\n          indent: 0,\n          version: 1,\n        },\n        {\n          type: 'paragraph',\n          children: [],\n          direction: null,\n          format: '',\n          indent: 0,\n          version: 1,\n        },\n      ],\n      type: 'root',\n      direction: null,\n      format: '',\n      indent: 0,\n      version: 1,\n    },\n    type: 'person',  // This marks it as a person note\n  };\n}\n```\n\n## Error Codes to Add\nAdd these to packages/shared/src/errors.ts if not present:\n- NO_VAULT_OPEN: No vault is currently open\n- INVALID_PERSON_NAME: Empty or whitespace-only name provided  \n- PEOPLE_LIST_FAILED: Failed to retrieve people list\n- PEOPLE_CREATE_FAILED: Failed to create person\n- PEOPLE_SEARCH_FAILED: Failed to search people\n\n## Dependencies\nThis task depends on linked-62 (vault.create signature change) being completed first.\n\n## Acceptance Criteria\n- [ ] people:list returns all notes with type='person'\n- [ ] people:create creates person with H1 title and type='person'\n- [ ] people:create validates name is not empty/whitespace\n- [ ] people:search filters people by case-insensitive substring match\n- [ ] people:search respects limit parameter (default 10)\n- [ ] Proper error handling with ScribeError\n- [ ] Returns empty array if no people exist\n- [ ] createPersonContent helper produces valid Lexical JSON","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:55:38.346398-06:00","updated_at":"2025-11-27T10:44:16.09399-06:00","closed_at":"2025-11-27T10:44:16.09399-06:00","dependencies":[{"issue_id":"linked-69","depends_on_id":"linked-62","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-69","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-7","title":"Implement WikiLinkPlugin - bracket detection and node insertion","description":"Create the core WikiLinkPlugin that detects [[ typing and manages wiki-link creation.\n\n## Details\n- File: renderer/src/components/Editor/plugins/WikiLinkPlugin.tsx\n\n## Responsibilities\n1. Detect when user types `[[` \n2. Track the position where autocomplete should appear\n3. Insert WikiLinkNode when link is finalized\n4. Handle manual link closure with `]]`\n\n## Implementation\n\n### Plugin Structure\n```typescript\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { useEffect, useCallback, useState } from 'react';\nimport { \n  $getSelection, \n  $isRangeSelection,\n  $getNodeByKey,\n  TextNode,\n  COMMAND_PRIORITY_LOW,\n  KEY_ESCAPE_COMMAND,\n} from 'lexical';\nimport { $createWikiLinkNode } from './WikiLinkNode';\n\ninterface WikiLinkPluginProps {\n  onTrigger: (query: string, position: { top: number; left: number }) =\u003e void;\n  onQueryChange: (query: string) =\u003e void;\n  onClose: () =\u003e void;\n  currentNoteId: string | null;\n}\n\ninterface TriggerState {\n  isActive: boolean;\n  startOffset: number;\n  anchorKey: string;\n  query: string;\n}\n\nexport function WikiLinkPlugin({ \n  onTrigger, \n  onQueryChange,\n  onClose, \n  currentNoteId \n}: WikiLinkPluginProps) {\n  const [editor] = useLexicalComposerContext();\n  const [triggerState, setTriggerState] = useState\u003cTriggerState | null\u003e(null);\n\n  // ... implementation\n  return null;\n}\n```\n\n### Key Detection Logic\nUse editor.registerUpdateListener to monitor text changes:\n```typescript\nuseEffect(() =\u003e {\n  return editor.registerUpdateListener(({ editorState }) =\u003e {\n    editorState.read(() =\u003e {\n      const selection = $getSelection();\n      if (!$isRangeSelection(selection)) return;\n      \n      const anchor = selection.anchor;\n      const anchorNode = anchor.getNode();\n      \n      if (!(anchorNode instanceof TextNode)) return;\n      \n      const text = anchorNode.getTextContent();\n      const offset = anchor.offset;\n      \n      // Check for [[ pattern\n      if (text.slice(offset - 2, offset) === '[[') {\n        // Start tracking\n        const domNode = editor.getElementByKey(anchorNode.getKey());\n        if (domNode) {\n          const rect = domNode.getBoundingClientRect();\n          onTrigger('', { top: rect.bottom, left: rect.left });\n          setTriggerState({\n            isActive: true,\n            startOffset: offset - 2,\n            anchorKey: anchorNode.getKey(),\n            query: ''\n          });\n        }\n      }\n      \n      // If tracking, update query\n      if (triggerState?.isActive \u0026\u0026 anchorNode.getKey() === triggerState.anchorKey) {\n        const query = text.slice(triggerState.startOffset + 2, offset);\n        \n        // Check for ]] closure\n        if (query.endsWith(']]')) {\n          const linkText = query.slice(0, -2);\n          insertWikiLink(linkText);\n          setTriggerState(null);\n          onClose();\n        } else {\n          onQueryChange(query);\n        }\n      }\n    });\n  });\n}, [editor, triggerState, onTrigger, onQueryChange, onClose]);\n```\n\n### WikiLinkNode Insertion\n```typescript\nconst insertWikiLink = useCallback((linkText: string) =\u003e {\n  editor.update(() =\u003e {\n    const selection = $getSelection();\n    if (!$isRangeSelection(selection) || !triggerState) return;\n    \n    // Parse alias syntax: \"note title|display text\"\n    const pipeIndex = linkText.lastIndexOf('|');\n    let noteTitle: string;\n    let displayText: string;\n    \n    if (pipeIndex \u003e 0) {\n      noteTitle = linkText.slice(0, pipeIndex).trim();\n      displayText = linkText.slice(pipeIndex + 1).trim();\n    } else {\n      noteTitle = linkText.trim();\n      displayText = noteTitle;\n    }\n    \n    // Get anchor node and remove [[...]] text\n    const anchorNode = $getNodeByKey(triggerState.anchorKey);\n    if (anchorNode instanceof TextNode) {\n      const text = anchorNode.getTextContent();\n      const before = text.slice(0, triggerState.startOffset);\n      const after = text.slice(selection.anchor.offset);\n      \n      // Create wiki-link node\n      const wikiLinkNode = $createWikiLinkNode(noteTitle, displayText, null);\n      \n      // Replace text with before + node + after\n      anchorNode.setTextContent(before);\n      anchorNode.insertAfter(wikiLinkNode);\n      \n      if (after) {\n        const afterNode = new TextNode(after);\n        wikiLinkNode.insertAfter(afterNode);\n        afterNode.select(0, 0);\n      } else {\n        wikiLinkNode.selectNext();\n      }\n    }\n  });\n}, [editor, triggerState]);\n```\n\n### Escape Key Handling\n```typescript\nuseEffect(() =\u003e {\n  return editor.registerCommand(\n    KEY_ESCAPE_COMMAND,\n    () =\u003e {\n      if (triggerState?.isActive) {\n        // Remove [[ text and cancel\n        editor.update(() =\u003e {\n          const node = $getNodeByKey(triggerState.anchorKey);\n          if (node instanceof TextNode) {\n            const text = node.getTextContent();\n            const newText = text.slice(0, triggerState.startOffset) + \n                           text.slice(triggerState.startOffset + 2 + triggerState.query.length);\n            node.setTextContent(newText);\n          }\n        });\n        setTriggerState(null);\n        onClose();\n        return true;\n      }\n      return false;\n    },\n    COMMAND_PRIORITY_LOW\n  );\n}, [editor, triggerState, onClose]);\n```\n\n## Props Interface\n```typescript\ninterface WikiLinkPluginProps {\n  onTrigger: (query: string, position: { top: number; left: number }) =\u003e void;\n  onQueryChange: (query: string) =\u003e void;\n  onClose: () =\u003e void;\n  currentNoteId: string | null;\n}\n```\n\n## Acceptance Criteria\n- [ ] Detects [[ typing pattern\n- [ ] Tracks cursor position for autocomplete popup\n- [ ] Converts [[text]] to WikiLinkNode on closure\n- [ ] Parses alias syntax (pipe separator) - last | wins\n- [ ] Cancels on Escape key and removes [[ text\n- [ ] Handles edge cases (end of document, selection changes)\n- [ ] Exposes insertWikiLink for programmatic insertion from autocomplete","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:41:18.904575-06:00","updated_at":"2025-11-26T15:13:46.54482-06:00","closed_at":"2025-11-26T15:13:46.54482-06:00","dependencies":[{"issue_id":"linked-7","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-7","depends_on_id":"linked-1","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-7","depends_on_id":"linked-2","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-70","title":"Phase 4.2: Preload API for people namespace","description":"Add people namespace to preload API for renderer access.\n\n## File\napps/desktop/electron/preload/src/preload.ts\n\n## API Extensions\n```typescript\npeople: {\n  /**\n   * List all people\n   */\n  list: (): Promise\u003cNote[]\u003e =\u003e \n    ipcRenderer.invoke('people:list'),\n\n  /**\n   * Create a new person\n   */\n  create: (name: string): Promise\u003cNote\u003e =\u003e \n    ipcRenderer.invoke('people:create', name),\n\n  /**\n   * Search people by name (for autocomplete)\n   */\n  search: (query: string, limit?: number): Promise\u003cSearchResult[]\u003e =\u003e \n    ipcRenderer.invoke('people:search', query, limit ?? 10),\n}\n```\n\n## Usage Examples\n```typescript\n// In renderer\nconst people = await window.scribe.people.list();\nconst newPerson = await window.scribe.people.create('John Smith');\nconst results = await window.scribe.people.search('joh', 5);\n```\n\n## Acceptance Criteria\n- [ ] people.list() exposed in preload\n- [ ] people.create(name) exposed in preload\n- [ ] people.search(query, limit) exposed with default limit\n- [ ] All methods use ipcRenderer.invoke\n- [ ] Type safety maintained","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:55:46.058-06:00","updated_at":"2025-11-27T10:45:23.154153-06:00","closed_at":"2025-11-27T10:45:23.154153-06:00","dependencies":[{"issue_id":"linked-70","depends_on_id":"linked-69","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-70","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-71","title":"Phase 4.3: TypeScript declarations for people API","description":"Update TypeScript declarations to include people API types.\n\n## File\napps/desktop/renderer/src/types/scribe.d.ts\n\n## Type Declarations\n```typescript\ninterface PeopleAPI {\n  /** List all people */\n  list(): Promise\u003cNote[]\u003e;\n  \n  /** Create a new person with the given name */\n  create(name: string): Promise\u003cNote\u003e;\n  \n  /** Search people by name (for autocomplete) */\n  search(query: string, limit?: number): Promise\u003cSearchResult[]\u003e;\n}\n\ninterface ScribeAPI {\n  // Existing namespaces...\n  notes: NotesAPI;\n  search: SearchAPI;\n  graph: GraphAPI;\n  app: AppAPI;\n  \n  // NEW\n  people: PeopleAPI;\n}\n```\n\n## Acceptance Criteria\n- [ ] PeopleAPI interface defined\n- [ ] ScribeAPI extended with people namespace\n- [ ] All method signatures match implementation\n- [ ] TypeScript compiles without errors\n- [ ] Auto-complete works in IDE","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:55:52.326132-06:00","updated_at":"2025-11-27T10:46:59.40482-06:00","closed_at":"2025-11-27T10:46:59.40482-06:00","dependencies":[{"issue_id":"linked-71","depends_on_id":"linked-70","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-71","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-72","title":"Phase 4.4: Extend CommandContext with promptInput, navigateToNote, and setPaletteMode","description":"Add promptInput, navigateToNote, and setPaletteMode methods to CommandContext for people commands.\n\n## File\napps/desktop/renderer/src/commands/types.ts\n\n## CommandContext Extensions\n```typescript\ninterface CommandContext {\n  // Existing methods...\n  closePalette: () =\u003e void;\n  setCurrentNoteId: (noteId: string) =\u003e void;\n  getCurrentNoteId: () =\u003e string | null;\n  saveCurrentNote: () =\u003e Promise\u003cvoid\u003e;\n  createNote: () =\u003e Promise\u003cvoid\u003e;\n  \n  // NEW METHODS\n  \n  /**\n   * Prompt user for text input with a modal dialog\n   * Returns the entered text, or undefined if cancelled\n   */\n  promptInput: (placeholder: string) =\u003e Promise\u003cstring | undefined\u003e;\n  \n  /**\n   * Navigate to a note by ID\n   * Handles autosave, history push, and editor focus\n   */\n  navigateToNote: (noteId: NoteId) =\u003e void;\n  \n  /**\n   * Switch the command palette to a different mode\n   * Used by Browse People to switch to person-browse mode\n   */\n  setPaletteMode: (mode: PaletteMode) =\u003e void;\n}\n```\n\n## Implementation Notes\n\n### promptInput Implementation\nShow a modal dialog with:\n- Input field using the design system Input component\n- OK/Cancel buttons\n- Return the entered text, or undefined if cancelled\n- Consider: Should this be a separate component or inline in CommandPalette?\n\n### navigateToNote Implementation\nReuse existing navigation logic from wiki-links:\n1. Autosave current note\n2. Push current note to history stack\n3. Load target note\n4. Focus editor\n\n### setPaletteMode Implementation\nThis should update the palette state to switch modes (command, file-browse, person-browse, etc.)\n\n## Usage in Commands\n```typescript\n// New Person command\nrun: async (context) =\u003e {\n  const name = await context.promptInput('Person name');\n  if (!name) return;  // User cancelled\n  \n  const person = await window.scribe.people.create(name);\n  context.navigateToNote(person.id);\n}\n\n// Browse People command\nrun: async (context) =\u003e {\n  context.setPaletteMode('person-browse');\n}\n```\n\n## Acceptance Criteria\n- [ ] promptInput method added to CommandContext interface\n- [ ] navigateToNote method added to CommandContext interface\n- [ ] setPaletteMode method added to CommandContext interface\n- [ ] Implementation provided in command palette context\n- [ ] promptInput shows modal dialog with input field\n- [ ] promptInput returns undefined when cancelled\n- [ ] navigateToNote triggers proper navigation flow\n- [ ] setPaletteMode switches palette to specified mode","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:56:02.284447-06:00","updated_at":"2025-11-27T10:39:18.409989-06:00","closed_at":"2025-11-27T10:39:18.409989-06:00","dependencies":[{"issue_id":"linked-72","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-73","title":"Phase 4.5: Add person-browse PaletteMode","description":"Add person-browse mode to PaletteMode type and implement state handling.\n\n## File\napps/desktop/renderer/src/commands/paletteState.ts\n\n## PaletteMode Extension\n```typescript\ntype PaletteMode = \n  | 'command' \n  | 'file-browse' \n  | 'delete-browse' \n  | 'delete-confirm'\n  | 'person-browse';  // NEW: Browse people mode\n```\n\n## State Handling for person-browse\n```typescript\ncase 'person-browse':\n  return {\n    ...state,\n    mode: 'person-browse',\n    items: await window.scribe.people.list(),\n    selectedIndex: 0,\n    placeholder: 'Search people...',\n  };\n```\n\n## Behavior\n- Shows list of all people (type='person' notes)\n- Filtered by search query as user types\n- Selecting a person navigates to their page\n- Escape returns to command mode\n\n## Acceptance Criteria\n- [ ] PaletteMode includes 'person-browse'\n- [ ] State handler loads people list\n- [ ] Search/filter works on people list\n- [ ] Selection navigates to person page\n- [ ] Escape returns to command mode\n- [ ] Empty state shown when no people exist","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:56:22.57496-06:00","updated_at":"2025-11-27T10:50:24.953865-06:00","closed_at":"2025-11-27T10:50:24.953865-06:00","dependencies":[{"issue_id":"linked-73","depends_on_id":"linked-71","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-73","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-74","title":"Phase 4.6: Implement people commands (New Person, Browse People)","description":"Create people-related commands for the command palette.\n\n## Files\n- renderer/src/commands/people.ts (NEW)\n- renderer/src/commands/registry.ts (modify)\n\n## Command Group Registration\n```typescript\n// In commands/registry.ts or commands/index.ts\ncommandRegistry.registerGroup('people', { \n  title: 'People', \n  order: 3  // After 'notes' (1) and 'navigation' (2)\n});\n```\n\n## Commands\n\n### New Person\n```typescript\n{\n  id: 'person:create',\n  title: 'New Person',\n  description: 'Create a new person',\n  group: 'people',\n  keywords: ['person', 'contact', 'create', '@'],\n  run: async (context) =\u003e {\n    const name = await context.promptInput('Person name');\n    if (!name) return;\n    \n    const person = await window.scribe.people.create(name);\n    context.navigateToNote(person.id);\n  }\n}\n```\n\n### Browse People\n```typescript\n{\n  id: 'person:browse',\n  title: 'Browse People',\n  description: 'View all people',\n  group: 'people',\n  keywords: ['person', 'contact', 'list', '@'],\n  closeOnSelect: false,  // Keep palette open, switch mode\n  run: async (context) =\u003e {\n    context.setPaletteMode('person-browse');\n  }\n}\n```\n\n## Test Cases\n| Test Case | Action | Expected |\n|-----------|--------|----------|\n| New Person command | Execute command | Prompts for name, creates person |\n| New Person cancel | Cancel prompt | No person created |\n| New Person empty | Submit empty name | Shows validation error |\n| Browse People | Execute command | Switches to person-browse mode |\n| Browse People select | Select person in browse | Navigates to person's page |\n\n## Acceptance Criteria\n- [ ] people.ts file created with both commands\n- [ ] 'people' group registered with proper order\n- [ ] New Person prompts for name\n- [ ] New Person creates and navigates to person\n- [ ] Browse People switches palette mode\n- [ ] Commands appear in palette search\n- [ ] Keywords enable finding commands","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:56:34.13537-06:00","updated_at":"2025-11-27T10:52:12.289089-06:00","closed_at":"2025-11-27T10:52:12.289089-06:00","dependencies":[{"issue_id":"linked-74","depends_on_id":"linked-72","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-74","depends_on_id":"linked-73","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-74","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-75","title":"Phase 5.1: Editor integration - Register PersonMentionNode and plugin","description":"Wire PersonMentionNode and plugin into EditorRoot.\n\n## File\napps/desktop/renderer/src/components/Editor/EditorRoot.tsx\n\n## Changes Required\n\n### 1. Import PersonMentionNode\n```typescript\nimport { PersonMentionNode, $createPersonMentionNode } from './plugins/PersonMentionNode';\nimport { PersonMentionPlugin } from './plugins/PersonMentionPlugin';\nimport { PersonMentionProvider } from './plugins/PersonMentionContext';\n```\n\n### 2. Register Node in Lexical Config\n```typescript\nconst editorConfig = {\n  nodes: [\n    // Existing nodes...\n    WikiLinkNode,\n    PersonMentionNode,  // NEW\n  ],\n  // ...\n};\n```\n\n### 3. Add Plugin with Props\n```typescript\n\u003cLexicalComposer initialConfig={editorConfig}\u003e\n  \u003cPersonMentionProvider \n    onNavigate={handleNavigateToNote} \n    onError={handleError}\n  \u003e\n    {/* Existing plugins... */}\n    \u003cWikiLinkPlugin /\u003e\n    \u003cPersonMentionPlugin currentNoteId={currentNoteId} /\u003e  {/* NEW */}\n  \u003c/PersonMentionProvider\u003e\n\u003c/LexicalComposer\u003e\n```\n\n### 4. Navigation Handler\n```typescript\nconst handleNavigateToNote = useCallback((noteId: NoteId) =\u003e {\n  // Save current note (autosave)\n  // Push to history\n  // Load target note\n  // Focus editor\n}, [/* deps */]);\n```\n\n## Acceptance Criteria\n- [ ] PersonMentionNode registered with Lexical\n- [ ] PersonMentionPlugin added with currentNoteId prop\n- [ ] PersonMentionProvider wraps editor\n- [ ] Navigation handler connects to existing nav system\n- [ ] Error handler shows toast on error\n- [ ] No TypeScript errors\n- [ ] Existing wiki-links still work","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:56:45.165426-06:00","updated_at":"2025-11-27T10:50:24.968019-06:00","closed_at":"2025-11-27T10:50:24.968019-06:00","dependencies":[{"issue_id":"linked-75","depends_on_id":"linked-68","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-75","depends_on_id":"linked-71","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-75","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-76","title":"Phase 5.2: Add person-mention CSS styles to EditorRoot","description":"Add person-mention global styles to EditorRoot.css.ts.\n\n## File\napps/desktop/renderer/src/components/Editor/EditorRoot.css.ts\n\n## CSS Styles to Add\n```typescript\nimport { globalStyle } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\n// Person mention styles\nglobalStyle('.person-mention', {\n  color: vars.color.accent,\n  cursor: 'pointer',\n  fontStyle: 'normal',\n});\n\nglobalStyle('.person-mention:hover', {\n  textDecoration: 'underline',\n});\n```\n\n## Visual States\n| State | Appearance |\n|-------|------------|\n| Default | Accent text color, cursor: pointer |\n| Hover | Underlined |\n| Incomplete | Plain text (while typing @partial) |\n\n## Design Notes\n- Uses existing accent color from design system\n- Consistent with wiki-link styling approach\n- Future option: Add vars.color.accentSecondary for distinct people color\n\n## Acceptance Criteria\n- [ ] .person-mention class styled\n- [ ] Uses design system tokens (vars.color.accent)\n- [ ] Hover state with underline\n- [ ] Cursor changes to pointer\n- [ ] Visually distinguishable as clickable\n- [ ] Works in both light and dark themes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T09:56:54.399169-06:00","updated_at":"2025-11-27T10:45:23.166332-06:00","closed_at":"2025-11-27T10:45:23.166332-06:00","dependencies":[{"issue_id":"linked-76","depends_on_id":"linked-65","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-76","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-77","title":"Phase 5.3: Integration tests for People feature","description":"Create integration tests for the complete People feature flow.\n\n## File\napps/desktop/people.integration.test.ts (NEW)\n\n## Test Setup (following existing patterns)\n```typescript\nimport { describe, it, expect, beforeEach, afterEach } from 'vitest';\nimport { FileSystemVault } from '@scribe/storage-fs';\nimport { GraphEngine } from '@scribe/engine-graph';\nimport type { Note, LexicalState } from '@scribe/shared';\nimport {\n  type TestContext,\n  setupTestContext,\n  cleanupTestContext,\n} from './test-helpers';\n\ndescribe('People Feature Integration Tests', () =\u003e {\n  let ctx: TestContext;\n  let vault: FileSystemVault;\n  let graphEngine: GraphEngine;\n\n  beforeEach(async () =\u003e {\n    ctx = await setupTestContext('people-test');\n    vault = ctx.vault;\n    graphEngine = ctx.graphEngine;\n  });\n\n  afterEach(async () =\u003e {\n    await cleanupTestContext(ctx);\n  });\n  \n  // Tests here...\n});\n```\n\n## Test Flow 1: Create person via vault\n```typescript\nit('should create a person note with type=\"person\"', async () =\u003e {\n  const content = createPersonContent('John Smith');\n  const person = await vault.create({ content, type: 'person' });\n  \n  expect(person.metadata.type).toBe('person');\n  expect(person.metadata.title).toBe('John Smith');\n  expect(person.content.type).toBe('person');\n});\n```\n\n## Test Flow 2: Person type persists through save/load\n```typescript\nit('should persist person type through save and reload', async () =\u003e {\n  const person = await vault.create({ \n    content: createPersonContent('Jane Doe'),\n    type: 'person' \n  });\n  \n  // Simulate restart by loading from disk\n  const vault2 = new FileSystemVault(ctx.tempDir);\n  await vault2.load();\n  \n  const loaded = vault2.read(person.id);\n  expect(loaded.metadata.type).toBe('person');\n});\n```\n\n## Test Flow 3: Graph engine tracks mentions\n```typescript\nit('should track person mentions in graph engine', async () =\u003e {\n  const alice = await vault.create({ \n    content: createPersonContent('Alice'),\n    type: 'person' \n  });\n  \n  const noteContent = createNoteWithMention('Meeting notes', alice.id, 'Alice');\n  const meetingNote = await vault.create({ content: noteContent });\n  \n  graphEngine.addNote(alice);\n  graphEngine.addNote(meetingNote);\n  \n  const mentioningNotes = graphEngine.notesMentioning(alice.id);\n  expect(mentioningNotes).toContain(meetingNote.id);\n  \n  const mentionedPeople = graphEngine.peopleMentionedIn(meetingNote.id);\n  expect(mentionedPeople).toContain(alice.id);\n});\n```\n\n## Test Flow 4: getAllPeople returns only person notes\n```typescript\nit('should filter people correctly in getAllPeople', async () =\u003e {\n  const person1 = await vault.create({ content: createPersonContent('Bob'), type: 'person' });\n  const person2 = await vault.create({ content: createPersonContent('Carol'), type: 'person' });\n  const regularNote = await vault.create(); // No type\n  \n  graphEngine.addNote(person1);\n  graphEngine.addNote(person2);\n  graphEngine.addNote(regularNote);\n  \n  const people = graphEngine.getAllPeople();\n  \n  expect(people).toHaveLength(2);\n  expect(people).toContain(person1.id);\n  expect(people).toContain(person2.id);\n  expect(people).not.toContain(regularNote.id);\n});\n```\n\n## Test Flow 5: Remove person cleans up mentions\n```typescript\nit('should clean up mention indexes when person is removed', async () =\u003e {\n  const alice = await vault.create({ content: createPersonContent('Alice'), type: 'person' });\n  const note = await vault.create({ content: createNoteWithMention('Note', alice.id, 'Alice') });\n  \n  graphEngine.addNote(alice);\n  graphEngine.addNote(note);\n  \n  // Verify mention tracked\n  expect(graphEngine.notesMentioning(alice.id)).toContain(note.id);\n  \n  // Remove person\n  graphEngine.removeNote(alice.id);\n  \n  // Verify cleanup\n  expect(graphEngine.notesMentioning(alice.id)).toHaveLength(0);\n});\n```\n\n## Helper Functions to Add\n```typescript\nfunction createPersonContent(name: string): LexicalState \u0026 { type: 'person' } {\n  return {\n    root: {\n      type: 'root',\n      children: [\n        { type: 'heading', tag: 'h1', children: [{ type: 'text', text: name }] },\n        { type: 'paragraph', children: [] },\n      ],\n    },\n    type: 'person',\n  };\n}\n\nfunction createNoteWithMention(title: string, personId: string, personName: string): LexicalState {\n  return {\n    root: {\n      type: 'root',\n      children: [\n        { type: 'paragraph', children: [{ type: 'text', text: title }] },\n        { \n          type: 'paragraph', \n          children: [\n            { type: 'text', text: 'Meeting with ' },\n            { type: 'person-mention', personId, personName },\n          ] \n        },\n      ],\n    },\n  };\n}\n```\n\n## Acceptance Criteria\n- [ ] All test flows pass\n- [ ] Tests follow existing patterns from mvp.integration.test.ts\n- [ ] Tests run in CI\n- [ ] No flaky tests\n- [ ] Proper cleanup between tests using test-helpers\n- [ ] Tests are isolated (don't depend on order)\n- [ ] Helper functions are reusable","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T09:57:07.213177-06:00","updated_at":"2025-11-27T11:35:10.755688-06:00","closed_at":"2025-11-27T11:35:10.755688-06:00","dependencies":[{"issue_id":"linked-77","depends_on_id":"linked-75","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-77","depends_on_id":"linked-76","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-77","depends_on_id":"linked-74","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-77","depends_on_id":"linked-60","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-78","title":"Phase 1.1: Extend shared types with NoteType and mentions field","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T10:22:20.011773-06:00","updated_at":"2025-11-27T10:29:32.06902-06:00","closed_at":"2025-11-27T10:29:32.06902-06:00"}
{"id":"linked-79","title":"Missing PersonMentionContext integration in EditorRoot","description":"The PersonMentionProvider context is created but never used in EditorRoot. The PersonMentionNode component calls usePersonMentionContext() which will throw a runtime error when clicking a mention. Need to wrap LexicalComposer with PersonMentionProvider and provide onMentionClick and onError callbacks.\n\nFile: apps/desktop/renderer/src/components/Editor/EditorRoot.tsx:116-143\n\nThis is a critical blocker - clicking any person mention will crash the app.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-27T11:39:40.11743-06:00","updated_at":"2025-11-27T11:42:29.359904-06:00","closed_at":"2025-11-27T11:42:29.359904-06:00"}
{"id":"linked-8","title":"Implement WikiLinkAutocomplete UI component","description":"Create the autocomplete popup UI that shows note suggestions.\n\n## Details\n- Files: \n  - renderer/src/components/Editor/plugins/WikiLinkAutocomplete.tsx\n  - renderer/src/components/Editor/plugins/WikiLinkAutocomplete.css\n\n## Component Interface\n```typescript\nimport type { SearchResult } from '@scribe/shared';\n\ninterface WikiLinkAutocompleteProps {\n  isOpen: boolean;\n  query: string;\n  position: { top: number; left: number };\n  results: SearchResult[];\n  selectedIndex: number;\n  onSelect: (result: SearchResult) =\u003e void;\n  onClose: () =\u003e void;\n  isLoading: boolean;\n}\n```\n\n## Implementation\n```typescript\nimport { useEffect, useRef } from 'react';\nimport type { SearchResult } from '@scribe/shared';\nimport './WikiLinkAutocomplete.css';\n\nexport function WikiLinkAutocomplete({\n  isOpen,\n  query,\n  position,\n  results,\n  selectedIndex,\n  onSelect,\n  onClose,\n  isLoading,\n}: WikiLinkAutocompleteProps) {\n  const listRef = useRef\u003cHTMLDivElement\u003e(null);\n  const selectedRef = useRef\u003cHTMLDivElement\u003e(null);\n\n  // Scroll selected item into view\n  useEffect(() =\u003e {\n    if (selectedRef.current) {\n      selectedRef.current.scrollIntoView({ block: 'nearest' });\n    }\n  }, [selectedIndex]);\n\n  if (!isOpen) return null;\n\n  return (\n    \u003cdiv \n      className=\"wiki-link-autocomplete\"\n      style={{ top: position.top, left: position.left }}\n    \u003e\n      \u003cdiv className=\"wiki-link-autocomplete-list\" ref={listRef}\u003e\n        {isLoading ? (\n          \u003cdiv className=\"wiki-link-autocomplete-loading\"\u003eSearching...\u003c/div\u003e\n        ) : results.length === 0 ? (\n          \u003cdiv className=\"wiki-link-autocomplete-empty\"\u003e\n            {query ? 'No matching notes' : 'Type to search notes'}\n          \u003c/div\u003e\n        ) : (\n          results.map((result, index) =\u003e (\n            \u003cdiv\n              key={result.id}\n              ref={index === selectedIndex ? selectedRef : null}\n              className={`wiki-link-autocomplete-item ${\n                index === selectedIndex ? 'wiki-link-autocomplete-item--selected' : ''\n              }`}\n              onClick={() =\u003e onSelect(result)}\n              onMouseEnter={() =\u003e {/* optionally update selectedIndex */}}\n            \u003e\n              \u003cspan className=\"wiki-link-autocomplete-title\"\u003e\n                {result.title || 'Untitled'}\n              \u003c/span\u003e\n            \u003c/div\u003e\n          ))\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## CSS (WikiLinkAutocomplete.css)\n```css\n.wiki-link-autocomplete {\n  position: fixed;\n  z-index: 1000;\n  width: 280px;\n  max-height: 300px;\n  background: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  overflow: hidden;\n}\n\n.wiki-link-autocomplete-list {\n  overflow-y: auto;\n  max-height: 300px;\n}\n\n.wiki-link-autocomplete-item {\n  padding: 10px 12px;\n  cursor: pointer;\n  border-bottom: 1px solid #f0f0f0;\n}\n\n.wiki-link-autocomplete-item:last-child {\n  border-bottom: none;\n}\n\n.wiki-link-autocomplete-item:hover,\n.wiki-link-autocomplete-item--selected {\n  background-color: #f5f5f5;\n}\n\n.wiki-link-autocomplete-title {\n  display: block;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  font-size: 14px;\n}\n\n.wiki-link-autocomplete-empty,\n.wiki-link-autocomplete-loading {\n  padding: 12px;\n  color: #666;\n  font-size: 13px;\n  text-align: center;\n}\n\n/* Dark mode */\n[data-theme='dark'] .wiki-link-autocomplete {\n  background: #1e1e1e;\n  border-color: #404040;\n}\n\n[data-theme='dark'] .wiki-link-autocomplete-item:hover,\n[data-theme='dark'] .wiki-link-autocomplete-item--selected {\n  background-color: #2d2d2d;\n}\n\n[data-theme='dark'] .wiki-link-autocomplete-item {\n  border-color: #333;\n}\n\n[data-theme='dark'] .wiki-link-autocomplete-empty,\n[data-theme='dark'] .wiki-link-autocomplete-loading {\n  color: #999;\n}\n```\n\n## Specifications\n| Element | Value |\n|---------|-------|\n| Width | 280px fixed |\n| Max height | 300px (scrollable) |\n| Item height | ~40px (10px padding + content) |\n| Position | Fixed, at cursor location |\n| Z-index | 1000 (above editor) |\n\n## Important Notes\n- Use `position: fixed` not `absolute` for correct positioning in Lexical\n- SearchResult type from @scribe/shared\n- Keyboard handling is done by parent (WikiLinkPlugin), this is just UI\n\n## Acceptance Criteria\n- [ ] Popup renders at correct position (fixed positioning)\n- [ ] Results display with proper styling\n- [ ] Selected item highlighted with background\n- [ ] Empty state shows \"No matching notes\"\n- [ ] Loading state shows \"Searching...\"\n- [ ] Click on item triggers onSelect callback\n- [ ] Scroll works for long lists\n- [ ] Selected item scrolls into view\n- [ ] Works in both light and dark themes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:41:37.376174-06:00","updated_at":"2025-11-26T15:03:34.351415-06:00","closed_at":"2025-11-26T15:03:34.351415-06:00","dependencies":[{"issue_id":"linked-8","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-80","title":"Remove duplicate PersonMentionAutocomplete component","description":"Two nearly identical autocomplete components exist:\n- PersonMentionPlugin.tsx:399-503 (PersonMentionAutocompleteInternal)\n- PersonMentionAutocomplete.tsx:27-135\n\nPersonMentionAutocomplete.tsx appears to be unused - all functionality is in PersonMentionAutocompleteInternal inside the plugin file. Should consolidate to a single source or remove the unused file.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T11:39:41.992348-06:00","updated_at":"2025-11-27T11:43:19.514895-06:00","closed_at":"2025-11-27T11:43:19.514895-06:00"}
{"id":"linked-81","title":"Race condition with setTimeout in justInsertedRef reset","description":"Using setTimeout to manage state in React/Lexical can lead to race conditions, especially with rapid typing. The 100ms timeout is arbitrary and may not account for all scenarios.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:140-142\n\nConsider using Lexical's command/update system more directly, or use requestAnimationFrame with a cleanup mechanism.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-27T11:39:43.342346-06:00","updated_at":"2025-11-27T11:44:28.343353-06:00","closed_at":"2025-11-27T11:44:28.343353-06:00"}
{"id":"linked-82","title":"No debounce on people search in autocomplete","description":"The search is triggered on every useEffect with query change, but there's no debouncing. For rapid typing, this causes excessive IPC calls.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:443-445\n\nAdd debouncing with ~150ms delay to reduce IPC overhead during typing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T11:39:44.918228-06:00","updated_at":"2025-11-27T11:44:54.242331-06:00","closed_at":"2025-11-27T11:44:54.242331-06:00"}
{"id":"linked-83","title":"Potential memory leak with global event listeners in PersonMentionPlugin","description":"Event listeners are added to document for keydown and mousedown events. While the current cleanup pattern appears correct, verify that cleanup always runs when component unmounts.\n\nFiles:\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:340-341\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:358-359\n\nReview and ensure no edge cases cause listener leaks.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T11:39:47.316315-06:00","updated_at":"2025-11-27T11:45:11.386315-06:00","closed_at":"2025-11-27T11:45:11.386315-06:00"}
{"id":"linked-84","title":"Inconsistent error handling in people IPC handlers","description":"The people IPC handlers throw raw Error objects instead of using the existing ScribeError pattern used elsewhere in the codebase.\n\nFile: apps/desktop/electron/main/src/main.ts:316-378\n\nShould use ScribeError with appropriate ErrorCode for consistency:\n- ErrorCode.VAULT_NOT_INITIALIZED\n- ErrorCode.GRAPH_NOT_INITIALIZED\n- ErrorCode.SEARCH_NOT_INITIALIZED\n- ErrorCode.VALIDATION_ERROR (for empty name)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T11:39:49.286867-06:00","updated_at":"2025-11-27T11:46:23.386446-06:00","closed_at":"2025-11-27T11:46:23.386446-06:00"}
{"id":"linked-85","title":"Cursor position calculation is approximate in PersonMentionPlugin","description":"The autocomplete popup position uses an approximate character width calculation that doesn't account for variable-width fonts.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:242-248\n\nconst charWidth = fontSize * 0.6; // Approximate character width ratio\n\nConsider using getSelection().getRangeAt(0).getBoundingClientRect() for accurate cursor positioning.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T11:39:53.844462-06:00","updated_at":"2025-11-27T11:47:02.098036-06:00","closed_at":"2025-11-27T11:47:02.098036-06:00"}
{"id":"linked-86","title":"Missing error handling in people commands","description":"No error handling for the person:create command - if the API call fails, the error is unhandled.\n\nFile: apps/desktop/renderer/src/commands/people.ts:20-26\n\nrun: async (context) =\u003e {\n  const name = await context.promptInput('Person name');\n  if (!name) return;\n  const person = await window.scribe.people.create(name);  // No try/catch\n  context.navigateToNote(person.id);\n},\n\nAdd try/catch with appropriate error feedback to user.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T11:39:56.047185-06:00","updated_at":"2025-11-27T11:47:35.986001-06:00","closed_at":"2025-11-27T11:47:35.986001-06:00"}
{"id":"linked-87","title":"NoteType could be more extensible","description":"The NoteType is currently a single-value union type which limits future extensibility.\n\nFile: packages/shared/src/types.ts:24\n\nexport type NoteType = 'person';  // Single value\n\nConsider making this a more explicit union for future types or add a comment explaining the design decision for keeping it as a single value.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-11-27T11:39:57.997836-06:00","updated_at":"2025-11-27T11:48:09.099384-06:00","closed_at":"2025-11-27T11:48:09.099384-06:00"}
{"id":"linked-88","title":"Missing CSS definition for .person-mention class","description":"The PersonMentionNode applies a .person-mention CSS class to the DOM but there's no corresponding CSS definition visible.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionNode.ts:94\n\nspan.className = 'person-mention';\n\nEnsure styling is defined in EditorRoot.css.ts or a global stylesheet to give visual feedback for person mentions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T11:40:00.686212-06:00","updated_at":"2025-11-27T11:42:05.272305-06:00","closed_at":"2025-11-27T11:42:05.272305-06:00"}
{"id":"linked-89","title":"Test helper duplication for createPersonContent","description":"createPersonContent and createPersonMentionNode helper functions are duplicated between:\n- apps/desktop/people.integration.test.ts:51-58\n- apps/desktop/electron/main/src/main.ts:100-133\n\nConsider moving shared helpers to test-helpers.ts or a shared location to reduce duplication and ensure consistency.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-11-27T11:40:02.56141-06:00","updated_at":"2025-11-27T11:49:16.950533-06:00","closed_at":"2025-11-27T11:49:16.950533-06:00"}
{"id":"linked-9","title":"Integrate autocomplete with search API","description":"Connect the autocomplete popup to the notes:searchTitles API.\n\n## Details\n- File: renderer/src/components/Editor/plugins/WikiLinkPlugin.tsx\n\nThis task extends WikiLinkPlugin to manage autocomplete state and integrate with the search API.\n\n## State Management\nAdd to WikiLinkPlugin:\n```typescript\nconst [autocompleteState, setAutocompleteState] = useState\u003c{\n  isOpen: boolean;\n  query: string;\n  results: SearchResult[];\n  selectedIndex: number;\n  position: { top: number; left: number };\n  isLoading: boolean;\n}\u003e({\n  isOpen: false,\n  query: '',\n  results: [],\n  selectedIndex: 0,\n  position: { top: 0, left: 0 },\n  isLoading: false,\n});\n```\n\n## Search Integration with Debounce\n```typescript\nimport { useCallback, useRef, useEffect } from 'react';\nimport type { SearchResult } from '@scribe/shared';\n\n// Debounce search calls\nconst searchTimeoutRef = useRef\u003cNodeJS.Timeout | null\u003e(null);\n\nconst performSearch = useCallback(async (query: string) =\u003e {\n  if (!query.trim()) {\n    setAutocompleteState(s =\u003e ({ ...s, results: [], isLoading: false }));\n    return;\n  }\n  \n  setAutocompleteState(s =\u003e ({ ...s, isLoading: true }));\n  \n  try {\n    const results = await window.scribe.notes.searchTitles(query, 10);\n    // Filter out current note\n    const filtered = results.filter(r =\u003e r.id !== currentNoteId);\n    setAutocompleteState(s =\u003e ({\n      ...s,\n      results: filtered,\n      selectedIndex: 0,\n      isLoading: false,\n    }));\n  } catch (error) {\n    console.error('Search failed:', error);\n    setAutocompleteState(s =\u003e ({ ...s, results: [], isLoading: false }));\n  }\n}, [currentNoteId]);\n\n// Called when query changes\nconst handleQueryChange = useCallback((query: string) =\u003e {\n  setAutocompleteState(s =\u003e ({ ...s, query }));\n  \n  // Debounce\n  if (searchTimeoutRef.current) {\n    clearTimeout(searchTimeoutRef.current);\n  }\n  searchTimeoutRef.current = setTimeout(() =\u003e {\n    performSearch(query);\n  }, 150);\n}, [performSearch]);\n\n// Cleanup timeout on unmount\nuseEffect(() =\u003e {\n  return () =\u003e {\n    if (searchTimeoutRef.current) {\n      clearTimeout(searchTimeoutRef.current);\n    }\n  };\n}, []);\n```\n\n## Keyboard Handling\n```typescript\nuseEffect(() =\u003e {\n  if (!autocompleteState.isOpen) return;\n  \n  const handleKeyDown = (e: KeyboardEvent) =\u003e {\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setAutocompleteState(s =\u003e ({\n          ...s,\n          selectedIndex: Math.min(s.selectedIndex + 1, s.results.length - 1)\n        }));\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setAutocompleteState(s =\u003e ({\n          ...s,\n          selectedIndex: Math.max(s.selectedIndex - 1, 0)\n        }));\n        break;\n      case 'Tab':\n      case 'Enter':\n        e.preventDefault();\n        const selected = autocompleteState.results[autocompleteState.selectedIndex];\n        if (selected) {\n          handleSelect(selected);\n        }\n        break;\n      case 'Escape':\n        e.preventDefault();\n        handleCancel();\n        break;\n    }\n  };\n  \n  document.addEventListener('keydown', handleKeyDown, true);\n  return () =\u003e document.removeEventListener('keydown', handleKeyDown, true);\n}, [autocompleteState.isOpen, autocompleteState.selectedIndex, autocompleteState.results]);\n```\n\n## Selection Handling\n```typescript\nconst handleSelect = useCallback((result: SearchResult) =\u003e {\n  // Insert WikiLinkNode with selected note\n  editor.update(() =\u003e {\n    // Use the insertWikiLink from WikiLinkPlugin\n    // noteTitle: result.title\n    // displayText: result.title (no alias from autocomplete)\n    // targetId: result.id\n  });\n  \n  setAutocompleteState(s =\u003e ({\n    ...s,\n    isOpen: false,\n    query: '',\n    results: [],\n    selectedIndex: 0,\n  }));\n}, [editor, triggerState]);\n```\n\n## Render Autocomplete\n```typescript\nreturn (\n  \u003c\u003e\n    \u003cWikiLinkAutocomplete\n      isOpen={autocompleteState.isOpen}\n      query={autocompleteState.query}\n      position={autocompleteState.position}\n      results={autocompleteState.results}\n      selectedIndex={autocompleteState.selectedIndex}\n      onSelect={handleSelect}\n      onClose={handleCancel}\n      isLoading={autocompleteState.isLoading}\n    /\u003e\n  \u003c/\u003e\n);\n```\n\n## Important Notes\n- Debounce delay: 150ms (fast enough to feel responsive)\n- Filter out currentNoteId from results (no self-linking from autocomplete)\n- Use capture phase for keyboard events to intercept before editor\n- SearchResult type from @scribe/shared\n\n## Acceptance Criteria\n- [ ] Search triggers on query change (debounced)\n- [ ] Debouncing prevents excessive API calls\n- [ ] Loading state shown during fetch\n- [ ] Current note excluded from results\n- [ ] Arrow keys navigate results\n- [ ] Tab/Enter selects current result\n- [ ] Escape cancels autocomplete\n- [ ] Selected note inserted as WikiLinkNode with targetId\n- [ ] Focus returns to editor after selection","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-26T14:41:57.718368-06:00","updated_at":"2025-11-26T15:19:14.234566-06:00","closed_at":"2025-11-26T15:19:14.234566-06:00","dependencies":[{"issue_id":"linked-9","depends_on_id":"linked-notes-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-9","depends_on_id":"linked-6","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-9","depends_on_id":"linked-7","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"linked-9","depends_on_id":"linked-8","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"linked-90","title":"Unused onClose parameter in PersonMentionAutocomplete","description":"The onClose parameter is defined in PersonMentionAutocompleteProps interface but prefixed with underscore indicating it's unused.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionAutocomplete.tsx:33\n\nonClose: _onClose,  // Prefixed with _ but defined in interface\n\nEither use the callback for click-outside behavior or remove from the interface if not needed.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-11-27T11:40:04.939312-06:00","updated_at":"2025-11-27T11:49:41.502308-06:00","closed_at":"2025-11-27T11:49:41.502308-06:00"}
{"id":"linked-91","title":"Add user-facing error feedback when person creation fails in PersonMentionPlugin","description":"In PersonMentionPlugin.tsx:185-189, creation failure is silently logged and the UI closes without informing the user. If window.scribe.people.create() fails (e.g., validation error, storage full), the user loses their typed name with no feedback.\n\nRecommendation: Bubble error to UI via context or callback:\n```typescript\n} catch (error) {\n  console.error('Failed to create person:', error);\n  onError?.(`Failed to create \"${name}\"`);  // Add onError to props\n  handleClose();\n  setTriggerState(null);\n}\n```\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:185-189","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-27T12:59:00.738055-06:00","updated_at":"2025-11-27T20:19:48.459271-06:00","closed_at":"2025-11-27T20:19:48.459271-06:00"}
{"id":"linked-92","title":"Replace hardcoded z-index with design system token in PersonMentionAutocomplete.css.ts","description":"In PersonMentionAutocomplete.css.ts:20, z-index is hardcoded to 1000 instead of using a design system token.\n\nCurrent code:\n```typescript\nzIndex: 1000, // High z-index for popover\n```\n\nThe issue spec mentioned using vars.zIndex.popover. Other UI overlays may conflict with this hardcoded value.\n\nRecommendation: Use design system token if available, or define one:\n```typescript\nzIndex: vars.zIndex.popover, // Or define in tokens if missing\n```\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionAutocomplete.css.ts:20","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T12:59:06.351001-06:00","updated_at":"2025-11-27T20:20:11.067094-06:00","closed_at":"2025-11-27T20:20:11.067094-06:00"}
{"id":"linked-93","title":"Add consistent error handling to people:create IPC handler","description":"The people:create handler in main.ts throws ScribeError for validation, but the error is not converted to a user-friendly format before reaching the renderer, unlike notes:save which does this conversion.\n\nThe notes:save handler does:\n```typescript\nif (error instanceof ScribeError) {\n  const userError = new Error(error.getUserMessage());\n  userError.name = error.code;\n  throw userError;\n}\n```\n\nBut people:create does not have this pattern.\n\nRecommendation: Add consistent error handling to people:create:\n```typescript\n} catch (error) {\n  if (error instanceof ScribeError) {\n    const userError = new Error(error.getUserMessage());\n    userError.name = error.code;\n    throw userError;\n  }\n  throw error;\n}\n```\n\nFile: apps/desktop/electron/main/src/main.ts:329-351","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-27T12:59:12.254615-06:00","updated_at":"2025-11-27T20:20:37.842181-06:00","closed_at":"2025-11-27T20:20:37.842181-06:00"}
{"id":"linked-94","title":"Optimize PersonMentionPlugin update listener to avoid re-registration on triggerState change","description":"The registerUpdateListener callback in PersonMentionPlugin captures triggerState in its closure but re-registers on every triggerState change due to the dependency array.\n\nCurrent code (lines 217-310):\n```typescript\nuseEffect(() =\u003e {\n  return editor.registerUpdateListener(({ editorState }) =\u003e {\n    if (insertionCounterRef.current !== lastProcessedCounterRef.current) return;\n    // ... uses triggerState\n  });\n}, [editor, triggerState, handleClose]);  // triggerState in deps\n```\n\nProblem: Re-registering the listener on every triggerState change is inefficient and could cause brief periods of stale callbacks.\n\nRecommendation: Use a ref for triggerState to avoid re-registering:\n```typescript\nconst triggerStateRef = useRef(triggerState);\ntriggerStateRef.current = triggerState;\n\nuseEffect(() =\u003e {\n  return editor.registerUpdateListener(({ editorState }) =\u003e {\n    const currentTriggerState = triggerStateRef.current;\n    // ... use currentTriggerState\n  });\n}, [editor, handleClose]); // Remove triggerState from deps\n```\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:217-310","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T12:59:18.462801-06:00","updated_at":"2025-11-27T20:21:28.705967-06:00","closed_at":"2025-11-27T20:21:28.705967-06:00"}
{"id":"linked-95","title":"Add accessibility attributes to PersonMentionNode component","description":"PersonMentionNode.ts:61 creates a span without proper accessibility attributes.\n\nCurrent code:\n```typescript\nreturn createElement('span', { onClick: handleClick }, `@${personName}`);\n```\n\nImprovement: Add accessibility attributes for keyboard navigation and screen readers:\n```typescript\nreturn createElement('span', {\n  onClick: handleClick,\n  onKeyDown: (e) =\u003e e.key === 'Enter' \u0026\u0026 handleClick(e),\n  role: 'link',\n  tabIndex: 0,\n  'aria-label': `Mention of ${personName}`,\n}, `@${personName}`);\n```\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionNode.ts:61","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T12:59:24.416616-06:00","updated_at":"2025-11-27T20:22:12.043626-06:00","closed_at":"2025-11-27T20:22:12.043626-06:00"}
{"id":"linked-96","title":"Add nullish coalescing to metadata.links in GraphEngine.addNote for consistency","description":"In graph-engine.ts, there's inconsistent use of nullish coalescing for metadata arrays.\n\nLine 126 uses it for mentions:\n```typescript\nconst newMentions = new Set(metadata.mentions ?? []);\n```\n\nBut line 82 doesn't use it for links:\n```typescript\nconst newOutgoing = new Set(metadata.links);\n```\n\nRecommendation: Be consistent with nullish coalescing for defensive programming:\n```typescript\nconst newOutgoing = new Set(metadata.links ?? []);\n```\n\nFile: packages/engine-graph/src/graph-engine.ts:82","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T12:59:30.624041-06:00","updated_at":"2025-11-27T20:22:27.52293-06:00","closed_at":"2025-11-27T20:22:27.52293-06:00"}
{"id":"linked-97","title":"Add loading spinner/animation to PersonMentionAutocomplete","description":"In PersonMentionPlugin.tsx:496-497, the loading state shows plain text 'Searching...' without any visual animation.\n\nCurrent code:\n```typescript\n{isLoading ? (\n  \u003cdiv className={autocompleteStyles.emptyState}\u003eSearching...\u003c/div\u003e\n```\n\nImprovement: Consider adding a spinner or animated indicator for better UX. This could be a simple CSS animation or reusing an existing Spinner component from the design system.\n\nFile: apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx:496-497","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T12:59:37.457326-06:00","updated_at":"2025-11-27T20:23:21.841893-06:00","closed_at":"2025-11-27T20:23:21.841893-06:00"}
{"id":"linked-98","title":"Extract PersonMentionAutocompleteInternal to separate file for better maintainability","description":"The PersonMentionAutocompleteInternal component is inlined within PersonMentionPlugin.tsx (lines 413-533). Consider extracting it to a separate file for better maintainability.\n\nCurrent structure:\n- PersonMentionPlugin.tsx contains both the plugin logic AND the autocomplete UI\n\nRecommendation: Extract to separate files:\n```typescript\n// PersonMentionAutocomplete.tsx (new file)\nexport function PersonMentionAutocomplete({\n  query,\n  position,\n  selectedIndex,\n  onSelect,\n  onCreate,\n  currentNoteId,\n  onResultsChange,\n}: PersonMentionAutocompleteProps) {\n  // ... existing implementation from PersonMentionAutocompleteInternal\n}\n\n// PersonMentionPlugin.tsx (updated)\nimport { PersonMentionAutocomplete } from './PersonMentionAutocomplete';\n\n// In render:\nreturn createPortal(\n  \u003cPersonMentionAutocomplete {...props} /\u003e,\n  document.body\n);\n```\n\nBenefits:\n- Testability (can unit test autocomplete separately)\n- File organization (autocomplete styles, types, and component in one place)\n- Future extensibility (reuse autocomplete pattern for other entity types)\n\nFiles:\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionPlugin.tsx\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionAutocomplete.tsx (to create)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-27T12:59:46.470633-06:00","updated_at":"2025-11-27T20:24:46.169993-06:00","closed_at":"2025-11-27T20:24:46.169993-06:00"}
{"id":"linked-99","title":"Add unit tests for extractMentions function in metadata.ts","description":"The integration tests cover mention extraction end-to-end, but there are no isolated unit tests for the extractMentions function in metadata.ts.\n\nRecommended test cases for packages/engine-core/src/metadata.test.ts:\n1. Extract mentions - finds all person-mention nodes\n2. No duplicates - same person mentioned twice returns single entry\n3. Empty mentions - note with no mentions returns empty array\n4. Nested mentions - mentions in nested paragraph structures\n5. Malformed nodes - handles person-mention nodes with missing personId gracefully\n\nFile: packages/engine-core/src/metadata.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T12:59:52.923276-06:00","updated_at":"2025-11-27T20:25:58.613887-06:00","closed_at":"2025-11-27T20:25:58.613887-06:00"}
{"id":"linked-notes-1","title":"Linked Notes Feature","description":"Implement Obsidian-style wiki-links ([[note title]]) with autocomplete, navigation, and back button. See features/linked-notes/spec.md for full specification.\n\n## Summary\nAdd wiki-link support to enable users to create linked notes using [[Note Title]] syntax, navigate between linked notes with a single click, and use back navigation to return to previously viewed notes.\n\n## Key Features\n1. **Wiki-link syntax**: Type [[Note Title]] to create links\n2. **Autocomplete**: Popup shows matching notes as you type\n3. **Click navigation**: Click any wiki-link to navigate to that note\n4. **Back navigation**: Button and Cmd+[ to return to previous note\n5. **Graph integration**: Wiki-links appear in backlinks\n\n## Task Organization\n\n### Foundation (no blockers - start here)\n- linked-1: WikiLinkNode (Lexical custom node)\n- linked-4: Metadata extraction for wiki-links\n- linked-5: notes:findByTitle IPC handler\n- linked-6: notes:searchTitles IPC handler\n- linked-8: WikiLinkAutocomplete UI\n- linked-11: useNavigationHistory hook\n- linked-3: Wiki-link CSS styles\n\n### Core Implementation (blocked by foundation)\n- linked-2: Register WikiLinkNode in EditorRoot (blocked by linked-1)\n- linked-7: WikiLinkPlugin - bracket detection (blocked by linked-1, linked-2)\n- linked-12: Back button UI (blocked by linked-11)\n- linked-13: Cmd+[ keyboard shortcut (blocked by linked-11)\n- linked-10: Wiki-link click navigation (blocked by linked-5, linked-7, linked-11)\n\n### Integration (blocked by core)\n- linked-9: Autocomplete + search API (blocked by linked-6, linked-7, linked-8)\n- linked-14: Full App.tsx integration (blocked by linked-10, linked-11, linked-12, linked-13)\n\n### Testing (blocked by integration)\n- linked-15: WikiLinkNode unit tests\n- linked-16: useNavigationHistory unit tests\n- linked-17: WikiLinkAutocomplete component tests\n- linked-18: Integration tests (full feature)\n- linked-19: Metadata extraction tests\n\n## Implementation Order (Recommended)\n1. Start with foundation tasks in parallel (linked-1, linked-4, linked-5, linked-6, linked-8, linked-11, linked-3)\n2. Complete core tasks as blockers are resolved\n3. Integration tasks bring everything together\n4. Testing tasks can run alongside or after implementation\n\n## Files Modified/Created\nSee individual task descriptions for specific file locations.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-26T14:39:22.403206-06:00","updated_at":"2025-11-26T15:27:57.56767-06:00","closed_at":"2025-11-26T15:27:57.56767-06:00"}
{"id":"redesign-1","title":"UI Redesign: Phase 1 - Foundation","description":"Foundation work for the Scribe UI redesign. Includes color palette update, animation tokens, and app shell layout. These are P0 prerequisites that must be completed before any other redesign work can begin.\n\n## Scope\n- Feature 1: Design System Color Palette Update\n- Feature 2: App Shell Layout\n- Animation tokens for design system\n\n## Child Tasks (in execution order)\n1. **redesign-5**: Update design token contract with new tokens (radius.xl, shadow.xl, fontFamily.serif, animation.*)\n2. **redesign-6**: Update light theme with cool neutral palette\n3. **redesign-7**: Update dark theme with cool neutral palette (zinc scale)\n4. **redesign-8**: Create vanilla-extract animation utilities (keyframes)\n5. **redesign-9**: Create AppShell layout component (three-panel layout)\n\n## Parallelization\n- redesign-5 must be done first (contract changes)\n- redesign-6 and redesign-7 can be done in parallel after redesign-5\n- redesign-8 can be done in parallel with themes after redesign-5\n- redesign-9 depends on redesign-6 and redesign-7\n\n## Success Criteria\n- [ ] New color tokens deployed to design system (light + dark themes)\n- [ ] Animation tokens (durations, easings) added to design system\n- [ ] New border radius tokens (xl, 2xl) and shadow token (xl) added\n- [ ] New font family token (serif) added\n- [ ] Animation keyframes (fadeIn, slideUp, enter, spin) available\n- [ ] Three-panel app shell layout functional with collapse/expand\n- [ ] Existing app functionality preserved\n\n## Quick Start\n```bash\n# Check ready work for this epic\nbd ready --json | jq '.[] | select(.dependencies[].depends_on_id | startswith(\"redesign-1\"))'\n\n# Start with the first task\nbd update redesign-5 --status in_progress\n```\n\n## Reference\n- features/redesign/color-palette.md\n- features/redesign/animations.md\n- features/redesign/feature-breakdown.md (Features 1, 2)","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-27T21:18:36.355826-06:00","updated_at":"2025-11-27T21:36:45.346513-06:00","closed_at":"2025-11-27T21:36:45.346513-06:00"}
{"id":"redesign-10","title":"Create Sidebar component with note list","description":"Create the left sidebar showing the note library with search, create, and note list functionality.\n\n## Files to Create\n```\napps/desktop/renderer/src/\n  components/\n    Sidebar/\n      Sidebar.tsx\n      Sidebar.css.ts\n      NoteListItem.tsx\n      NoteListItem.css.ts\n      index.ts\n```\n\n## Prerequisites\n- redesign-9 (AppShell) must be completed first\n\n## Component Props\n\n### Sidebar\n```typescript\ninterface SidebarProps {\n  isOpen: boolean;\n  notes: NoteMetadata[];\n  activeNoteId: string | null;\n  onSelectNote: (id: string) =\u003e void;\n  onCreateNote: () =\u003e void;\n  onDeleteNote: (id: string) =\u003e void;\n  onThemeToggle: () =\u003e void;\n  currentTheme: 'light' | 'dark';\n}\n```\n\n### NoteListItem\n```typescript\ninterface NoteListItemProps {\n  note: NoteMetadata;\n  isActive: boolean;\n  onSelect: () =\u003e void;\n  onDelete: () =\u003e void;\n}\n```\n\n## Sidebar Sections\n1. **Header**: \"Scribe\" app name, \"LIBRARY\" label in muted uppercase\n2. **New Note Button**: Full-width button with plus icon circle on left\n3. **Note List**: Scrollable list of notes, sorted by updatedAt descending\n4. **Footer**: User avatar placeholder (circle with initials) + theme toggle button\n\n## Note List Item Design\n- Title (truncated with ellipsis if too long)\n- Relative timestamp using date-fns `formatDistanceToNow` (e.g., \"2 hours ago\")\n- Delete button (trash icon) appears on hover only\n- Active state: ring/shadow highlight using accent color\n\n## Styling Requirements\n\n### NoteListItem states\n```typescript\n// Default\nbackgroundColor: 'transparent',\ncursor: 'pointer',\npadding: vars.spacing['3'],\nborderRadius: vars.radius.md,\ntransition: \\`all \\${vars.animation.duration.normal}\\`,\n\n// Hover\nbackgroundColor: vars.color.surface,\n\n// Active (selected note)\nbackgroundColor: vars.color.surface,\nboxShadow: \\`inset 0 0 0 2px \\${vars.color.accent}\\`,\n```\n\n### Delete button reveal\n```typescript\n// Hidden by default\nopacity: 0,\ntransition: 'opacity 0.15s',\n\n// Visible on item hover\nopacity: 1,\n```\n\n## New Note Button Design\n- Full-width with icon in a circle on left side\n- On hover: icon circle inverts (black bg, white icon in light mode)\n- Border with subtle hover shadow\n\n## Implementation Steps\n1. Create directory structure\n2. Install date-fns if not already: `bun add date-fns` (check package.json first)\n3. Create NoteListItem component with hover states and delete button\n4. Create Sidebar component with all sections\n5. Wire up to existing note state from App.tsx\n6. Test theme toggle integration\n7. Test note selection and creation\n\n## Integration with App.tsx\n```tsx\n\u003cSidebar\n  isOpen={sidebarOpen}\n  notes={noteState.notes}\n  activeNoteId={noteState.currentNoteId}\n  onSelectNote={(id) =\u003e noteState.loadNote(id)}\n  onCreateNote={() =\u003e noteState.createNote()}\n  onDeleteNote={(id) =\u003e { /* trigger delete flow */ }}\n  onThemeToggle={toggleTheme}\n  currentTheme={theme}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] Sidebar container component renders all sections\n- [ ] NoteListItem component with hover/active states\n- [ ] New Note button with hover animation (icon circle inversion)\n- [ ] Theme toggle button in footer (sun/moon icons)\n- [ ] Delete button appears on hover (with fade transition)\n- [ ] Timestamps show relative time (\"2 hours ago\", \"yesterday\", etc.)\n- [ ] Notes sorted by updatedAt (most recent first)\n- [ ] Integrates with AppShell sidebar slot\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 3)\n- redesign-poc/components/Sidebar.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T21:20:42.787067-06:00","updated_at":"2025-11-27T21:47:48.472401-06:00","closed_at":"2025-11-27T21:47:48.472401-06:00","dependencies":[{"issue_id":"redesign-10","depends_on_id":"redesign-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-10","depends_on_id":"redesign-9","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-11","title":"Create FloatingDock component","description":"Create the bottom-centered floating toolbar with quick actions.\n\n## Files to Create\n```\napps/desktop/renderer/src/\n  components/\n    FloatingDock/\n      FloatingDock.tsx\n      FloatingDock.css.ts\n      index.ts\n```\n\n## Prerequisites\n- redesign-9 (AppShell) must be completed first\n\n## Component Props\n```typescript\ninterface FloatingDockProps {\n  sidebarOpen: boolean;\n  contextPanelOpen: boolean;\n  onToggleSidebar: () =\u003e void;\n  onToggleContextPanel: () =\u003e void;\n  onOpenSearch: () =\u003e void;\n}\n```\n\n## Design Specifications\n- Pill-shaped container with glassmorphism (blur + transparency)\n- Fixed position: bottom center of viewport\n- Three sections separated by vertical dividers:\n  1. **Left**: Sidebar toggle (hamburger/menu icon) - active when sidebar open\n  2. **Center**: Search button with \"Cmd+K\" badge\n  3. **Right**: Context panel toggle (sidebar icon mirrored) - active when panel open\n\n## Glassmorphism Styling\n```typescript\nexport const dock = style({\n  position: 'fixed',\n  bottom: vars.spacing['6'],\n  left: '50%',\n  transform: 'translateX(-50%)',\n  zIndex: vars.zIndex.overlay,\n  \n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['1'],\n  padding: vars.spacing['2'],\n  \n  // Glassmorphism effect\n  backgroundColor: 'rgba(255, 255, 255, 0.9)',\n  backdropFilter: 'blur(12px)',\n  WebkitBackdropFilter: 'blur(12px)', // Safari support\n  borderRadius: vars.radius.full,\n  boxShadow: vars.shadow.lg,\n  border: \\`1px solid \\${vars.color.border}\\`,\n  \n  transition: 'all 0.15s',\n  \n  ':hover': {\n    transform: 'translateX(-50%) scale(1.02)',\n    boxShadow: vars.shadow.xl,\n  },\n});\n```\n\n## Button Styling\n```typescript\nexport const dockButton = style({\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  padding: vars.spacing['2'],\n  borderRadius: vars.radius.md,\n  backgroundColor: 'transparent',\n  border: 'none',\n  cursor: 'pointer',\n  color: vars.color.foregroundMuted,\n  transition: \\`all \\${vars.animation.duration.fast}\\`,\n  \n  ':hover': {\n    backgroundColor: vars.color.surface,\n    color: vars.color.foreground,\n  },\n});\n\nexport const dockButtonActive = style({\n  color: vars.color.accent,\n});\n```\n\n## Keyboard Shortcut Badge\n```typescript\nexport const shortcutBadge = style({\n  fontSize: vars.typography.size.xs,\n  color: vars.color.foregroundMuted,\n  backgroundColor: vars.color.surface,\n  padding: \\`\\${vars.spacing['1']} \\${vars.spacing['2']}\\`,\n  borderRadius: vars.radius.sm,\n  marginLeft: vars.spacing['2'],\n});\n```\n\n## Divider\n```typescript\nexport const divider = style({\n  width: '1px',\n  height: '24px',\n  backgroundColor: vars.color.border,\n  margin: \\`0 \\${vars.spacing['1']}\\`,\n});\n```\n\n## Dark Mode Adjustment\nIn dark mode, adjust glassmorphism background:\n```typescript\n// Consider using theme-aware approach or CSS variable\nbackgroundColor: 'rgba(24, 24, 27, 0.9)', // zinc-900 with transparency\n```\n\n## Implementation Steps\n1. Create directory structure\n2. Create FloatingDock.css.ts with glassmorphism styles\n3. Create FloatingDock.tsx component with three button sections\n4. Add dividers between sections\n5. Add icons (use existing icon approach or Lucide icons if available)\n6. Wire up to App.tsx state toggles and command palette opener\n7. Test hover scale effect\n8. Test dark mode glassmorphism\n\n## Integration with App.tsx\n```tsx\n\u003cFloatingDock\n  sidebarOpen={sidebarOpen}\n  contextPanelOpen={contextPanelOpen}\n  onToggleSidebar={() =\u003e setSidebarOpen(prev =\u003e !prev)}\n  onToggleContextPanel={() =\u003e setContextPanelOpen(prev =\u003e !prev)}\n  onOpenSearch={() =\u003e setIsPaletteOpen(true)}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] FloatingDock component with three sections\n- [ ] Glassmorphism effect (blur + transparency)\n- [ ] Sidebar toggle button with active state indicator\n- [ ] Search button with \"Cmd+K\" badge\n- [ ] Context panel toggle button with active state indicator\n- [ ] Hover scale effect on dock (1.02x)\n- [ ] Dark mode styling (adjusted background opacity)\n- [ ] Integrates with App.tsx state\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 4)\n- features/redesign/animations.md (Floating Action Dock)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T21:20:58.936285-06:00","updated_at":"2025-11-27T21:49:59.303262-06:00","closed_at":"2025-11-27T21:49:59.303262-06:00","dependencies":[{"issue_id":"redesign-11","depends_on_id":"redesign-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-11","depends_on_id":"redesign-9","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-12","title":"Redesign CommandPalette visual styling","description":"Update the existing CommandPalette to match the POC's visual design while preserving all functionality.\n\n## Files to Modify\n- apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx\n- apps/desktop/renderer/src/components/CommandPalette/CommandPalette.css.ts\n\n## Prerequisites\n- redesign-6 must be completed (light theme tokens available)\n\n## IMPORTANT: Preserve Existing Functionality\nThis is a visual restyling ONLY. Do NOT change:\n- All existing modes (command, file-browse, delete-browse, delete-confirm, prompt-input)\n- Keyboard navigation logic (arrows, enter, escape)\n- Fuzzy search algorithm\n- All tests must continue to pass\n\n## Visual Changes Required\n\n### Container\n- Larger border radius (radius.xl → 1rem instead of radius.lg)\n- Ring border effect (1px solid border with subtle shadow)\n- Softer shadow (shadow.lg)\n- Max width: 640px\n- Slide-up animation on open\n\n### Input Styling\n- Border-bottom separator instead of full border around input\n- ESC badge on the right side of input row (not inside input)\n- Larger font size for search\n- Placeholder: \"Search notes, commands...\"\n\n### Result Items\n- File icon for notes (📄 or use icon component)\n- Command icon for commands (⌘ or use icon component)\n- Cleaner spacing (padding adjustments)\n- Subtle hover background (surface color)\n- Selected state with accent color highlight\n\n### \"Create New Note\" Option\n- Always visible at bottom when query exists\n- Plus icon (+)\n- Distinct styling (subtle background)\n\n## CSS Updates (CommandPalette.css.ts)\n```typescript\nimport { style, keyframes } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nconst slideUp = keyframes({\n  '0%': { opacity: 0, transform: 'translateY(10px)' },\n  '100%': { opacity: 1, transform: 'translateY(0)' },\n});\n\nexport const overlay = style({\n  position: 'fixed',\n  inset: 0,\n  backgroundColor: 'rgba(0, 0, 0, 0.3)',\n  backdropFilter: 'blur(4px)',\n  display: 'flex',\n  alignItems: 'flex-start',\n  justifyContent: 'center',\n  paddingTop: '15vh',\n  zIndex: vars.zIndex.palette,\n});\n\nexport const container = style({\n  width: '100%',\n  maxWidth: '640px',\n  backgroundColor: vars.color.background,\n  borderRadius: vars.radius.xl,\n  boxShadow: vars.shadow.lg,\n  border: \\`1px solid \\${vars.color.border}\\`,\n  overflow: 'hidden',\n  animation: \\`\\${slideUp} \\${vars.animation.duration.slow} \\${vars.animation.easing.default}\\`,\n});\n```\n\n## Implementation Steps\n1. Read existing CommandPalette.tsx to understand current structure\n2. Update CommandPalette.css.ts with new styles\n3. Add slideUp animation keyframe\n4. Update input row to include ESC badge element\n5. Update result item styling for icons and spacing\n6. Update \"Create\" option styling\n7. Run all existing tests: `bun test CommandPalette`\n8. Manual testing of all modes: command, file-browse, delete-browse, delete-confirm\n\n## Acceptance Criteria\n- [ ] Container styling updated (radius.xl, shadow.lg, animation)\n- [ ] Input styling with ESC badge\n- [ ] Result items restyled with icons\n- [ ] \"Create New Note\" option styled distinctly\n- [ ] Slide-up animation on open\n- [ ] Dark mode works correctly\n- [ ] ALL existing tests pass (run `bun test`)\n- [ ] All palette modes still functional (manually verify)\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 6)\n- features/redesign/animations.md (Command Palette)\n- redesign-poc/components/CommandPalette.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T21:21:18.917128-06:00","updated_at":"2025-11-27T21:55:16.756094-06:00","closed_at":"2025-11-27T21:54:57.342339-06:00","dependencies":[{"issue_id":"redesign-12","depends_on_id":"redesign-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-12","depends_on_id":"redesign-6","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-14","title":"Create SelectionToolbar floating menu","description":"Create a floating toolbar that appears above selected text with formatting options.\n\n## Files to Create\n```\napps/desktop/renderer/src/\n  components/\n    Editor/\n      SelectionToolbar/\n        SelectionToolbar.tsx\n        SelectionToolbar.css.ts\n        index.ts\n```\n\n## Component Props\n```typescript\ninterface SelectionToolbarProps {\n  editor: LexicalEditor;\n}\n\ntype FormatType = 'bold' | 'italic' | 'underline' | 'strike' | 'h1' | 'h2' | 'highlight' | 'link';\n```\n\n## Toolbar Layout\nThree sections separated by dividers:\n1. **Text formatting**: Bold, Italic, Underline, Strikethrough\n2. **Block formatting**: H1, H2, Highlight\n3. **Actions**: Link, \"Ask AI\" (placeholder)\n\n## Position Calculation\n```typescript\nconst calculatePosition = useCallback(() =\u003e {\n  const selection = window.getSelection();\n  if (!selection || selection.isCollapsed) return null;\n  \n  const range = selection.getRangeAt(0);\n  const rect = range.getBoundingClientRect();\n  \n  return {\n    top: rect.top - 50, // Above selection\n    left: rect.left + rect.width / 2, // Centered\n  };\n}, []);\n```\n\n## Styling (SelectionToolbar.css.ts)\n\n```typescript\nimport { style, keyframes } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nconst enter = keyframes({\n  from: { opacity: 0, transform: 'scale(0.95)' },\n  to: { opacity: 1, transform: 'scale(1)' },\n});\n\nexport const toolbar = style({\n  position: 'fixed',\n  transform: 'translateX(-50%)',\n  zIndex: vars.zIndex.popover,\n  \n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['1'],\n  padding: vars.spacing['2'],\n  \n  backgroundColor: vars.color.background,\n  borderRadius: vars.radius.lg,\n  boxShadow: vars.shadow.lg,\n  border: \\`1px solid \\${vars.color.border}\\`,\n  \n  animation: \\`\\${enter} \\${vars.animation.duration.normal} \\${vars.animation.easing.default}\\`,\n});\n\nexport const button = style({\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  width: '32px',\n  height: '32px',\n  borderRadius: vars.radius.sm,\n  backgroundColor: 'transparent',\n  border: 'none',\n  cursor: 'pointer',\n  color: vars.color.foreground,\n  transition: \\`all \\${vars.animation.duration.fast}\\`,\n  \n  ':hover': {\n    backgroundColor: vars.color.surface,\n  },\n});\n\nexport const buttonActive = style({\n  backgroundColor: vars.color.accent,\n  color: vars.color.accentForeground,\n});\n\nexport const divider = style({\n  width: '1px',\n  height: '20px',\n  backgroundColor: vars.color.border,\n  margin: \\`0 \\${vars.spacing['1']}\\`,\n});\n\nexport const pointer = style({\n  position: 'absolute',\n  bottom: '-6px',\n  left: '50%',\n  transform: 'translateX(-50%)',\n  width: 0,\n  height: 0,\n  borderLeft: '6px solid transparent',\n  borderRight: '6px solid transparent',\n  borderTop: \\`6px solid \\${vars.color.background}\\`,\n});\n```\n\n## Behavior\n| Event | Action |\n|-------|--------|\n| Text selected | Show toolbar above selection |\n| Selection collapsed | Hide toolbar |\n| Click format button | Apply format, keep toolbar |\n| Click outside | Hide toolbar |\n| mousedown on button | preventDefault (keep selection) |\n\n## Lexical Integration\n```typescript\n// Use Lexical's selection listener\neditor.registerUpdateListener(({ editorState }) =\u003e {\n  editorState.read(() =\u003e {\n    const selection = ();\n    if (!(selection) || selection.isCollapsed()) {\n      setPosition(null);\n      return;\n    }\n    // Calculate and set position\n  });\n});\n\n// Apply formatting\nconst applyFormat = (format: FormatType) =\u003e {\n  editor.dispatchCommand(FORMAT_TEXT_COMMAND, format);\n};\n```\n\n## Acceptance Criteria\n- [ ] Toolbar appears above text selection\n- [ ] All format buttons work (bold, italic, etc.)\n- [ ] Active state shows for current formats\n- [ ] Toolbar hides when selection collapses\n- [ ] mousedown prevents focus loss\n- [ ] Animation on appear (fade + scale)\n- [ ] Triangle pointer below toolbar\n- [ ] Dividers between sections\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 8)\n- features/redesign/animations.md (Selection Toolbar)\n- redesign-poc/components/Editor/SelectionMenu.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T21:22:05.785298-06:00","updated_at":"2025-11-27T22:43:10.743205-06:00","closed_at":"2025-11-27T22:43:10.743205-06:00","dependencies":[{"issue_id":"redesign-14","depends_on_id":"redesign-3","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-14","depends_on_id":"redesign-6","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-15","title":"Create SlashMenu command menu","description":"Create a floating menu triggered by typing \"/\" in the editor showing block formatting and AI commands.\n\n## Files to Create\n```\napps/desktop/renderer/src/\n  components/\n    Editor/\n      SlashMenu/\n        SlashMenu.tsx\n        SlashMenu.css.ts\n        SlashMenuItem.tsx\n        commands.ts\n        index.ts\n      plugins/\n        SlashMenuPlugin.tsx\n```\n\n## Command Definitions (commands.ts)\n```typescript\nexport interface SlashCommand {\n  id: string;\n  label: string;\n  description: string;\n  icon: ReactNode;\n  keywords: string[];\n  execute: (editor: LexicalEditor) =\u003e void;\n}\n\nexport const slashCommands: SlashCommand[] = [\n  {\n    id: 'text',\n    label: 'Text',\n    description: 'Just start writing with plain text',\n    icon: \u003cTextIcon /\u003e,\n    keywords: ['text', 'paragraph', 'plain'],\n    execute: (editor) =\u003e { /* Set to paragraph */ },\n  },\n  {\n    id: 'heading1',\n    label: 'Heading 1',\n    description: 'Big section heading',\n    icon: \u003cH1Icon /\u003e,\n    keywords: ['heading', 'h1', 'title', '#'],\n    execute: (editor) =\u003e { /* Convert to H1 */ },\n  },\n  {\n    id: 'heading2',\n    label: 'Heading 2',\n    description: 'Medium section heading',\n    icon: \u003cH2Icon /\u003e,\n    keywords: ['heading', 'h2', 'subtitle', '##'],\n    execute: (editor) =\u003e { /* Convert to H2 */ },\n  },\n  {\n    id: 'bullet',\n    label: 'Bullet List',\n    description: 'Create a bulleted list',\n    icon: \u003cListIcon /\u003e,\n    keywords: ['bullet', 'list', 'unordered', '-'],\n    execute: (editor) =\u003e { /* Insert bullet list */ },\n  },\n  {\n    id: 'todo',\n    label: 'To-do',\n    description: 'Track tasks with checkboxes',\n    icon: \u003cCheckboxIcon /\u003e,\n    keywords: ['todo', 'checkbox', 'task', '[]'],\n    execute: (editor) =\u003e { /* Insert checkbox */ },\n  },\n  {\n    id: 'quote',\n    label: 'Quote',\n    description: 'Capture a quote',\n    icon: \u003cQuoteIcon /\u003e,\n    keywords: ['quote', 'blockquote', '\u003e'],\n    execute: (editor) =\u003e { /* Insert blockquote */ },\n  },\n  // AI commands (placeholders)\n  {\n    id: 'ai-continue',\n    label: 'Continue',\n    description: 'AI continues your text',\n    icon: \u003cSparkleIcon /\u003e,\n    keywords: ['ai', 'continue', 'generate'],\n    execute: (editor) =\u003e { /* Placeholder */ },\n  },\n  {\n    id: 'ai-summarize',\n    label: 'Summarize',\n    description: 'AI summarizes content',\n    icon: \u003cSummaryIcon /\u003e,\n    keywords: ['ai', 'summarize', 'summary'],\n    execute: (editor) =\u003e { /* Placeholder */ },\n  },\n];\n```\n\n## SlashMenuPlugin\n```typescript\n// Detects '/' at start of line or after space\n// Manages menu visibility and query state\n// Handles selection and cleanup\n```\n\n## Styling (SlashMenu.css.ts)\n```typescript\nexport const menu = style({\n  position: 'fixed',\n  zIndex: vars.zIndex.popover,\n  minWidth: '280px',\n  maxWidth: '320px',\n  maxHeight: '300px',\n  overflow: 'auto',\n  \n  backgroundColor: vars.color.background,\n  borderRadius: vars.radius.lg,\n  boxShadow: vars.shadow.lg,\n  border: \\`1px solid \\${vars.color.border}\\`,\n  \n  animation: \\`\\${fadeIn} \\${vars.animation.duration.normal} \\${vars.animation.easing.default}\\`,\n});\n\nexport const menuItem = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['3'],\n  padding: \\`\\${vars.spacing['2']} \\${vars.spacing['3']}\\`,\n  cursor: 'pointer',\n  transition: \\`background-color \\${vars.animation.duration.fast}\\`,\n  \n  ':hover': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\nexport const menuItemSelected = style({\n  backgroundColor: vars.color.surface,\n});\n\nexport const menuItemIcon = style({\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  width: '32px',\n  height: '32px',\n  borderRadius: vars.radius.md,\n  backgroundColor: vars.color.surface,\n  color: vars.color.foreground,\n});\n\nexport const menuItemText = style({\n  flex: 1,\n});\n\nexport const menuItemLabel = style({\n  fontSize: vars.typography.size.sm,\n  fontWeight: vars.typography.weight.medium,\n  color: vars.color.foreground,\n});\n\nexport const menuItemDescription = style({\n  fontSize: vars.typography.size.xs,\n  color: vars.color.foregroundMuted,\n});\n```\n\n## Behavior\n| Event | Action |\n|-------|--------|\n| Type \"/\" at start or after space | Open menu at cursor |\n| Continue typing | Filter commands by query |\n| Arrow up/down | Navigate list |\n| Enter | Execute selected command |\n| Escape | Close menu, keep \"/\" text |\n| Click outside | Close menu |\n\n## Acceptance Criteria\n- [ ] SlashMenuPlugin detects \"/\" trigger\n- [ ] Menu appears below cursor\n- [ ] Commands filter by query (fuzzy match on label + keywords)\n- [ ] Keyboard navigation (up/down/enter/escape)\n- [ ] Command execution removes trigger text\n- [ ] AI commands show as placeholders (disabled or show toast)\n- [ ] Animation on appear (fadeIn)\n- [ ] Consistent styling with SelectionToolbar\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 9)\n- features/redesign/animations.md (Floating Menus)\n- redesign-poc/components/Editor/FloatingMenu.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-27T21:22:28.01967-06:00","updated_at":"2025-11-28T12:41:39.651841-06:00","closed_at":"2025-11-28T12:41:39.651841-06:00","dependencies":[{"issue_id":"redesign-15","depends_on_id":"redesign-3","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-15","depends_on_id":"redesign-14","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-16","title":"Create ContextPanel right sidebar component","description":"Create the right panel showing contextual information about the current note.\n\n## Files to Create\n```\napps/desktop/renderer/src/\n  components/\n    ContextPanel/\n      ContextPanel.tsx\n      ContextPanel.css.ts\n      LinkedMentions.tsx\n      TasksWidget.tsx\n      CalendarWidget.tsx\n      index.ts\n```\n\n## Component Props\n\n### ContextPanel\n```typescript\ninterface ContextPanelProps {\n  isOpen: boolean;\n  currentNoteId: string | null;\n}\n```\n\n### LinkedMentions\n```typescript\ninterface LinkedMentionsProps {\n  backlinks: GraphNode[];\n  onSelectBacklink: (id: string) =\u003e void;\n}\n```\n\n## Panel Sections\n1. **CONTEXT Header** (label)\n2. **Linked Mentions Card**: Shows notes referencing current note\n3. **Tasks Card**: Checkbox list (placeholder - shows \"No tasks\")\n4. **CALENDAR Header** (label)\n5. **Upcoming Card**: Date pills + events (placeholder)\n\n## Styling (ContextPanel.css.ts)\n\n```typescript\nexport const panel = style({\n  display: 'flex',\n  flexDirection: 'column',\n  height: '100%',\n  padding: vars.spacing['4'],\n  overflow: 'auto',\n});\n\nexport const sectionLabel = style({\n  fontSize: vars.typography.size.xs,\n  fontWeight: vars.typography.weight.medium,\n  color: vars.color.foregroundMuted,\n  textTransform: 'uppercase',\n  letterSpacing: '0.05em',\n  marginBottom: vars.spacing['3'],\n  marginTop: vars.spacing['6'],\n  \n  selectors: {\n    '\u0026:first-child': {\n      marginTop: 0,\n    },\n  },\n});\n\nexport const card = style({\n  backgroundColor: vars.color.background,\n  borderRadius: vars.radius.lg,\n  padding: vars.spacing['4'],\n  marginBottom: vars.spacing['3'],\n});\n\nexport const cardTitle = style({\n  fontSize: vars.typography.size.sm,\n  fontWeight: vars.typography.weight.medium,\n  color: vars.color.foreground,\n  marginBottom: vars.spacing['3'],\n});\n\nexport const backlinkItem = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['3'],\n  padding: vars.spacing['2'],\n  borderRadius: vars.radius.sm,\n  cursor: 'pointer',\n  transition: \\`background-color \\${vars.animation.duration.fast}\\`,\n  \n  ':hover': {\n    backgroundColor: vars.color.surface,\n  },\n});\n\nexport const backlinkIcon = style({\n  width: '24px',\n  height: '24px',\n  borderRadius: vars.radius.sm,\n  backgroundColor: vars.color.surface,\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  color: vars.color.foregroundMuted,\n});\n\nexport const emptyState = style({\n  fontSize: vars.typography.size.sm,\n  color: vars.color.foregroundMuted,\n  fontStyle: 'italic',\n});\n```\n\n## LinkedMentions Component\n- Uses existing graph.backlinks() API\n- Shows note icon + title for each backlink\n- Click navigates to that note\n- Empty state: \"No linked mentions\"\n\n## TasksWidget Component (Placeholder)\n- Static checkbox items with placeholder text\n- Shows \"No tasks\" empty state\n- Future: Extract checkboxes from note content\n\n## CalendarWidget Component (Placeholder)\n- Static date pills for \"Today\", \"Tomorrow\"\n- Static event items\n- Shows \"No upcoming events\" empty state\n- Future: Calendar integration\n\n## Acceptance Criteria\n- [ ] ContextPanel container with collapse animation\n- [ ] LinkedMentions shows backlinks from graph engine\n- [ ] Clicking backlink navigates to note\n- [ ] TasksWidget placeholder displays\n- [ ] CalendarWidget placeholder displays\n- [ ] Section labels styled correctly\n- [ ] Card styling using design tokens\n- [ ] Empty states for all sections\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 5)\n- redesign-poc/components/RightPanel.tsx","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-27T21:22:58.014842-06:00","updated_at":"2025-11-27T21:22:58.014842-06:00","dependencies":[{"issue_id":"redesign-16","depends_on_id":"redesign-4","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-16","depends_on_id":"redesign-9","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-17","title":"Restyle PersonMentionAutocomplete (@) to match floating menu design","description":"Update the existing PersonMentionAutocomplete to match the POC's floating menu design established by SlashMenu.\n\n## Files to Modify\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionAutocomplete.tsx\n- apps/desktop/renderer/src/components/Editor/plugins/PersonMentionAutocomplete.css.ts\n\n## Prerequisites\n- redesign-15 (SlashMenu) should be completed first to establish floating menu styling patterns\n\n## Design Goals\nMatch the visual style of SlashMenu:\n- Same border radius, shadow, and padding\n- Same item layout (icon + text)\n- Same hover and selected states\n- Same animation on appear (fadeIn)\n\n## IMPORTANT: Preserve Existing Functionality\nThis is a visual restyling ONLY. Do NOT change:\n- @ trigger detection logic\n- Keyboard navigation (arrows, tab, enter, escape)\n- Person search/lookup functionality\n- Person creation functionality\n- All tests must continue to pass\n\n## Visual Changes Required\n\n### Container\n```typescript\n// Match SlashMenu.css.ts menu style\nexport const dropdown = style({\n  position: 'absolute',\n  zIndex: vars.zIndex.popover,\n  minWidth: '200px',\n  maxWidth: '280px',\n  maxHeight: '300px',\n  overflow: 'auto',\n  \n  backgroundColor: vars.color.background,\n  borderRadius: vars.radius.lg,\n  boxShadow: vars.shadow.lg,\n  border: \\`1px solid \\${vars.color.border}\\`,\n  \n  animation: \\`\\${fadeIn} \\${vars.animation.duration.normal} \\${vars.animation.easing.default}\\`,\n});\n```\n\n### Items\n```typescript\nexport const item = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['3'],\n  padding: \\`\\${vars.spacing['2']} \\${vars.spacing['3']}\\`,\n  cursor: 'pointer',\n  transition: \\`background-color \\${vars.animation.duration.fast}\\`,\n  \n  ':hover': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\nexport const itemSelected = style({\n  backgroundColor: vars.color.surface,\n});\n\n// Person icon in colored circle (initials or person icon)\nexport const itemIcon = style({\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  width: '32px',\n  height: '32px',\n  borderRadius: vars.radius.full,\n  backgroundColor: vars.color.accent,\n  color: vars.color.accentForeground,\n  fontSize: vars.typography.size.sm,\n  fontWeight: vars.typography.weight.medium,\n});\n```\n\n### \"Create\" Option\n```typescript\nexport const createOption = style({\n  borderTop: \\`1px solid \\${vars.color.border}\\`,\n  marginTop: vars.spacing['2'],\n  paddingTop: vars.spacing['2'],\n});\n```\n\n## Implementation Steps\n1. Read SlashMenu.css.ts for reference styling\n2. Update PersonMentionAutocomplete.css.ts with new styles\n3. Import fadeIn keyframe from design-system or define locally\n4. Update component JSX to use new class names if structure changed\n5. Add person icon circle (can use initials like \"JS\" for John Smith)\n6. Run all existing tests: `bun test PersonMention`\n7. Manual testing of @ trigger and selection\n\n## Acceptance Criteria\n- [ ] Container styling matches SlashMenu (radius, shadow, animation)\n- [ ] Items have consistent layout with icon circle\n- [ ] Hover and selected states match SlashMenu\n- [ ] \"Create new person\" option styled distinctly\n- [ ] fadeIn animation on appear\n- [ ] Dark mode works correctly\n- [ ] ALL existing tests pass\n- [ ] Keyboard navigation still works\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 10)\n- redesign-15 (SlashMenu styling)","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-27T21:23:14.113169-06:00","updated_at":"2025-11-27T21:31:18.65097-06:00","dependencies":[{"issue_id":"redesign-17","depends_on_id":"redesign-4","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-17","depends_on_id":"redesign-15","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-18","title":"Restyle WikiLinkAutocomplete ([[) to match floating menu design","description":"Update the existing WikiLinkAutocomplete to match the POC's floating menu design established by SlashMenu.\n\n## Files to Modify\n- apps/desktop/renderer/src/components/Editor/plugins/WikiLinkAutocomplete.tsx\n- apps/desktop/renderer/src/components/Editor/plugins/WikiLinkAutocomplete.css.ts\n\n## Prerequisites\n- redesign-15 (SlashMenu) should be completed first to establish floating menu styling patterns\n\n## Design Goals\nMatch the visual style of SlashMenu and PersonMentionAutocomplete:\n- Same border radius, shadow, and padding\n- Same item layout (icon + text)\n- Same hover and selected states\n- Same animation on appear (fadeIn)\n\n## IMPORTANT: Preserve Existing Functionality\nThis is a visual restyling ONLY. Do NOT change:\n- [[ trigger detection logic\n- Keyboard navigation (arrows, enter, escape)\n- Note search/lookup functionality\n- Note creation functionality (\"Create new note\")\n- All tests must continue to pass\n\n## Visual Changes Required\n\n### Container\n```typescript\n// Match SlashMenu.css.ts menu style\nexport const dropdown = style({\n  position: 'absolute',\n  zIndex: vars.zIndex.popover,\n  minWidth: '200px',\n  maxWidth: '320px',\n  maxHeight: '300px',\n  overflow: 'auto',\n  \n  backgroundColor: vars.color.background,\n  borderRadius: vars.radius.lg,\n  boxShadow: vars.shadow.lg,\n  border: \\`1px solid \\${vars.color.border}\\`,\n  \n  animation: \\`\\${fadeIn} \\${vars.animation.duration.normal} \\${vars.animation.easing.default}\\`,\n});\n```\n\n### Items\n```typescript\nexport const item = style({\n  display: 'flex',\n  alignItems: 'center',\n  gap: vars.spacing['3'],\n  padding: \\`\\${vars.spacing['2']} \\${vars.spacing['3']}\\`,\n  cursor: 'pointer',\n  transition: \\`background-color \\${vars.animation.duration.fast}\\`,\n  \n  ':hover': {\n    backgroundColor: vars.color.backgroundAlt,\n  },\n});\n\nexport const itemSelected = style({\n  backgroundColor: vars.color.surface,\n});\n\n// File/note icon in rounded square\nexport const itemIcon = style({\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'center',\n  width: '32px',\n  height: '32px',\n  borderRadius: vars.radius.md, // Rounded square, not circle\n  backgroundColor: vars.color.surface,\n  color: vars.color.foregroundMuted,\n});\n\nexport const itemText = style({\n  flex: 1,\n  minWidth: 0, // Allow truncation\n  overflow: 'hidden',\n  textOverflow: 'ellipsis',\n  whiteSpace: 'nowrap',\n});\n```\n\n### \"Create\" Option\n```typescript\nexport const createOption = style({\n  borderTop: \\`1px solid \\${vars.color.border}\\`,\n  marginTop: vars.spacing['2'],\n  paddingTop: vars.spacing['2'],\n});\n\n// Plus icon or distinct styling for create\nexport const createIcon = style({\n  backgroundColor: vars.color.accent,\n  color: vars.color.accentForeground,\n});\n```\n\n## Implementation Steps\n1. Read SlashMenu.css.ts and PersonMentionAutocomplete.css.ts for reference\n2. Update WikiLinkAutocomplete.css.ts with new styles\n3. Import fadeIn keyframe from design-system or define locally\n4. Update component JSX to use new class names if structure changed\n5. Add file icon (📄 or use icon component) in rounded square\n6. Run all existing tests: `bun test WikiLink`\n7. Manual testing of [[ trigger and selection\n\n## Acceptance Criteria\n- [ ] Container styling matches SlashMenu (radius, shadow, animation)\n- [ ] Items have consistent layout with file icon\n- [ ] Hover and selected states match SlashMenu\n- [ ] \"Create new note\" option styled distinctly\n- [ ] fadeIn animation on appear\n- [ ] Dark mode works correctly\n- [ ] ALL existing tests pass\n- [ ] Keyboard navigation still works\n- [ ] Note title truncation works for long titles\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 11)\n- redesign-15 (SlashMenu styling)\n- redesign-17 (PersonMentionAutocomplete styling)","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-27T21:23:26.570602-06:00","updated_at":"2025-11-27T21:31:32.050486-06:00","dependencies":[{"issue_id":"redesign-18","depends_on_id":"redesign-4","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-18","depends_on_id":"redesign-15","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-2","title":"UI Redesign: Phase 2 - Core Navigation","description":"Core navigation components for the redesigned UI. These components form the primary navigation structure users will interact with daily.\n\n## Scope\n- Feature 3: Sidebar (Note List)\n- Feature 4: Floating Action Dock\n- Feature 6: Command Palette Redesign\n\n## Child Tasks (in suggested order)\n1. **redesign-10**: Create Sidebar component with note list (depends on redesign-9)\n2. **redesign-11**: Create FloatingDock component (depends on redesign-9)\n3. **redesign-12**: Redesign CommandPalette visual styling (depends on redesign-6)\n\n## Parallelization\n- All three tasks can be developed in parallel once their dependencies are met\n- redesign-10 and redesign-11 both depend on AppShell (redesign-9)\n- redesign-12 only depends on theme tokens (redesign-6)\n\n## Success Criteria\n- [ ] Left sidebar with note list, search, create functionality\n- [ ] Notes sorted by updatedAt, with relative timestamps\n- [ ] Theme toggle in sidebar footer\n- [ ] Floating dock with sidebar toggle, search (Cmd+K), and context panel toggle\n- [ ] Glassmorphism effect on dock\n- [ ] Command palette visually refreshed with new styling\n- [ ] All existing command palette tests pass\n- [ ] All existing palette modes still functional\n\n## Quick Start\n```bash\n# Check which Phase 2 tasks are ready\nbd list --json | jq '.[] | select(.id | startswith(\"redesign-1\")) | select(.status == \"open\")'\n\n# Verify dependencies\nbd dep tree redesign-10\nbd dep tree redesign-11\nbd dep tree redesign-12\n```\n\n## Reference\n- features/redesign/feature-breakdown.md (Features 3, 4, 6)\n- redesign-poc/components/Sidebar.tsx\n- redesign-poc/components/CommandPalette.tsx","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-27T21:18:44.344604-06:00","updated_at":"2025-11-27T21:55:28.691875-06:00","closed_at":"2025-11-27T21:55:28.691875-06:00","dependencies":[{"issue_id":"redesign-2","depends_on_id":"redesign-1","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-3","title":"UI Redesign: Phase 3 - Editor Enhancements","description":"Editor-focused enhancements that improve the writing experience with better formatting tools and inline commands.\n\n## Scope\n- Feature 7: Editor Title Input\n- Feature 8: Selection Toolbar\n- Feature 9: Slash Command Menu\n\n## Child Tasks (in suggested order)\n1. **[deleted:redesign-13]**: Add Editor title input above content (depends on redesign-6)\n2. **redesign-14**: Create SelectionToolbar floating menu (depends on redesign-6)\n3. **redesign-15**: Create SlashMenu command menu (depends on redesign-14 for styling patterns)\n\n## Parallelization\n- [deleted:redesign-13] and redesign-14 can be developed in parallel (both depend only on theme tokens)\n- redesign-15 should follow redesign-14 to reuse floating menu styling patterns\n\n## Success Criteria\n- [ ] Large serif title input above editor content with auto-resize\n- [ ] Title uses Merriweather font (vars.typography.fontFamily.serif)\n- [ ] Tab/Enter from title focuses editor\n- [ ] Selection toolbar appears on text selection with formatting buttons\n- [ ] Selection toolbar has fade+scale animation\n- [ ] Slash command menu triggered by '/' at start of line or after space\n- [ ] All formatting commands execute correctly in Lexical editor\n- [ ] Keyboard navigation works for both floating menus (arrows, enter, escape)\n- [ ] AI commands in slash menu show as placeholders\n\n## Technical Notes\n- Selection Toolbar and Slash Menu share similar floating UI patterns\n- Consider extracting shared positioning/animation logic to a hook or utility\n- Must integrate with existing Lexical editor configuration\n- Use editor.registerUpdateListener for selection changes\n\n## Quick Start\n```bash\n# Check dependencies for Phase 3 tasks\nbd dep tree [deleted:redesign-13]\nbd dep tree redesign-14\nbd dep tree redesign-15\n```\n\n## Reference\n- features/redesign/feature-breakdown.md (Features 7, 8, 9)\n- features/redesign/animations.md (Selection Toolbar, Floating Menus)\n- redesign-poc/components/Editor/FloatingMenu.tsx\n- redesign-poc/components/Editor/SelectionMenu.tsx","status":"open","priority":1,"issue_type":"epic","created_at":"2025-11-27T21:18:54.075256-06:00","updated_at":"2025-11-27T22:37:59.767799-06:00","dependencies":[{"issue_id":"redesign-3","depends_on_id":"redesign-1","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-4","title":"UI Redesign: Phase 4 - Context Panel \u0026 Polish","description":"Final phase including the right context panel and visual polish of existing autocomplete components.\n\n## Scope\n- Feature 5: Context Panel (Right Sidebar)\n- Feature 10: Mention Autocomplete (@) Restyle\n- Feature 11: Note Link Autocomplete ([[) Restyle\n\n## Child Tasks (in suggested order)\n1. **redesign-16**: Create ContextPanel right sidebar component (depends on redesign-9)\n2. **redesign-17**: Restyle PersonMentionAutocomplete (@) (depends on redesign-15 for styling patterns)\n3. **redesign-18**: Restyle WikiLinkAutocomplete ([[) (depends on redesign-15 for styling patterns)\n\n## Parallelization\n- redesign-16 can start as soon as AppShell is done (parallel with Phase 2/3 work)\n- redesign-17 and redesign-18 should wait for SlashMenu styling to ensure consistency\n- redesign-17 and redesign-18 can be done in parallel once SlashMenu is complete\n\n## Success Criteria\n- [ ] Context panel shows linked mentions (backlinks from graph engine)\n- [ ] Context panel includes tasks placeholder widget\n- [ ] Context panel includes calendar placeholder widget\n- [ ] Context panel collapse/expand animation matches sidebar\n- [ ] PersonMentionAutocomplete (@) restyled to match SlashMenu floating design\n- [ ] WikiLinkAutocomplete ([[) restyled to match SlashMenu floating design\n- [ ] All existing autocomplete functionality preserved\n- [ ] All existing tests pass\n\n## Notes on Placeholders\n- Tasks widget: Shows \"No tasks\" - checkbox extraction is future work\n- Calendar widget: Shows \"No upcoming events\" - calendar integration is out of scope\n\n## Quick Start\n```bash\n# Check dependencies for Phase 4 tasks\nbd dep tree redesign-16\nbd dep tree redesign-17\nbd dep tree redesign-18\n```\n\n## Reference\n- features/redesign/feature-breakdown.md (Features 5, 10, 11)\n- redesign-poc/components/RightPanel.tsx","status":"open","priority":2,"issue_type":"epic","created_at":"2025-11-27T21:19:03.443848-06:00","updated_at":"2025-11-27T21:30:57.67417-06:00","dependencies":[{"issue_id":"redesign-4","depends_on_id":"redesign-1","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-5","title":"Update design token contract with new tokens","description":"Extend the vanilla-extract theme contract to include new design tokens required for the redesign.\n\n## File\npackages/design-system/src/tokens/contract.css.ts\n\n## New Tokens to Add\n\n### Border Radius\n```typescript\nradius: {\n  // existing: none, sm, md, lg, full\n  xl: null,    // NEW: 1rem (16px) - for command palette, cards\n  '2xl': null, // NEW: 1.5rem (24px) - for large modals\n}\n```\n\n### Shadows\n```typescript\nshadow: {\n  // existing: sm, md, lg\n  xl: null,  // NEW: 0 20px 40px rgba(0,0,0,0.12) - floating dock\n}\n```\n\n### Typography\n```typescript\ntypography: {\n  fontFamily: {\n    // existing: ui, mono\n    serif: null, // NEW: for note titles (Merriweather)\n  }\n}\n```\n\n### Animation Tokens (NEW section)\n```typescript\nanimation: {\n  duration: {\n    fast: null,    // 150ms - micro-interactions\n    normal: null,  // 200ms - standard transitions\n    slow: null,    // 300ms - content transitions\n    slower: null,  // 500ms - layout changes\n  },\n  easing: {\n    default: null, // ease-out\n    smooth: null,  // cubic-bezier(0.32, 0.72, 0, 1) - sidebar\n  },\n}\n```\n\n## Implementation Steps\n1. Open packages/design-system/src/tokens/contract.css.ts\n2. Add `xl` and `'2xl'` to the existing `radius` object (after `lg`, before `full`)\n3. Add `xl` to the existing `shadow` object (after `lg`)\n4. Add `serif` to the existing `typography.fontFamily` object\n5. Add new `animation` object at the root level with `duration` and `easing` sub-objects\n6. Run `bun run typecheck` to verify ThemeVars type updates correctly\n\n## Verification\nAfter changes, the contract should include:\n- `vars.radius.xl` and `vars.radius['2xl']`\n- `vars.shadow.xl`\n- `vars.typography.fontFamily.serif`\n- `vars.animation.duration.fast/normal/slow/slower`\n- `vars.animation.easing.default/smooth`\n\n## Acceptance Criteria\n- [ ] radius.xl and radius.2xl added to contract\n- [ ] shadow.xl added to contract\n- [ ] fontFamily.serif added to contract\n- [ ] animation.duration tokens added (fast, normal, slow, slower)\n- [ ] animation.easing tokens added (default, smooth)\n- [ ] TypeScript compiles without errors (`bun run typecheck`)\n- [ ] ThemeVars type updated automatically (no manual changes needed)\n\n## Reference\n- features/redesign/color-palette.md (Additional Token Updates)\n- features/redesign/animations.md (Animation Tokens)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-27T21:19:21.286952-06:00","updated_at":"2025-11-27T21:34:06.59454-06:00","closed_at":"2025-11-27T21:34:06.59454-06:00","dependencies":[{"issue_id":"redesign-5","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-6","title":"Update light theme with cool neutral palette","description":"Update the light theme to use the new cool, neutral color palette.\n\n## File\npackages/design-system/src/themes/light.css.ts\n\n## Prerequisites\n- redesign-5 must be completed first (new tokens added to contract)\n\n## Color Changes (Old → New)\n\n| Token | Old (Warm) | New (Cool) |\n|-------|-----------|-----------|\n| background | #FAF9F7 (cream) | #FFFFFF (white) |\n| backgroundAlt | #F4F1EC (beige) | #F9FAFB (gray-50) |\n| surface | #EAE6DF (tan) | #F3F4F6 (gray-100) |\n| border | #D8D3CB (warm gray) | #E5E7EB (gray-200) |\n| foreground | #1E1C19 (warm black) | #111827 (gray-900) |\n| foregroundMuted | #7A756B (warm gray) | #6B7280 (gray-500) |\n| accent | #D9A441 (amber) | #111827 (black) |\n| accentForeground | #1E1C19 | #FFFFFF (white) |\n| danger | #B94A48 | #DC2626 |\n| dangerForeground | #FFFFFF | #FFFFFF (no change) |\n| warning | #E2A65C | #D97706 |\n| info | #50698C | #2563EB |\n\n## New Token Values to Add\n\n```typescript\nradius: {\n  // ... existing values\n  xl: '1rem',      // 16px\n  '2xl': '1.5rem', // 24px\n},\nshadow: {\n  // ... existing values\n  xl: '0 20px 40px rgba(0, 0, 0, 0.12)',\n},\ntypography: {\n  fontFamily: {\n    // ... existing values\n    serif: '\"Merriweather\", Georgia, serif',\n  },\n},\nanimation: {\n  duration: {\n    fast: '150ms',\n    normal: '200ms',\n    slow: '300ms',\n    slower: '500ms',\n  },\n  easing: {\n    default: 'ease-out',\n    smooth: 'cubic-bezier(0.32, 0.72, 0, 1)',\n  },\n},\n```\n\n## Implementation Steps\n1. Open packages/design-system/src/themes/light.css.ts\n2. Update all color values according to the table above\n3. Add the new radius, shadow, typography.fontFamily, and animation values\n4. Run `bun run typecheck` to verify no type errors\n5. Run the app to visually verify the new palette\n\n## Acceptance Criteria\n- [ ] All color tokens updated to new values\n- [ ] New radius tokens (xl, 2xl) populated\n- [ ] New shadow token (xl) populated\n- [ ] New font family token (serif) populated\n- [ ] Animation duration tokens populated\n- [ ] Animation easing tokens populated\n- [ ] TypeScript compiles without errors\n- [ ] Visual comparison matches spec in color-palette.md\n\n## Reference\n- features/redesign/color-palette.md (Light Theme section)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-27T21:19:34.865215-06:00","updated_at":"2025-11-27T21:34:07.786184-06:00","closed_at":"2025-11-27T21:34:07.786184-06:00","dependencies":[{"issue_id":"redesign-6","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-6","depends_on_id":"redesign-5","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-7","title":"Update dark theme with cool neutral palette","description":"Update the dark theme to use the new cool, neutral color palette (Tailwind zinc scale).\n\n## File\npackages/design-system/src/themes/dark.css.ts\n\n## Prerequisites\n- redesign-5 must be completed first (new tokens added to contract)\n\n## Color Values (New)\n\n| Token | Hex | Tailwind | Description |\n|-------|-----|----------|-------------|\n| background | #09090B | zinc-950 | Near-black, main app background |\n| backgroundAlt | #18181B | zinc-900 | Slightly lighter for sidebars |\n| surface | #27272A | zinc-800 | Interactive containers, hover states |\n| border | #3F3F46 | zinc-700 | Subtle borders |\n| foreground | #F4F4F5 | zinc-100 | Primary text, near-white |\n| foregroundMuted | #A1A1AA | zinc-400 | Secondary text |\n| accent | #FFFFFF | white | Primary actions (white, inverted) |\n| accentForeground | #09090B | zinc-950 | Text on accent backgrounds |\n| danger | #EF4444 | red-500 | Error states (brighter for dark) |\n| dangerForeground | #FFFFFF | white | Text on danger backgrounds |\n| warning | #F59E0B | amber-500 | Warning states |\n| info | #3B82F6 | blue-500 | Informational, links |\n\n## New Token Values\n\n```typescript\nradius: {\n  // ... existing values (same as light)\n  xl: '1rem',\n  '2xl': '1.5rem',\n},\nshadow: {\n  // ... existing values\n  xl: '0 20px 40px rgba(0, 0, 0, 0.24)', // NOTE: Darker for dark mode\n},\ntypography: {\n  fontFamily: {\n    // ... existing values\n    serif: '\"Merriweather\", Georgia, serif',\n  },\n},\nanimation: {\n  duration: {\n    fast: '150ms',\n    normal: '200ms',\n    slow: '300ms',\n    slower: '500ms',\n  },\n  easing: {\n    default: 'ease-out',\n    smooth: 'cubic-bezier(0.32, 0.72, 0, 1)',\n  },\n},\n```\n\n## Implementation Steps\n1. Open packages/design-system/src/themes/dark.css.ts\n2. Update all color values according to the table above\n3. Add the new radius, shadow (note: 0.24 opacity for dark), typography.fontFamily, and animation values\n4. Run `bun run typecheck` to verify no type errors\n5. Run the app and toggle to dark mode to visually verify\n\n## Important Note\nThe shadow.xl value differs from light theme:\n- Light: rgba(0, 0, 0, 0.12)\n- Dark: rgba(0, 0, 0, 0.24) - higher opacity for visibility on dark backgrounds\n\n## Acceptance Criteria\n- [ ] All color tokens updated to zinc scale values\n- [ ] Shadows adjusted for dark mode (higher opacity: 0.24 vs 0.12)\n- [ ] All new tokens populated (radius, typography, animation)\n- [ ] TypeScript compiles without errors\n- [ ] Visual comparison matches spec in color-palette.md\n\n## Reference\n- features/redesign/color-palette.md (Dark Theme section)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-27T21:19:44.765427-06:00","updated_at":"2025-11-27T21:34:08.892619-06:00","closed_at":"2025-11-27T21:34:08.892619-06:00","dependencies":[{"issue_id":"redesign-7","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-7","depends_on_id":"redesign-5","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-8","title":"Create vanilla-extract animation utilities","description":"Create reusable animation keyframes and utility styles using vanilla-extract.\n\n## File to Create\npackages/design-system/src/tokens/animations.css.ts\n\n## Prerequisites\n- redesign-5 must be completed first (animation tokens in contract)\n\n## Keyframes to Define\n\n### fadeIn\nUsed for: Editor content, floating menus\n```typescript\nexport const fadeIn = keyframes({\n  '0%': { opacity: 0 },\n  '100%': { opacity: 1 },\n});\n```\n\n### slideUp\nUsed for: Command palette, toasts\n```typescript\nexport const slideUp = keyframes({\n  '0%': { opacity: 0, transform: 'translateY(10px)' },\n  '100%': { opacity: 1, transform: 'translateY(0)' },\n});\n```\n\n### enter (composite)\nUsed for: Selection toolbar (fade + scale)\n```typescript\nexport const enter = keyframes({\n  from: {\n    opacity: 'var(--enter-opacity, 1)',\n    transform: 'scale3d(var(--enter-scale, 1), var(--enter-scale, 1), 1)',\n  },\n});\n```\n\n### spin\nUsed for: Loading spinners\n```typescript\nexport const spin = keyframes({\n  from: { transform: 'rotate(0deg)' },\n  to: { transform: 'rotate(360deg)' },\n});\n```\n\n## Utility Styles\n```typescript\nimport { style, keyframes, globalStyle } from '@vanilla-extract/css';\nimport { vars } from './contract.css';\n\nexport const animateFadeIn = style({\n  animation: \\`\\${fadeIn} \\${vars.animation.duration.normal} \\${vars.animation.easing.default} forwards\\`,\n});\n\nexport const animateSlideUp = style({\n  animation: \\`\\${slideUp} \\${vars.animation.duration.slow} \\${vars.animation.easing.default} forwards\\`,\n});\n\nexport const animateSpin = style({\n  animation: \\`\\${spin} 1s linear infinite\\`,\n});\n```\n\n## Reduced Motion Support\n```typescript\nglobalStyle('@media (prefers-reduced-motion: reduce)', {\n  '*': {\n    animationDuration: '0.01ms !important',\n    animationIterationCount: '1 !important',\n    transitionDuration: '0.01ms !important',\n  },\n});\n```\n\n## Implementation Steps\n1. Create packages/design-system/src/tokens/animations.css.ts\n2. Import keyframes and style from @vanilla-extract/css\n3. Import vars from ./contract.css\n4. Define all keyframes (fadeIn, slideUp, enter, spin)\n5. Create utility style classes\n6. Add reduced motion media query\n7. Update packages/design-system/src/index.ts to export animations\n8. Run `bun run typecheck` to verify\n\n## Export from index.ts\n```typescript\n// In packages/design-system/src/index.ts\nexport {\n  fadeIn,\n  slideUp,\n  enter,\n  spin,\n  animateFadeIn,\n  animateSlideUp,\n  animateSpin,\n} from './tokens/animations.css';\n```\n\n## Usage Example\n```typescript\n// In component file\nimport { fadeIn, vars } from '@scribe/design-system';\n\nexport const myFloatingMenu = style({\n  animation: \\`\\${fadeIn} \\${vars.animation.duration.normal} \\${vars.animation.easing.default}\\`,\n});\n```\n\n## Acceptance Criteria\n- [ ] animations.css.ts file created\n- [ ] fadeIn, slideUp, enter, spin keyframes defined\n- [ ] Utility styles created using animation tokens from contract\n- [ ] Reduced motion media query implemented\n- [ ] Exported from design-system package index\n- [ ] TypeScript compiles without errors\n\n## Reference\n- features/redesign/animations.md (Keyframe Animations, Accessibility)\n- features/redesign/feature-breakdown.md (references animation usage)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-27T21:19:57.684915-06:00","updated_at":"2025-11-27T21:35:35.912437-06:00","closed_at":"2025-11-27T21:35:35.912437-06:00","dependencies":[{"issue_id":"redesign-8","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-8","depends_on_id":"redesign-5","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
{"id":"redesign-9","title":"Create AppShell layout component","description":"Create the three-panel responsive layout shell that contains the sidebar, main content area, and context panel.\n\n## Files to Create\n```\napps/desktop/renderer/src/\n  layouts/\n    AppShell/\n      AppShell.tsx\n      AppShell.css.ts\n      index.ts\n```\n\n## Prerequisites\n- redesign-6 and redesign-7 must be completed (theme tokens available)\n\n## Component Props\n```typescript\ninterface AppShellProps {\n  sidebar?: ReactNode;\n  main: ReactNode;\n  contextPanel?: ReactNode;\n  sidebarOpen?: boolean;\n  contextPanelOpen?: boolean;\n  onToggleSidebar?: () =\u003e void;\n  onToggleContextPanel?: () =\u003e void;\n}\n```\n\n## Layout Specifications\n| Element | Width | Behavior |\n|---------|-------|----------|\n| Sidebar | 320px | Collapsible, slides left |\n| Main | Flexible | Centered content, max-width |\n| Context Panel | 320px | Collapsible, slides right |\n\n## Animation Specifications\n```css\n.sidebar, .context-panel {\n  transition: all 500ms cubic-bezier(0.32, 0.72, 0, 1);\n}\n\n/* Closed state - slides out with fade */\n.sidebar-closed {\n  width: 0;\n  opacity: 0;\n  transform: translateX(-40px);\n  overflow: hidden;\n}\n\n.context-panel-closed {\n  width: 0;\n  opacity: 0;\n  transform: translateX(40px);\n  overflow: hidden;\n}\n```\n\n## CSS Structure (AppShell.css.ts)\n```typescript\nimport { style } from '@vanilla-extract/css';\nimport { vars } from '@scribe/design-system';\n\nexport const container = style({\n  display: 'flex',\n  height: '100vh',\n  backgroundColor: vars.color.background,\n});\n\nexport const sidebar = style({\n  width: '320px',\n  flexShrink: 0,\n  transition: \\`all \\${vars.animation.duration.slower} \\${vars.animation.easing.smooth}\\`,\n  backgroundColor: vars.color.backgroundAlt,\n  borderRight: \\`1px solid \\${vars.color.border}\\`,\n  overflow: 'hidden',\n});\n\nexport const sidebarClosed = style({\n  width: 0,\n  opacity: 0,\n  transform: 'translateX(-40px)',\n});\n\nexport const main = style({\n  flex: 1,\n  display: 'flex',\n  flexDirection: 'column',\n  minWidth: 0, // Allow shrinking below content size\n  overflow: 'auto',\n});\n\nexport const contextPanel = style({\n  width: '320px',\n  flexShrink: 0,\n  transition: \\`all \\${vars.animation.duration.slower} \\${vars.animation.easing.smooth}\\`,\n  backgroundColor: vars.color.backgroundAlt,\n  borderLeft: \\`1px solid \\${vars.color.border}\\`,\n  overflow: 'hidden',\n});\n\nexport const contextPanelClosed = style({\n  width: 0,\n  opacity: 0,\n  transform: 'translateX(40px)',\n});\n```\n\n## Implementation Steps\n1. Create the directory structure: apps/desktop/renderer/src/layouts/AppShell/\n2. Create index.ts to export AppShell component\n3. Create AppShell.css.ts with the styles above\n4. Create AppShell.tsx component using clsx for conditional class composition\n5. Component should use `clsx(styles.sidebar, !sidebarOpen \u0026\u0026 styles.sidebarClosed)` pattern\n6. Update App.tsx to use AppShell, replacing current layout\n7. Add state for sidebarOpen/contextPanelOpen (default both true or sidebarOpen=true, contextPanelOpen=false)\n8. Preserve the titlebar drag region (-webkit-app-region: drag)\n\n## Integration with App.tsx\n```tsx\n// App.tsx\nconst [sidebarOpen, setSidebarOpen] = useState(true);\nconst [contextPanelOpen, setContextPanelOpen] = useState(false);\n\nreturn (\n  \u003cAppShell\n    sidebar={\u003cSidebar ... /\u003e}\n    main={\u003cEditorArea ... /\u003e}\n    contextPanel={\u003cContextPanel ... /\u003e}\n    sidebarOpen={sidebarOpen}\n    contextPanelOpen={contextPanelOpen}\n    onToggleSidebar={() =\u003e setSidebarOpen(prev =\u003e !prev)}\n    onToggleContextPanel={() =\u003e setContextPanelOpen(prev =\u003e !prev)}\n  /\u003e\n);\n```\n\n## Acceptance Criteria\n- [ ] AppShell component renders three-panel layout\n- [ ] Sidebar collapses/expands with smooth animation (500ms, smooth easing)\n- [ ] Context panel collapses/expands with smooth animation\n- [ ] Main content area is flexible and fills available space\n- [ ] Works with existing App.tsx (doesn't break current functionality)\n- [ ] Titlebar drag region preserved for macOS window dragging\n- [ ] Keyboard shortcuts for panel toggles can be added separately\n\n## Reference\n- features/redesign/feature-breakdown.md (Feature 2)\n- features/redesign/animations.md (Sidebar animations)\n- redesign-poc/App.tsx (for layout reference)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-27T21:20:13.708173-06:00","updated_at":"2025-11-27T21:36:43.703857-06:00","closed_at":"2025-11-27T21:36:43.703857-06:00","dependencies":[{"issue_id":"redesign-9","depends_on_id":"redesign-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-9","depends_on_id":"redesign-6","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""},{"issue_id":"redesign-9","depends_on_id":"redesign-7","type":"blocks","created_at":"0001-01-01T00:00:00Z","created_by":""}]}
