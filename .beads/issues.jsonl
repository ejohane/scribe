{"id":"scribe-1cc","title":"Write ShareMenu component tests","description":"Create comprehensive component tests for the ShareMenu to ensure correct behavior and prevent regressions.\n\n## Why This Matters\nComponent tests provide:\n1. Confidence that the component works correctly\n2. Documentation of expected behavior\n3. Protection against regressions\n4. Fast feedback during development\n\n## Files to Create\n- apps/desktop/renderer/src/components/ShareMenu/ShareMenu.test.tsx (NEW)\n\n## Test Cases from Spec\n\n### Rendering\n| Test | Action | Expected |\n|------|--------|----------|\n| Renders share button | Mount component | Button visible with share icon |\n| Button has aria-label | Mount component | aria-label='Share note' present |\n\n### Dropdown Behavior\n| Test | Action | Expected |\n|------|--------|----------|\n| Opens dropdown | Click button | Menu appears with 'Export to Markdown' |\n| Closes on outside click | Click outside | Menu closes |\n| Closes on Escape | Press Escape | Menu closes |\n| aria-expanded updates | Open/close menu | Attribute toggles |\n\n### Export Action\n| Test | Action | Expected |\n|------|--------|----------|\n| Calls export API | Click export option | window.scribe.export.toMarkdown called with noteId |\n| Shows loading state | During export | Button disabled |\n| Calls onExportSuccess | Export succeeds | Callback fired with filename |\n| Calls onExportError | Export fails | Callback fired with error message |\n| No callback on cancel | User cancels dialog | No callbacks fired |\n\n### Keyboard Navigation\n| Test | Action | Expected |\n|------|--------|----------|\n| Opens via keyboard | Focus + Enter | Menu opens |\n| Navigates with arrows | ArrowDown/Up | Focus moves between items |\n| Closes on Escape | Escape key | Menu closes, focus returns to button |\n| Activates with Enter | Enter on menu item | Item activated |\n\n## Test Setup\n```typescript\n// Mock window.scribe.export\nconst mockToMarkdown = vi.fn();\n\nbeforeEach(() =\u003e {\n  vi.resetAllMocks();\n  window.scribe = {\n    export: {\n      toMarkdown: mockToMarkdown,\n    },\n  } as unknown as ScribeAPI;\n});\n```\n\n## Testing Library\nUse @testing-library/react:\n- render() for mounting\n- screen for queries\n- userEvent for interactions\n- waitFor for async assertions\n\n## Acceptance Criteria\n- [ ] All test cases pass\n- [ ] Tests cover happy path and error cases\n- [ ] Keyboard navigation tested\n- [ ] Tests are readable and maintainable\n- [ ] No flaky tests","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T17:56:51.048305-06:00","updated_at":"2025-12-17T17:56:51.048305-06:00","dependencies":[{"issue_id":"scribe-1cc","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:56:56.252501-06:00","created_by":"daemon"},{"issue_id":"scribe-1cc","depends_on_id":"scribe-lra","type":"blocks","created_at":"2025-12-17T17:56:56.301209-06:00","created_by":"daemon"}]}
{"id":"scribe-1ra","title":"Write CLI export command tests","description":"Create unit tests for the CLI export subcommand to ensure correct behavior.\n\n## Why This Matters\nCLI commands are user-facing and must work correctly:\n1. Users rely on CLI for automation\n2. Breaking changes affect scripts\n3. Edge cases need coverage\n\n## Files to Create\n- apps/cli/tests/unit/notes-export.test.ts (NEW)\n\n## Test Cases from Spec\n\n| Test | Command | Assert |\n|------|---------|--------|\n| Exports to stdout | notes export abc-123 | Markdown in stdout, no JSON |\n| Exports to file | notes export abc-123 --output out.md | File created with content |\n| No frontmatter | notes export abc-123 --no-frontmatter | No YAML block in output |\n| Invalid note | notes export invalid-id | Error with appropriate message |\n| Includes frontmatter by default | notes export abc-123 | YAML block present |\n| File path resolution | notes export abc-123 --output ./relative.md | Resolves relative path |\n\n## Test Setup\n\n```typescript\nimport { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\nimport * as fs from 'node:fs/promises';\nimport path from 'path';\n\n// Mock vault\nconst mockVault = {\n  read: vi.fn(),\n};\n\n// Mock context initialization\nvi.mock('../context.js', () =\u003e ({\n  initializeContext: vi.fn().mockResolvedValue({\n    vault: mockVault,\n  }),\n}));\n\n// Test note\nconst testNote = {\n  id: 'abc-123',\n  title: 'Test Note',\n  content: { root: { children: [] } },\n  tags: ['test'],\n  createdAt: Date.now(),\n  updatedAt: Date.now(),\n};\n```\n\n## Testing Approach\n1. Mock vault.read() to return test notes\n2. Capture stdout for stdout tests\n3. Use temp files for file output tests\n4. Verify error handling\n\n## Acceptance Criteria\n- [ ] All test cases pass\n- [ ] stdout and file output modes tested\n- [ ] Error cases covered\n- [ ] Tests are isolated (no side effects)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T17:58:26.839166-06:00","updated_at":"2025-12-17T17:58:26.839166-06:00","dependencies":[{"issue_id":"scribe-1ra","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:58:58.701742-06:00","created_by":"daemon"},{"issue_id":"scribe-1ra","depends_on_id":"scribe-thw","type":"blocks","created_at":"2025-12-17T17:58:58.746925-06:00","created_by":"daemon"}]}
{"id":"scribe-40n","title":"Wire up toast notifications for export feedback","description":"Connect the export success/error callbacks to the existing toast notification system in the parent component.\n\n## Why This Matters\nUsers need feedback when export succeeds or fails:\n1. Success: 'Exported to filename.md' toast\n2. Error: 'Export failed: error message' toast\n\nWithout this, users have no idea if the export worked.\n\n## Background: Existing Toast System\nScribe already has a fully implemented toast system. No new toast code is needed.\n\n### Location\n- Hook: apps/desktop/renderer/src/hooks/useToast.ts\n- Component: apps/desktop/renderer/src/components/Toast/Toast.tsx\n\n### API\n```typescript\ninterface UseToastReturn {\n  toasts: Toast[];\n  showToast: (message: string, type?: 'success' | 'error') =\u003e void;\n  dismissToast: (id: string) =\u003e void;\n}\n```\n\n### Features\n- Auto-dismiss after 3 seconds\n- Success: polite live region, inverted colors\n- Error: assertive live region, danger colors\n- Already wired up in App.tsx\n\n## Files to Modify\n- The parent component that renders NoteHeader (likely App.tsx or a view component)\n\n## Implementation\n\nIn the parent component that renders NoteHeader:\n\n```tsx\nimport { useToast } from '../hooks/useToast';\n\nfunction NoteView() {\n  const { showToast } = useToast();\n  \n  const handleExportSuccess = useCallback((filename: string) =\u003e {\n    showToast(`Exported to ${filename}`, 'success');\n  }, [showToast]);\n  \n  const handleExportError = useCallback((error: string) =\u003e {\n    showToast(`Export failed: ${error}`, 'error');\n  }, [showToast]);\n  \n  return (\n    \u003cNoteHeader\n      note={currentNote}\n      onExportSuccess={handleExportSuccess}\n      onExportError={handleExportError}\n      // ... other props\n    /\u003e\n  );\n}\n```\n\n## Toast Messages\n- Success: 'Exported to {filename}' (e.g., 'Exported to meeting-notes.md')\n- Error: 'Export failed: {error}' (e.g., 'Export failed: Permission denied')\n\nNote: Filename is extracted in ShareMenu using path.split(/[\\/\\\\]/).pop()\n\n## Acceptance Criteria\n- [ ] Success toast shows on successful export\n- [ ] Error toast shows on failed export\n- [ ] Toast messages include relevant details\n- [ ] Toasts auto-dismiss after 3 seconds\n- [ ] No toast on cancelled export","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T17:57:35.593664-06:00","updated_at":"2025-12-17T17:57:35.593664-06:00","dependencies":[{"issue_id":"scribe-40n","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:57:40.802417-06:00","created_by":"daemon"},{"issue_id":"scribe-40n","depends_on_id":"scribe-j6r","type":"blocks","created_at":"2025-12-17T17:57:40.851273-06:00","created_by":"daemon"}]}
{"id":"scribe-4ks","title":"Implement basic Lexical node conversion (paragraphs, headings, lists)","description":"Implement the core Lexical to Markdown conversion for basic block-level nodes: paragraphs, headings, and lists.\n\n## Why This Matters\nThese are the most common node types in any note. Getting these right first provides immediate value and establishes the conversion pattern for other node types.\n\n## Files to Modify\n- packages/shared/src/content-extractor.ts\n\n## Lexical Node â†’ Markdown Conversion\n\n### Headings\n| Lexical Node | Output |\n|--------------|--------|\n| heading (h1) | # Heading |\n| heading (h2) | ## Heading |\n| heading (h3) | ### Heading |\n\n### Paragraphs\n- Plain text with blank line separation between paragraphs\n- Empty paragraphs preserved as blank lines\n\n### Lists\n| Lexical Node | Output |\n|--------------|--------|\n| listitem (unordered) | - item |\n| listitem (ordered) | 1. item |\n| listitem (checked) | - [x] task |\n| listitem (unchecked) | - [ ] task |\n| nested lists | Proper 2-space indentation |\n\n## Implementation Approach\n1. Parse Lexical JSON structure (root.children array)\n2. Recursively process each node by type\n3. Build output string with proper line breaks\n4. Handle nesting depth for lists\n\n## Edge Cases\n- Empty content (no children)\n- Deeply nested lists (3+ levels)\n- Mixed list types (ordered inside unordered)\n\n## Acceptance Criteria\n- [ ] H1, H2, H3 headings convert correctly\n- [ ] Paragraphs have proper spacing\n- [ ] Unordered lists use - prefix\n- [ ] Ordered lists use 1. 2. 3. numbering\n- [ ] Checklists use - [ ] and - [x] syntax\n- [ ] Nested lists indent correctly","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:42:27.281354-06:00","updated_at":"2025-12-17T06:42:27.281354-06:00","dependencies":[{"issue_id":"scribe-4ks","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:42:32.099252-06:00","created_by":"daemon"},{"issue_id":"scribe-4ks","depends_on_id":"scribe-77f","type":"blocks","created_at":"2025-12-17T06:42:32.148479-06:00","created_by":"daemon"}]}
{"id":"scribe-4wl","title":"Export extractMarkdown from shared package and update CLI re-export","description":"Make extractMarkdown available to consumers by exporting from packages/shared and updating the CLI to re-export it.\n\n## Why This Matters\nThe shared module is useless if it's not exported. Both the desktop app and CLI need access to extractMarkdown. The CLI already has a content-extractor.ts that exports extractPlainText - we need to add the new function alongside it.\n\n## Files to Modify\n1. packages/shared/src/index.ts - Add export\n2. apps/cli/src/content-extractor.ts - Re-export from shared\n\n## Implementation\n\n### packages/shared/src/index.ts\n```typescript\n// Add to existing exports\nexport { extractMarkdown, type MarkdownExportOptions } from './content-extractor.js';\n```\n\n### apps/cli/src/content-extractor.ts\nThe CLI already has extractPlainText here. Add:\n```typescript\n// Re-export from shared alongside existing extractPlainText\nexport { extractMarkdown } from '@scribe/shared';\n```\n\n## Verification Steps\n1. Build shared package: bun run build (in packages/shared)\n2. Verify export in dist: check index.d.ts includes extractMarkdown\n3. Build CLI: bun run build (in apps/cli)\n4. Verify CLI can import: add simple test import\n\n## Notes from Spec\n- The existing apps/cli/src/content-extractor.ts contains extractPlainText() \n- The new extractMarkdown() will be added to shared and re-exported alongside existing function\n\n## Acceptance Criteria\n- [ ] extractMarkdown exported from @scribe/shared\n- [ ] MarkdownExportOptions type exported\n- [ ] CLI can import extractMarkdown\n- [ ] Existing extractPlainText still works\n- [ ] Both packages build successfully","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:44:51.198183-06:00","updated_at":"2025-12-17T06:44:51.198183-06:00","dependencies":[{"issue_id":"scribe-4wl","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:44:56.491218-06:00","created_by":"daemon"},{"issue_id":"scribe-4wl","depends_on_id":"scribe-4ks","type":"blocks","created_at":"2025-12-17T06:44:56.540778-06:00","created_by":"daemon"},{"issue_id":"scribe-4wl","depends_on_id":"scribe-hzv","type":"blocks","created_at":"2025-12-17T06:44:56.587462-06:00","created_by":"daemon"},{"issue_id":"scribe-4wl","depends_on_id":"scribe-6xk","type":"blocks","created_at":"2025-12-17T06:44:56.635959-06:00","created_by":"daemon"},{"issue_id":"scribe-4wl","depends_on_id":"scribe-61y","type":"blocks","created_at":"2025-12-17T06:44:56.683931-06:00","created_by":"daemon"},{"issue_id":"scribe-4wl","depends_on_id":"scribe-ga2","type":"blocks","created_at":"2025-12-17T06:44:56.73318-06:00","created_by":"daemon"}]}
{"id":"scribe-60c","title":"Review and polish markdown-export spec","description":"Epic to track all findings from thorough review of features/markdown-export/spec.md. Covers gaps, inconsistencies, technical inaccuracies, and areas needing more context or polish.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-16T22:22:26.542958-06:00","updated_at":"2025-12-17T06:33:34.751768-06:00","closed_at":"2025-12-17T06:33:34.751768-06:00"}
{"id":"scribe-60c.1","title":"Fix cross-platform path handling in ShareMenu filename extraction","description":"In ShareMenu.tsx line 460, the code uses `result.filePath.split('/').pop()` to extract the filename. This will fail on Windows where the path separator is `\\`. \n\nThe renderer process doesn't have access to Node's `path.basename()`, so need an alternative solution:\n- Use a regex that handles both separators: `filePath.split(/[/\\\\]/).pop()`\n- Or pass the filename separately from the main process\n\nLocation: features/markdown-export/spec.md line 460 (ShareMenu component code)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T22:22:34.162512-06:00","updated_at":"2025-12-16T22:28:26.097989-06:00","closed_at":"2025-12-16T22:28:26.097989-06:00","dependencies":[{"issue_id":"scribe-60c.1","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:34.162874-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.10","title":"Add error handling for file permission errors","description":"The export handler (lines 329-335) has generic error handling but doesn't specifically handle permission errors. Users may select directories they don't have write access to.\n\nCurrent code:\n```typescript\n} catch (error) {\n  const message = error instanceof Error ? error.message : 'Unknown error';\n  return { success: false, error: `Failed to write file: ${message}` };\n}\n```\n\nShould add specific handling for:\n1. EACCES - Permission denied\n2. EROFS - Read-only file system\n3. ENOSPC - No space left on device\n\nUser-friendly error messages would be better than raw system errors:\n- \"Permission denied. Try saving to a different location.\"\n- \"The disk is full. Free up space and try again.\"\n\nLocation: features/markdown-export/spec.md lines 329-335","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:23:27.244426-06:00","updated_at":"2025-12-16T22:43:27.887441-06:00","closed_at":"2025-12-16T22:43:27.887441-06:00","dependencies":[{"issue_id":"scribe-60c.10","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:27.244813-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.11","title":"Specify line ending format for exported Markdown","description":"The spec doesn't specify whether exported Markdown files should use:\n- LF (Unix-style: `\\n`)\n- CRLF (Windows-style: `\\r\\n`)\n- Platform-native line endings\n\nThis affects cross-platform compatibility. A Markdown file exported on Windows with CRLF may display differently in some tools on macOS/Linux.\n\nRecommendation: Use LF (`\\n`) consistently for all platforms because:\n1. Markdown parsers universally support LF\n2. Most modern editors handle LF fine on Windows\n3. Git's autocrlf setting can convert if needed\n4. It's the CommonMark spec's line ending\n\nShould add this to the Implementation Notes section.\n\nLocation: features/markdown-export/spec.md - Implementation Notes section (around line 198)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:31.770165-06:00","updated_at":"2025-12-17T06:33:10.722899-06:00","closed_at":"2025-12-17T06:33:10.722899-06:00","dependencies":[{"issue_id":"scribe-60c.11","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:31.770526-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.12","title":"Document handling of special Markdown characters in plain text","description":"The spec doesn't address how special Markdown characters in regular text content should be handled. For example:\n\nIf a note contains literal text like:\n- \"The price is $100 * 2 = $200\"\n- \"Use # to start a comment\"\n- \"The [brackets] are important\"\n\nThese could be misinterpreted as Markdown syntax:\n- `*` could start emphasis\n- `#` at line start could become a heading\n- `[brackets]` could become a broken link\n\nOptions to consider:\n1. Escape special characters: `\\*`, `\\#`, `\\[`\n2. Only escape when ambiguous (context-aware)\n3. Don't escape (preserve raw text, accept rendering differences)\n\nThe CommonMark spec defines which characters need escaping. This should be explicitly documented in the Content Conversion section.\n\nLocation: features/markdown-export/spec.md - Content Conversion section (around line 174)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:23:36.925181-06:00","updated_at":"2025-12-16T22:45:02.409119-06:00","closed_at":"2025-12-16T22:45:02.409119-06:00","dependencies":[{"issue_id":"scribe-60c.12","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:36.925552-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.13","title":"Add File Changes entry for test files","description":"The File Changes table (lines 99-114) lists all production code files but omits test files. The Testing Plan section references specific test file paths that should be included in the File Changes table for completeness:\n\nMissing test file entries:\n1. `packages/shared/src/content-extractor.test.ts` - **New** - Unit tests for content extractor\n2. `apps/desktop/renderer/src/components/ShareMenu/ShareMenu.test.tsx` - **New** - Component tests for ShareMenu\n3. `apps/desktop/electron/main/src/handlers/exportHandlers.test.ts` - **New** - Integration tests for export handler\n4. `apps/cli/tests/unit/notes-export.test.ts` or similar - **New** - CLI export tests\n\nAdding these ensures implementers know the full scope of files to create.\n\nLocation: features/markdown-export/spec.md lines 99-114","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:45.149142-06:00","updated_at":"2025-12-17T06:33:11.382962-06:00","closed_at":"2025-12-17T06:33:11.382962-06:00","dependencies":[{"issue_id":"scribe-60c.13","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:45.149538-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.14","title":"Verify file paths match actual project structure","description":"The spec references several file paths that need verification against the actual project structure. Some paths may not exist or may have different structures:\n\nPaths to verify:\n1. `apps/desktop/electron/main/src/handlers/` - Does this handlers directory exist? The spec assumes a handlers pattern that may not be established.\n\n2. `apps/desktop/electron/main/src/handlers/index.ts` - Assumes a barrel export file exists for handlers.\n\n3. `apps/desktop/renderer/src/components/NoteHeader/` - Does NoteHeader component exist? The spec modifies it but the component may have a different name or location.\n\n4. `apps/cli/src/content-extractor.ts` - Is there an existing content extractor in CLI to modify?\n\n5. `packages/shared/src/ipc-contract.ts` - Verify this file exists and contains the IPC_CHANNELS constant.\n\nShould examine actual project structure and update paths in spec accordingly.\n\nLocation: features/markdown-export/spec.md lines 99-114 (File Changes table)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T22:23:50.803022-06:00","updated_at":"2025-12-16T22:32:09.138028-06:00","closed_at":"2025-12-16T22:32:09.138028-06:00","dependencies":[{"issue_id":"scribe-60c.14","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:50.803393-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.15","title":"Clarify table formatting approach in Open Questions","description":"Clarified table formatting approach in Open Questions section with concrete example","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:56.896644-06:00","updated_at":"2025-12-17T06:33:12.223237-06:00","closed_at":"2025-12-17T06:33:12.223237-06:00","dependencies":[{"issue_id":"scribe-60c.15","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:56.897015-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.16","title":"Fix wiki-link capitalization inconsistency","description":"Minor inconsistency in wiki-link representation throughout the spec:\n\n- Goal #3 (line 18): \"wiki-links as `[[title]]`\" (lowercase)\n- Content Conversion table (line 188): \"wiki-link â†’ `[[Target Title]]`\" (Title Case)\n- Implementation Notes (line 203): \"Wiki-link titles are preserved as-is\"\n\nThe table shows \"Target Title\" with title case which might imply the title is transformed, but the implementation notes say titles are \"preserved as-is\".\n\nRecommendation: Update the Content Conversion table to show a more neutral example like `[[Meeting Notes]]` that doesn't imply any case transformation, and add a note that the title is preserved exactly as stored in the wiki-link node.\n\nLocation: features/markdown-export/spec.md lines 18, 188, 203","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-16T22:24:06.185802-06:00","updated_at":"2025-12-17T06:33:13.013829-06:00","closed_at":"2025-12-17T06:33:13.013829-06:00","dependencies":[{"issue_id":"scribe-60c.16","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:06.186195-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.17","title":"Document toast system dependency and useToast hook","description":"The spec assumes a toast notification system exists (line 648-665) with a `useToast` hook, but doesn't reference where this comes from or verify it exists.\n\nThe Toast Integration section shows:\n```typescript\nconst { showToast } = useToast();\nshowToast(`Exported to ${filename}`, 'success');\nshowToast(`Export failed: ${error}`, 'error');\n```\n\nMissing information:\n1. Where is `useToast` imported from? Is it `@scribe/design-system`? A local hook?\n2. What are the valid toast types? ('success', 'error', 'warning', 'info'?)\n3. How long do toasts display?\n4. Can toasts be dismissed?\n5. Does the toast system already exist or does it need to be created?\n\nIf the toast system doesn't exist, this becomes a dependency/blocker that should be noted in the Implementation Plan.\n\nLocation: features/markdown-export/spec.md lines 648-665","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:24:10.886339-06:00","updated_at":"2025-12-16T22:46:55.996851-06:00","closed_at":"2025-12-16T22:46:55.996851-06:00","dependencies":[{"issue_id":"scribe-60c.17","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:10.886753-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.18","title":"Add handling for file extension changes in save dialog","description":"The save dialog allows the user to change the filename including the extension. The spec doesn't address what happens if the user:\n\n1. Removes the `.md` extension entirely (saves as \"Meeting Notes\" with no extension)\n2. Changes the extension to something else (saves as \"Meeting Notes.txt\")\n3. Adds a double extension (saves as \"Meeting Notes.md.md\")\n\nOptions to consider:\n1. Always append `.md` if missing: `ensureExtension(filePath, '.md')`\n2. Trust the user's choice (they may want a different extension)\n3. Warn if extension is not `.md` but allow it\n\nThe `dialog.showSaveDialog` filters (lines 317-320) suggest Markdown as primary but allow \"All Files\", so users can bypass the extension.\n\nRecommendation: Document the expected behavior - probably option 2 (trust user) for flexibility, but this should be explicit.\n\nLocation: features/markdown-export/spec.md lines 315-322","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T22:24:16.872393-06:00","updated_at":"2025-12-17T06:33:13.706323-06:00","closed_at":"2025-12-17T06:33:13.706323-06:00","dependencies":[{"issue_id":"scribe-60c.18","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:16.872765-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.19","title":"Add encoding specification for exported files","description":"The spec doesn't explicitly specify the file encoding for exported Markdown. While the code shows `fs.writeFile(filePath, markdown, 'utf-8')` (line 330), this should be documented as a requirement.\n\nAdditionally, YAML frontmatter should ideally include encoding information or assume UTF-8. Some tools may have issues with non-ASCII characters if encoding isn't clear.\n\nRecommendations:\n1. Document that UTF-8 encoding is used (no BOM)\n2. Consider if a BOM should be optional for Windows compatibility\n3. Ensure the content extractor properly handles Unicode characters (emoji, international characters, etc.)\n4. Add a test case for notes with non-ASCII content\n\nLocation: features/markdown-export/spec.md - Implementation Notes section","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T22:24:27.634554-06:00","updated_at":"2025-12-17T06:33:14.641344-06:00","closed_at":"2025-12-17T06:33:14.641344-06:00","dependencies":[{"issue_id":"scribe-60c.19","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:27.634956-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.2","title":"Add consecutive dash cleanup in filename sanitization","description":"In exportHandlers.ts (spec line 309-312), the filename sanitization regex `replace(/[\u003c\u003e:\"/\\\\|?*]/g, '-')` replaces invalid characters with dashes, but a title like \"Meeting: Q\u0026A / Discussion\" would become \"Meeting- Q\u0026A - Discussion\" with potential consecutive dashes.\n\nShould add `.replace(/-+/g, '-')` to clean up multiple consecutive dashes:\n```typescript\nconst sanitizedTitle = note.title\n  .replace(/[\u003c\u003e:\"/\\\\|?*]/g, '-')\n  .replace(/-+/g, '-')  // Add this line\n  .replace(/\\s+/g, ' ')\n  .trim() || 'Untitled';\n```\n\nLocation: features/markdown-export/spec.md lines 309-313","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T22:22:37.76428-06:00","updated_at":"2025-12-16T22:33:25.863431-06:00","closed_at":"2025-12-16T22:33:25.863431-06:00","dependencies":[{"issue_id":"scribe-60c.2","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:37.764648-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.20","title":"Define behavior when vault.read fails vs note not found","description":"The export handler (lines 299-303) checks if a note exists:\n\n```typescript\nconst note = vault.read(noteId);\nif (!note) {\n  return { success: false, error: 'Note not found' };\n}\n```\n\nBut this doesn't distinguish between:\n1. Note doesn't exist (ID is invalid)\n2. Note exists but vault.read() failed (file corruption, disk error, etc.)\n\nIf `vault.read()` can throw exceptions, those aren't caught here. The error handling should be more explicit:\n\n```typescript\nlet note;\ntry {\n  note = vault.read(noteId);\n} catch (error) {\n  return { success: false, error: 'Failed to read note from vault' };\n}\nif (!note) {\n  return { success: false, error: 'Note not found' };\n}\n```\n\nShould clarify the vault.read() behavior and update error handling accordingly.\n\nLocation: features/markdown-export/spec.md lines 299-303","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:24:31.620506-06:00","updated_at":"2025-12-17T06:33:10.044383-06:00","closed_at":"2025-12-17T06:33:10.044383-06:00","dependencies":[{"issue_id":"scribe-60c.20","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:24:31.620877-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.3","title":"Replace emoji with icon from design system in ShareMenu","description":"The ShareMenu component uses an emoji `ðŸ“„` for the menu item icon (spec line 495). This has several issues:\n1. Inconsistent rendering across platforms/fonts\n2. May not be accessible to screen readers\n3. Project guidelines discourage emoji use unless explicitly requested\n\nThe spec comment on line 409 says \"(or import from design system)\" for icons. Should explicitly use a design system icon instead.\n\nRecommendation: Use a document/file icon from `@scribe/design-system/icons` or define a proper SVG icon component.\n\nLocation: features/markdown-export/spec.md line 495","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:41.289999-06:00","updated_at":"2025-12-16T22:34:51.732684-06:00","closed_at":"2025-12-16T22:34:51.732684-06:00","dependencies":[{"issue_id":"scribe-60c.3","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:41.290382-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.4","title":"Document the Note type fields and clarify 'type' field in frontmatter","description":"The spec has ambiguity around the Note type and frontmatter fields:\n\n1. The frontmatter example (line 169) shows `type: meeting` but this field is never defined in the `MarkdownExportOptions` interface or mentioned in the Goals section. Where does this come from? Is it a standard Note field?\n\n2. The API section imports `type { Note } from './types'` (line 128) but the IPC contract imports from `@scribe/shared`. These need to be consistent.\n\n3. The Note type's expected fields should be documented so implementers know what metadata is available for frontmatter.\n\nQuestions to resolve:\n- What fields does the Note type contain?\n- Is `type` a standard field on all notes?\n- Which fields should be included in frontmatter by default?\n\nLocation: features/markdown-export/spec.md lines 128, 159-171","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T22:22:50.257861-06:00","updated_at":"2025-12-16T22:30:18.028109-06:00","closed_at":"2025-12-16T22:30:18.028109-06:00","dependencies":[{"issue_id":"scribe-60c.4","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:50.25823-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.5","title":"Add missing imports to code snippets throughout spec","description":"Several code snippets are missing import statements, making them incomplete for copy-paste implementation:\n\n1. CLI command (lines 675-718):\n   - Missing: `import { extractMarkdown } from '@scribe/shared'`\n   - Missing: `import * as fs from 'node:fs/promises'`\n   - Missing: `import path from 'path'`\n   - Missing: `import { createNoteId } from '...'`\n   - `output()` function not imported or explained\n\n2. Handler code (line 277-338):\n   - `withEngines()` function is used but not explained - what is it and what does it return?\n   - `HandlerDependencies` type is referenced but not defined\n\n3. ShareMenu (lines 403-503):\n   - `window.scribe` TypeScript declaration not shown - how should it be typed?\n\nEach code snippet should either include all necessary imports or reference where they come from.\n\nLocation: features/markdown-export/spec.md lines 277-338, 675-718, 403-503","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:55.42621-06:00","updated_at":"2025-12-16T22:38:27.38078-06:00","closed_at":"2025-12-16T22:38:27.38078-06:00","dependencies":[{"issue_id":"scribe-60c.5","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:55.4266-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.6","title":"Verify design token names exist in design system","description":"Verified design token names against actual design system. Updated spec with correct token paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:22:59.469184-06:00","updated_at":"2025-12-16T22:40:30.751123-06:00","closed_at":"2025-12-16T22:40:30.751123-06:00","dependencies":[{"issue_id":"scribe-60c.6","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:22:59.46957-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.7","title":"Add keyboard shortcut for export functionality","description":"The spec doesn't mention any keyboard shortcut for exporting notes. Power users typically expect keyboard shortcuts for common actions.\n\nRecommendation: Add a keyboard shortcut such as:\n- macOS: Cmd+Shift+E\n- Windows/Linux: Ctrl+Shift+E\n\nThis should be documented in:\n1. The acceptance criteria (line 46-55)\n2. The ShareMenu component implementation\n3. The testing plan\n\nAlso consider whether the shortcut should:\n- Open the share menu, or\n- Directly trigger export (skip menu if only one export option)\n\nLocation: features/markdown-export/spec.md - User Stories section (line 39-68)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:10.065886-06:00","updated_at":"2025-12-17T06:33:15.430088-06:00","closed_at":"2025-12-17T06:33:15.430088-06:00","dependencies":[{"issue_id":"scribe-60c.7","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:10.06626-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.8","title":"Add accessibility considerations section","description":"Added comprehensive accessibility section to markdown-export spec covering screen reader support, focus management, keyboard navigation, color contrast requirements, and reduced motion preferences","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-16T22:23:14.777805-06:00","updated_at":"2025-12-16T22:42:13.437175-06:00","closed_at":"2025-12-16T22:42:13.437175-06:00","dependencies":[{"issue_id":"scribe-60c.8","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:14.778165-06:00","created_by":"daemon"}]}
{"id":"scribe-60c.9","title":"Clarify empty note test case expected behavior","description":"In the Testing Plan unit tests table (line 748), the \"Empty note\" test case has ambiguous expected output:\n\n| Test | Input | Expected Output |\n|------|-------|-----------------|\n| Empty note | Note with empty content | Empty string (or just frontmatter) |\n\nThe \"(or just frontmatter)\" makes this test case unclear. The behavior should be explicitly defined:\n\nOption A: Empty content returns empty string (no frontmatter)\nOption B: Empty content returns only frontmatter block\nOption C: Depends on `includeFrontmatter` option\n\nThis should align with the `MarkdownExportOptions.includeFrontmatter` option (default: true per line 131).\n\nRecommendation: If `includeFrontmatter: true`, return frontmatter even for empty notes. If `includeFrontmatter: false`, return empty string.\n\nLocation: features/markdown-export/spec.md line 748","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T22:23:20.187651-06:00","updated_at":"2025-12-17T06:33:16.236178-06:00","closed_at":"2025-12-17T06:33:16.236178-06:00","dependencies":[{"issue_id":"scribe-60c.9","depends_on_id":"scribe-60c","type":"parent-child","created_at":"2025-12-16T22:23:20.188078-06:00","created_by":"daemon"}]}
{"id":"scribe-61y","title":"Implement YAML frontmatter generation","description":"Generate YAML frontmatter with note metadata for Markdown exports.\n\n## Why This Matters\nFrontmatter enables:\n1. Re-import into Obsidian, Notion, Jekyll, etc.\n2. Preservation of metadata that isn't visible in content\n3. Machine-readable note properties for scripting\n\n## Files to Modify\n- packages/shared/src/content-extractor.ts\n\n## Frontmatter Format\n```yaml\n---\ntitle: \"Meeting with Alice\"\ntags:\n  - work\n  - 1on1\ncreated: 2025-12-15T10:30:00.000Z\nupdated: 2025-12-15T11:45:00.000Z\ntype: meeting\n---\n```\n\n## Field Mapping\n\n| Frontmatter Field | Note Field | Description |\n|-------------------|------------|-------------|\n| title | Note.title | User-editable title |\n| tags | Note.tags | Array of strings (no # prefix) |\n| created | Note.createdAt | Milliseconds â†’ ISO-8601 |\n| updated | Note.updatedAt | Milliseconds â†’ ISO-8601 |\n| type | Note.type | Only if not undefined (regular note) |\n\n## Implementation Details\n- Convert timestamps from milliseconds to ISO-8601 strings\n- Strip # prefix from tags if present\n- Omit type field for regular notes (type: undefined)\n- Quote title if it contains special YAML characters\n- Handle empty tags array (omit or empty array?)\n\n## Note Types in Frontmatter\n- person, project, meeting, daily, template (include)\n- undefined (regular note - omit type field)\n\n## Edge Cases\n- Title with colons, quotes, newlines\n- Empty tags array\n- Very long titles\n- Unicode in title/tags\n\n## Acceptance Criteria\n- [ ] Frontmatter wrapped in --- delimiters\n- [ ] Title properly quoted/escaped\n- [ ] Tags as YAML array\n- [ ] Dates in ISO-8601 format\n- [ ] Type only included for non-regular notes\n- [ ] Valid YAML syntax (parseable)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:43:21.268883-06:00","updated_at":"2025-12-17T06:43:21.268883-06:00","dependencies":[{"issue_id":"scribe-61y","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:43:25.643906-06:00","created_by":"daemon"},{"issue_id":"scribe-61y","depends_on_id":"scribe-77f","type":"blocks","created_at":"2025-12-17T06:43:25.692542-06:00","created_by":"daemon"}]}
{"id":"scribe-6xk","title":"Implement special nodes (wiki-links, mentions, blockquotes, code blocks, tables, hr)","description":"Implement conversion for Scribe-specific and complex Lexical nodes: wiki-links, person mentions, blockquotes, code blocks, tables, and horizontal rules.\n\n## Why This Matters\nThese special nodes are what make Scribe unique. Wiki-links and mentions are core to the note-linking experience. Preserving them in a compatible format (Obsidian-style [[brackets]]) enables interoperability with other tools.\n\n## Files to Modify\n- packages/shared/src/content-extractor.ts\n\n## Node Conversion Table\n\n| Lexical Node | Markdown Output | Notes |\n|--------------|-----------------|-------|\n| wiki-link | [[Meeting Notes]] | Preserve title exactly as stored |\n| person-mention | @Person Name | Space after @ |\n| quote | \u003e quoted text | Single \u003e per line |\n| code (block) | ```\\ncode\\n``` | Triple backticks, optional lang |\n| horizontalrule | --- | Three dashes |\n| table | Pipe table | See table format below |\n\n## Table Format (MVP)\nSimple pipe syntax without alignment markers:\n```markdown\n| Name | Status | Notes |\n|---|---|---|\n| Alice | Active |  |\n| Bob | Pending | Needs review |\n```\n\n- Include header separator row with dashes\n- No column alignment markers (:--- etc.)\n- Empty cells render as empty space\n\n## Implementation Approach\n1. Detect node type from Lexical JSON\n2. Extract relevant properties (title, text, language, etc.)\n3. Format according to CommonMark/GFM spec\n4. Handle nested content in blockquotes\n\n## Edge Cases\n- Wiki-links with special characters in title\n- Multi-line blockquotes\n- Code blocks with backticks in content\n- Tables with varying column counts\n\n## Acceptance Criteria\n- [ ] Wiki-links render as [[title]]\n- [ ] Mentions render as @Name\n- [ ] Blockquotes use \u003e prefix per line\n- [ ] Code blocks use triple backticks\n- [ ] Tables have proper pipe format\n- [ ] Horizontal rules are ---","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:43:02.724201-06:00","updated_at":"2025-12-17T06:43:02.724201-06:00","dependencies":[{"issue_id":"scribe-6xk","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:43:07.725212-06:00","created_by":"daemon"},{"issue_id":"scribe-6xk","depends_on_id":"scribe-77f","type":"blocks","created_at":"2025-12-17T06:43:07.774631-06:00","created_by":"daemon"}]}
{"id":"scribe-77f","title":"Create content-extractor.ts scaffold in packages/shared","description":"Create the foundational content-extractor.ts file in packages/shared/src/ with the basic structure, types, and API signature.\n\n## Why This Matters\nThis is the foundation for ALL export functionality. Both desktop and CLI will depend on this shared module. Creating a clean, well-typed scaffold first ensures consistent API across consumers.\n\n## Files to Create/Modify\n- packages/shared/src/content-extractor.ts (NEW)\n\n## Implementation Details\n\n### Types to Define\n```typescript\nexport interface MarkdownExportOptions {\n  includeFrontmatter?: boolean;  // default: true\n  includeTitle?: boolean;        // default: false\n}\n```\n\n### Function Signature\n```typescript\nexport function extractMarkdown(note: Note, options?: MarkdownExportOptions): string;\n```\n\n### Key Imports\n- Import Note, NoteType from './types.js' (relative, same package)\n\n## Notes from Spec\n- The Note type is a discriminated union with BaseNote fields (id, title, createdAt, updatedAt, tags, content, metadata)\n- NoteType can be: undefined (regular), 'person', 'project', 'meeting', 'daily', 'template', 'system'\n- Content is Lexical JSON format (EditorContent)\n\n## Acceptance Criteria\n- [ ] File created with proper TypeScript types\n- [ ] Function signature matches spec\n- [ ] File compiles without errors\n- [ ] Proper JSDoc comments documenting the API","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:42:10.302364-06:00","updated_at":"2025-12-17T06:42:10.302364-06:00","dependencies":[{"issue_id":"scribe-77f","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:42:14.576447-06:00","created_by":"daemon"}]}
{"id":"scribe-b7c","title":"Add export IPC channel and types to ipc-contract.ts","description":"Define the IPC channel constant and TypeScript types for the export functionality in the shared IPC contract.\n\n## Why This Matters\nThe IPC contract is the bridge between renderer and main process. Without proper types:\n1. No type safety across the Electron boundary\n2. Inconsistent API between preload and handlers\n3. Runtime errors that could be caught at compile time\n\n## Files to Modify\n- packages/shared/src/ipc-contract.ts\n\n## Implementation\n\n### Add IPC Channel\n```typescript\nexport const IPC_CHANNELS = {\n  // ... existing channels (PING, NOTES_*, SEARCH_*, GRAPH_*, etc.) ...\n  \n  // Export - add this new channel\n  EXPORT_TO_MARKDOWN: 'export:toMarkdown',\n} as const;\n```\n\n### Add Types\n```typescript\n/**\n * Result of an export operation\n */\nexport interface ExportResult {\n  /** Whether the export succeeded */\n  success: boolean;\n  /** Path where file was saved (if successful and not cancelled) */\n  filePath?: string;\n  /** Whether the user cancelled the save dialog */\n  cancelled?: boolean;\n  /** Error message if export failed */\n  error?: string;\n}\n\n/**\n * Export API for saving notes to external formats\n */\nexport interface ExportAPI {\n  /**\n   * Export a note to Markdown format.\n   * Opens a native file save dialog for the user to choose the destination.\n   * \n   * @param noteId - ID of the note to export\n   * @returns Export result with file path or cancellation status\n   */\n  toMarkdown(noteId: NoteId): Promise\u003cExportResult\u003e;\n}\n```\n\n### Update ScribeAPI\n```typescript\nexport interface ScribeAPI {\n  // ... existing APIs (notes, search, graph, shell, app, people, daily, meeting) ...\n  \n  /** Export notes to external formats */\n  export: ExportAPI;\n}\n```\n\n## Design Decisions\n- ExportResult uses success boolean + optional fields (not discriminated union)\n- cancelled is separate from success (cancelled is not a failure)\n- filePath only present on successful, non-cancelled export\n- error only present on failure\n\n## Acceptance Criteria\n- [ ] EXPORT_TO_MARKDOWN channel added\n- [ ] ExportResult interface defined\n- [ ] ExportAPI interface defined\n- [ ] ScribeAPI updated with export property\n- [ ] Types are exported from package\n- [ ] Package builds without errors","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:49:22.626007-06:00","updated_at":"2025-12-17T06:49:22.626007-06:00","dependencies":[{"issue_id":"scribe-b7c","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:49:27.003428-06:00","created_by":"daemon"}]}
{"id":"scribe-c05","title":"Create export handler in main process","description":"Implement the main process IPC handler for exporting notes to Markdown with native save dialog.\n\n## Why This Matters\nThe main process handler is where the actual export logic runs. It has access to:\n1. The vault (to read notes)\n2. Electron's dialog API (for native save picker)\n3. Node.js fs (for file writing)\n\nThe renderer can't do any of this directly due to Electron's security model.\n\n## Files to Create/Modify\n- apps/desktop/electron/main/src/handlers/exportHandlers.ts (NEW)\n- apps/desktop/electron/main/src/handlers/index.ts (modify to register)\n\n## Implementation Overview\n\n### exportHandlers.ts\n```typescript\nimport { ipcMain, dialog } from 'electron';\nimport * as fs from 'node:fs/promises';\nimport { IPC_CHANNELS, type NoteId, type ExportResult } from '@scribe/shared';\nimport { extractMarkdown } from '@scribe/shared';\nimport { HandlerDependencies, withEngines } from './types';\n\nexport function setupExportHandlers(deps: HandlerDependencies): void {\n  ipcMain.handle(\n    IPC_CHANNELS.EXPORT_TO_MARKDOWN,\n    async (_event, noteId: NoteId): Promise\u003cExportResult\u003e =\u003e {\n      // Implementation here\n    }\n  );\n}\n```\n\n### Handler Logic Flow\n1. Get vault from dependencies via withEngines()\n2. Read note from vault (throws ScribeError if not found)\n3. Convert to Markdown with extractMarkdown()\n4. Sanitize filename (remove invalid chars: \u003c\u003e:\"/\\|?*)\n5. Show native save dialog with defaultPath\n6. If cancelled, return { success: true, cancelled: true }\n7. Write file to disk\n8. Return { success: true, filePath }\n\n### Error Handling\n- Note not found: return { success: false, error: 'Note not found' }\n- File write errors:\n  - EACCES: 'Permission denied. Try saving to a different location.'\n  - EROFS: 'Cannot save to a read-only file system.'\n  - ENOSPC: 'The disk is full. Free up space and try again.'\n  - Other: Generic fallback message\n\n### vault.read() Behavior (Critical!)\nvault.read(noteId) THROWS ScribeError if not found. It does NOT return null.\nUse try/catch, not null check:\n```typescript\nlet note;\ntry {\n  note = vault.read(noteId);\n} catch (error) {\n  return { success: false, error: 'Note not found' };\n}\n```\n\n### Save Dialog Options\n```typescript\nconst { canceled, filePath } = await dialog.showSaveDialog({\n  defaultPath: `${sanitizedTitle}.md`,\n  filters: [\n    { name: 'Markdown', extensions: ['md'] },\n    { name: 'All Files', extensions: ['*'] },\n  ],\n  properties: ['createDirectory', 'showOverwriteConfirmation'],\n});\n```\n\n## Registration in index.ts\n```typescript\nexport { setupExportHandlers } from './exportHandlers';\n```\n\nThen in main.ts call setupExportHandlers(deps).\n\n## Acceptance Criteria\n- [ ] Handler responds to EXPORT_TO_MARKDOWN channel\n- [ ] Reads note from vault correctly\n- [ ] Converts to Markdown with frontmatter\n- [ ] Shows native save dialog\n- [ ] Handles cancel gracefully\n- [ ] Writes file to disk\n- [ ] Returns proper ExportResult\n- [ ] Error handling for all failure modes","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:49:48.193468-06:00","updated_at":"2025-12-17T06:49:48.193468-06:00","dependencies":[{"issue_id":"scribe-c05","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:49:52.71911-06:00","created_by":"daemon"},{"issue_id":"scribe-c05","depends_on_id":"scribe-b7c","type":"blocks","created_at":"2025-12-17T06:49:52.766852-06:00","created_by":"daemon"},{"issue_id":"scribe-c05","depends_on_id":"scribe-4wl","type":"blocks","created_at":"2025-12-17T06:49:52.812613-06:00","created_by":"daemon"}]}
{"id":"scribe-ga2","title":"Implement context-aware special character escaping","description":"Implement context-aware escaping for Markdown special characters in plain text content.\n\n## Why This Matters\nUsers may have typed characters like * _ # [ ] in their notes as literal text. Without proper escaping, these could be misinterpreted as Markdown formatting when the exported file is rendered. The goal is content fidelity: exported Markdown should render identically to the original Scribe note.\n\n## Files to Modify\n- packages/shared/src/content-extractor.ts\n\n## Characters Requiring Consideration\n| Character | Markdown Meaning | Example |\n|-----------|-----------------|---------|\n| * | Emphasis/bold | \"Price is $100 * 2\" |\n| _ | Emphasis/italic | \"Use snake_case\" |\n| # | Heading | \"Use # for comments\" |\n| [ ] | Link text | \"The [brackets] matter\" |\n| ` | Inline code | Already code |\n| \u003e | Blockquote | \"Use \u003e in email\" |\n| - + | List item | \"Temp is -5\" |\n| \\ | Escape char | \"C:\\Users\" |\n| | | Table cell | \"Use | separator\" |\n| ~ | Strikethrough | \"~100 items\" |\n\n## Escaping Strategy: Context-Aware (Recommended)\nEscape only when ambiguous to minimize visual noise.\n\n| Context | Rule | Example |\n|---------|------|---------|\n| * or _ at word boundary | Escape | \\*important\\* |\n| * or _ mid-word | No escape | snake_case |\n| # at line start | Escape | \\# comment |\n| # mid-line | No escape | Issue #123 |\n| [text] pattern | Escape [ | \\[brackets] |\n| \u003e at line start | Escape | \\\u003e quote |\n| - + * at line start + space | Escape | \\- item |\n| 1. at line start | Escape | 1\\. First |\n| | in table context | Escape | a \\| b |\n\n## Implementation\n```typescript\nfunction escapeMarkdownText(text: string, context: EscapeContext): string;\n\ninterface EscapeContext {\n  isLineStart: boolean;\n  isInTable: boolean;\n  isAtWordBoundary: boolean;\n}\n```\n\n## Edge Cases\n- Already-escaped content (user typed \\*): escape as \\\\*\n- Code blocks: no escaping (content is literal)\n- URLs in links: no escaping\n- Frontmatter: handled by YAML serialization\n\n## Acceptance Criteria\n- [ ] Word-boundary emphasis chars escaped\n- [ ] Mid-word chars preserved\n- [ ] Line-start list/heading chars escaped\n- [ ] Table pipes escaped in tables\n- [ ] Backslashes doubled\n- [ ] No over-escaping (readability preserved)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:43:43.971775-06:00","updated_at":"2025-12-17T06:43:43.971775-06:00","dependencies":[{"issue_id":"scribe-ga2","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:43:48.876628-06:00","created_by":"daemon"},{"issue_id":"scribe-ga2","depends_on_id":"scribe-77f","type":"blocks","created_at":"2025-12-17T06:43:48.924697-06:00","created_by":"daemon"}]}
{"id":"scribe-hzv","title":"Implement text formatting (bold, italic, code, strikethrough, links)","description":"Implement inline text formatting conversion from Lexical text nodes to Markdown syntax.\n\n## Why This Matters\nText formatting is essential for preserving the semantic meaning of notes. Bold, italic, and other formatting carry information that must be retained in the export.\n\n## Files to Modify\n- packages/shared/src/content-extractor.ts\n\n## Lexical Text Formatting â†’ Markdown\n\n### Format Flags (on text nodes)\n| Lexical Format | Markdown Output |\n|----------------|-----------------|\n| bold | **bold** |\n| italic | *italic* |\n| code | `code` |\n| strikethrough | ~~strikethrough~~ |\n\n### Combined Formatting\n- Bold + Italic: ***text***\n- Order matters for nesting: outer format wraps inner\n\n### Links\n| Lexical Node | Output |\n|--------------|--------|\n| link | [text](url) |\n| linebreak | \\n |\n\n## Implementation Approach\n1. Check text node's format bitmask/flags\n2. Apply formatting in consistent order (bold â†’ italic â†’ code â†’ strike)\n3. Handle link nodes specially (they contain child text)\n4. Preserve linebreaks as literal newlines\n\n## Edge Cases\n- Empty text with formatting\n- Multiple formats combined\n- Links with formatted text inside\n- Escaped characters in URLs\n\n## Acceptance Criteria\n- [ ] Bold text uses ** wrapper\n- [ ] Italic text uses * wrapper\n- [ ] Inline code uses backtick wrapper\n- [ ] Strikethrough uses ~~ wrapper\n- [ ] Combined formats nest correctly\n- [ ] Links render as [text](url)\n- [ ] Linebreaks produce newlines","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:42:43.326834-06:00","updated_at":"2025-12-17T06:42:43.326834-06:00","dependencies":[{"issue_id":"scribe-hzv","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:42:47.620957-06:00","created_by":"daemon"},{"issue_id":"scribe-hzv","depends_on_id":"scribe-77f","type":"blocks","created_at":"2025-12-17T06:42:47.66909-06:00","created_by":"daemon"}]}
{"id":"scribe-j6r","title":"Integrate ShareMenu into NoteHeader component","description":"Add the ShareMenu component to the NoteHeader to make the export functionality accessible from the note view.\n\n## Why This Matters\nWithout this integration:\n1. Users have no way to access the export feature\n2. The ShareMenu component exists but isn't rendered\n3. The feature is complete but invisible\n\n## Files to Modify\n- apps/desktop/renderer/src/components/NoteHeader/NoteHeader.tsx\n- apps/desktop/renderer/src/components/NoteHeader/NoteHeader.css.ts\n\n## Implementation\n\n### NoteHeader.tsx Changes\n\n1. Add import:\n```typescript\nimport { ShareMenu } from '../ShareMenu';\n```\n\n2. Extend props interface:\n```typescript\ninterface NoteHeaderProps {\n  note: Note;\n  onTitleChange: (title: string) =\u003e void;\n  onTagsChange: (tags: string[]) =\u003e void;\n  onDateClick?: (date: Date) =\u003e void;\n  translateY?: number;\n  // New props for export feedback\n  onExportSuccess?: (filename: string) =\u003e void;\n  onExportError?: (error: string) =\u003e void;\n}\n```\n\n3. Add ShareMenu to metadata row (after tags):\n```tsx\n\u003cdiv className={styles.metadataRow}\u003e\n  {/* Creation date */}\n  \u003cdiv className={styles.metadataItem}\u003e\n    \u003cbutton className={styles.dateButton} onClick={...}\u003e\n      {formatDate(note.createdAt)}\n    \u003c/button\u003e\n  \u003c/div\u003e\n  \n  {/* Tags */}\n  {(note.tags.length \u003e 0 || isAddingTag) \u0026\u0026 \u003cdiv className={styles.divider} /\u003e}\n  \u003cdiv className={styles.tagsContainer}\u003e\n    {/* ... existing tag rendering ... */}\n  \u003c/div\u003e\n  \n  {/* Share menu - new addition */}\n  \u003cdiv className={styles.shareMenuContainer}\u003e\n    \u003cShareMenu\n      noteId={note.id}\n      onExportSuccess={onExportSuccess}\n      onExportError={onExportError}\n    /\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n### NoteHeader.css.ts Changes\n\nAdd new style:\n```typescript\nexport const shareMenuContainer = style({\n  marginLeft: 'auto',  // Push to the right side of metadata row\n  paddingLeft: 8,\n});\n```\n\n## Visual Layout\nThe metadata row should look like:\n`[Date] | [Tags...] .......................... [Share]`\n\nThe share menu is right-aligned (marginLeft: auto) to appear at the end of the row.\n\n## Acceptance Criteria\n- [ ] ShareMenu imported in NoteHeader\n- [ ] Props interface extended\n- [ ] ShareMenu rendered in metadata row\n- [ ] Style pushes ShareMenu to right\n- [ ] Callbacks connected\n- [ ] Component renders without errors","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T17:57:13.378942-06:00","updated_at":"2025-12-17T17:57:13.378942-06:00","dependencies":[{"issue_id":"scribe-j6r","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:57:18.785045-06:00","created_by":"daemon"},{"issue_id":"scribe-j6r","depends_on_id":"scribe-o9i","type":"blocks","created_at":"2025-12-17T17:57:18.835231-06:00","created_by":"daemon"}]}
{"id":"scribe-lpp","title":"Write integration tests for export handler","description":"Create integration tests for the main process export handler to verify end-to-end behavior.\n\n## Why This Matters\nIntegration tests verify the handler works correctly with real dependencies:\n1. Vault reading\n2. Markdown conversion\n3. Save dialog interaction\n4. File writing\n\nUnit tests can't catch integration issues.\n\n## Files to Create\n- apps/desktop/electron/main/src/handlers/exportHandlers.test.ts (NEW)\n\n## Test Cases from Spec\n\n| Test | Setup | Action | Assert |\n|------|-------|--------|--------|\n| Exports valid note | Create note in vault | Call handler | Markdown contains content |\n| Includes frontmatter | Note with tags, dates | Call handler | YAML block present |\n| Sanitizes filename | Note with '/' in title | Call handler | Invalid chars removed from defaultPath |\n| Handles missing note | Invalid ID | Call handler | Returns { success: false, error: 'Note not found' } |\n| Returns cancelled | Mock dialog cancel | Call handler | Returns { success: true, cancelled: true } |\n| Handles write error | Mock fs.writeFile fail | Call handler | Returns { success: false, error: '...' } |\n| Permission denied | Mock EACCES error | Call handler | User-friendly error message |\n\n## Test Setup\n\n```typescript\nimport { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { dialog } from 'electron';\nimport * as fs from 'node:fs/promises';\n\n// Mock Electron dialog\nvi.mock('electron', () =\u003e ({\n  ipcMain: {\n    handle: vi.fn(),\n  },\n  dialog: {\n    showSaveDialog: vi.fn(),\n  },\n}));\n\n// Mock fs\nvi.mock('node:fs/promises', () =\u003e ({\n  writeFile: vi.fn(),\n}));\n\n// Mock vault\nconst mockVault = {\n  read: vi.fn(),\n};\n\nconst mockDeps = {\n  vault: mockVault,\n  // ... other deps\n};\n```\n\n## Test Scenarios\n\n### Success Path\n```typescript\nit('exports note to file', async () =\u003e {\n  mockVault.read.mockReturnValue(testNote);\n  vi.mocked(dialog.showSaveDialog).mockResolvedValue({\n    canceled: false,\n    filePath: '/tmp/test.md',\n  });\n  vi.mocked(fs.writeFile).mockResolvedValue(undefined);\n\n  const result = await handler('note-id');\n\n  expect(result).toEqual({\n    success: true,\n    filePath: '/tmp/test.md',\n  });\n});\n```\n\n### Error Handling\n```typescript\nit('returns error for missing note', async () =\u003e {\n  mockVault.read.mockImplementation(() =\u003e {\n    throw new ScribeError('Not found', ErrorCode.NOTE_NOT_FOUND);\n  });\n\n  const result = await handler('invalid-id');\n\n  expect(result).toEqual({\n    success: false,\n    error: 'Note not found',\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] All test cases pass\n- [ ] Success path covered\n- [ ] Error cases covered\n- [ ] Dialog mocking works\n- [ ] File system mocking works","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T17:59:16.201323-06:00","updated_at":"2025-12-17T17:59:16.201323-06:00","dependencies":[{"issue_id":"scribe-lpp","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:59:27.192203-06:00","created_by":"daemon"},{"issue_id":"scribe-lpp","depends_on_id":"scribe-c05","type":"blocks","created_at":"2025-12-17T17:59:27.241236-06:00","created_by":"daemon"}]}
{"id":"scribe-lra","title":"Implement ShareMenu accessibility and keyboard navigation","description":"Add full accessibility support and keyboard navigation to the ShareMenu component per WCAG 2.1 AA requirements.\n\n## Why This Matters\nExport functionality must be usable by everyone, including:\n1. Screen reader users\n2. Keyboard-only users\n3. Users with reduced motion preferences\n4. Users who rely on high contrast\n\nWithout accessibility, we exclude a significant portion of users.\n\n## Files to Modify\n- apps/desktop/renderer/src/components/ShareMenu/ShareMenu.tsx\n- apps/desktop/renderer/src/components/ShareMenu/ShareMenu.css.ts\n\n## ARIA Attributes Required\n\n### Share Button\n```tsx\n\u003cbutton\n  aria-label=\"Share note\"\n  aria-haspopup=\"true\"\n  aria-expanded={isOpen}\n  title=\"Share\"\n\u003e\n```\n\n### Dropdown Menu\n```tsx\n\u003cdiv role=\"menu\"\u003e\n  \u003cbutton role=\"menuitem\"\u003eExport to Markdown\u003c/button\u003e\n\u003c/div\u003e\n```\n\n## Keyboard Navigation\n\n| Key | Action |\n|-----|--------|\n| Tab | Focus share button |\n| Enter/Space | Toggle menu open/close |\n| Arrow Down | Move to next menu item (wrap) |\n| Arrow Up | Move to previous menu item (wrap) |\n| Home | Move to first menu item |\n| End | Move to last menu item |\n| Enter/Space | Activate focused item |\n| Escape | Close menu, return focus to button |\n| Tab | Close menu, move to next element |\n\n## Focus Management\n1. When menu opens, focus moves to first menu item\n2. When menu closes via Escape, focus returns to button\n3. When menu closes via selection, focus returns to button\n4. When menu closes via outside click, focus stays where clicked\n5. Focus trap: Tab cycles within open menu\n\n## Implementation\n```typescript\nconst handleKeyDown = (event: KeyboardEvent) =\u003e {\n  switch (event.key) {\n    case 'ArrowDown':\n      event.preventDefault();\n      focusNextItem();\n      break;\n    case 'ArrowUp':\n      event.preventDefault();\n      focusPreviousItem();\n      break;\n    case 'Home':\n      event.preventDefault();\n      focusFirstItem();\n      break;\n    case 'End':\n      event.preventDefault();\n      focusLastItem();\n      break;\n    case 'Escape':\n      closeMenu();\n      triggerRef.current?.focus();\n      break;\n    case 'Enter':\n    case ' ':\n      event.preventDefault();\n      activateFocusedItem();\n      break;\n  }\n};\n```\n\n## Reduced Motion Support\n```typescript\n// In ShareMenu.css.ts\nexport const dropdown = style({\n  // ... other styles ...\n  \n  '@media': {\n    '(prefers-reduced-motion: reduce)': {\n      transition: 'none',\n      animation: 'none',\n    },\n  },\n});\n```\n\n## Focus Indicators\n- All interactive elements must have visible focus ring\n- Use outline (not border) to avoid layout shift\n- Recommended: outline: 2px solid var(--focus-color); outline-offset: 2px;\n\n## Color Contrast\nAll text must meet 4.5:1 contrast ratio:\n- Menu item text vs surface background\n- Muted icon vs background\n- Focus indicator vs adjacent colors\n\n## Acceptance Criteria\n- [ ] Screen reader announces button, menu items, expanded state\n- [ ] Full keyboard navigation works\n- [ ] Focus management is correct\n- [ ] Reduced motion disables animations\n- [ ] Focus indicators are visible\n- [ ] Passes axe DevTools audit","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T17:56:23.573846-06:00","updated_at":"2025-12-17T17:56:23.573846-06:00","dependencies":[{"issue_id":"scribe-lra","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:56:32.493577-06:00","created_by":"daemon"},{"issue_id":"scribe-lra","depends_on_id":"scribe-o9i","type":"blocks","created_at":"2025-12-17T17:56:32.541027-06:00","created_by":"daemon"}]}
{"id":"scribe-mwt","title":"Markdown Export Feature","description":"Allow users to export individual notes from Scribe as standalone Markdown files. Desktop app provides ShareMenu in note header with native file picker and toast notifications. CLI supports export to stdout or file. See features/markdown-export/spec.md for full specification.\n\n## Goals\n1. Export single note to .md file with all content preserved\n2. Include YAML frontmatter with metadata (title, tags, dates, type)\n3. Preserve wiki-links as [[title]] and mentions as @name\n4. Native OS file picker for destination selection\n5. Toast notifications for user feedback\n6. CLI support for automation/scripting\n\n## Architecture Overview\n- Shared module: packages/shared/src/content-extractor.ts\n- IPC: New EXPORT_TO_MARKDOWN channel in ipc-contract.ts\n- Main process: exportHandlers.ts with save dialog\n- Preload: Export namespace in scribeAPI\n- UI: ShareMenu component in NoteHeader\n- CLI: export subcommand in notes.ts\n\n## Non-Goals (Out of Scope)\n- Batch export of multiple notes\n- Export to formats other than Markdown\n- Asset/attachment export\n- Configurable frontmatter fields\n- Clipboard copy","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-17T06:41:58.749257-06:00","updated_at":"2025-12-17T06:41:58.749257-06:00"}
{"id":"scribe-mwt.1","title":"Add global keyboard shortcut (Cmd/Ctrl+Shift+E) to open ShareMenu","description":"Implement the global keyboard shortcut Cmd+Shift+E (macOS) / Ctrl+Shift+E (Windows/Linux) to open the ShareMenu from anywhere in the note view.\n\n## Why This Matters\nThis is a user acceptance criterion from the spec:\n\u003e \"I can press Cmd+Shift+E (macOS) or Ctrl+Shift+E (Windows/Linux) to open the share menu\"\n\nPower users expect keyboard shortcuts for common actions.\n\n## Files to Modify\n- apps/desktop/renderer/src/components/NoteHeader/NoteHeader.tsx (or parent component)\n- Possibly a keyboard shortcut hook if one exists\n\n## Implementation Options\n\n### Option 1: useEffect in NoteHeader/Parent\n```typescript\nuseEffect(() =\u003e {\n  const handleKeyDown = (e: KeyboardEvent) =\u003e {\n    const isMac = navigator.platform.toUpperCase().indexOf('MAC') \u003e= 0;\n    const modifier = isMac ? e.metaKey : e.ctrlKey;\n    \n    if (modifier \u0026\u0026 e.shiftKey \u0026\u0026 e.key === 'E') {\n      e.preventDefault();\n      // Toggle ShareMenu open state\n      setShareMenuOpen(true);\n    }\n  };\n  \n  window.addEventListener('keydown', handleKeyDown);\n  return () =\u003e window.removeEventListener('keydown', handleKeyDown);\n}, []);\n```\n\n### Option 2: Check for existing hotkey system\nLook for existing patterns in the codebase (useHotkey, command palette, etc.)\n\n## State Management\nThe ShareMenu needs to expose a way to control its open state from parent:\n- Either: `isOpen` and `onOpenChange` props\n- Or: forward a ref with `open()` method\n\n## Acceptance Criteria\n- [ ] Cmd+Shift+E opens ShareMenu on macOS\n- [ ] Ctrl+Shift+E opens ShareMenu on Windows/Linux\n- [ ] Shortcut only works when a note is focused/visible\n- [ ] Shortcut doesn't conflict with other app shortcuts\n- [ ] Works when focus is in editor or elsewhere in note view","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T18:05:16.721558-06:00","updated_at":"2025-12-17T18:05:16.721558-06:00","dependencies":[{"issue_id":"scribe-mwt.1","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T18:05:16.721963-06:00","created_by":"daemon"},{"issue_id":"scribe-mwt.1","depends_on_id":"scribe-j6r","type":"blocks","created_at":"2025-12-17T18:05:20.892182-06:00","created_by":"daemon"}]}
{"id":"scribe-o7z","title":"Write comprehensive unit tests for content extractor","description":"Create thorough unit tests for the content extractor to ensure correct Markdown conversion for all node types and edge cases.\n\n## Why This Matters\nThe content extractor is the core of this feature. If it produces incorrect Markdown, the entire export is worthless. Comprehensive tests:\n1. Catch regressions as code evolves\n2. Document expected behavior\n3. Cover edge cases that might be missed in manual testing\n\n## Files to Create\n- packages/shared/src/content-extractor.test.ts (NEW)\n\n## Test Cases from Spec\n\n### Empty/Minimal Notes\n| Test | Input | Expected |\n|------|-------|----------|\n| Empty note (with frontmatter) | Empty content, includeFrontmatter: true | YAML frontmatter only |\n| Empty note (no frontmatter) | Empty content, includeFrontmatter: false | Empty string |\n\n### Headings\n| Test | Input | Expected |\n|------|-------|----------|\n| Heading H1 | Lexical heading h1 | # Heading |\n| Heading H2 | Lexical heading h2 | ## Heading |\n| Heading H3 | Lexical heading h3 | ### Heading |\n\n### Paragraphs\n| Test | Input | Expected |\n|------|-------|----------|\n| Single paragraph | One paragraph | Plain text |\n| Multiple paragraphs | Two paragraphs | Text with blank line between |\n\n### Lists\n| Test | Input | Expected |\n|------|-------|----------|\n| Unordered list | Lexical list items | - item1\\n- item2 |\n| Ordered list | Numbered list | 1. item1\\n2. item2 |\n| Checklist unchecked | Lexical checklist | - [ ] task |\n| Checklist checked | Lexical checklist | - [x] task |\n| Nested list | Nested items | Indented list items |\n\n### Text Formatting\n| Test | Input | Expected |\n|------|-------|----------|\n| Bold text | Text with bold flag | **bold** |\n| Italic text | Text with italic flag | *italic* |\n| Inline code | Text with code flag | `code` |\n| Strikethrough | Text with strike flag | ~~text~~ |\n| Combined formats | Bold+italic | ***text*** |\n\n### Links and Special Nodes\n| Test | Input | Expected |\n|------|-------|----------|\n| Wiki-link | Lexical wiki-link | [[Meeting Notes]] |\n| Person mention | Lexical mention | @Person Name |\n| External link | Lexical link | [text](url) |\n| Blockquote | Lexical quote | \u003e quoted text |\n| Code block | Lexical code block | ```\\ncode\\n``` |\n| Table | Lexical table | Pipe-formatted table |\n\n### Frontmatter\n| Test | Input | Expected |\n|------|-------|----------|\n| With metadata | Note with title, tags, dates | Valid YAML block |\n| With type | Meeting note | type: meeting in frontmatter |\n| Without type | Regular note | No type field |\n\n### Special Character Escaping\n| Test | Input | Expected |\n|------|-------|----------|\n| Mid-word asterisk | \"$100 * 2\" | $100 * 2 (no escape) |\n| Word-boundary asterisk | *important* | \\*important\\* |\n| snake_case | snake_case_name | snake_case_name (no escape) |\n| Line-start hash | \"# comment\" (plain) | \\# comment |\n| Brackets | [see docs] | \\[see docs] |\n| Backslash | C:\\Users | C:\\\\Users |\n\n### Unicode\n| Test | Input | Expected |\n|------|-------|----------|\n| Unicode content | \"CafÃ© â˜• æ—¥æœ¬èªž\" | Characters preserved |\n\n## Acceptance Criteria\n- [ ] All test cases pass\n- [ ] Edge cases covered\n- [ ] Tests are well-documented\n- [ ] Coverage \u003e 90% for content-extractor.ts","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T06:45:18.232519-06:00","updated_at":"2025-12-17T06:45:18.232519-06:00","dependencies":[{"issue_id":"scribe-o7z","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T06:45:23.466736-06:00","created_by":"daemon"},{"issue_id":"scribe-o7z","depends_on_id":"scribe-4wl","type":"blocks","created_at":"2025-12-17T06:45:23.516238-06:00","created_by":"daemon"}]}
{"id":"scribe-o9i","title":"Create ShareMenu component with dropdown and export action","description":"Create the ShareMenu React component that displays a share button with a dropdown menu for export options.\n\n## Why This Matters\nThis is the primary UI for the export feature. Users interact with the share button to:\n1. See available export options\n2. Trigger the Markdown export\n3. Receive feedback on success/failure\n\n## Files to Create\n- apps/desktop/renderer/src/components/ShareMenu/ShareMenu.tsx (NEW)\n- apps/desktop/renderer/src/components/ShareMenu/ShareMenu.css.ts (NEW)\n- apps/desktop/renderer/src/components/ShareMenu/index.ts (NEW)\n\n## Component Props\n```typescript\ninterface ShareMenuProps {\n  noteId: NoteId;\n  onExportSuccess?: (filePath: string) =\u003e void;\n  onExportError?: (error: string) =\u003e void;\n}\n```\n\n## Component Behavior\n1. Render share icon button (28x28px, subtle)\n2. Click opens dropdown menu\n3. Menu shows 'Export to Markdown' option\n4. Click option triggers window.scribe.export.toMarkdown(noteId)\n5. Handle success: call onExportSuccess with filename\n6. Handle error: call onExportError with message\n7. Handle cancel: do nothing (no callbacks)\n\n## Dropdown Behavior\n- Opens below and right-aligned to button\n- Closes on outside click\n- Closes on Escape key\n- Closes after selecting an item\n\n## Loading State\n- While exporting, button is disabled\n- isExporting state prevents double-clicks\n\n## Styling Details (from spec)\n- Container: position relative, inline-flex\n- Button: 28x28px, transparent bg, muted icon color\n- Hover: backgroundAlt bg, foreground icon color\n- Dropdown: absolute, right-aligned, min-width 180px\n- Menu items: 8px 12px padding, hover backgroundAlt\n\n## Design System Tokens\nUse @scribe/design-system vars:\n- vars.color.foreground, foregroundMuted, surface, backgroundAlt, border\n- vars.radius.sm, md\n- vars.shadow.md\n- vars.zIndex.popover\n- vars.typography.size.sm\n\n## Icon\nInline ShareIcon SVG (from spec) or import from design system if available.\n\n## Acceptance Criteria\n- [ ] Share button renders with icon\n- [ ] Click opens dropdown menu\n- [ ] Menu shows 'Export to Markdown' option\n- [ ] Export triggers IPC call\n- [ ] Success callback receives filename\n- [ ] Error callback receives message\n- [ ] Outside click closes menu\n- [ ] Escape closes menu\n- [ ] Disabled during export","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T17:55:53.349218-06:00","updated_at":"2025-12-17T17:55:53.349218-06:00","dependencies":[{"issue_id":"scribe-o9i","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:56:03.076588-06:00","created_by":"daemon"},{"issue_id":"scribe-o9i","depends_on_id":"scribe-urw","type":"blocks","created_at":"2025-12-17T17:56:03.122175-06:00","created_by":"daemon"}]}
{"id":"scribe-thw","title":"Add CLI export subcommand to notes.ts","description":"Add the 'export' subcommand to the notes CLI command for exporting notes to Markdown from the terminal.\n\n## Why This Matters\nCLI export enables:\n1. Scripted bulk exports\n2. Integration with other tools\n3. Quick note content dumps to terminal\n4. Piping to clipboard or other commands\n\n## Files to Modify\n- apps/cli/src/commands/notes.ts\n\n## Implementation\n\nAdd these imports:\n```typescript\nimport * as fs from 'node:fs/promises';\nimport path from 'path';\nimport { extractMarkdown } from '@scribe/shared';\n```\n\nAdd the export subcommand:\n```typescript\nnotes\n  .command('export')\n  .description('Export note to Markdown format')\n  .argument('\u003cid\u003e', 'Note ID')\n  .option('--output \u003cpath\u003e', 'Output file path (defaults to stdout)')\n  .option('--no-frontmatter', 'Exclude YAML frontmatter')\n  .action(async (id: string, options: { output?: string; frontmatter: boolean }) =\u003e {\n    const globalOpts = program.opts() as GlobalOptions;\n    const ctx = await initializeContext(globalOpts);\n    \n    // Get note from vault (throws if not found)\n    let note;\n    try {\n      note = ctx.vault.read(createNoteId(id));\n    } catch {\n      throw noteNotFound(id);\n    }\n    \n    // Convert to Markdown\n    const markdown = extractMarkdown(note, {\n      includeFrontmatter: options.frontmatter,\n    });\n    \n    if (options.output) {\n      // Write to file\n      const outputPath = path.resolve(options.output);\n      await fs.writeFile(outputPath, markdown, 'utf-8');\n      \n      output(\n        {\n          success: true,\n          note: { id: note.id, title: note.title },\n          outputPath,\n        },\n        globalOpts\n      );\n    } else {\n      // Write to stdout (raw markdown)\n      process.stdout.write(markdown);\n    }\n  });\n```\n\n## Usage Examples\n```bash\n# Export to stdout\nscribe notes export abc-123\n\n# Export to file\nscribe notes export abc-123 --output ~/Desktop/meeting-notes.md\n\n# Export without frontmatter\nscribe notes export abc-123 --no-frontmatter\n\n# Pipe to clipboard (macOS)\nscribe notes export abc-123 | pbcopy\n\n# Pipe to file\nscribe notes export abc-123 \u003e notes.md\n```\n\n## Error Handling\n- Invalid note ID: throw noteNotFound(id)\n- File write error: let it bubble up (handled by CLI framework)\n\n## Output Modes\n- stdout: Raw markdown (no JSON formatting)\n- file: JSON output via output() function\n\n## Acceptance Criteria\n- [ ] Export subcommand registered\n- [ ] --output option works\n- [ ] --no-frontmatter option works\n- [ ] stdout outputs raw markdown\n- [ ] File output uses output() function\n- [ ] Error on invalid note ID","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T17:58:02.831098-06:00","updated_at":"2025-12-17T17:58:02.831098-06:00","dependencies":[{"issue_id":"scribe-thw","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:58:08.173413-06:00","created_by":"daemon"},{"issue_id":"scribe-thw","depends_on_id":"scribe-4wl","type":"blocks","created_at":"2025-12-17T17:58:08.221516-06:00","created_by":"daemon"}]}
{"id":"scribe-tzs","title":"Manual E2E testing and accessibility audit","description":"Perform comprehensive manual end-to-end testing and accessibility audit before shipping the feature.\n\n## Why This Matters\nAutomated tests can't catch everything:\n1. Visual issues (layout, spacing, colors)\n2. Usability issues (confusing UX)\n3. Cross-platform differences\n4. Accessibility issues that automated tools miss\n\n## Testing Scope\n\n### Desktop App E2E Flow\n1. Open a note with various content types\n2. Click share button in note header\n3. Verify dropdown menu appears\n4. Click 'Export to Markdown'\n5. Verify native save dialog appears\n6. Choose location and filename\n7. Click Save\n8. Verify success toast appears\n9. Open exported file in text editor\n10. Verify content matches original note\n\n### Content Verification\nTest export with notes containing:\n- [ ] Plain text paragraphs\n- [ ] Headings (H1, H2, H3)\n- [ ] Bulleted lists\n- [ ] Numbered lists\n- [ ] Checklists (checked and unchecked)\n- [ ] Bold/italic/code formatting\n- [ ] Wiki-links [[like this]]\n- [ ] @mentions\n- [ ] Code blocks\n- [ ] Tables\n- [ ] Blockquotes\n- [ ] Links [text](url)\n- [ ] Unicode (emoji, CJK, accents)\n- [ ] Special characters (* _ # [ ] etc.)\n\n### Error Scenarios\n- [ ] Cancel save dialog (no error)\n- [ ] Invalid note ID (error toast)\n- [ ] Permission denied location (error toast)\n- [ ] Very long note (performance ok)\n- [ ] Empty note (frontmatter only)\n\n### CLI E2E Flow\n1. Run: scribe notes export \u003cvalid-id\u003e\n2. Verify Markdown output in terminal\n3. Run: scribe notes export \u003cvalid-id\u003e --output test.md\n4. Verify file created with correct content\n5. Run: scribe notes export \u003cinvalid-id\u003e\n6. Verify error message\n7. Run: scribe notes export \u003cid\u003e --no-frontmatter\n8. Verify no YAML block\n\n## Accessibility Audit Checklist\n\n### Screen Reader (VoiceOver on macOS)\n- [ ] Share button announced as 'Share note, button'\n- [ ] Menu items announced correctly\n- [ ] Expanded/collapsed state announced\n- [ ] Toast messages announced without focus\n\n### Keyboard Only\n- [ ] Tab to share button\n- [ ] Enter/Space opens menu\n- [ ] Arrow keys navigate menu\n- [ ] Enter activates item\n- [ ] Escape closes menu\n- [ ] Focus returns to button after close\n\n### Visual\n- [ ] Focus indicators visible on all elements\n- [ ] Color contrast passes (4.5:1 text, 3:1 UI)\n- [ ] Works at 200% zoom\n- [ ] No text clipping/overlap\n\n### Reduced Motion\n- [ ] Enable 'Reduce motion' in System Preferences\n- [ ] Verify no animations (instant open/close)\n\n## Acceptance Criteria\n- [ ] All E2E scenarios pass\n- [ ] Accessibility audit passes\n- [ ] No visual regressions\n- [ ] Ready for user testing","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T17:59:48.234012-06:00","updated_at":"2025-12-17T17:59:48.234012-06:00","dependencies":[{"issue_id":"scribe-tzs","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:59:55.08724-06:00","created_by":"daemon"},{"issue_id":"scribe-tzs","depends_on_id":"scribe-40n","type":"blocks","created_at":"2025-12-17T17:59:55.132937-06:00","created_by":"daemon"},{"issue_id":"scribe-tzs","depends_on_id":"scribe-thw","type":"blocks","created_at":"2025-12-17T17:59:55.176567-06:00","created_by":"daemon"},{"issue_id":"scribe-tzs","depends_on_id":"scribe-1cc","type":"blocks","created_at":"2025-12-17T17:59:55.219323-06:00","created_by":"daemon"},{"issue_id":"scribe-tzs","depends_on_id":"scribe-lpp","type":"blocks","created_at":"2025-12-17T17:59:55.263152-06:00","created_by":"daemon"},{"issue_id":"scribe-tzs","depends_on_id":"scribe-1ra","type":"blocks","created_at":"2025-12-17T17:59:55.305573-06:00","created_by":"daemon"},{"issue_id":"scribe-tzs","depends_on_id":"scribe-o7z","type":"blocks","created_at":"2025-12-17T17:59:55.348097-06:00","created_by":"daemon"},{"issue_id":"scribe-tzs","depends_on_id":"scribe-mwt.1","type":"blocks","created_at":"2025-12-17T18:05:21.794805-06:00","created_by":"daemon"}]}
{"id":"scribe-urw","title":"Add export namespace to preload bridge","description":"Wire up the export IPC bridge in the preload script to expose the export API to the renderer process.\n\n## Why This Matters\nThe preload script is the security boundary between renderer and main process. Without this bridge:\n1. The renderer cannot call the export handler\n2. window.scribe.export would be undefined\n3. The ShareMenu component would fail to export\n\n## Files to Modify\n- apps/desktop/electron/preload/src/preload.ts\n\n## Implementation\n\nAdd the export namespace to the existing scribeAPI object:\n```typescript\n// apps/desktop/electron/preload/src/preload.ts\n\n// Existing imports at top:\n// import { contextBridge, ipcRenderer } from 'electron';\n// import type { Note, NoteId, TaskFilter, TaskChangeEvent } from '@scribe/shared';\n// import { IPC_CHANNELS, type ScribeAPI } from '@scribe/shared';\n\nconst scribeAPI: ScribeAPI = {\n  // ... existing APIs (notes, search, graph, shell, app, people, daily, meeting, etc.) ...\n  \n  export: {\n    toMarkdown: (noteId: NoteId) =\u003e \n      ipcRenderer.invoke(IPC_CHANNELS.EXPORT_TO_MARKDOWN, noteId),\n  },\n};\n\n// Already exposed via contextBridge.exposeInMainWorld('scribe', scribeAPI);\n```\n\n## How It Works\n1. ScribeAPI interface (from @scribe/shared) now includes ExportAPI\n2. preload.ts implements the export.toMarkdown method\n3. ipcRenderer.invoke sends message to main process\n4. Main process handler (exportHandlers.ts) responds\n5. Result is returned to renderer\n\n## Verification\n1. Build the preload script\n2. Start the app\n3. Open DevTools console\n4. Check: typeof window.scribe.export === 'object'\n5. Check: typeof window.scribe.export.toMarkdown === 'function'\n\n## Acceptance Criteria\n- [ ] export namespace added to scribeAPI object\n- [ ] toMarkdown method invokes correct IPC channel\n- [ ] TypeScript compiles without errors\n- [ ] window.scribe.export is available in renderer","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-17T17:55:29.649215-06:00","updated_at":"2025-12-17T17:55:29.649215-06:00","dependencies":[{"issue_id":"scribe-urw","depends_on_id":"scribe-mwt","type":"parent-child","created_at":"2025-12-17T17:55:35.150304-06:00","created_by":"daemon"},{"issue_id":"scribe-urw","depends_on_id":"scribe-b7c","type":"blocks","created_at":"2025-12-17T17:55:35.20376-06:00","created_by":"daemon"}]}
