{"id":"dn-03l","content_hash":"b0538004bf638be889172dde32ade2863ae53af66964d13ea678d4a42cc6c198","title":"E2E: Delete current note flow","description":"Integration test for deleting the currently open note.\n\n**File:** apps/desktop/delete-note.integration.test.ts\n\n**Test Flow (Flow 3 from spec.md):**\n1. Create test vault with 3+ notes\n2. Track which note is 'current' (most recently accessed)\n3. Delete the current note\n4. Verify:\n   - Note is deleted\n   - Most recent remaining note becomes 'current'\n   - Graph and search engines updated\n\n**Example test:**\n```typescript\nit('should load most recent note when current note is deleted', async () =\u003e {\n  // Create notes with known timestamps\n  const note1 = await vault.create();\n  await new Promise(r =\u003e setTimeout(r, 10)); // Small delay\n  const note2 = await vault.create();\n  await new Promise(r =\u003e setTimeout(r, 10));\n  const note3 = await vault.create(); // Most recent\n  \n  // note3 is 'current', delete it\n  await vault.delete(note3.id);\n  graphEngine.removeNote(note3.id);\n  searchEngine.removeNote(note3.id);\n  \n  // Find most recent remaining note\n  const remaining = vault.list().sort((a, b) =\u003e b.updatedAt - a.updatedAt);\n  expect(remaining[0].id).toBe(note2.id); // note2 should be most recent\n});\n```\n\n**Dependencies:**\n- Blocks on: All implementation tasks complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:57:05.278532-06:00","updated_at":"2025-11-25T21:42:55.071759-06:00","closed_at":"2025-11-25T21:42:55.071759-06:00","source_repo":".","dependencies":[{"issue_id":"dn-03l","depends_on_id":"dn-tum","type":"parent-child","created_at":"2025-11-25T19:57:14.596751-06:00","created_by":"erikjohansson"},{"issue_id":"dn-03l","depends_on_id":"dn-ct5","type":"blocks","created_at":"2025-11-25T19:57:16.190712-06:00","created_by":"erikjohansson"}]}
{"id":"dn-2w1","content_hash":"317b16368de44fbe65fe4fa271a2c8f9b935dddfa08ebad503a118e1cf7168c7","title":"E2E: Delete last note in vault flow","description":"Integration test for deleting the only note in the vault.\n\n**File:** apps/desktop/delete-note.integration.test.ts\n\n**Test Flow (Flow 4 from spec.md):**\n1. Create test vault with exactly 1 note\n2. Delete that note\n3. Verify:\n   - Note is deleted\n   - New note should be created automatically\n   - Vault is not empty after operation\n\n**Example test:**\n```typescript\nit('should create new note when deleting the last note', async () =\u003e {\n  // Create single note\n  const onlyNote = await vault.create();\n  expect(vault.list()).toHaveLength(1);\n  \n  // Delete it\n  await vault.delete(onlyNote.id);\n  graphEngine.removeNote(onlyNote.id);\n  searchEngine.removeNote(onlyNote.id);\n  \n  // Verify vault is now empty\n  expect(vault.list()).toHaveLength(0);\n  \n  // Create new note (simulates what app would do)\n  const newNote = await vault.create();\n  expect(vault.list()).toHaveLength(1);\n  expect(newNote.id).not.toBe(onlyNote.id);\n});\n```\n\n**Note:** The 'create new note' behavior is in the UI layer (CommandPalette), \nso engine-level test just verifies deletion works and new note can be created.\n\n**Dependencies:**\n- Blocks on: All implementation tasks complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:57:07.143373-06:00","updated_at":"2025-11-25T21:42:55.194688-06:00","closed_at":"2025-11-25T21:42:55.194688-06:00","source_repo":".","dependencies":[{"issue_id":"dn-2w1","depends_on_id":"dn-tum","type":"parent-child","created_at":"2025-11-25T19:57:14.629532-06:00","created_by":"erikjohansson"},{"issue_id":"dn-2w1","depends_on_id":"dn-ct5","type":"blocks","created_at":"2025-11-25T19:57:16.223244-06:00","created_by":"erikjohansson"}]}
{"id":"dn-3y2","content_hash":"dadb9a11a06cd93f93b1117d9499e3014b5d7c03c9dcf06c7c82604ac4b65550","title":"Add notes:delete IPC handler in main process","description":"Add the notes:delete IPC handler in the main process.\n\n**File:** apps/desktop/electron/main/src/main.ts\n\n**Requirements:**\n- Add ipcMain.handle('notes:delete', ...) handler in setupIPCHandlers() function (around line 102)\n- Follow existing pattern from notes:save handler (lines 145-174)\n- Call vault.delete(id)\n- Call graphEngine.removeNote(id) \n- Call searchEngine.removeNote(id)\n- Return { success: true } on success\n- Handle errors using ScribeError pattern (see notes:save for reference)\n\n**Implementation (add after notes:save handler around line 175):**\n```typescript\n// Delete a note\nipcMain.handle('notes:delete', async (_event, id: NoteId) =\u003e {\n  try {\n    if (!vault) {\n      throw new Error('Vault not initialized');\n    }\n    if (!graphEngine) {\n      throw new Error('Graph engine not initialized');\n    }\n    if (!searchEngine) {\n      throw new Error('Search engine not initialized');\n    }\n    await vault.delete(id);\n    graphEngine.removeNote(id);\n    searchEngine.removeNote(id);\n    return { success: true };\n  } catch (error) {\n    if (error instanceof ScribeError) {\n      const userError = new Error(error.getUserMessage());\n      userError.name = error.code;\n      throw userError;\n    }\n    throw error;\n  }\n});\n```\n\n**Note:** All backend methods (vault.delete, graphEngine.removeNote, searchEngine.removeNote) already exist. This task only needs to wire them together via IPC.\n\n**Dependencies:**\n- Blocks on: Preload API (dn-dgb)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:54:54.927539-06:00","updated_at":"2025-11-25T21:18:09.357423-06:00","closed_at":"2025-11-25T21:18:09.357423-06:00","source_repo":".","dependencies":[{"issue_id":"dn-3y2","depends_on_id":"dn-5t8","type":"parent-child","created_at":"2025-11-25T19:54:59.897802-06:00","created_by":"erikjohansson"},{"issue_id":"dn-3y2","depends_on_id":"dn-dgb","type":"blocks","created_at":"2025-11-25T19:55:01.403154-06:00","created_by":"erikjohansson"}]}
{"id":"dn-412","content_hash":"5788bf6b7e7381a473794a4e4841fb63becabf126150b973e8e4bb2323a62b8c","title":"E2E: Cancel deletion flow","description":"Integration test for canceling a note deletion.\n\n**File:** apps/desktop/delete-note.integration.test.ts\n\n**Test Flow (Flow 2 from spec.md):**\n1. Create test vault with notes\n2. Enter delete-browse mode, select a note\n3. In confirmation screen, press Escape or click Cancel\n4. Verify:\n   - Returns to delete-browse mode\n   - Note still exists in vault\n   - Note still in graph and search engines\n\n**Example test:**\n```typescript\nit('should preserve note when deletion is cancelled', async () =\u003e {\n  const note = await vault.create();\n  note.content = { root: { type: 'root', children: [\n    { type: 'paragraph', children: [{ type: 'text', text: 'Test Note' }] }\n  ]}};\n  await vault.save(note);\n  graphEngine.addNote(note);\n  searchEngine.indexNote(note);\n  \n  // Simulate cancel (no deletion action)\n  // Note should still exist\n  const remainingNotes = vault.list();\n  expect(remainingNotes.find(n =\u003e n.id === note.id)).toBeDefined();\n  expect(searchEngine.search('Test Note')).toHaveLength(1);\n});\n```\n\n**Dependencies:**\n- Blocks on: All implementation tasks complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:57:03.265325-06:00","updated_at":"2025-11-25T21:42:54.9782-06:00","closed_at":"2025-11-25T21:42:54.9782-06:00","source_repo":".","dependencies":[{"issue_id":"dn-412","depends_on_id":"dn-tum","type":"parent-child","created_at":"2025-11-25T19:57:14.56427-06:00","created_by":"erikjohansson"},{"issue_id":"dn-412","depends_on_id":"dn-ct5","type":"blocks","created_at":"2025-11-25T19:57:16.158081-06:00","created_by":"erikjohansson"}]}
{"id":"dn-5eh","content_hash":"8a67a237cd20d6bb7863d9b3eda61533c1f379ae063e31a8ed43a08991fec329","title":"Implement delete-browse mode in CommandPalette","description":"Add delete-browse mode to CommandPalette component.\n\n**File:** apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx\n\n**Overview:** delete-browse mode is nearly identical to file-browse mode. The main differences are:\n- Different placeholder text\n- On note selection: goes to delete-confirm instead of opening note\n- Excludes current note from list (same as file-browse)\n\n**Step 1: Add state for pending deletion (around line 109):**\n```typescript\n// Track the note pending deletion\nconst [pendingDeleteNote, setPendingDeleteNote] = useState\u003cNote | null\u003e(null);\n\n// Track which mode to return to after cancel (delete-browse or file-browse)\nconst [returnMode, setReturnMode] = useState\u003cPaletteMode\u003e('delete-browse');\n```\n\n**Step 2: Add new prop for showToast (update interface around line 34):**\n```typescript\n/** Callback to show toast notifications */\nshowToast?: (message: string, type?: 'success' | 'error') =\u003e void;\n```\n\n**Step 3: Update note fetch effect to include delete-browse (line 178):**\n```typescript\nif (mode !== 'file-browse' \u0026\u0026 mode !== 'delete-browse') {\n  return;\n}\n```\n\n**Step 4: Update keyboard handler for delete-browse (around line 288):**\nAdd handling for delete-browse mode similar to file-browse but:\n- On Enter: set pendingDeleteNote, setReturnMode('delete-browse'), setMode('delete-confirm')\n- On Escape: return to 'command' mode\n\n**Step 5: Update placeholder based on mode (line 491):**\n```typescript\nplaceholder={\n  mode === 'file-browse' ? 'Search notes...' : \n  mode === 'delete-browse' ? 'Select note to delete...' : \n  'Search or run a command...'\n}\n```\n\n**Step 6: Add renderDeleteBrowseResults() function:**\nReuse renderFileBrowseResults() logic or combine them with conditional note selection handling.\n\n**Tests:** Update CommandPalette.test.tsx\n- Mode switching (command -\u003e delete-browse -\u003e command)\n- Escape returns to command mode  \n- Note selection transitions to delete-confirm\n- Correct placeholder text\n\n**Dependencies:**\n- Blocks on: PaletteMode type update (dn-6nr)\n- Blocks on: Delete Note command registration (dn-r58)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:55:55.190708-06:00","updated_at":"2025-11-25T21:22:53.051726-06:00","closed_at":"2025-11-25T21:22:53.051726-06:00","source_repo":".","dependencies":[{"issue_id":"dn-5eh","depends_on_id":"dn-sul","type":"parent-child","created_at":"2025-11-25T19:56:22.509964-06:00","created_by":"erikjohansson"},{"issue_id":"dn-5eh","depends_on_id":"dn-6nr","type":"blocks","created_at":"2025-11-25T19:56:24.385442-06:00","created_by":"erikjohansson"},{"issue_id":"dn-5eh","depends_on_id":"dn-r58","type":"blocks","created_at":"2025-11-25T19:56:24.417945-06:00","created_by":"erikjohansson"}]}
{"id":"dn-5t8","content_hash":"82e06a5ea57d13687e417b764824ed89ed744e650b129912f11bf2fbba88272b","title":"Backend: Storage \u0026 IPC Layer for Delete","description":"Sub-epic: Implement the backend infrastructure for note deletion including vault.delete(), IPC handlers, and engine cleanup (graph/search). This work stream has no frontend dependencies and can be done in parallel with UI work.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-25T19:54:15.692896-06:00","updated_at":"2025-11-25T21:43:43.64867-06:00","closed_at":"2025-11-25T21:43:43.64867-06:00","source_repo":".","dependencies":[{"issue_id":"dn-5t8","depends_on_id":"dn-nrk","type":"parent-child","created_at":"2025-11-25T19:54:26.699029-06:00","created_by":"erikjohansson"}]}
{"id":"dn-6hz","content_hash":"fab90ea7d0c7db635cd39852042369ec420d7cc51f532d8f204425c9129e1536","title":"Integrate Toast system into App.tsx","description":"Wire up the toast system in the main App component.\n\n**File:** apps/desktop/renderer/src/App.tsx\n\n**Requirements:**\n1. Import useToast hook and Toast component\n2. Call useToast hook at component level\n3. Render Toast component in JSX (after ErrorNotification, around line 229)\n4. Create a ToastContext to share showToast with child components (CommandPalette needs it)\n\n**Implementation Steps:**\n\n**Step 1: Add imports (around line 6):**\n```typescript\nimport { useToast, ToastProvider } from './hooks/useToast';\nimport { Toast } from './components/Toast/Toast';\n```\n\n**Step 2: Add hook call in App function (around line 21):**\n```typescript\nconst { toasts, showToast, dismissToast } = useToast();\n```\n\n**Step 3: Add Toast component in JSX (around line 229, after ErrorNotification):**\n```typescript\n\u003cToast toasts={toasts} onDismiss={dismissToast} /\u003e\n```\n\n**Step 4: Pass showToast to CommandPalette (add new prop):**\n```typescript\n\u003cCommandPalette\n  ...existingProps\n  showToast={showToast}\n/\u003e\n```\n\n**Alternative: ToastContext approach**\nIf prop drilling is complex, consider creating a ToastContext:\n- Create ToastContext in useToast.ts\n- Wrap App in ToastProvider  \n- Use useToastContext() in CommandPalette\n\n**Dependencies:**\n- Blocks on: useToast hook (dn-beu)\n- Blocks on: Toast component (dn-gg5)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:55:25.031784-06:00","updated_at":"2025-11-25T21:22:53.084781-06:00","closed_at":"2025-11-25T21:22:53.084781-06:00","source_repo":".","dependencies":[{"issue_id":"dn-6hz","depends_on_id":"dn-9wc","type":"parent-child","created_at":"2025-11-25T19:55:29.87005-06:00","created_by":"erikjohansson"},{"issue_id":"dn-6hz","depends_on_id":"dn-beu","type":"blocks","created_at":"2025-11-25T19:55:29.933653-06:00","created_by":"erikjohansson"},{"issue_id":"dn-6hz","depends_on_id":"dn-gg5","type":"blocks","created_at":"2025-11-25T19:55:29.965221-06:00","created_by":"erikjohansson"}]}
{"id":"dn-6ln","content_hash":"f5a5f097e8bbda6b5d238c39c6333f777ff56b014cf43d66e7b704421c09bd44","title":"Add delete icon to note items in file-browse mode","description":"Add a delete icon to each note item in file-browse mode.\n\n**File:** apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx\n\n**Requirements:**\n- In file-browse mode only, render a delete icon button on each note item\n- Icon is an X or trash icon (suggest using a simple X: ×)\n- Click handler opens confirmation screen\n- Use stopPropagation to prevent note from opening when clicking icon\n\n**Step 1: Update renderFileBrowseResults() note item rendering (around line 394):**\n```typescript\nreturn displayedNotes.map((note, index) =\u003e (\n  \u003cdiv\n    key={note.id}\n    className={`command-palette-item ${index === selectedNoteIndex ? 'selected' : ''}`}\n    onClick={() =\u003e {\n      if (onNoteSelect) {\n        onNoteSelect(note.id);\n        onClose();\n      }\n    }}\n    onMouseEnter={() =\u003e setSelectedNoteIndex(index)}\n  \u003e\n    \u003cdiv className=\"command-palette-item-title\"\u003e{truncateTitle(note.metadata.title)}\u003c/div\u003e\n    \u003cdiv className=\"command-palette-note-subtext\"\u003e{formatRelativeDate(note.updatedAt)}\u003c/div\u003e\n    \n    {/* Delete icon - only in file-browse mode */}\n    \u003cbutton\n      className=\"note-item-delete-icon\"\n      onClick={(e) =\u003e {\n        e.stopPropagation(); // Prevent note from opening\n        setPendingDeleteNote(note);\n        setReturnMode('file-browse'); // Return here after cancel\n        setMode('delete-confirm');\n      }}\n      aria-label={`Delete ${note.metadata.title || 'note'}`}\n    \u003e\n      \u003csvg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"\u003e\n        \u003cpath d=\"M18 6L6 18M6 6l12 12\" /\u003e\n      \u003c/svg\u003e\n    \u003c/button\u003e\n  \u003c/div\u003e\n));\n```\n\n**Key behaviors:**\n- stopPropagation prevents parent click from opening the note\n- setReturnMode('file-browse') ensures Cancel returns to file-browse (not delete-browse)\n- aria-label for accessibility\n- Icon uses simple X SVG (can substitute with trash icon if preferred)\n\n**Tests:** CommandPalette.file-browse.test.tsx\n- Delete icon hidden by default (CSS handles via opacity)\n- Delete icon visible on hover (CSS handles)\n- Delete icon click opens confirmation screen\n- Delete icon click does NOT open note (stopPropagation works)\n- Cancel from confirmation returns to file-browse mode\n- returnMode is correctly set to 'file-browse'\n\n**Dependencies:**\n- Blocks on: delete-confirm screen (dn-9le)\n- Blocks on: delete icon CSS styles (dn-z00)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:56:44.823883-06:00","updated_at":"2025-11-25T21:36:40.020941-06:00","closed_at":"2025-11-25T21:36:40.020941-06:00","source_repo":".","dependencies":[{"issue_id":"dn-6ln","depends_on_id":"dn-bh6","type":"parent-child","created_at":"2025-11-25T19:56:49.328451-06:00","created_by":"erikjohansson"},{"issue_id":"dn-6ln","depends_on_id":"dn-9le","type":"blocks","created_at":"2025-11-25T19:56:49.360717-06:00","created_by":"erikjohansson"},{"issue_id":"dn-6ln","depends_on_id":"dn-z00","type":"blocks","created_at":"2025-11-25T19:56:49.39346-06:00","created_by":"erikjohansson"}]}
{"id":"dn-6nr","content_hash":"058fc9fd61dc62aed57cb377ca6da58760afd6b824479b4230f137eb6da01eb9","title":"Add delete-browse and delete-confirm to PaletteMode type","description":"Update the PaletteMode type to include new delete modes.\n\n**File:** apps/desktop/renderer/src/commands/types.ts\n\n**Current (line 12):**\n```typescript\nexport type PaletteMode = 'command' | 'file-browse';\n```\n\n**Updated:**\n```typescript\nexport type PaletteMode = 'command' | 'file-browse' | 'delete-browse' | 'delete-confirm';\n```\n\n**No other changes needed - TypeScript will enforce the new modes where PaletteMode is used.**\n\n**No blocking dependencies - can start immediately**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:55:39.310556-06:00","updated_at":"2025-11-25T21:15:50.599204-06:00","closed_at":"2025-11-25T21:15:50.599204-06:00","source_repo":".","dependencies":[{"issue_id":"dn-6nr","depends_on_id":"dn-sul","type":"parent-child","created_at":"2025-11-25T19:56:22.410715-06:00","created_by":"erikjohansson"}]}
{"id":"dn-6ze","content_hash":"0316156c68bafbeeb4b7ec0afcf008f8253390f27f2bb8c5dce6cf693e15b2e3","title":"Define named constants for title truncation lengths","description":"In CommandPalette.tsx, title truncation uses inconsistent magic numbers across different contexts:\n\n- Line 31: truncateTitle defaults to 50 chars (for list display)\n- Line 170: Toast uses 30 chars: truncateTitle(noteTitle, 30)\n- Line 601: Confirmation dialog uses 27 chars: truncateTitle(..., 27)\n\nFix: Define named constants at the top of the file to make intent clear:\n```typescript\nconst TITLE_TRUNCATE_LIST = 50;\nconst TITLE_TRUNCATE_TOAST = 30;\nconst TITLE_TRUNCATE_CONFIRM = 27;\n```\n\nThen update truncateTitle calls to use these constants.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T00:00:31.466883-06:00","updated_at":"2025-11-26T06:47:43.763234-06:00","closed_at":"2025-11-26T06:47:43.763234-06:00","source_repo":"."}
{"id":"dn-7um","content_hash":"79e9f5bc34ae09ef6b7d0ec43f678a8b471427c4ac680e5f9b35d65b5051de4a","title":"Add deleteNote method to useNoteState hook","description":"Add deleteNote method to useNoteState hook.\n\n**File:** apps/desktop/renderer/src/hooks/useNoteState.ts\n\n**Step 1: Update interface (around line 4):**\n```typescript\ninterface UseNoteStateReturn {\n  // ... existing properties (lines 5-24)\n  \n  /** Delete a note by ID */\n  deleteNote: (id: NoteId) =\u003e Promise\u003cvoid\u003e;\n}\n```\n\n**Step 2: Add deleteNote callback (after createNote, around line 129):**\n```typescript\n/**\n * Delete a note by ID\n */\nconst deleteNote = useCallback(async (id: NoteId) =\u003e {\n  try {\n    await window.scribe.notes.delete(id);\n    \n    // If we deleted the current note, clear it\n    if (id === currentNoteId) {\n      setCurrentNote(null);\n      setCurrentNoteId(null);\n    }\n  } catch (err) {\n    const errorMessage = err instanceof Error ? err.message : 'Failed to delete note';\n    setError(errorMessage);\n    console.error('Failed to delete note:', err);\n    throw err; // Re-throw so caller can handle (e.g., show error toast)\n  }\n}, [currentNoteId]);\n```\n\n**Step 3: Add to return object (around line 167):**\n```typescript\nreturn useMemo(\n  () =\u003e ({\n    currentNote,\n    currentNoteId,\n    isLoading,\n    error,\n    loadNote,\n    saveNote,\n    createNote,\n    deleteNote, // Add this\n  }),\n  [currentNote, currentNoteId, isLoading, error, loadNote, saveNote, createNote, deleteNote]\n);\n```\n\n**Dependencies:**\n- Blocks on: IPC handler (dn-3y2) and preload API (dn-dgb)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:55:46.610727-06:00","updated_at":"2025-11-25T21:22:53.017502-06:00","closed_at":"2025-11-25T21:22:53.017502-06:00","source_repo":".","dependencies":[{"issue_id":"dn-7um","depends_on_id":"dn-sul","type":"parent-child","created_at":"2025-11-25T19:56:22.478553-06:00","created_by":"erikjohansson"},{"issue_id":"dn-7um","depends_on_id":"dn-3y2","type":"blocks","created_at":"2025-11-25T19:56:24.482361-06:00","created_by":"erikjohansson"}]}
{"id":"dn-9le","content_hash":"50c5479fe835745d64490f4f25a090bde144451ba84db759c1f9778018b11653","title":"Implement delete-confirm screen in CommandPalette","description":"Add the confirmation screen UI when in delete-confirm mode.\n\n**File:** apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx\n\n**UI Layout:**\n```\n┌─────────────────────────────────────────┐\n│                                         │\n│       Delete \"{note-title}\"?           │\n│                                         │\n│       This action cannot be undone.     │\n│                                         │\n│        [ Cancel ]    [ Delete ]         │\n│                                         │\n└─────────────────────────────────────────┘\n```\n\n**Implementation:**\n\n**Step 1: Add renderDeleteConfirm() function:**\n```typescript\nconst renderDeleteConfirm = () =\u003e {\n  if (!pendingDeleteNote) return null;\n  \n  const truncatedTitle = truncateTitle(pendingDeleteNote.metadata.title, 30);\n  \n  return (\n    \u003cdiv \n      className=\"delete-confirmation\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby=\"delete-confirm-title\"\n    \u003e\n      \u003ch2 id=\"delete-confirm-title\" className=\"delete-confirmation-title\"\u003e\n        Delete \"{truncatedTitle}\"?\n      \u003c/h2\u003e\n      \u003cp className=\"delete-confirmation-message\"\u003e\n        This action cannot be undone.\n      \u003c/p\u003e\n      \u003cdiv className=\"delete-confirmation-actions\"\u003e\n        \u003cbutton\n          className=\"delete-confirmation-cancel\"\n          onClick={handleDeleteCancel}\n          autoFocus\n        \u003e\n          Cancel\n        \u003c/button\u003e\n        \u003cbutton\n          className=\"delete-confirmation-confirm\"\n          onClick={handleDeleteConfirm}\n        \u003e\n          Delete\n        \u003c/button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n};\n```\n\n**Step 2: Add handlers:**\n```typescript\nconst handleDeleteCancel = () =\u003e {\n  setPendingDeleteNote(null);\n  setMode(returnMode);\n};\n\nconst handleDeleteConfirm = async () =\u003e {\n  // Implemented in dn-ct5 (Wire up delete action)\n};\n```\n\n**Step 3: Update keyboard handler for delete-confirm mode:**\n- Escape: call handleDeleteCancel()\n- Enter: call handleDeleteConfirm()\n- Tab: move focus between Cancel and Delete buttons\n\n**Step 4: Update render to show confirmation when mode === 'delete-confirm':**\n```typescript\n{mode === 'delete-confirm' ? renderDeleteConfirm() : (\n  // existing results rendering\n)}\n```\n\n**Accessibility:**\n- role='dialog', aria-modal='true', aria-labelledby\n- Focus on Cancel button when opened (safer default)\n- Tab navigation between buttons\n\n**Tests:** CommandPalette.test.tsx\n- Screen displays correct note title\n- Long titles truncated at 30 chars\n- Cancel returns to previous mode (returnMode)\n- Escape key cancels\n- Enter key triggers confirm\n- Focus management\n\n**Dependencies:**\n- Blocks on: delete-browse mode (dn-5eh)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:56:02.6019-06:00","updated_at":"2025-11-25T21:28:45.240834-06:00","closed_at":"2025-11-25T21:28:45.240834-06:00","source_repo":".","dependencies":[{"issue_id":"dn-9le","depends_on_id":"dn-sul","type":"parent-child","created_at":"2025-11-25T19:56:22.541912-06:00","created_by":"erikjohansson"},{"issue_id":"dn-9le","depends_on_id":"dn-5eh","type":"blocks","created_at":"2025-11-25T19:56:24.450644-06:00","created_by":"erikjohansson"}]}
{"id":"dn-9wc","content_hash":"dc223da94ad653ff94c4cc11f20d5c54e2f20030055ea6cbdc6a5f55bbec8369","title":"Frontend: Toast Notification System","description":"Sub-epic: Implement a reusable toast notification system (useToast hook + Toast component). This is a foundational UI component needed by the delete feature but designed for reuse across the app.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-25T19:54:17.62915-06:00","updated_at":"2025-11-25T21:43:43.713607-06:00","closed_at":"2025-11-25T21:43:43.713607-06:00","source_repo":".","dependencies":[{"issue_id":"dn-9wc","depends_on_id":"dn-nrk","type":"parent-child","created_at":"2025-11-25T19:54:26.730232-06:00","created_by":"erikjohansson"}]}
{"id":"dn-akn","content_hash":"0c62df0cb1a481eb71bafff18e948ef3d6d730ba94a152769fb26fc9ed12b040","title":"Add error logging in handleDeleteConfirm catch block","description":"In CommandPalette.tsx:176-184, the catch block shows an error toast but silently swallows the actual error, making debugging difficult.\n\nCurrent code:\n```typescript\n} catch {\n  showToast?.('Failed to delete note', 'error');\n  // ...\n}\n```\n\nFix: Add console.error to log the actual error:\n```typescript\n} catch (error) {\n  console.error('Failed to delete note:', error);\n  showToast?.('Failed to delete note', 'error');\n  // ...\n}\n```","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-26T00:00:19.38877-06:00","updated_at":"2025-11-26T06:47:42.091871-06:00","closed_at":"2025-11-26T06:47:42.091871-06:00","source_repo":"."}
{"id":"dn-beu","content_hash":"d42dbd621dbc8ead3733faf4f6c6d5fd47fc8428864a26f3389968183bbe08ba","title":"Implement useToast hook","description":"Create a reusable toast state management hook.\n\n**File:** apps/desktop/renderer/src/hooks/useToast.ts\n\n**Interface:**\n```typescript\ninterface Toast {\n  id: string;\n  message: string;\n  type: 'success' | 'error';\n}\n\ninterface UseToastReturn {\n  toasts: Toast[];\n  showToast: (message: string, type?: 'success' | 'error') =\u003e void;\n  dismissToast: (id: string) =\u003e void;\n}\n\nexport function useToast(): UseToastReturn;\n```\n\n**Requirements:**\n- Generate unique IDs for each toast (use crypto.randomUUID())\n- Default type is 'success'\n- Auto-dismiss after 3 seconds (use setTimeout + cleanup)\n- Support manual dismissal via dismissToast\n- Support multiple concurrent toasts\n- Export the Toast interface for use by Toast component\n\n**Implementation hints:**\n- Use useState for toasts array\n- Use useCallback for showToast and dismissToast\n- Track timeouts in a ref to clean up on unmount\n- Consider using useRef for timeout IDs to avoid stale closures\n\n**Tests:** apps/desktop/renderer/src/hooks/useToast.test.ts\n- showToast adds toast to array with unique ID\n- dismissToast removes specific toast by ID\n- Auto-dismiss after 3 seconds (use vi.useFakeTimers)\n- Multiple toasts stack correctly\n- Cleanup on unmount cancels pending timeouts\n\n**No blocking dependencies - can start immediately**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:55:14.751498-06:00","updated_at":"2025-11-25T21:15:50.566588-06:00","closed_at":"2025-11-25T21:15:50.566588-06:00","source_repo":".","dependencies":[{"issue_id":"dn-beu","depends_on_id":"dn-9wc","type":"parent-child","created_at":"2025-11-25T19:55:29.806408-06:00","created_by":"erikjohansson"}]}
{"id":"dn-bh6","content_hash":"dd794fe59130d1afa154047b0a2b24846a65826311cfce92fdbc170a7ce25a63","title":"Frontend: Delete Icon in File-Browse Mode","description":"Sub-epic: Add delete icon to file-browse mode note items with hover behavior. Reuses confirmation screen from delete-browse implementation.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-25T19:54:20.461133-06:00","updated_at":"2025-11-25T21:43:43.845759-06:00","closed_at":"2025-11-25T21:43:43.845759-06:00","source_repo":".","dependencies":[{"issue_id":"dn-bh6","depends_on_id":"dn-nrk","type":"parent-child","created_at":"2025-11-25T19:54:26.793346-06:00","created_by":"erikjohansson"}]}
{"id":"dn-ccw","content_hash":"51619dad40d34880e2247cafbe33c8d5564b9055ce6921214e967d6066ef46cb","title":"Extract shared test helpers from integration tests","description":"In delete-note.integration.test.ts, several helper functions are defined that duplicate patterns found in other integration tests:\n\n- createNoteWithTitle(title, delayMs)\n- createAndIndexNote(title, bodyText)\n- indexNoteInEngines(note)\n- removeNoteFromEngines(noteId)\n- createNoteContent(title, bodyText)\n- createFuseIndex(notes)\n- getRecentNotes(notes, currentNoteId, limit)\n\nFix: Extract these to a shared test utilities file (e.g., apps/desktop/test/integration-helpers.ts) that can be imported by all integration tests. This improves maintainability and ensures consistent test setup across test files.\n\nFiles to update:\n- apps/desktop/delete-note.integration.test.ts\n- apps/desktop/mvp.integration.test.ts (if it has similar helpers)\n- apps/desktop/last-note.integration.test.ts (if applicable)\n- apps/desktop/open-file.integration.test.ts (if applicable)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T00:00:46.135976-06:00","updated_at":"2025-11-26T06:47:45.838636-06:00","closed_at":"2025-11-26T06:47:45.838636-06:00","source_repo":"."}
{"id":"dn-ct5","content_hash":"d907bec6c2dedbc495334e3dff52882dc9ec56ff163e0fd0582836e89b408f91","title":"Wire up delete action with post-deletion behavior","description":"Implement the full deletion flow including post-deletion behavior.\n\n**File:** apps/desktop/renderer/src/components/CommandPalette/CommandPalette.tsx\n\n**This task implements handleDeleteConfirm() function.**\n\n**Post-deletion requirements (from spec.md):**\n| Scenario                          | Behavior                                       |\n| --------------------------------- | ---------------------------------------------- |\n| Deleted note was current note     | Open most recent remaining note                |\n| Deleted note was not current note | Keep current note loaded                       |\n| No notes remaining after deletion | Create new note                                |\n| Command palette state             | Close palette after successful deletion        |\n| Success toast                     | Show \"\"{note-title}\" deleted\"                  |\n| Error during deletion             | Show error toast, stay in delete-browse mode   |\n\n**Props needed (add to CommandPaletteProps):**\n```typescript\n/** Note state management */\nnoteState?: {\n  currentNoteId: NoteId | null;\n  deleteNote: (id: NoteId) =\u003e Promise\u003cvoid\u003e;\n  loadNote: (id: NoteId) =\u003e Promise\u003cvoid\u003e;\n  createNote: () =\u003e Promise\u003cvoid\u003e;\n};\n\n/** Toast notification callback */\nshowToast?: (message: string, type?: 'success' | 'error') =\u003e void;\n```\n\n**Implementation of handleDeleteConfirm:**\n```typescript\nconst handleDeleteConfirm = async () =\u003e {\n  if (!pendingDeleteNote || !noteState) return;\n  \n  const noteTitle = pendingDeleteNote.metadata.title || 'Untitled';\n  const noteId = pendingDeleteNote.id;\n  const wasCurrentNote = noteId === noteState.currentNoteId;\n  \n  try {\n    await noteState.deleteNote(noteId);\n    \n    // Refresh notes list to get remaining notes\n    const remainingNotes = allNotes.filter(n =\u003e n.id !== noteId);\n    \n    if (wasCurrentNote) {\n      if (remainingNotes.length \u003e 0) {\n        // Load most recent remaining note\n        const mostRecent = remainingNotes.sort((a, b) =\u003e b.updatedAt - a.updatedAt)[0];\n        await noteState.loadNote(mostRecent.id);\n      } else {\n        // No notes remaining, create new one\n        await noteState.createNote();\n      }\n    }\n    \n    // Show success toast\n    showToast?.(`\"${truncateTitle(noteTitle, 30)}\" deleted`);\n    \n    // Close palette\n    onClose();\n  } catch (error) {\n    // Show error toast\n    showToast?.('Failed to delete note', 'error');\n    \n    // Return to delete-browse mode\n    setPendingDeleteNote(null);\n    setMode('delete-browse');\n  }\n};\n```\n\n**Update App.tsx to pass noteState and showToast props to CommandPalette.**\n\n**Tests:** CommandPalette.test.tsx\n- Delete non-current note: current note remains loaded\n- Delete current note: most recent remaining note opened\n- Delete last note: new note created\n- Success toast shown with note title\n- Error toast shown on failure\n- Palette closes on success\n- Returns to delete-browse on error\n\n**Dependencies:**\n- Blocks on: delete-confirm screen (dn-9le)\n- Blocks on: useNoteState.deleteNote (dn-7um)\n- Blocks on: Toast system integration (dn-6hz)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:56:16.427983-06:00","updated_at":"2025-11-25T21:33:16.095046-06:00","closed_at":"2025-11-25T21:33:16.095046-06:00","source_repo":".","dependencies":[{"issue_id":"dn-ct5","depends_on_id":"dn-sul","type":"parent-child","created_at":"2025-11-25T19:56:22.605621-06:00","created_by":"erikjohansson"},{"issue_id":"dn-ct5","depends_on_id":"dn-9le","type":"blocks","created_at":"2025-11-25T19:56:24.514184-06:00","created_by":"erikjohansson"},{"issue_id":"dn-ct5","depends_on_id":"dn-7um","type":"blocks","created_at":"2025-11-25T19:56:24.546342-06:00","created_by":"erikjohansson"},{"issue_id":"dn-ct5","depends_on_id":"dn-6hz","type":"blocks","created_at":"2025-11-25T19:56:24.57798-06:00","created_by":"erikjohansson"}]}
{"id":"dn-cuv","content_hash":"db9e5df2049bf0755762b0ede952ae69ce0bd3c66a9f5d5eecb58a257e6b5bed","title":"Implement vault.delete() in storage-fs","description":"Add delete method to vault in packages/storage-fs/src/vault.ts.\n\n**Requirements:**\n- Add `delete(id: NoteId): Promise\u003cvoid\u003e` method to Vault class\n- Delete the note file from filesystem using fs.unlink\n- Handle errors gracefully (file not found, permission denied)\n- Consider what happens if file is locked/in use\n\n**File:** packages/storage-fs/src/vault.ts\n\n**Tests:** Add unit tests in packages/storage-fs/src/storage.test.ts\n- Delete existing note\n- Delete non-existent note (graceful handling)\n- Error scenarios\n\n**No dependencies - can start immediately**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:54:39.137542-06:00","updated_at":"2025-11-25T20:59:00.850102-06:00","closed_at":"2025-11-25T20:59:00.850102-06:00","source_repo":".","dependencies":[{"issue_id":"dn-cuv","depends_on_id":"dn-5t8","type":"parent-child","created_at":"2025-11-25T19:54:59.772991-06:00","created_by":"erikjohansson"}]}
{"id":"dn-dgb","content_hash":"5b045153f6e4bcd75f38e9aaf18a2d9d9cdedcfa4f0ad8de830c95572c804ee9","title":"Add notes.delete to preload API","description":"Add delete method to the notes preload API bridge.\n\n**Files to modify:**\n1. apps/desktop/electron/preload/src/preload.ts\n2. apps/desktop/renderer/src/types/scribe.d.ts\n\n**Requirements:**\n\n**Step 1: Update preload.ts (after line 35):**\n```typescript\n/**\n * Delete a note by ID\n */\ndelete: (id: NoteId): Promise\u003c{ success: boolean }\u003e =\u003e ipcRenderer.invoke('notes:delete', id),\n```\n\n**Step 2: Update scribe.d.ts (inside notes object, after create on line 11):**\n```typescript\ndelete: (id: NoteId) =\u003e Promise\u003c{ success: boolean }\u003e;\n```\n\n**No blocking dependencies - can start immediately**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:54:50.989539-06:00","updated_at":"2025-11-25T21:15:50.530737-06:00","closed_at":"2025-11-25T21:15:50.530737-06:00","source_repo":".","dependencies":[{"issue_id":"dn-dgb","depends_on_id":"dn-5t8","type":"parent-child","created_at":"2025-11-25T19:54:59.866755-06:00","created_by":"erikjohansson"}]}
{"id":"dn-dtt","content_hash":"33612bd992b4286b4aec4c7aa8d8f3741745a581f1da6e8116f5d003fc645e5e","title":"Add searchEngine.removeNote() method","description":"Add removeNote method to search engine in packages/engine-search/src/search-engine.ts.\n\n**Requirements:**\n- Add `removeNote(id: NoteId): void` method to SearchEngine class\n- Remove note from Fuse.js index\n- Should be idempotent (no error if note doesn't exist)\n\n**File:** packages/engine-search/src/search-engine.ts\n\n**Tests:** Add unit tests in packages/engine-search/src/search-engine.test.ts\n- Remove note that exists in index\n- Remove non-existent note (no-op)\n- Verify search no longer returns removed note\n\n**No dependencies - can start immediately**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:54:44.639608-06:00","updated_at":"2025-11-25T20:59:02.88586-06:00","closed_at":"2025-11-25T20:59:02.88586-06:00","source_repo":".","dependencies":[{"issue_id":"dn-dtt","depends_on_id":"dn-5t8","type":"parent-child","created_at":"2025-11-25T19:54:59.83578-06:00","created_by":"erikjohansson"}]}
{"id":"dn-gfi","content_hash":"6091863ee997bd34141e428607d98109f9bc9b57f9c6ae8bf93eb55bb2c0a430","title":"E2E: Delete via icon in file-browse mode flow","description":"Integration test for deleting a note via the delete icon in file-browse mode.\n\n**File:** apps/desktop/delete-note.integration.test.ts\n\n**Test Flow (Flow 5 from spec.md):**\n1. Create test vault with 3+ notes\n2. In file-browse mode, hover over a note (UI behavior)\n3. Click delete icon -\u003e opens confirmation\n4. Click Cancel -\u003e returns to file-browse (NOT delete-browse)\n5. Click delete icon again, then Delete -\u003e note deleted\n\n**This flow is primarily a UI test.** For integration testing:\n- Verify the underlying delete operation works\n- Verify graph/search cleanup\n- UI-specific behavior (hover, icon visibility) tested in component tests\n\n**Example test:**\n```typescript\nit('should delete note initiated from file-browse mode', async () =\u003e {\n  const note1 = await vault.create();\n  const note2 = await vault.create();\n  const note3 = await vault.create();\n  \n  // Engines should be populated\n  graphEngine.addNote(note1);\n  graphEngine.addNote(note2);\n  graphEngine.addNote(note3);\n  searchEngine.indexNote(note1);\n  searchEngine.indexNote(note2);\n  searchEngine.indexNote(note3);\n  \n  // Delete note2 (simulating delete icon click -\u003e confirm)\n  await vault.delete(note2.id);\n  graphEngine.removeNote(note2.id);\n  searchEngine.removeNote(note2.id);\n  \n  // Verify deletion\n  expect(vault.list()).toHaveLength(2);\n  expect(graphEngine.getStats().nodes).toBe(2);\n  expect(searchEngine.size()).toBe(2);\n});\n```\n\n**UI-specific tests (for CommandPalette.test.tsx):**\n- Delete icon hidden by default\n- Delete icon visible on hover\n- Click icon -\u003e confirmation screen\n- Click icon does NOT open note\n- Cancel returns to file-browse (not delete-browse)\n\n**Dependencies:**\n- Blocks on: All implementation tasks complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:57:10.060204-06:00","updated_at":"2025-11-25T21:42:55.277054-06:00","closed_at":"2025-11-25T21:42:55.277054-06:00","source_repo":".","dependencies":[{"issue_id":"dn-gfi","depends_on_id":"dn-tum","type":"parent-child","created_at":"2025-11-25T19:57:14.662137-06:00","created_by":"erikjohansson"},{"issue_id":"dn-gfi","depends_on_id":"dn-6ln","type":"blocks","created_at":"2025-11-25T19:57:16.255968-06:00","created_by":"erikjohansson"}]}
{"id":"dn-gg5","content_hash":"c186c0d19ca15dea45c04ff8942843dfb1d1898391a12fc8c583e4d50c0d406f","title":"Implement Toast component","description":"Create the Toast UI component with animations.\n\n**Files:**\n- apps/desktop/renderer/src/components/Toast/Toast.tsx\n- apps/desktop/renderer/src/components/Toast/Toast.css\n\n**Props Interface:**\n```typescript\nimport type { Toast } from '../../hooks/useToast';\n\ninterface ToastProps {\n  toasts: Toast[];\n  onDismiss: (id: string) =\u003e void;\n}\n```\n\n**Visual Specs (from spec.md):**\n- Position: fixed, bottom-center of viewport (bottom: 24px, left: 50%, transform: translateX(-50%))\n- Width: auto (content-based), max 400px\n- Stack vertically with 8px gap (flex-direction: column)\n- z-index: 2000 (above command palette)\n- Success style: neutral dark background (#1a1a1a), white text\n- Error style: red background (#dc3545), white text\n- Animation: slide up + fade in on enter, slide down + fade out on exit\n- Click to dismiss (cursor: pointer, pointer-events: auto)\n- Border radius: 8px, padding: 12px 16px, font-size: 14px\n\n**CSS Classes:**\n- .toast-container - fixed positioning container\n- .toast - individual toast styling with enter animation\n- .toast--error - red background override\n- .toast--exiting - exit animation (applied before removal)\n\n**Keyframe animations (see spec.md CSS section):**\n- toastSlideIn: translateY(16px) + opacity 0 -\u003e translateY(0) + opacity 1\n- toastSlideOut: reverse of above\n\n**Tests:** apps/desktop/renderer/src/components/Toast/Toast.test.tsx\n- Renders message text correctly\n- Applies default (success) styling\n- Applies .toast--error class for error type\n- Click triggers onDismiss with correct ID\n- Multiple toasts render stacked vertically\n- Correct ARIA attributes for accessibility\n\n**Dependencies:**\n- Blocks on: useToast hook (for Toast type import)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:55:20.875691-06:00","updated_at":"2025-11-25T21:18:09.391428-06:00","closed_at":"2025-11-25T21:18:09.391428-06:00","source_repo":".","dependencies":[{"issue_id":"dn-gg5","depends_on_id":"dn-9wc","type":"parent-child","created_at":"2025-11-25T19:55:29.838232-06:00","created_by":"erikjohansson"},{"issue_id":"dn-gg5","depends_on_id":"dn-beu","type":"blocks","created_at":"2025-11-25T19:55:29.902187-06:00","created_by":"erikjohansson"}]}
{"id":"dn-ldw","content_hash":"36bdeb9248a2cc303c8b19d6578e40e2a74f1c623e99905bb8acde0240e41019","title":"Add confirmation screen CSS styles","description":"Add CSS styles for the delete confirmation screen.\n\n**File:** apps/desktop/renderer/src/components/CommandPalette/CommandPalette.css\n\n**Add the following styles (from spec.md):**\n```css\n/* Delete Confirmation Screen */\n.delete-confirmation {\n  padding: 24px;\n  text-align: center;\n  animation: fadeIn 0.15s ease-out;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n.delete-confirmation-title {\n  font-size: 16px;\n  font-weight: 600;\n  margin-bottom: 8px;\n  color: var(--text-primary, #1a1a1a);\n}\n\n.delete-confirmation-message {\n  font-size: 14px;\n  color: var(--text-secondary, #666666);\n  margin-bottom: 20px;\n}\n\n.delete-confirmation-actions {\n  display: flex;\n  justify-content: center;\n  gap: 8px;\n}\n\n.delete-confirmation-cancel {\n  padding: 8px 16px;\n  border: 1px solid var(--border-color, #e0e0e0);\n  border-radius: 6px;\n  background: var(--bg-primary, #ffffff);\n  color: var(--text-primary, #1a1a1a);\n  cursor: pointer;\n  font-size: 14px;\n}\n\n.delete-confirmation-cancel:hover {\n  background: var(--bg-hover, #f5f5f5);\n}\n\n.delete-confirmation-cancel:focus {\n  outline: 2px solid var(--focus-ring, #0066cc);\n  outline-offset: 2px;\n}\n\n.delete-confirmation-confirm {\n  padding: 8px 16px;\n  border: none;\n  border-radius: 6px;\n  background: #dc3545;\n  color: #ffffff;\n  cursor: pointer;\n  font-size: 14px;\n}\n\n.delete-confirmation-confirm:hover {\n  background: #c82333;\n}\n\n.delete-confirmation-confirm:focus {\n  outline: 2px solid #dc3545;\n  outline-offset: 2px;\n}\n```\n\n**Notes:**\n- Uses CSS custom properties for theming where possible\n- Added fadeIn animation (0.15s ease-out per spec)\n- Added focus styles for accessibility\n- Consider checking if any CSS custom properties exist in the file already\n\n**No blocking dependencies - can be done in parallel with TSX work**","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:56:07.38087-06:00","updated_at":"2025-11-25T21:15:50.630724-06:00","closed_at":"2025-11-25T21:15:50.630724-06:00","source_repo":".","dependencies":[{"issue_id":"dn-ldw","depends_on_id":"dn-sul","type":"parent-child","created_at":"2025-11-25T19:56:22.573943-06:00","created_by":"erikjohansson"}]}
{"id":"dn-miq","content_hash":"fd082e4f2653f8b27410abe6de9479e46513e50fcf30e7f162951c577e4741b5","title":"Add graphEngine.removeNote() method","description":"Add removeNote method to graph engine in packages/engine-graph/src/graph-engine.ts.\n\n**Requirements:**\n- Add `removeNote(id: NoteId): void` method to GraphEngine class\n- Remove note from internal graph data structure\n- Clean up any edges/links referencing this note\n- Should be idempotent (no error if note doesn't exist)\n\n**File:** packages/engine-graph/src/graph-engine.ts\n\n**Tests:** Add unit tests in packages/engine-graph/src/graph-engine.test.ts\n- Remove note that exists in graph\n- Remove note with links to/from other notes\n- Remove non-existent note (no-op)\n\n**No dependencies - can start immediately**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:54:42.692737-06:00","updated_at":"2025-11-25T20:59:01.981746-06:00","closed_at":"2025-11-25T20:59:01.981746-06:00","source_repo":".","dependencies":[{"issue_id":"dn-miq","depends_on_id":"dn-5t8","type":"parent-child","created_at":"2025-11-25T19:54:59.804614-06:00","created_by":"erikjohansson"}]}
{"id":"dn-nrk","content_hash":"2956435e9634bcd4ea393342762ee386feb0a6a1169d59eba80d96e6d2d411bf","title":"Delete Note Feature","description":"Epic: Add a Delete Note command that allows users to permanently delete notes from the vault. Includes command palette integration, confirmation modal, toast notifications, and delete icon in file-browse mode. See features/delete-note/spec.md for full specification.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-25T19:54:10.121182-06:00","updated_at":"2025-11-25T21:43:44.016598-06:00","closed_at":"2025-11-25T21:43:44.016598-06:00","source_repo":"."}
{"id":"dn-qio","content_hash":"61066ea0bc208883bd7175c955d368ed7a4f8f177ec9459040c873efea91b605","title":"Fix race condition in handleDeleteConfirm using stale allNotes state","description":"In CommandPalette.tsx:156-162, handleDeleteConfirm uses allNotes from React state to find remaining notes after deletion. This state is stale at the point of use - if the vault changed (e.g., another deletion), this logic could select a deleted note or miss a newer one.\n\nCurrent code:\n```typescript\nconst remainingNotes = allNotes.filter((n) =\u003e n.id !== noteId);\nif (wasCurrentNote) {\n  if (remainingNotes.length \u003e 0) {\n    const mostRecent = remainingNotes.sort((a, b) =\u003e b.updatedAt - a.updatedAt)[0];\n    await noteState.loadNote(mostRecent.id);\n```\n\nFix: Either refetch notes after deletion, or move 'load next note' logic to useNoteState hook where it has access to actual vault state. Consider extending deleteNote signature: deleteNote(id: NoteId, loadNext?: boolean)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-26T00:00:13.460081-06:00","updated_at":"2025-11-26T06:47:41.629971-06:00","closed_at":"2025-11-26T06:47:41.629971-06:00","source_repo":"."}
{"id":"dn-r58","content_hash":"78a03e351693989bc8e1fb0a550a949f0bf2bb58f6051f0ea6d81f2ce68a5d54","title":"Register Delete Note command","description":"Register the Delete Note command in App.tsx.\n\n**File:** apps/desktop/renderer/src/App.tsx\n\n**Add in useEffect (around line 85, after 'show-backlinks' command):**\n```typescript\n// Command: Delete Note\ncommandRegistry.register({\n  id: 'delete-note',\n  title: 'Delete Note',\n  description: 'Permanently delete a note',\n  keywords: ['remove', 'trash', 'destroy'],\n  group: 'notes',\n  closeOnSelect: false, // Keep palette open for file selection + confirmation\n  run: async () =\u003e {\n    setPaletteMode('delete-browse');\n  },\n});\n```\n\n**Notes:**\n- Follow existing pattern from 'open-note' command (lines 46-58)\n- closeOnSelect: false keeps palette open to show delete-browse mode\n- The actual deletion logic will be in CommandPalette component\n\n**Dependencies:**\n- Blocks on: PaletteMode type update (dn-6nr) - needs 'delete-browse' mode","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-25T19:55:42.623546-06:00","updated_at":"2025-11-25T21:18:09.423645-06:00","closed_at":"2025-11-25T21:18:09.423645-06:00","source_repo":".","dependencies":[{"issue_id":"dn-r58","depends_on_id":"dn-sul","type":"parent-child","created_at":"2025-11-25T19:56:22.446377-06:00","created_by":"erikjohansson"},{"issue_id":"dn-r58","depends_on_id":"dn-6nr","type":"blocks","created_at":"2025-11-25T19:56:24.353296-06:00","created_by":"erikjohansson"}]}
{"id":"dn-rd4","content_hash":"c944ab8865b246263b5ea3c0f9400c9448a473ec469d090d6c5838cfdfced3c9","title":"E2E: Delete note via command palette flow","description":"Integration test for deleting a note through the command palette.\n\n**File:** apps/desktop/delete-note.integration.test.ts (new file)\n\n**Test Flow (Flow 1 from spec.md):**\n1. Create test vault with 3+ notes\n2. Simulate Cmd+K opening command palette\n3. Select 'Delete Note' command -\u003e enters delete-browse mode\n4. Verify note list is displayed (excluding current note)\n5. Select a note (keyboard or click) -\u003e enters delete-confirm mode\n6. Verify confirmation screen shows correct note title\n7. Click 'Delete' button\n8. Verify:\n   - Note is deleted from vault (vault.list() doesn't include it)\n   - Success toast appears with note title\n   - Palette closes\n\n**Testing approach:**\nFollow existing pattern from mvp.integration.test.ts:\n- Use temporary directory for test vault\n- Create FileSystemVault, GraphEngine, SearchEngine instances\n- Simulate the deletion flow at the engine level\n- For UI testing, consider using @testing-library/react for component tests\n\n**Example test structure:**\n```typescript\ndescribe('Delete Note Flow', () =\u003e {\n  it('should delete a note via command palette flow', async () =\u003e {\n    // Setup: Create 3 notes\n    const note1 = await vault.create();\n    const note2 = await vault.create();\n    const note3 = await vault.create();\n    \n    // Add content to note2 to make it identifiable\n    note2.content = { root: { type: 'root', children: [\n      { type: 'paragraph', children: [{ type: 'text', text: 'Note To Delete' }] }\n    ]}};\n    await vault.save(note2);\n    graphEngine.addNote(note2);\n    searchEngine.indexNote(note2);\n    \n    // Action: Delete note2\n    await vault.delete(note2.id);\n    graphEngine.removeNote(note2.id);\n    searchEngine.removeNote(note2.id);\n    \n    // Assert: Note no longer exists\n    const remainingNotes = vault.list();\n    expect(remainingNotes).toHaveLength(2);\n    expect(remainingNotes.find(n =\u003e n.id === note2.id)).toBeUndefined();\n  });\n});\n```\n\n**Dependencies:**\n- Blocks on: All implementation tasks complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:57:01.098497-06:00","updated_at":"2025-11-25T21:42:54.870616-06:00","closed_at":"2025-11-25T21:42:54.870616-06:00","source_repo":".","dependencies":[{"issue_id":"dn-rd4","depends_on_id":"dn-tum","type":"parent-child","created_at":"2025-11-25T19:57:14.531469-06:00","created_by":"erikjohansson"},{"issue_id":"dn-rd4","depends_on_id":"dn-ct5","type":"blocks","created_at":"2025-11-25T19:57:16.093156-06:00","created_by":"erikjohansson"},{"issue_id":"dn-rd4","depends_on_id":"dn-6ln","type":"blocks","created_at":"2025-11-25T19:57:16.125483-06:00","created_by":"erikjohansson"}]}
{"id":"dn-sul","content_hash":"7df3119006d482353bcb05df9c94c27ff1c7f02ccc7c5369148bb76a84791caa","title":"Frontend: Delete Browse Mode \u0026 Confirmation","description":"Sub-epic: Implement the delete-browse palette mode and confirmation screen UI. Depends on backend IPC and toast system.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-25T19:54:19.049996-06:00","updated_at":"2025-11-25T21:43:43.776202-06:00","closed_at":"2025-11-25T21:43:43.776202-06:00","source_repo":".","dependencies":[{"issue_id":"dn-sul","depends_on_id":"dn-nrk","type":"parent-child","created_at":"2025-11-25T19:54:26.762207-06:00","created_by":"erikjohansson"}]}
{"id":"dn-tum","content_hash":"74b1ff173a5d6733dd405f0471a35fcc89541dc8edde34b2a595d37926550ec1","title":"Testing: Delete Note Integration \u0026 E2E","description":"Sub-epic: Integration and E2E tests for the complete delete note feature. Depends on all implementation work being complete.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-25T19:54:21.764397-06:00","updated_at":"2025-11-25T21:43:43.926144-06:00","closed_at":"2025-11-25T21:43:43.926144-06:00","source_repo":".","dependencies":[{"issue_id":"dn-tum","depends_on_id":"dn-nrk","type":"parent-child","created_at":"2025-11-25T19:54:26.824326-06:00","created_by":"erikjohansson"}]}
{"id":"dn-uei","content_hash":"82b57ad10ea1d2b3eb3c7e2d405de0d30a958dad80e24785f9b88d76f87672a3","title":"Memoize recentNotes computation in CommandPalette","description":"In CommandPalette.tsx:287-290, recentNotes is computed on every render without memoization:\n\n```typescript\nconst recentNotes = allNotes\n  .filter((note) =\u003e note.id !== currentNoteId)\n  .sort((a, b) =\u003e b.updatedAt - a.updatedAt)\n  .slice(0, MAX_RECENT_NOTES);\n```\n\nWhile the sort doesn't mutate allNotes (filter creates a new array), this computation runs on every render unnecessarily.\n\nFix: Wrap in useMemo with [allNotes, currentNoteId] dependencies, similar to how fuseIndex is already memoized.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-26T00:00:25.94337-06:00","updated_at":"2025-11-26T06:47:42.944781-06:00","closed_at":"2025-11-26T06:47:42.944781-06:00","source_repo":"."}
{"id":"dn-yhn","content_hash":"6d3d1e4d999a005aeffa0a7cd7d880c29c8d0dc6988183f7a04366ad30eec22d","title":"Add aria-live attribute to Toast container for screen reader support","description":"In Toast.tsx:22, the toast container lacks aria-live attribute for proper screen reader announcements.\n\nCurrent code:\n```tsx\n\u003cdiv className=\"toast-container\"\u003e\n  {toasts.map((toast) =\u003e (\n    \u003cdiv ... role=\"alert\"\u003e\n```\n\nWhile individual toasts have role=\"alert\", adding aria-live to the container ensures screen readers announce new toasts as they appear.\n\nFix: Add aria-live=\"polite\" to the container:\n```tsx\n\u003cdiv className=\"toast-container\" aria-live=\"polite\"\u003e\n```\n\nNote: role=\"alert\" on children already implies aria-live=\"assertive\", but having it on the container with \"polite\" provides a fallback and clearer semantics for the container's purpose.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-26T00:00:37.640302-06:00","updated_at":"2025-11-26T06:47:44.702816-06:00","closed_at":"2025-11-26T06:47:44.702816-06:00","source_repo":"."}
{"id":"dn-z00","content_hash":"6ed38fd0d492e18330f6e43f438baa952952b4af5191547e066fcae41fe3be59","title":"Add delete icon CSS styles for file-browse mode","description":"Add CSS styles for the delete icon on note items in file-browse mode.\n\n**File:** apps/desktop/renderer/src/components/CommandPalette/CommandPalette.css\n\n**Add the following styles (from spec.md):**\n```css\n/* Delete Icon on Note Items */\n.command-palette-item {\n  position: relative;\n}\n\n.note-item-delete-icon {\n  position: absolute;\n  right: 12px;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  cursor: pointer;\n  opacity: 0;\n  transition: opacity 0.15s ease;\n  color: var(--text-tertiary, #999999);\n  background: transparent;\n  border: none;\n  padding: 0;\n}\n\n.command-palette-item:hover .note-item-delete-icon {\n  opacity: 1;\n}\n\n/* Hide delete icon when item is keyboard-selected */\n.command-palette-item.selected .note-item-delete-icon {\n  opacity: 0;\n}\n\n.note-item-delete-icon:hover {\n  color: #dc3545;\n  background-color: rgba(220, 53, 69, 0.1);\n}\n\n.note-item-delete-icon svg {\n  width: 16px;\n  height: 16px;\n}\n```\n\n**Notes:**\n- Uses button element for accessibility (can be focused)\n- Icon hidden by default (opacity: 0)\n- Icon visible on note item hover\n- Icon hidden when item is keyboard-selected (.selected class)\n- Icon turns red with subtle background on direct hover\n- 24px clickable area, 16px icon\n\n**Consider checking for existing .command-palette-item styles and merge appropriately.**\n\n**No blocking dependencies - can be done in parallel with TSX work**","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-25T19:56:38.205215-06:00","updated_at":"2025-11-25T21:36:39.971389-06:00","closed_at":"2025-11-25T21:36:39.971389-06:00","source_repo":".","dependencies":[{"issue_id":"dn-z00","depends_on_id":"dn-bh6","type":"parent-child","created_at":"2025-11-25T19:56:49.292318-06:00","created_by":"erikjohansson"}]}
